[
	{
		"desc": "parserTests"
	},
	{
		"desc": "Simple paragraph",
		"wikitext": "This is a simple paragraph.",
		"parsed": "This is a simple paragraph."
	},
	{
		"desc": "Paragraphs with extra newline spacing",
		"wikitext": "a\n\nb (+2 nls)\n\n\nc (+3 nls)\n\n\n\nd (+4 nls)\n\n\n\n\ne (+5 nls)",
		"parsed": "ab (+2 nls)c (+3 nls)d (+4 nls)e (+5 nls)"
	},
	{
		"desc": "Paragraphs with newline spacing with comment lines in between",
		"wikitext": "----\na\n<!--foo-->\nb\n----\na\n<!--foo--><!--More than 1 comment, still stripped-->\nb\n----\na\n <!--foo--> <!----> <!-- bar --> \nb\n----\na\n<!--foo-->\n\nb\n----\na\n\n<!--foo-->\nb\n----\na\n<!--foo-->\n\n\nb\n----\na\n\n\n<!--foo-->\nb\n----",
		"parsed": "<hr>----</>a<comment>&lt;!--foo--&gt</>b<hr>----</>a<comment>&lt;!--foo--&gt&lt;!--More than 1 comment, still stripped--&gt</>b<hr>----</>a<skipformatting> </><comment>&lt;!--foo--&gt</> <comment>&lt;!----&gt</> <comment>&lt;!-- bar --&gt</> b<hr>----</>a<comment>&lt;!--foo--&gt</>b<hr>----</>a<comment>&lt;!--foo--&gt</>b<hr>----</>a<comment>&lt;!--foo--&gt</>b<hr>----</>a<comment>&lt;!--foo--&gt</>b<hr>----</>"
	},
	{
		"desc": "Paragraphs with newline spacing with non-empty white-space lines in between",
		"wikitext": "----\na\n \nb\n----\na\n \n \nb\n----",
		"parsed": "<hr>----</>a<skipformatting> </>b<hr>----</>a<skipformatting>  </>b<hr>----</>"
	},
	{
		"desc": "Paragraphs with newline spacing with non-empty mixed comment and white-space lines in between",
		"wikitext": "----\na\n <!--foo-->\nb\n----\na\n <!--foo--><!--More than 1 comment doesn't disable stripping of this line!-->\nb\n----\na\n \n<!--foo-->\n <!--bar-->\nb\n----\na\n \n <!--foo-->\n <!--bar-->\n \nb\n----",
		"parsed": "<hr>----</>a<skipformatting> </><comment>&lt;!--foo--&gt</>b<hr>----</>a<skipformatting> </><comment>&lt;!--foo--&gt&lt;!--More than 1 comment doesn't disable stripping of this line!--&gt</>b<hr>----</>a<skipformatting> </><comment>&lt;!--foo--&gt</><skipformatting> </><comment>&lt;!--bar--&gt</>b<hr>----</>a<skipformatting>  </><comment>&lt;!--foo--&gt</><skipformatting> </><comment>&lt;!--bar--&gt</><skipformatting> </>b<hr>----</>"
	},
	{
		"desc": "Extra newlines: More paragraphs with indented comment",
		"wikitext": "a\n\n   <!--boo-->\n\nb",
		"parsed": "a<skipformatting> </>  <comment>&lt;!--boo--&gt</>b"
	},
	{
		"desc": "Extra new lines before and after lists are preserved",
		"wikitext": "a\n\n\n*b\n\n\nc",
		"parsed": "a<list>*</>bc"
	},
	{
		"desc": "Multiple newlines after tables are converted to p-br-p tags",
		"wikitext": "{|\n|x\n|}\n\n\n\n\n=b=",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>x</><table-bracket>|}</><section-header section--1>=</><section>b</><section-header>=</>"
	},
	{
		"desc": "Parsing an URL",
		"wikitext": "http://fr.wikipedia.org/wiki/🍺\n<!-- EasterEgg we love beer, better be able be able to link to it -->",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>fr.wikipedia.org/wiki/🍺</><comment>&lt;!-- EasterEgg we love beer, better be able be able to link to it --&gt</>"
	},
	{
		"desc": "Simple list",
		"wikitext": "*Item 1\n*Item 2",
		"parsed": "<list>*</>Item 1<list>*</>Item 2"
	},
	{
		"desc": "Non-html5 tags should be accepted",
		"wikitext": "<center>''foo''</center>\n<big>''foo''</big>\n<font style=\"123\">''foo''</font>\n<strike>''foo''</strike>\n<tt>''foo''</tt>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>center</><htmltag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>center</><htmltag-bracket>&gt&lt;</><htmltag-name>big</><htmltag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>big</><htmltag-bracket>&gt&lt;</><htmltag-name>font </><htmltag-attribute html-font>style=</><htmltag-attribute-value>\"123\"</><htmltag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt&lt;</><htmltag-name>strike</><htmltag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>strike</><htmltag-bracket>&gt&lt;</><htmltag-name>tt</><htmltag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>tt</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "<wbr> is valid wikitext (T54468)",
		"wikitext": "<wbr>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>wbr</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "<s> or <strike> for strikethrough",
		"wikitext": "<strike>strike</strike>\n\n<s>s</s>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>strike</><htmltag-bracket>&gt</>strike<htmltag-bracket>&lt;/</><htmltag-name>strike</><htmltag-bracket>&gt&lt;</><htmltag-name>s</><htmltag-bracket>&gt</>s<htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Text-level semantic html elements in wikitext",
		"wikitext": "<em>text</em>\n<strong>text</strong>\n<small>text</small>\n<s>text</s>\n<cite>text</cite>\n<q>text</q>\n<dfn>text</dfn>\n<abbr>text</abbr>\n<data>text</data>\n<time>text</time>\n<code>text</code>\n<var>text</var>\n<samp>text</samp>\n<kbd>text</kbd>\n<sub>text</sub>\n<u>text</u>\n<mark>text</mark>\n<ruby><rb>明日</rb><rp>(</rp><rt>Ashita</rt><rp> </rp><rtc>あした</rtc><rp>)</rp></ruby>\n<bdi>text</bdi>\n<bdo>text</bdo>\n<span>text</span>\n<wbr />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>em</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>em</><htmltag-bracket>&gt&lt;</><htmltag-name>strong</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>strong</><htmltag-bracket>&gt&lt;</><htmltag-name>small</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt&lt;</><htmltag-name>s</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt&lt;</><htmltag-name>cite</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>cite</><htmltag-bracket>&gt&lt;</><htmltag-name>q</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>q</><htmltag-bracket>&gt&lt;</><htmltag-name>dfn</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>dfn</><htmltag-bracket>&gt&lt;</><htmltag-name>abbr</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>abbr</><htmltag-bracket>&gt&lt;</><htmltag-name>data</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>data</><htmltag-bracket>&gt&lt;</><htmltag-name>time</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>time</><htmltag-bracket>&gt&lt;</><htmltag-name>code</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>code</><htmltag-bracket>&gt&lt;</><htmltag-name>var</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>var</><htmltag-bracket>&gt&lt;</><htmltag-name>samp</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>samp</><htmltag-bracket>&gt&lt;</><htmltag-name>kbd</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>kbd</><htmltag-bracket>&gt&lt;</><htmltag-name>sub</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>sub</><htmltag-bracket>&gt&lt;</><htmltag-name>u</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>u</><htmltag-bracket>&gt&lt;</><htmltag-name>mark</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>mark</><htmltag-bracket>&gt&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>明日<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rp</><htmltag-bracket>&gt</>(<htmltag-bracket>&lt;/</><htmltag-name>rp</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Ashita<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rp</><htmltag-bracket>&gt</> <htmltag-bracket>&lt;/</><htmltag-name>rp</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc</><htmltag-bracket>&gt</>あした<htmltag-bracket>&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rp</><htmltag-bracket>&gt</>)<htmltag-bracket>&lt;/</><htmltag-name>rp</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt&lt;</><htmltag-name>bdi</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>bdi</><htmltag-bracket>&gt&lt;</><htmltag-name>bdo</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>bdo</><htmltag-bracket>&gt&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>text<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>wbr </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "Ruby markup (W3C-style)",
		"wikitext": ";Mono-ruby for individual base characters\n:<ruby>日<rt>に</rt>本<rt>ほん</rt>語<rt>ご</rt></ruby>\n;Group ruby\n:<ruby>今日<rt>きょう</rt></ruby>\n;Jukugo ruby\n:<ruby>法<rb>華</rb><rb>経</rb><rt>ほ</rt><rt>け</rt><rt>きょう</rt></ruby>\n;Inline ruby\n:<ruby>東<rb>京</rb><rp>(</rp><rt>とう</rt><rt>きょう</rt><rp>)</rp></ruby>\n;Double-sided ruby\n:<ruby><rb>旧</rb><rb>金</rb><rb>山</rb><rt>jiù</rt><rt>jīn</rt><rt>shān</rt><rtc>San Francisco</rtc></ruby>\n\n<ruby>\n<rb>♥</rb><rtc><rt>Heart</rt></rtc><rtc lang=\"fr\"><rt>Cœur</rt></rtc>\n<rb>☘</rb><rtc><rt>Shamrock</rt></rtc><rtc lang=\"fr\"><rt>Trèfle</rt></rtc>\n<rb>✶</rb><rtc><rt>Star</rt></rtc><rtc lang=\"fr\"><rt>Étoile</rt></rtc>\n</ruby>",
		"parsed": "<list>;</><strong>Mono-ruby for individual base characters</><list>:</><htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>日<htmltag-bracket>&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>に<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt</>本<htmltag-bracket>&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>ほん<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt</>語<htmltag-bracket>&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>ご<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</><list>;</><strong>Group ruby</><list>:</><htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>今日<htmltag-bracket>&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>きょう<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</><list>;</><strong>Jukugo ruby</><list>:</><htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>法<htmltag-bracket>&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>華<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>経<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>ほ<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>け<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>きょう<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</><list>;</><strong>Inline ruby</><list>:</><htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>東<htmltag-bracket>&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>京<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rp</><htmltag-bracket>&gt</>(<htmltag-bracket>&lt;/</><htmltag-name>rp</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>とう<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>きょう<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rp</><htmltag-bracket>&gt</>)<htmltag-bracket>&lt;/</><htmltag-name>rp</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</><list>;</><strong>Double-sided ruby</><list>:</><htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>旧<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>金<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>山<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>jiù<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>jīn<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>shān<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc</><htmltag-bracket>&gt</>San Francisco<htmltag-bracket>&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>♥<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Heart<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc </><htmltag-attribute html-rtc>lang=</><htmltag-attribute-value>\"fr\"</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Cœur<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>☘<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Shamrock<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc </><htmltag-attribute html-rtc>lang=</><htmltag-attribute-value>\"fr\"</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Trèfle<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rb</><htmltag-bracket>&gt</>✶<htmltag-bracket>&lt;/</><htmltag-name>rb</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Star<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;</><htmltag-name>rtc </><htmltag-attribute html-rtc>lang=</><htmltag-attribute-value>\"fr\"</><htmltag-bracket>&gt&lt;</><htmltag-name>rt</><htmltag-bracket>&gt</>Étoile<htmltag-bracket>&lt;/</><htmltag-name>rt</><htmltag-bracket>&gt&lt;/</><htmltag-name>rtc</><htmltag-bracket>&gt&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Non-word characters don't terminate tag names (T19663, T42670, T54022)",
		"wikitext": "<blockquote|>a</blockquote>\n\n<b→> doesn't terminate </b→>\n\n<bä> doesn't terminate </bä>\n\n<boo> doesn't terminate </boo>\n\n<s.foo> doesn't terminate </s.foo>\n\n<sub-ID#1>",
		"parsed": "<blockquote|>a<error>&lt;/blockquote&gt</><b→> doesn't terminate </b→><bä> doesn't terminate </bä><boo> doesn't terminate </boo><s.foo> doesn't terminate </s.foo><sub-ID#1>"
	},
	{
		"desc": "Isolated close tags should be treated as literal text (T54760)",
		"wikitext": "</b>\n\n<s.foo>s</s>",
		"parsed": "<error>&lt;/b&gt</><s.foo>s<error>&lt;/s&gt</>"
	},
	{
		"desc": "Self-closed tag hooks",
		"wikitext": "<pre />\n<gallery />\n<indicator name=\"something\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-bracket>/&gt&lt;</><exttag-name>gallery </><exttag-bracket>/&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"something\"</><exttag-attribute ext-indicator> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Bare pipe character (T54363)",
		"wikitext": "|",
		"parsed": "|"
	},
	{
		"desc": "Bare pipe character from a template (T54363)",
		"wikitext": "{{pipe}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>pipe</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Implicit newline insertion/sol when expanding templates (T241150/T14974/T2529)",
		"wikitext": "{{1x|#foo}}{{1x|#foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>#foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>#foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "<nowiki> unordered list",
		"wikitext": "<nowiki>* This is not an unordered list item.</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>* This is not an unordered list item.</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<nowiki> spacing",
		"wikitext": "<nowiki>Lorem ipsum dolor\n\nsed abit.\n  sed nullum.\n\n:and a colon\n</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>Lorem ipsum dolorsed abit.  sed nullum.:and a colon</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Don't parse <nowiki><span class=\"error\"></nowiki> (T149622)",
		"wikitext": "<nowiki><span class=\"error\"></nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;span class=\"error\"&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "nowiki 3",
		"wikitext": ":There is not nowiki.\n:There is <nowiki>nowiki</nowiki>.\n\n#There is not nowiki.\n#There is <nowiki>nowiki</nowiki>.\n\n*There is not nowiki.\n*There is <nowiki>nowiki</nowiki>.",
		"parsed": "<list>:</>There is not nowiki.<list>:</>There is <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>nowiki</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>.<list>#</>There is not nowiki.<list>#</>There is <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>nowiki</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>.<list>*</>There is not nowiki.<list>*</>There is <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>nowiki</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>."
	},
	{
		"desc": "Entities inside <nowiki>",
		"wikitext": "<nowiki>&lt;</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki entity>&amp;lt;</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Entities inside template parameters",
		"wikitext": "{{1x|&ndash;}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground entity>&amp;ndash;</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Properly escape nowiki when combined with other wiki markup",
		"wikitext": "<nowiki>*</nowiki> <nowiki>&lt;/nowiki&gt;</nowiki> tag",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki entity>&amp;lt;</><tag-nowiki>/nowiki</><tag-nowiki entity>&amp;gt;</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> tag"
	},
	{
		"desc": "T93824: Put escaped HTML tags inside nowiki",
		"wikitext": "<nowiki><h2>foo</h2></nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;h2&gtfoo&lt;/h2&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T71950: 1. Put nowiki as close to cause as possible, even with non-quote escapable chars",
		"wikitext": "This text: L'[[Foo]]\nThis text: L<nowiki>''</nowiki>[[Foo]]\nThis text: L<nowiki>'''</nowiki>[[Foo]]<nowiki>''</nowiki>",
		"parsed": "This text: L'<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>This text: L<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>This text: L<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>'''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T71950: 2. Put nowiki as close to cause as possible, after ' :'",
		"wikitext": "This text : L<nowiki>''</nowiki>[[Foo]]",
		"parsed": "This text : L<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T71482: Use {{!}} instead of nowiki for single pipe in template argument",
		"wikitext": "{{1x|foo{{!}}bar}}\n{{1x|<nowiki>foo|bar |[[</nowiki>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>bar</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>foo|bar |[[</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T53961: Output correct nowikis in template arguments",
		"wikitext": "{{1x|a [ b}}\n{{1x|<nowiki>a }} b</nowiki>}}\n{{1x|<nowiki>a [[ b</nowiki>}}\n{{1x|<nowiki>a | {{ ]]</nowiki>}}\n{{1x|a <nowiki>}</nowiki>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a [ b</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>a }} b</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>a [[ b</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>a | {{ ]]</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a </><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>}</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Cases where \"!!\" needs nowiki protection",
		"wikitext": "{|\n!<nowiki>this needs protection !! here</nowiki>\n|}\n\n{|\n!this does not need\nprotection !! here\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>this needs protection !! here</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-bracket>|}{|</><table-delimiter>!</><table-th>this does not needprotection !! here</><table-bracket>|}</>"
	},
	{
		"desc": "Nowiki with newlines in list",
		"wikitext": ":<nowiki>test\n123</nowiki>",
		"parsed": "<list>:</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>test123</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Nowiki and french spacing",
		"wikitext": "<nowiki>test : 123</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>test : 123</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T255007: French spacing in raw text elements",
		"wikitext": "<html>\n<script>test ; 123</script>\n<style>test : 123</style>\n</html>",
		"parsed": "<html><script>test ; 123</script><style>test : 123</style></html>"
	},
	{
		"desc": "French spacing and spans",
		"wikitext": "[[Test]] : <span>123</span>\n« Test »<span>123</span>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</> : <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>123<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>« Test »<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>123<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "post-expand include size being exceeded",
		"wikitext": "{{3x_on_newline|1234567890}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>3x_on_newline</><template-ground template-delimiter>|</><template-ground template>1234567890</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "max template depth being reached",
		"wikitext": "{{1x with depth|too deep!}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x with depth</><template-ground template-delimiter>|</><template-ground template>too deep!</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "multiple templates that are redirects",
		"wikitext": "{{redirect to foo}}\n{{redirect to foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>redirect to foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>redirect to foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T53086: Double newlines in blockquotes should be turned into paragraphs",
		"wikitext": "<blockquote>\nFoo\n\nBar\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>FooBar<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T17491: <ins>/<del> in blockquote",
		"wikitext": "<blockquote>\nFoo <del>bar</del> <ins>baz</ins> quux\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Foo <htmltag-bracket>&lt;</><htmltag-name>del</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>del</><htmltag-bracket>&gt</> <htmltag-bracket>&lt;</><htmltag-name>ins</><htmltag-bracket>&gt</>baz<htmltag-bracket>&lt;/</><htmltag-name>ins</><htmltag-bracket>&gt</> quux<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T17491: <ins>/<del> in blockquote (2)",
		"wikitext": "<blockquote>Foo <del>bar</del> <ins>baz</ins> quux\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Foo <htmltag-bracket>&lt;</><htmltag-name>del</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>del</><htmltag-bracket>&gt</> <htmltag-bracket>&lt;</><htmltag-name>ins</><htmltag-bracket>&gt</>baz<htmltag-bracket>&lt;/</><htmltag-name>ins</><htmltag-bracket>&gt</> quux<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Don't paragraph-wrap empty newlines between HTML list items",
		"wikitext": "<ol>\n<li>foo</li>\n\n\n\n<li>foo</li>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: Strip leading and trailing whitespace from named-param values",
		"wikitext": "{{1x|1= a }}\n\n{{1x|1= {{1x|b}} }}\n\n{{1x| 1 =\n c }}\n\n{{1x| 1 =\n* d\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template> a </><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template> </><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>b</><template2-ground template-bracket>}}</><template-ground template-bracket> }}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name> 1 =</><template-ground template> c </><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name> 1 =</><template-ground list>*</><template-ground template> d</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Don't strip whitespace from positional-param values",
		"wikitext": "{{1x|a }}\n\n{{1x|{{1x|b}} }}\n\n{{1x| c \n}}\n\n{{1x| {{1x|d}}\n}}\n\n{{1x|\n e}}\n\n{{1x|\n*f}}\n\n{{1x|\n }}g",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a </><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>b</><template2-ground template-bracket>}}</><template-ground template-bracket> }}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> c </><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> </><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>d</><template2-ground template-bracket>}}</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> e</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground list>*</><template-ground template>f</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket> }}</>g"
	},
	{
		"desc": "Templates: Don't recognize targets split by newlines",
		"wikitext": "{{ech\no|foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>ech</>o|foo}}"
	},
	{
		"desc": "Templates: Recognize targets when newlines and comments don't split the target",
		"wikitext": "{{  \n <!--X--> 1<!--X-->x<!--X-->  \n   <!--X-->   <!--X-->\n\n |foo}}",
		"parsed": "<template-ground template-bracket>{{  </><template-ground comment> &lt;!--X--&gt</><template-ground> </><template-ground template-name pagename>1</><template-ground comment>&lt;!--X--&gt</><template-ground template-name pagename>x</><template-ground comment>&lt;!--X--&gt</><template-ground>  </><template-ground comment>   &lt;!--X--&gt   &lt;!--X--&gt</><template-ground template-delimiter> |</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Target with an extension tag",
		"wikitext": "{{{{1x|1x}}<nowiki>hi</nowiki>|ho}}",
		"parsed": "<template-ground template-bracket>{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>1x</><template2-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>hi</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>|ho}}"
	},
	{
		"desc": "Templates: Handle empty comment-and-ws-only lines correctly",
		"wikitext": "{{1x|foo\n<!--should be ignored-->\n <!--should be ignored as well-->\nbar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground comment>&lt;!--should be ignored--&gt</><template-ground template> </><template-ground comment>&lt;!--should be ignored as well--&gt</><template-ground template>bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Handle comments in the target",
		"wikitext": "{{1x\n<!-- should be ignored -->\n|foo}}\n\n{{1x\n<!-- should be ignored and spaces on next line should not trip us up (T147742) -->\n  |foo}}\n\n{{1x<!-- should be ignored -->\n|foo}}\n\n{{1x<!-- should be ignored -->|foo}}\n\n{{<!-- should be ignored -->1x|foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground comment>&lt;!-- should be ignored and spaces on next line should not trip us up (T147742) --&gt</><template-ground template-delimiter>  |</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Handle comments in parameter names (T69657)",
		"wikitext": "{{1x|1\n<!-- should be ignored -->\n=foo}}\n\n{{1x|\n<!-- should be ignored -->\n1 = foo}}\n\n{{1x|1<!-- should be ignored -->=foo}}\n\n{{1x|<!-- should be ignored -->1=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>1</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-argument-name>=</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-argument-name>1 =</><template-ground template> foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-argument-name>=</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground comment>&lt;!-- should be ignored --&gt</><template-ground template-argument-name>1=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Other wikitext in parameter names (T69657)",
		"wikitext": "{{1x|''1''=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>''1''=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: With colons",
		"wikitext": "{{With: Colon}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>With: Colon</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Parsoid parameter escaping test 1",
		"wikitext": "{{1x|[foo]|{{1x|[bar]}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>[foo]</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>[bar]</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Pipes in external links in template parameter",
		"wikitext": "{{1x|[{{1x|http://example.com}} link]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>[</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>http://example.com</><template2-ground template-bracket>}}</><template-ground template> link]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: pipe in transclusion parameter",
		"wikitext": "{{1x|http://foo.com/a&#124;b}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>http://foo.com/a</><template-ground entity>&amp;#124;</><template-ground template>b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Pipe in external link target and content in template parameter",
		"wikitext": "{{1x|[http://foo.com/a&#124;b a&#124;b]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>foo.com/a&amp;#124;b</><template-link-ground extlink-text> a</><template-link-ground entity>&amp;#124;</><template-link-ground extlink-text>b</><template-link-ground extlink-bracket>]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Pipe in template with nested template in external link target in template parameter (seriously)",
		"wikitext": "{{1x|[{{fullurl:{{FULLPAGENAME}}|action=edit}} bar]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>[</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>fullurl</><template-ext-ground parserfunction-delimiter>:</><template-ext2-ground parserfunction-bracket>{{</><template-ext2-ground parserfunction-name>FULLPAGENAME</><template-ext2-ground parserfunction-bracket>}}</><template-ext-ground parserfunction-delimiter>|</><template-ext-ground parserfunction>action=edit</><template-ext-ground parserfunction-bracket>}}</><template-ground template> bar]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Don't escape already nowiki-escaped text in template parameters",
		"wikitext": "{{1x|foo<nowiki>|</nowiki>bar}}\n{{1x|<nowiki>&lt;div&gt;</nowiki>}}\n{{1x|<nowiki></nowiki>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>|</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template>bar</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki entity>&amp;lt;</><tag-nowiki>div</><tag-nowiki entity>&amp;gt;</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: '=' char in nested transclusions should not trigger nowiki escapes or conversion to named param",
		"wikitext": "{{1x|{{1x|1=bar}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template-argument-name>1=</><template2-ground template>bar</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates parameters with special tokenizing behavior dont get modified because of arg escaping",
		"wikitext": "{{1x|a : b}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a : b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Preserve blank parameter names",
		"wikitext": "{{1x|=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Preserve blank parameter names in other positions",
		"wikitext": "{{blank_param|bar|=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>blank_param</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-delimiter>|</><template-ground template-argument-name>=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Broken wikilinks (but not external links) prevent templates from closing",
		"wikitext": "[http://example.com x\n\n{{1x|[http://example.com x}}\n\n[[Foo\n\n{{1x|[[Foo}}",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> x</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>example.com</><template-link-ground extlink-text> x}}</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-link-ground link-bracket>[[</><template2-link-ground link-pagename pagename>Foo</><template2-link-ground error>}}</>"
	},
	{
		"desc": "Wikilinks with embedded newlines are not broken",
		"wikitext": "{{1x|[[ Foo\nB\nC]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[ </><template-link-ground link-pagename pagename>Foo</><template-ground template>BC]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Broken templates",
		"wikitext": "{{1x|[[Foo|}}]]\n\n[[Foo|{{1x|]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template-link-ground link-text>}}</><template-link-ground link-bracket>]][[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template2-link-ground template-bracket>{{</><template2-link-ground template-name pagename>1x</><template2-link-ground template-delimiter>|</><template2-link-ground template>]]</><template2-link-ground template-bracket>}}</>"
	},
	{
		"desc": "Template returning pipe used in wikilink target",
		"wikitext": "[[{{pipe page}}]]",
		"parsed": "<link-ground link-bracket>[[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>pipe page</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T4702: Mismatched <i>, <b> and <a> tags are invalid",
		"wikitext": "''[http://example.com text'']\n[http://example.com '''text]'''\n''Something [http://example.com in italic'']\n''Something [http://example.com mixed''''', even bold]'''\n'''''Now [http://example.com both''''']",
		"parsed": "<apostrophes>''</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text em> text</><link-ground apostrophes>''</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> </><link-ground apostrophes>'''</><link-ground extlink-text strong>text</><link-ground extlink-bracket>]</><apostrophes>'''''</><em>Something </><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text em> in italic</><link-ground apostrophes>''</><link-ground extlink-bracket>]</><apostrophes>''</><em>Something </><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text em> mixed</><link-ground apostrophes>'''''</><link-ground extlink-text strong>, even bold</><link-ground extlink-bracket>]</><apostrophes>''''''''</><strong em>Now </><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text strong em> both</><link-ground apostrophes>'''''</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Serialize <a> tags with invalid link targets as plain text",
		"wikitext": "text\n<nowiki>*</nowiki>text\n<nowiki>[[foo]]</nowiki>\n<nowiki>*</nowiki>a <nowiki>[[foo]]</nowiki>",
		"parsed": "text<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>text<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>a <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "mw:ExtLink -vs- mw:WikiLink (T94723)",
		"wikitext": "[[Foo|Bar]]\n[[Foo|Bar]]\n[[:en:Foo|Bar]]\n[[:en:Foo|Bar]]\n\n[[:en:European_Robin|European Robin]]\n[[:en:European_Robin|European Robin]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:en:Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:en:Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:en:European_Robin</><link-ground link-delimiter>|</><link-ground link-text>European Robin</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:en:European_Robin</><link-ground link-delimiter>|</><link-ground link-text>European Robin</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Break on | in element attribute in template",
		"wikitext": "{{1x|1=<div class=\"hi|ho\">ha</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div </><template-ground htmltag-attribute html-div>class=</><template-ground htmltag-attribute-value>\"hi</><template-ground template-delimiter>|</><template-ground template>ho\"&gtha</><template-ground error>&lt;/div&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Break on | in element attribute name in template",
		"wikitext": "{{1x|<div cla|ss=\"hiho\">ha</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div </><template-ground htmltag-attribute html-div>cla</><template-ground template-delimiter>|</><template-ground template-argument-name>ss=</><template-ground template>\"hiho\"&gtha</><template-ground error>&lt;/div&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Plain link, capitalized",
		"wikitext": "[[Main Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Plain link, uncapitalized",
		"wikitext": "[[main Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link",
		"wikitext": "[[Main Page|The Main Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>The Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link with comment in link text",
		"wikitext": "[[Main Page|The Main<!--front--> Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>The Main</><link-ground comment>&lt;!--front--&gt</><link-ground link-text> Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link with multiple pipe characters in link text",
		"wikitext": "[[Main Page||The|Main|Page|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>|The|Main|Page|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link with no link text",
		"wikitext": "[[Thomas Bek (bishop of St David's)|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Thomas Bek (bishop of St David's)</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link with empty link text",
		"wikitext": "[[Main Page|<nowiki/>]] - empty nowiki\n[[Main Page|&nbsp;]] - empty non breaking space",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>/&gt</><link-ground link-bracket>]]</> - empty nowiki<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground entity>&amp;nbsp;</><link-ground link-bracket>]]</> - empty non breaking space"
	},
	{
		"desc": "Piped link with empty link text - 2",
		"wikitext": "[[Main Page| ]] - empty space",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>| </><link-ground link-bracket>]]</> - empty space"
	},
	{
		"desc": "Broken link",
		"wikitext": "[[Zigzagzogzagzig]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Zigzagzogzagzig</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken link with fragment",
		"wikitext": "[[Zigzagzogzagzig#zug]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Zigzagzogzagzig</><link-ground link-tosection>#zug</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Special page link with fragment",
		"wikitext": "[[Special:Version#anchor]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Special:Version</><link-ground link-tosection>#anchor</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Nonexistent special page link with fragment",
		"wikitext": "[[Special:ThisNameWillHopefullyNeverBeUsed#anchor]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Special:ThisNameWillHopefullyNeverBeUsed</><link-ground link-tosection>#anchor</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with prefix",
		"wikitext": "xxx[[main Page]], xxx[[Main Page]], Xxx[[main Page]] XXX[[main Page]], XXX[[Main Page]]",
		"parsed": "xxx<link-ground link-bracket>[[</><link-ground link-pagename pagename>main Page</><link-ground link-bracket>]]</>, xxx<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>, Xxx<link-ground link-bracket>[[</><link-ground link-pagename pagename>main Page</><link-ground link-bracket>]]</> XXX<link-ground link-bracket>[[</><link-ground link-pagename pagename>main Page</><link-ground link-bracket>]]</>, XXX<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with suffix",
		"wikitext": "[[Main Page]]xxx, [[Main Page]]XXX, [[Main Page]]!!!",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>xxx, <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>XXX, <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>!!!"
	},
	{
		"desc": "T45661: Piped links with identical prefixes",
		"wikitext": "[[prefixed article|prefixed articles with spaces]]\n\n[[prefixed article|prefixed articlesaoeu]]\n\n[[Main Page|Main Page test]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>prefixed article</><link-ground link-delimiter>|</><link-ground link-text>prefixed articles with spaces</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>prefixed article</><link-ground link-delimiter>|</><link-ground link-text>prefixed articlesaoeu</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>Main Page test</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with HTML entity in suffix / tail",
		"wikitext": "[[Main Page]]&quot;, [[Main Page]]&#97;",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><entity>&amp;quot;</>, <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><entity>&amp;#97;</>"
	},
	{
		"desc": "Link with 3 brackets",
		"wikitext": "[[[Main Page]]]\nFoo [[[Main Page]]]",
		"parsed": "[[[Main Page]]]Foo [[[Main Page]]]"
	},
	{
		"desc": "Link with 4 brackets",
		"wikitext": "[[[[Main Page]]]]",
		"parsed": "[[<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>]]"
	},
	{
		"desc": "Piped link with 3 brackets",
		"wikitext": "[[[main page|the main page]]]",
		"parsed": "[[[main page|the main page]]]"
	},
	{
		"desc": "Piped link with extlink-like text",
		"wikitext": "[[Main Page|[bar]]]\n[[Main Page|This is a [bar]]]\n[[Main Page|[bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>[bar]</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>This is a [bar]</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>[bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with multiple pipes",
		"wikitext": "[[Main Page|The|Main|Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>The|Main|Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Anchor containing a #. (T65430)",
		"wikitext": "[[Main Page#And#Link]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-tosection>#And#Link</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link to namespaces",
		"wikitext": "[[Talk:Parser testing]], [[Meta:Disclaimers]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Talk:Parser testing</><link-ground link-bracket>]]</>, <link-ground link-bracket>[[</><link-ground link-pagename pagename>Meta:Disclaimers</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with space in namespace",
		"wikitext": "[[User talk:Foo bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>User talk:Foo bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Namespace takes precedence over interwiki link (T53680)",
		"wikitext": "[[MemoryAlpha:AlphaTest]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>MemoryAlpha:AlphaTest</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link to namespace preferred over interwiki with correct rel attribute",
		"wikitext": "[[MemoryAlpha:AlphaTest]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>MemoryAlpha:AlphaTest</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link to namespace",
		"wikitext": "[[Meta:Disclaimers|The disclaimers]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Meta:Disclaimers</><link-ground link-delimiter>|</><link-ground link-text>The disclaimers</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing }",
		"wikitext": "[[Usually caused by a typo (oops}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Usually caused by a typo (oops</><link-ground error>}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing % (not as a hex sequence)",
		"wikitext": "[[7% Solution]]\n[[7% Solution|7%25 Solution]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>7% Solution</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>7% Solution</><link-ground link-delimiter>|</><link-ground link-text>7%25 Solution</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing % as a single hex sequence interpreted to char",
		"wikitext": "[[7%25 Solution]]\n[[7%25 Solution|7%25 Solution]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>7%25 Solution</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>7%25 Solution</><link-ground link-delimiter>|</><link-ground link-text>7%25 Solution</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing % as a double hex sequence interpreted to hex sequence",
		"wikitext": "[[7%2525 Solution]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>7%2525 Solution</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing \"#<\" and \"#>\" % as a hex sequences- these are valid section anchors",
		"wikitext": "[[%23%3c]][[%23%3e]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>%23%3c</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>%23%3e</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing \"#<\" and \"#>\" % as a hex sequences- these are valid section anchors (legacy)",
		"wikitext": "[[%23%3c]][[%23%3e]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>%23%3c</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>%23%3e</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing \"<#\" and \">#\" as a hex sequences",
		"wikitext": "[[%3c%23]][[%3e%23]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>%3c%23</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>%3e%23</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing an equals sign",
		"wikitext": "[[Special:BookSources/isbn=4-00-026157-6]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Special:BookSources/isbn=4-00-026157-6</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing an ampersand",
		"wikitext": "[[Foo & bar]]\n\n[[Foo &amp; bar]]\n\n[[Foo &amp;amp; bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo &amp; bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo &amp;amp; bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo &amp;amp;amp; bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing a tilde",
		"wikitext": "[[Foo~bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo~bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing double-single-quotes '' (T6598)",
		"wikitext": "[[Lista d''e paise d''o munno]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Lista d''e paise d''o munno</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing double quotes and spaces",
		"wikitext": "[[Cool \"Gator\"]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Cool \"Gator\"</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link containing double-single-quotes '' in text (T6598 check)",
		"wikitext": "Some [[Link|pretty ''italics'' and stuff]]!",
		"parsed": "Some <link-ground link-bracket>[[</><link-ground link-pagename pagename>Link</><link-ground link-delimiter>|</><link-ground link-text>pretty </><link-ground apostrophes>''</><link-ground link-text em>italics</><link-ground apostrophes>''</><link-ground link-text> and stuff</><link-ground link-bracket>]]</>!"
	},
	{
		"desc": "Link containing double-single-quotes '' in text embedded in italics (T6598 check)",
		"wikitext": "''Some [[Link|pretty ''italics'' and stuff]]!''",
		"parsed": "<apostrophes>''</><em>Some </><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Link</><link-ground link-delimiter>|</><link-ground link-text em>pretty </><link-ground apostrophes>''</><link-ground link-text em em>italics</><link-ground apostrophes>''</><link-ground link-text em> and stuff</><link-ground link-bracket>]]</><em>!</><apostrophes>''</>"
	},
	{
		"desc": "Link with double quotes in title part (literal) and alternate part (interpreted)",
		"wikitext": "[[File:Denys_Savchenko_''Pentecoste''.jpg]]\n\n[[''Pentecoste'']]\n\n[[''Pentecoste''|Pentecoste]]\n\n[[''Pentecoste''|''Pentecoste'']]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Denys_Savchenko_''Pentecoste''.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>''Pentecoste''</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>''Pentecoste''</><link-ground link-delimiter>|</><link-ground link-text>Pentecoste</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>''Pentecoste''</><link-ground link-delimiter>|</><link-ground apostrophes>''</><link-ground link-text em>Pentecoste</><link-ground apostrophes>''</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Plain link to URL",
		"wikitext": "[[http://www.example.com]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link to URL with link text",
		"wikitext": "[[http://www.example.com Link text]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text> Link text</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link to URL containing special characters, with link text (see T213950).",
		"wikitext": "[[http://www.example.com/?q=%7Babc%7D Link text]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?q=%7Babc%7D</><link-ground extlink-text> Link text</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link to protocol-relative URL",
		"wikitext": "[[//www.example.com]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>www.example.com</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link to protocol-relative URL with link text",
		"wikitext": "[[//www.example.com Link text]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>www.example.com</><link-ground extlink-text> Link text</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link to page with question mark in title",
		"wikitext": "[[A?b]]\n\n[[A?b|Baz]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>A?b</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>A?b</><link-ground link-delimiter>|</><link-ground link-text>Baz</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link to URL",
		"wikitext": "Piped link to URL: [[http://www.example.com|an example URL]]",
		"parsed": "Piped link to URL: [<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com|an</><link-ground extlink-text> example URL</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Nested wikilink syntax in wikilink syntax that parses as wikilink in extlink",
		"wikitext": "[[http://example.com|[[Example]]]]",
		"parsed": "[<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Example</><link-ground link-bracket>]]</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Plain link in template argument",
		"wikitext": "{{1x|[http://www.example.com |123]}}\n\n{{1x|[[http://www.example.com |123]]}}\n\n{{1x|[[http://www.example.com |123]}}\n\n{{1x|[http://www.example.com |123]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>www.example.com</><template-link-ground extlink-text> </><template-ground template-delimiter>|</><template-ground template>123]</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>[</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>www.example.com</><template-link-ground extlink-text> </><template-ground template-delimiter>|</><template-ground template>123]]</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>[</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>www.example.com</><template-link-ground extlink-text> </><template-ground template-delimiter>|</><template-ground template>123]</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>www.example.com</><template-link-ground extlink-text> </><template-ground template-delimiter>|</><template-ground template>123]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2002: [[page|http://url/]] should link to page, not http://url/",
		"wikitext": "[[Main Page|http://url/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>http://url/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2337: Escaped self-links should be bold",
		"wikitext": "[[Bu&#103;462]] [[Bug462]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Bu&amp;#103;462</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Bug462</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Self-link to section should not be bold",
		"wikitext": "[[Main Page#section]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-tosection>#section</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Self-link hash fragment should be escaped",
		"wikitext": "[[Main Page#section with spaces]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-tosection>#section with spaces</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Self-link to numeric title",
		"wikitext": "[[0]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>0</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link to numeric-equivalent title",
		"wikitext": "[[00]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>00</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "<nowiki> inside a link",
		"wikitext": "[[Main<nowiki> Page</nowiki>]] [[Main Page|the main page <nowiki>[it's not very good]</nowiki>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki> Page</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</>]] <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>the main page </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[it's not very good]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "<pre> inside a link",
		"wikitext": "[[Main<pre> Page</pre>]] [[Main Page|the main page <pre>[it's not very good]</pre>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>pre</><link-ground exttag-bracket>&gt</><tag-pre> Page</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>pre</><link-ground exttag-bracket>&gt</>]] <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>the main page </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>pre</><link-ground exttag-bracket>&gt</><tag-pre>[it's not very good]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>pre</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Non-breaking spaces in title",
		"wikitext": "[[&nbsp; Main &nbsp; Page &nbsp;]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>&amp;nbsp; Main &amp;nbsp; Page &amp;nbsp;</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Multiple spaces in titles should normalize to a single underscore",
		"wikitext": "[[Foo bar baz|x]]\n[[Foo  bar baz|x]]\n[[Foo  bar   baz|x]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo bar baz</><link-ground link-delimiter>|</><link-ground link-text>x</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo  bar baz</><link-ground link-delimiter>|</><link-ground link-text>x</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo  bar   baz</><link-ground link-delimiter>|</><link-ground link-text>x</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Internal link with en linktrail: no apostrophes (T29473)",
		"wikitext": "[[Something]]'nice",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Something</><link-ground link-bracket>]]</>'nice"
	},
	{
		"desc": "Link with multiple \":\" in a subpage-supporting namespace (T65636)",
		"wikitext": "[[User:Foo/Test/63636:Bar|Test]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>User:Foo/Test/63636:Bar</><link-ground link-delimiter>|</><link-ground link-text>Test</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Handle title parsing for subpages",
		"wikitext": "123",
		"parsed": "123"
	},
	{
		"desc": "Link to a subpage from a namespace other than main",
		"wikitext": "[[/123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>/123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Ensure that transclusion titles are not url-decoded",
		"wikitext": "{{Bar%C3%A9}} {{/Bar%C3%A9}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Bar%C3%A9</><template-ground template-bracket>}}</> <template-ground template-bracket>{{</><template-ground template-name pagename>/Bar%C3%A9</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Purely hash wikilink",
		"wikitext": "[[#a|b]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#a</><link-ground link-delimiter>|</><link-ground link-text>b</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Serialization of purely hash wikilink",
		"wikitext": "[[#a|<nowiki>[[</nowiki>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#a</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[[</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "1. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|[[Foo]]}}l\n\n{{1x|[[Foo]]l}}\n\n{{1x|[[Foo]]l}}s\n\n{{1x|[[Foo]]<span>ls</span>}}\n\n[[{{1x|Foo}}]]l",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>l<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-bracket>]]</><template-ground template>l</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-bracket>]]</><template-ground template>l</><template-ground template-bracket>}}</>s<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-bracket>]]</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt</><template-ground template>ls</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><link-ground link-bracket>[[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foo</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>l"
	},
	{
		"desc": "2. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|Some [[Fool]]}}s",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Some </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Fool</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>s"
	},
	{
		"desc": "3. Interaction of linktrail and template encapsulation",
		"wikitext": "{{1x|Some [[Fool]]s are '''bold and foolish'''}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Some </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Fool</><template-link-ground link-bracket>]]</><template-ground template>s are </><template-ground apostrophes>'''</><template-ground template>bold and foolish</><template-ground apostrophes>'''</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid link trail escaping",
		"wikitext": "[[apple]]<nowiki/>s",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>apple</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>s"
	},
	{
		"desc": "Parsoid link bracket escaping",
		"wikitext": "[[Test]]\n\n[<nowiki/>[[Test]]]\n\n[[[[Test]]]]\n\n[[[<nowiki/>[[Test]]]]]\n\n[[[[[[Test]]]]]]\n\n[[[[[<nowiki/>[[Test]]]]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>[<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>][[<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>]][[[<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>]]][[[[<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>]]]][[[[[<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>]]]]]"
	},
	{
		"desc": "Parsoid-centric test: Whitespace in ext- and wiki-links should be preserved",
		"wikitext": "[[Foo|  bar]]\n\n[[Foo|  ''bar'']]\n\n[http://wp.org   foo]\n\n[http://wp.org   ''foo'']",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|  </><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|  </><link-ground apostrophes>''</><link-ground link-text em>bar</><link-ground apostrophes>''</><link-ground link-bracket>]]</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>wp.org</><link-ground extlink-text>   foo</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>wp.org</><link-ground extlink-text>   </><link-ground apostrophes>''</><link-ground extlink-text em>foo</><link-ground apostrophes>''</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Parsoid: Scoped parsing should handle mixed transclusions and plain text",
		"wikitext": "[[Foo|{{1x|a}} b {{1x|c}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>a</><template-link-ground template-bracket>}}</><link-ground link-text> b </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>c</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with angle bracket after anchor",
		"wikitext": "[[Foo#<bar>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-tosection>#&lt;bar&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link with angle bracket after anchor (legacy)",
		"wikitext": "[[Foo#<bar>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-tosection>#&lt;bar&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Wikilink in wikilink",
		"wikitext": "[[Hi|[[Ho]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Hi</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Ho</><link-ground link-bracket>]]</>]]"
	},
	{
		"desc": "Parsoid T55221: Wikilinks should be properly entity-escaped",
		"wikitext": "He&amp;nbsp;llo [[Foo|He&amp;nbsp;llo]]\n\nHe&amp;nbsp;llo He&amp;nbsp;llo",
		"parsed": "He<entity>&amp;amp;</>nbsp;llo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>He</><link-ground entity>&amp;amp;</><link-ground link-text>nbsp;llo</><link-ground link-bracket>]]</>He<entity>&amp;amp;</>nbsp;llo He<entity>&amp;amp;</>nbsp;llo"
	},
	{
		"desc": "Wikilinks with : should roundtrip correctly, with and without redlinks",
		"wikitext": "[[16:30]]\n[[18:30]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>16:30</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>18:30</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: handle constructor well",
		"wikitext": "[[constructor]]\n\n[[constructor:foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>constructor</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>constructor:foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Template parameter named \"constructor\"",
		"wikitext": "{{1x|  constructor =  |hi}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>  constructor =</><template-ground template-delimiter>  |</><template-ground template>hi</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "<br> to <br />",
		"wikitext": "1<br>2<br />3",
		"parsed": "1<htmltag-bracket>&lt;</><htmltag-name>br</><htmltag-bracket>&gt</>2<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-bracket>/&gt</>3"
	},
	{
		"desc": "Broken br tag sanitization",
		"wikitext": "</br>",
		"parsed": "<error>&lt;/br&gt</>"
	},
	{
		"desc": "Parsoid: Broken br tag recognition",
		"wikitext": "</br>\n\n<br/ >",
		"parsed": "<error>&lt;/br&gt</><htmltag-bracket>&lt;</><htmltag-name>br</><htmltag-attribute html-br>/ </><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Incorrecly removing closing slashes from correctly formed XHTML",
		"wikitext": "<br style=\"clear:both;\" />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\"clear:both;\"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "Failing to transform badly formed HTML into correct XHTML",
		"wikitext": "<br style=\"clear: left;\">\n<br style=\"clear: right;\">\n<br style=\"clear: both;\">",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\"clear: left;\"</><htmltag-bracket>&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\"clear: right;\"</><htmltag-bracket>&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\"clear: both;\"</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Handling html with a div self-closing tag",
		"wikitext": "<div title />\n<div title/>\n<div title/ >\n<div title=bar />\n<div title=bar/>\n<div title=bar/ >",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title </><htmltag-bracket>/&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>title</><htmltag-bracket>/&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>title/ </><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>bar</><htmltag-attribute html-div> </><htmltag-bracket>/&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>bar</><htmltag-bracket>/&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>bar/</><htmltag-attribute html-div> </><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Elements with solidus in various attribute positions",
		"wikitext": "<div cla/ss=\"123\">ha</div>\n\n<div / class=\"123\">ha</div>\n\n<div class= / \"123\">ha</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>cla/ss=</><htmltag-attribute-value>\"123\"</><htmltag-bracket>&gt</>ha<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>/ class=</><htmltag-attribute-value>\"123\"</><htmltag-bracket>&gt</>ha<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>class= </><htmltag-attribute-value>/</><htmltag-attribute html-div> \"123\"</><htmltag-bracket>&gt</>ha<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Handling html with a br self-closing tag",
		"wikitext": "<br title />\n<br title/>\n<br title/ >\n<br title=bar />\n<br title=bar/>\n<br title=bar/ >",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>title </><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>title</><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>title/ </><htmltag-bracket>&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>title=</><htmltag-attribute-value>bar</><htmltag-attribute html-br> </><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>title=</><htmltag-attribute-value>bar</><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>title=</><htmltag-attribute-value>bar/</><htmltag-attribute html-br> </><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Quoted attributes without spaces",
		"wikitext": "<div class=\"foo\"style=\"color:red\">red</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>class=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"color:red\"</><htmltag-bracket>&gt</>red<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Horizontal ruler (should it add that extra space?)",
		"wikitext": "<hr>\n<hr >\nfoo <hr\n> bar",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>hr</><htmltag-bracket>&gt&lt;</><htmltag-name>hr </><htmltag-bracket>&gt</>foo <htmltag-bracket>&lt;</><htmltag-name>hr</><htmltag-bracket>&gt</> bar"
	},
	{
		"desc": "Horizontal ruler -- 4+ dashes render hr",
		"wikitext": "----",
		"parsed": "<hr>----</>"
	},
	{
		"desc": "Horizontal ruler -- eats additional dashes on the same line",
		"wikitext": "---------",
		"parsed": "<hr>---------</>"
	},
	{
		"desc": "Horizontal ruler -- does not collapse dashes on consecutive lines",
		"wikitext": "----\n----",
		"parsed": "<hr>--------</>"
	},
	{
		"desc": "Horizontal ruler -- <4 dashes render as plain text",
		"wikitext": "---",
		"parsed": "---"
	},
	{
		"desc": "Horizontal ruler -- Supports content following dashes on same line",
		"wikitext": "---- Foo",
		"parsed": "<hr>----</> Foo"
	},
	{
		"desc": "Common list",
		"wikitext": "*Common list\n*item 2\n*item 3",
		"parsed": "<list>*</>Common list<list>*</>item 2<list>*</>item 3"
	},
	{
		"desc": "Numbered list",
		"wikitext": "#Numbered list\n#item 2\n#item 3",
		"parsed": "<list>#</>Numbered list<list>#</>item 2<list>#</>item 3"
	},
	{
		"desc": "Mixed list",
		"wikitext": "*Mixed list\n*#with numbers\n**and bullets\n*#and numbers\n*bullets again\n**bullet level 2\n***bullet level 3\n***#Number on level 4\n**bullet level 2\n**#Number on level 3\n**#Number on level 3\n*#number level 2\n*Level 1\n***Level 3\n#**Level 3, but ordered",
		"parsed": "<list>*</>Mixed list<list>*#</>with numbers<list>**</>and bullets<list>*#</>and numbers<list>*</>bullets again<list>**</>bullet level 2<list>***</>bullet level 3<list>***#</>Number on level 4<list>**</>bullet level 2<list>**#</>Number on level 3<list>**#</>Number on level 3<list>*#</>number level 2<list>*</>Level 1<list>***</>Level 3<list>#**</>Level 3, but ordered"
	},
	{
		"desc": "1. Nested mixed wikitext and html list",
		"wikitext": "*hi\n*<ul><li>ho</li></ul>\n*hi\n**ho",
		"parsed": "<list>*</>hi<list>*</><htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</><list>*</>hi<list>**</>ho"
	},
	{
		"desc": "2. Nested mixed wikitext and html list (incompatible)",
		"wikitext": ";hi\n:{{1x|<li>ho</li>}}",
		"parsed": "<list>;</><strong>hi</><list>:</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template>ho</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Nested lists 1",
		"wikitext": "*foo\n**bar",
		"parsed": "<list>*</>foo<list>**</>bar"
	},
	{
		"desc": "Nested lists 2",
		"wikitext": "**foo\n*bar",
		"parsed": "<list>**</>foo<list>*</>bar"
	},
	{
		"desc": "Nested lists 3 (first element empty)",
		"wikitext": "*\n**bar",
		"parsed": "<list>***</>bar"
	},
	{
		"desc": "Nested lists 4 (first element empty)",
		"wikitext": "**\n*bar",
		"parsed": "<list>***</>bar"
	},
	{
		"desc": "Nested lists 5 (both elements empty)",
		"wikitext": "**\n*",
		"parsed": "<list>***</>"
	},
	{
		"desc": "Nested lists 6 (both elements empty)",
		"wikitext": "*\n**",
		"parsed": "<list>***</>"
	},
	{
		"desc": "Nested lists 7 (skip initial nesting levels)",
		"wikitext": "***foo",
		"parsed": "<list>***</>foo"
	},
	{
		"desc": "Nested lists 8 (multiple nesting transitions)",
		"wikitext": "*foo\n***bar\n**baz\n*boo",
		"parsed": "<list>*</>foo<list>***</>bar<list>**</>baz<list>*</>boo"
	},
	{
		"desc": "Nested lists 10 (list and span siblings: wt2wt regression)",
		"wikitext": "*a <span>x</span>\n**b <span>y</span>",
		"parsed": "<list>*</>a <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>x<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>**</>b <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>y<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nested lists 11 (T262409: trailing whitespace & selser)",
		"wikitext": "**a\n***b",
		"parsed": "<list>**</>a<list>***</>b"
	},
	{
		"desc": "1. Lists and block-element interaction",
		"wikitext": "*<div>a\n*b\n</div>ಕ",
		"parsed": "<list>*</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>a<list>*</>b<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>ಕ"
	},
	{
		"desc": "2. Lists and block-element interaction",
		"wikitext": "*{{1x|<div>a\n*b\n}}</div>ಕ",
		"parsed": "<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>a</><template-ground list>*</><template-ground template>b</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>ಕ"
	},
	{
		"desc": "1. Lists with start-of-line-transparent tokens before bullets: Comments",
		"wikitext": "*foo\n*<!--cmt-->bar\n<!--cmt-->*baz",
		"parsed": "<list>*</>foo<list>*</><comment>&lt;!--cmt--&gt</>bar<comment>&lt;!--cmt--&gt</>*baz"
	},
	{
		"desc": "2. Lists with start-of-line-transparent tokens before bullets: Template close",
		"wikitext": "*foo {{1x|bar\n}}*baz",
		"parsed": "<list>*</>foo <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>*baz"
	},
	{
		"desc": "List items are not parsed correctly following a <pre> block (T2785)",
		"wikitext": "*<pre>foo</pre>\n*<pre>bar</pre>\n*zar",
		"parsed": "<list>*</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><list>*</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>bar</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><list>*</>zar"
	},
	{
		"desc": "List items from template",
		"wikitext": "{{inner list}}\n*item 2\n\n*item 0\n{{inner list}}\n*item 2\n\n*item 0\n*notSOL{{inner list}}\n*item 2",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>inner list</><template-ground template-bracket>}}</><list>*</>item 2<list>*</>item 0<template-ground template-bracket>{{</><template-ground template-name pagename>inner list</><template-ground template-bracket>}}</><list>*</>item 2<list>*</>item 0<list>*</>notSOL<template-ground template-bracket>{{</><template-ground template-name pagename>inner list</><template-ground template-bracket>}}</><list>*</>item 2"
	},
	{
		"desc": "List interrupted by empty line or heading",
		"wikitext": "*foo\n\n**bar\n==A heading==\n*Another list item",
		"parsed": "<list>*</>foo<list>**</>bar<section-header section--2>==</><section>A heading</><section-header>==</><list>*</>Another list item"
	},
	{
		"desc": "Multiple list tags generated by templates",
		"wikitext": "{{1x|<li>}}a\n{{1x|<li>}}b\n{{1x|<li>}}c",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>b<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>c"
	},
	{
		"desc": "Multiple newlines in between HTML list items don't induce paragraph wrapping",
		"wikitext": "<ul>\n<li>hi</li>\n\n\n\n\n<li>ho</li>\n</ul>\n\n<dl>\n<dt>hi</dt>\n<dd>ho<div>123</div>\n</dd>\n\n\n</dl>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>dl</><htmltag-bracket>&gt&lt;</><htmltag-name>dt</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>dt</><htmltag-bracket>&gt&lt;</><htmltag-name>dd</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>123<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>dd</><htmltag-bracket>&gt&lt;/</><htmltag-name>dl</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Single-comment whitespace lines dont break lists, and neither do multi-comment whitespace lines",
		"wikitext": "*a\n<!--This line will NOT split the list-->\n*b\n <!--This line will NOT split the list either-->\n*c\n <!--foo--> <!----> <!--This line NOT split the list either--> \n*d",
		"parsed": "<list>*</>a<comment>&lt;!--This line will NOT split the list--&gt</><list>*</>b<skipformatting> </><comment>&lt;!--This line will NOT split the list either--&gt</><list>*</>c<skipformatting> </><comment>&lt;!--foo--&gt</> <comment>&lt;!----&gt</> <comment>&lt;!--This line NOT split the list either--&gt</> <list>*</>d"
	},
	{
		"desc": "Replacing whitespace with tabs still doesn't break the list (gerrit 78327)",
		"wikitext": "*a\n<!--This line will NOT split the list-->\t\n*b\n\t<!--This line will NOT split the list either--> \t\n*c\n\t<!--foo--> <!---->\t<!--This line NOT split the list\n        either-->\t \n*d",
		"parsed": "<list>*</>a<comment>&lt;!--This line will NOT split the list--&gt</>\t<list>*</>b\t<comment>&lt;!--This line will NOT split the list either--&gt</> \t<list>*</>c\t<comment>&lt;!--foo--&gt</> <comment>&lt;!----&gt</>\t<comment>&lt;!--This line NOT split the list        either--&gt</>\t <list>*</>d"
	},
	{
		"desc": "Test the li-hack (a hack from Tidy days, but doesn't work as advertised with Remex)",
		"wikitext": "*foo\n*<li>li-hack\n**bar1\n*{{1x|<li>templated li-hack}}\n**bar2\n*<!--foo--><li> unsupported li-hack with preceding comments\n\n<ul>\n<li><li>not a li-hack\n</li>\n</ul>",
		"parsed": "<list>*</>foo<list>*</><htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>li-hack<list>**</>bar1<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>li</><template-ground htmltag-bracket>&gt</><template-ground template>templated li-hack</><template-ground template-bracket>}}</><list>**</>bar2<list>*</><comment>&lt;!--foo--&gt</><htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</> unsupported li-hack with preceding comments<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>not a li-hack<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt</><error>&lt;/ul&gt</>"
	},
	{
		"desc": "Parsoid: Make sure nested lists are serialized on their own line even if HTML contains no newlines",
		"wikitext": "#foo\n##bar\n\n*foo\n**bar\n\n:foo\n::bar",
		"parsed": "<list>#</>foo<list>##</>bar<list>*</>foo<list>**</>bar<list>:</>foo<list>::</>bar"
	},
	{
		"desc": "Parsoid: Test of whitespace serialization with Templated bullets",
		"wikitext": "* {{bullet}}",
		"parsed": "<list>*</> <template-ground template-bracket>{{</><template-ground template-name pagename>bullet</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Unbalanced closing block tags break a list",
		"wikitext": "<div>\n*a</div><div>\n*b</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><list>*</>a<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><list>*</>b<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Unbalanced closing wikitext block tags break a list",
		"wikitext": "<p>\n*a</p><p>\n*b</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><list>*</>a<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><list>*</>b<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Unbalanced closing non-block tags don't break a list",
		"wikitext": "<span>\n*a</span><span>\n*b</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</>a<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</>b<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Unclosed formatting tags that straddle lists are closed and reopened",
		"wikitext": "#<s> a\n#b </s>",
		"parsed": "<list>#</><htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt</> a<list>#</>b <htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "1. List embedded in a formatting tag",
		"wikitext": "<small>\n*foo\n</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><list>*</>foo<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. List embedded in a formatting tag in a misnested way",
		"wikitext": "<small>\n*a\n*b</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><list>*</>a<list>*</>b<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. List embedded in a formatting tag in a misnested way",
		"wikitext": "<small>\n\n** 123</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><list>**</> 123<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: unknown parser function (T314524)",
		"wikitext": "{{#tag:b|This is a known parser function}}\n\nNow show the unknown parser functions for comparison.\n\n{{#foo}}\n\n{{#foo:bar|bat}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>b</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>This is a known parser function</><ext-ground parserfunction-bracket>}}</>Now show the unknown parser functions for comparison.<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#foo</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#foo</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>bar</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>bat</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Page property magic word with magic word contents",
		"wikitext": "{{DISPLAYTITLE:''{{PAGENAME}}''}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground apostrophes>''</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground apostrophes>''</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Template-generated DISPLAYTITLE",
		"wikitext": "{{{{1x|DISPLAYTITLE}}:Foo}}",
		"parsed": "<template-ground template-bracket>{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>DISPLAYTITLE</><template2-ground template-bracket>}}</><template-ground template-name pagename>:Foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid html2wt b/c check: Cached Parsoid HTML for DISPLAYTITLE should be handled properly",
		"wikitext": "{{DISPLAYTITLE:foo}}\n{{DISPLAYTITLE:''{{PAGENAME}}''}}\n{{{{1x|DISPLAYTITLE}}:Foo}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground apostrophes>''</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground apostrophes>''</><ext-ground parserfunction-bracket>}}</><template-ground template-bracket>{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>DISPLAYTITLE</><template2-ground template-bracket>}}</><template-ground template-name pagename>:Foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Namespace 1 {{ns:1}}",
		"wikitext": "{{ns:1}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace 1 {{ns:01}}",
		"wikitext": "{{ns:01}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>01</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace 0 {{ns:0}} (T6783)",
		"wikitext": "{{ns:0}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>0</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace 0 {{ns:00}} (T6783)",
		"wikitext": "{{ns:00}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>00</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace -1 {{ns:-1}}",
		"wikitext": "{{ns:-1}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>-1</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace User {{ns:User}}",
		"wikitext": "{{ns:User}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>User</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace User talk {{ns:User_talk}}",
		"wikitext": "{{ns:User_talk}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>User_talk</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace User talk {{ns:uSeR tAlK}}",
		"wikitext": "{{ns:uSeR tAlK}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>uSeR tAlK</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace File {{ns:File}}",
		"wikitext": "{{ns:File}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>File</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Namespace File {{ns:Image}}",
		"wikitext": "{{ns:Image}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ns</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Image</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Urlencode",
		"wikitext": "{{urlencode:hi world?!}}\n{{urlencode:hi world?!|WIKI}}\n{{urlencode:hi world?!|PATH}}\n{{urlencode:hi world?!|QUERY}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>hi world?!</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>hi world?!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>WIKI</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>hi world?!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>PATH</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>hi world?!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>QUERY</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "__proto__ is treated as normal wikitext (T105997)",
		"wikitext": "__proto__",
		"parsed": "__proto__"
	},
	{
		"desc": "Template titles with entities in them",
		"wikitext": "*{{Foo–bar}}\n*{{Foo&ndash;bar}}",
		"parsed": "<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>Foo–bar</><template-ground template-bracket>}}</><list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>Foo&amp;ndash;bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Nonexistent template",
		"wikitext": "{{thistemplatedoesnotexist}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>thistemplatedoesnotexist</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with invalid target containing tags",
		"wikitext": "{{a<b>b</b>|{{1x|foo}}|{{1x|a}}={{1x|b}}|a = b}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>a</><template-ground error>&lt;</><template-ground template-name pagename>b</><template-ground error>&gt</><template-ground template-name pagename>b</><template-ground error>&lt;</><template-ground template-name pagename>/b</><template-ground error>&gt</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>foo</><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>a</><template2-ground template-bracket>}}</><template-ground template-argument-name>=</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>b</><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template-ground template-argument-name>a =</><template-ground template> b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with invalid target containing unclosed tag",
		"wikitext": "{{a<b>|{{1x|foo}}|{{1x|a}}={{1x|b}}|a = b}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>a</><template-ground error>&lt;</><template-ground template-name pagename>b</><template-ground error>&gt</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>foo</><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>a</><template2-ground template-bracket>}}</><template-ground template-argument-name>=</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>b</><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template-ground template-argument-name>a =</><template-ground template> b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with invalid target containing wikilink",
		"wikitext": "{{[[Main Page]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground error>[[</><template-ground template-name pagename>Main Page</><template-ground error>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with just whitespace in it, T70421",
		"wikitext": "{{1x|{{ }}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{ }}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with just whitespace (bad template brace matching)",
		"wikitext": "{{1x|{{ }<nowiki>}</nowiki>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{ </><template2-ground error>}</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>}</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Simple template",
		"wikitext": "{{test}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>test</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with explicit namespace",
		"wikitext": "{{Template:test}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Template:test</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template parameter",
		"wikitext": "{{paramtest|param=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtest</><template-ground template-delimiter>|</><template-ground template-argument-name>param=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template unnamed parameter",
		"wikitext": "{{paramtestnum|Main Page|the main page}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtestnum</><template-ground template-delimiter>|</><template-ground template>Main Page</><template-ground template-delimiter>|</><template-ground template>the main page</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with template name as unnamed argument",
		"wikitext": "{{templateasargtestnum|templatesimple}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateasargtestnum</><template-ground template-delimiter>|</><template-ground template>templatesimple</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with template name as argument",
		"wikitext": "{{templateasargtest|templ=simple}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateasargtest</><template-ground template-delimiter>|</><template-ground template-argument-name>templ=</><template-ground template>simple</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with template name as argument (2)",
		"wikitext": "{{templateasargtest2|templ=templatesimple}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateasargtest2</><template-ground template-delimiter>|</><template-ground template-argument-name>templ=</><template-ground template>templatesimple</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with default value",
		"wikitext": "{{templateasargtestdefault}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateasargtestdefault</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with default value (value set)",
		"wikitext": "{{templateasargtestdefault|templ=templa}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateasargtestdefault</><template-ground template-delimiter>|</><template-ground template-argument-name>templ=</><template-ground template>templa</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template redirect",
		"wikitext": "{{templateredirect}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>templateredirect</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with argument in separate line",
		"wikitext": "{{ templateasargtest  |\n templ = simple }}",
		"parsed": "<template-ground template-bracket>{{ </><template-ground template-name pagename>templateasargtest  </><template-ground template-delimiter>|</><template-ground template-argument-name> templ =</><template-ground template> simple </><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template with complex template as argument",
		"wikitext": "{{paramtest|\n  param ={{ templateasargtest  |\n templ = simple }}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtest</><template-ground template-delimiter>|</><template-ground template-argument-name>  param =</><template2-ground template-bracket>{{ </><template2-ground template-name pagename>templateasargtest  </><template2-ground template-delimiter>|</><template2-ground template-argument-name> templ =</><template2-ground template> simple </><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates with templated name",
		"wikitext": "{{{{1x|1x}}|foo}}\n{{{{1x|inner list}} }}",
		"parsed": "<template-ground template-bracket>{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>1x</><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>inner list</><template2-ground template-bracket>}}</><template-ground template-bracket> }}</>"
	},
	{
		"desc": "Templates with templated name and top level template args",
		"wikitext": "{{1{{2{{{3}}}|4=5}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1</><template2-ground template-bracket>{{</><template2-ground template-name pagename>2</><template2-ground templatevariable-bracket>{{{</><template2-ground templatevariable-name>3</><template2-ground templatevariable-bracket>}}}</><template2-ground template-delimiter>|</><template2-ground template-argument-name>4=</><template2-ground template>5</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates with invalid templated targets",
		"wikitext": "{{1x\n{{1x|foo}}\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>}}"
	},
	{
		"desc": "Template with complex arguments",
		"wikitext": "{{complextemplate|\n  param ={{ templateasargtest  |\n templ = simple }}|[[Template:complextemplate|link]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>complextemplate</><template-ground template-delimiter>|</><template-ground template-argument-name>  param =</><template2-ground template-bracket>{{ </><template2-ground template-name pagename>templateasargtest  </><template2-ground template-delimiter>|</><template2-ground template-argument-name> templ =</><template2-ground template> simple </><template2-ground template-bracket>}}</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Template:complextemplate</><template-link-ground link-delimiter>|</><template-link-ground link-text>link</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2553: link with two variables in a piped link",
		"wikitext": "{|\n|[[{{{1}}}|{{{2}}}]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground templatevariable-bracket>{{{</><link-ground templatevariable-name>1</><link-ground templatevariable-bracket>}}}</><link-ground link-delimiter>|</><link-ground templatevariable-bracket>{{{</><link-ground templatevariable-name>2</><link-ground templatevariable-bracket>}}}</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "Bail on table cell attribute parsing on wikilink",
		"wikitext": "{|\n|testing [[one|two]] |three||four\n|testing one two |three||four\n|testing=\"[[one|two]]\" |three||four\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>testing </><link-ground link-bracket>[[</><link-ground link-pagename pagename>one</><link-ground link-delimiter>|</><link-ground link-text>two</><link-ground link-bracket>]]</><table-td> |three</><table-delimiter>||</><table-td>four</><table-delimiter>|</><html-td table-definition>testing one two </><table-delimiter2>|</><table-td>three</><table-delimiter>||</><table-td>four</><table-delimiter>|</><table-td>testing=\"</><link-ground link-bracket>[[</><link-ground link-pagename pagename>one</><link-ground link-delimiter>|</><link-ground link-text>two</><link-ground link-bracket>]]</><table-td>\" |three</><table-delimiter>||</><table-td>four</><table-bracket>|}</>"
	},
	{
		"desc": "Don't bail on table cell attribute parsing if wikilink is found in template arg",
		"wikitext": "{|\n|Test {{#tag:spantag|One two \"[[three]]\" four}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>Test </><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>spantag</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>One two \"</><ext-link-ground link-bracket>[[</><ext-link-ground link-pagename pagename>three</><ext-link-ground link-bracket>]]</><ext-ground parserfunction>\" four</><ext-ground parserfunction-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Magic variable as template parameter",
		"wikitext": "{{paramtest|param={{SITENAME}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtest</><template-ground template-delimiter>|</><template-ground template-argument-name>param=</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>SITENAME</><template-ext-ground parserfunction-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template parameter as link source",
		"wikitext": "{{linktest|param=Main Page}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>linktest</><template-ground template-delimiter>|</><template-ground template-argument-name>param=</><template-ground template>Main Page</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template passing argument to another template",
		"wikitext": "{{paramtest2|arg='hmm'}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtest2</><template-ground template-delimiter>|</><template-ground template-argument-name>arg=</><template-ground template>'hmm'</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template as link source",
		"wikitext": "[[{{linktest2}}]]\n\n[[{{linktest2}}|Main Page]]\n\n[[{{linktest2}}]]Page",
		"parsed": "<link-ground link-bracket>[[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>linktest2</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>linktest2</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>Main Page</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>linktest2</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>Page"
	},
	{
		"desc": "Template infinite loop",
		"wikitext": "{{loop1}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>loop1</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template from main namespace",
		"wikitext": "{{:Main Page}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>:Main Page</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template from non-includable namespace",
		"wikitext": "{{1x|uh oh!}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>uh oh!</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2529: Template with table, not included at beginning of line",
		"wikitext": "foo {{table}}",
		"parsed": "foo <template-ground template-bracket>{{</><template-ground template-name pagename>table</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2523: Template shouldn't eat newline (or add an extra one before table)",
		"wikitext": "foo\n{{table}}",
		"parsed": "foo<template-ground template-bracket>{{</><template-ground template-name pagename>table</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2041: Template parameters shown as broken links",
		"wikitext": "{{{parameter}}}",
		"parsed": "<templatevariable-bracket>{{{</><templatevariable-name>parameter</><templatevariable-bracket>}}}</>"
	},
	{
		"desc": "Template with targets containing wikilinks",
		"wikitext": "{{[[foo]]}}\n\n{{[[{{1x|foo}}]]}}\n\n{{{{1x|[[foo}}]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground error>[[</><template-ground template-name pagename>foo</><template-ground error>]]</><template-ground template-bracket>}}{{</><template-ground error>[[</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>foo</><template2-ground template-bracket>}}</><template-ground error>]]</><template-ground template-bracket>}}{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-link-ground link-bracket>[[</><template2-link-ground link-pagename pagename>foo</><template2-link-ground error>}}</><template2-link-ground link-bracket>]]</><template2-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Double quotes as template target",
		"wikitext": "foo {{''}} baz",
		"parsed": "foo <template-ground template-bracket>{{</><template-ground template-name pagename>''</><template-ground template-bracket>}}</> baz"
	},
	{
		"desc": "Templates with intersecting and overlapping ranges",
		"wikitext": "{|{{1x|1=class=\"foo\"\n<p>ha</p>}}\n{|{{1x|1=class=\"bar\"\n<p>ho</p>}}\n{{1x|{{!}}hi}}\n|}",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>class=\"foo\"</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template>ha</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>class=\"bar\"</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template>ho</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>hi</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "msgnw keyword",
		"wikitext": "{{msgnw:MSGNW test}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>msgnw</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>MSGNW test</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "int keyword",
		"wikitext": "{{int:new-messages|lots of money|not!}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>int</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>new-messages</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>lots of money</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>not!</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "int keyword - non-existing message",
		"wikitext": "{{int:var}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>int</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>var</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "<includeonly> and <noinclude> being included",
		"wikitext": "{{Includes}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Includes</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "<onlyinclude> being included",
		"wikitext": "{{Includes2}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Includes2</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "<onlyinclude> and <includeonly> being included",
		"wikitext": "{{Includes3}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Includes3</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "<includeonly> and <noinclude> on a page",
		"wikitext": "Foo<noinclude>zar</noinclude><includeonly>bar</includeonly>",
		"parsed": "Foo<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>zar</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>bar</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Un-closed <noinclude>",
		"wikitext": "<noinclude>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Empty <noinclude>",
		"wikitext": "Hello<noinclude></noinclude>!",
		"parsed": "Hello<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>!"
	},
	{
		"desc": "Nested <noinclude>s",
		"wikitext": "<noinclude>\nx\n<noinclude>y</noinclude>\nz\n</noinclude>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>x&lt;noinclude&gty</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>z<error>&lt;/noinclude&gt</>"
	},
	{
		"desc": "<onlyinclude> on a page",
		"wikitext": "<onlyinclude>Foo</onlyinclude>bar",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude>Foo</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>bar"
	},
	{
		"desc": "Un-closed <onlyinclude>",
		"wikitext": "<onlyinclude>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236868: Un-closed <noinclude> caused bad SourceRange length",
		"wikitext": "{| <noinclude>\n|- <noinclude>\n| A\n|-</noinclude>\n|}",
		"parsed": "<table-bracket>{| </><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>|- &lt;noinclude&gt| A|-</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Self-closed noinclude, includeonly, onlyinclude tags",
		"wikitext": "<noinclude />\n<includeonly />\n<onlyinclude />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>noinclude </><exttag-bracket>/&gt&lt;</><exttag-name>includeonly </><exttag-bracket>/&gt</><onlyinclude />"
	},
	{
		"desc": "Unbalanced includeonly and noinclude tags",
		"wikitext": "{|\n|a</noinclude>\n|b</noinclude></noinclude>\n|c</noinclude></includeonly>\n|d</includeonly></includeonly>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><error>&lt;/noinclude&gt</><table-delimiter>|</><table-td>b</><error>&lt;/noinclude&gt&lt;/noinclude&gt</><table-delimiter>|</><table-td>c</><error>&lt;/noinclude&gt&lt;/includeonly&gt</><table-delimiter>|</><table-td>d</><error>&lt;/includeonly&gt&lt;/includeonly&gt</><table-bracket>|}</>"
	},
	{
		"desc": "includeonly / noinclude / onlyinclude and headers",
		"wikitext": "<includeonly><!--hello1 --></includeonly>== test 1 == <includeonly><!--hello2 --></includeonly>\n<noinclude><!--hello3 --></noinclude>== test 2 == <noinclude><!--hello4 --></noinclude>\n<onlyinclude><!--hello5 --></onlyinclude>== test 3 == <onlyinclude><!--hello6 --></onlyinclude>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly comment>&lt;!--hello1 --&gt</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>== test 1 == <exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly comment>&lt;!--hello2 --&gt</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude comment>&lt;!--hello3 --&gt</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>== test 2 == <exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude comment>&lt;!--hello4 --&gt</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude comment>&lt;!--hello5 --&gt</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>== test 3 == <exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude comment>&lt;!--hello6 --&gt</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T8563: Section extraction for section shown by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section T-2==",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly section-header section--2>==</><tag-includeonly section>Includeonly section</><tag-includeonly section-header>==</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><section-header section--2>==</><section>Section T-2</><section-header>==</>"
	},
	{
		"desc": "T8563: Section extraction for section suppressed by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section 1==",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly section-header section--2>==</><tag-includeonly section>Includeonly section</><tag-includeonly section-header>==</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><section-header section--2>==</><section>Section 1</><section-header>==</>"
	},
	{
		"desc": "Un-closed <includeonly>",
		"wikitext": "<includeonly>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Includes and comments at SOL",
		"wikitext": "<!-- comment --><noinclude><!-- comment --></noinclude><!-- comment -->==hu==\n\n<noinclude>\nsome\n</noinclude>*stuff\n*here\n\n<noinclude>\nsome</noinclude>* stuff\n* here\n\n<includeonly>can have stuff</includeonly>===here===\n\n__INDEX__== hi ==",
		"parsed": "<comment>&lt;!-- comment --&gt</><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude comment>&lt;!-- comment --&gt</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><comment>&lt;!-- comment --&gt</>==hu==<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>some</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>*stuff<list>*</>here<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>some</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>* stuff<list>*</> here<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>can have stuff</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>===here===<double-underscore>__INDEX__</>== hi =="
	},
	{
		"desc": "Parsoid: DOM fragment reuse",
		"wikitext": "a{{1x|b<table></table>c}}d\n\na{{1x|b\n<table></table>\nc}}d\n\n{{1x|a\n\n<table></table>\n\nb}}",
		"parsed": "a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template>c</><template-ground template-bracket>}}</>da<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template>c</><template-ground template-bracket>}}</>d<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template>b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Merge double tds (T52603)",
		"wikitext": "{|\n|{{1x|{{!}} foo}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template> foo</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Parsoid: Merge double tds in nested transclusion content (T52603)",
		"wikitext": "{{1x|<div>}}\n{|\n|{{1x|{{!}} foo}}\n|}\n{{1x|</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template> foo</><template-ground template-bracket>}}</><table-bracket>|}</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template name with question mark",
		"wikitext": "{{temp?|123}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>temp?</><template-ground template-delimiter>|</><template-ground template>123</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "0. includeonly around the entire attribute",
		"wikitext": "<span <includeonly>id=\"v1\"</includeonly><noinclude>id=\"v2\"</noinclude>>bar</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>id=\"v1\"</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>id=\"v2\"</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "1. includeonly in html attr key",
		"wikitext": "<span <noinclude>id</noinclude><includeonly>about</includeonly>=\"foo\">bar</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>id</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>about</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><htmltag-attribute html-span>=</><htmltag-attribute-value>\"foo\"</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. includeonly in html attr value",
		"wikitext": "<span id=\"<noinclude>v1</noinclude><includeonly>v2</includeonly>\">bar</span>\n<span id=<noinclude>\"v1\"</noinclude><includeonly>\"v2\"</includeonly>>bar</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"</><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>v1</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>v2</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>\"v1\"</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>\"v2\"</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. includeonly in part of an attr value",
		"wikitext": "<span style=\"color:<noinclude>red</noinclude><includeonly>blue</includeonly>;\">bar</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>style=</><htmltag-attribute-value>\"color:</><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>red</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>blue</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><htmltag-attribute-value>;\"</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. includeonly in table attributes",
		"wikitext": "{|\n|- <noinclude>\n|-\n|a\n</noinclude>\n|- <includeonly>\n|-\n|b\n</includeonly>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|- </><exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>|-|a</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><table-delimiter>|- </><exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>|-|b</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "1. Table tag in SOL posn. should get reparsed correctly with valid TSR",
		"wikitext": "{{1x|}}{| width = '100%'\n|foo\n|}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</>{| width = '100%'|foo|}"
	},
	{
		"desc": "2. Table tag in SOL posn. should get reparsed correctly with valid TSR",
		"wikitext": "<includeonly>a</includeonly>{| {{{b}}}\n|c\n|}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>a</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>{| <templatevariable-bracket>{{{</><templatevariable-name>b</><templatevariable-bracket>}}}</>|c|}"
	},
	{
		"desc": "Table wikitext syntax outside wiki-tables",
		"wikitext": "a\n|+ not a caption\n! not a table heading\n|- not a table row\n| not a table cell\n| class=\"foo bar\" | baz\nb\n|}\n|-\nc",
		"parsed": "a|+ not a caption! not a table heading|- not a table row| not a table cell| class=\"foo bar\" | bazb|}|-c"
	},
	{
		"desc": "Content after <tr> like wikitext should get fully processed",
		"wikitext": "x\n|- [[Foo]] and {{1x|bar}}\ny",
		"parsed": "x|- <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</> and <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>y"
	},
	{
		"desc": "P-wrapping should not break after <td>s separated by newlines are converted back to pipes",
		"wikitext": "a\n|b\n\n|c\nd",
		"parsed": "a|b|cd"
	},
	{
		"desc": "Orphaned table row wikitext with templated table for an attribute should not duplicate table",
		"wikitext": "|-{{1x|\n{{{!}}\n{{!}}foo\n{{!}}}\n}}",
		"parsed": "|-<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground table-bracket>{{{!}}</><template-ground table-delimiter>{{!}}</><template-ground table-td>foo</><template-ground table-bracket>{{!}}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Template Name/Arg clash: 1. Use of positional param",
		"wikitext": "{{quote|foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>quote</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Template Name/Arg clash: 2. Use of named param",
		"wikitext": "{{quote|quote=foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>quote</><template-ground template-delimiter>|</><template-ground template-argument-name>quote=</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: 1. Simple use",
		"wikitext": "{{1x|Foo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: 2. Inside a block tag",
		"wikitext": "<div>{{1x|Foo}}</div>\n<blockquote>{{1x|Foo}}</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: P-wrapping: 1a. Templates on consecutive lines",
		"wikitext": "{{1x|Foo}}\n{{1x|bar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: P-wrapping: 1b. Templates on consecutive lines",
		"wikitext": "Foo\n\n{{1x|bar}}\n{{1x|baz}}",
		"parsed": "Foo<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>baz</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: P-wrapping: 1c. Templates on consecutive lines",
		"wikitext": "{{1x|Foo}}\n{{1x|bar}} <div>baz</div>",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</> <htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>baz<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: P-wrapping: 1d. Template preceded by comment-only line",
		"wikitext": "<!-- foo -->\n{{1x|Bar}}",
		"parsed": "<comment>&lt;!-- foo --&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Scopes should not be expanded unnecessarily",
		"wikitext": "{{1x|<div>a</div>}}b{{1x|\n<div>c</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>a</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>b<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>c</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Inline Text: 1. Multiple template uses",
		"wikitext": "{{1x|Foo}}bar{{1x|baz}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}</>bar<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>baz</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Inline Text: 2. Back-to-back template uses",
		"wikitext": "{{1x|Foo}}{{1x|bar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Block Tags: 1. Multiple template uses",
		"wikitext": "{{1x|<div>Foo</div>}}<div>bar</div>{{1x|<div>baz</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>Foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>baz</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Block Tags: 2. Back-to-back template uses",
		"wikitext": "{{1x|<div>Foo</div>}}{{1x|<div>bar</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>Foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>bar</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Correctly encapsulate templates producing </p> tag without a corresponding <p> tag",
		"wikitext": "{{1x|a\nb</p>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>ab</><template-ground error>&lt;/p&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Drop stripped tag markers, unless they have encapsulation info",
		"wikitext": "{{1x|<tr></tr>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Links: 1. Simple example",
		"wikitext": "{{1x|[[Foo|bar]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template-link-ground link-text>bar</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Links: 2. Generation of link href",
		"wikitext": "[[{{1x|Foo}}|bar]]",
		"parsed": "<link-ground link-bracket>[[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foo</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Templates: Links: 3. Generation of part of a link href",
		"wikitext": "[[Fo{{1x|o}}|bar]]\n\n[[Foo{{1x|bar}}]]\n\n[[Foo{{1x|bar}}baz]]\n\n[[Foo{{1x|bar}}|bar]]\n\n[[:Foo{{1x|bar}}]]\n\n[[:Foo{{1x|bar}}|bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Fo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>o</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-pagename pagename>baz</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Foo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Foo</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Templates: Links: 4. Multiple templates generating link href",
		"wikitext": "[[{{1x|F}}{{1x|o}}ob{{1x|ar}}]]",
		"parsed": "<link-ground link-bracket>[[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>F</><template-link-ground template-bracket>}}{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>o</><template-link-ground template-bracket>}}</><link-ground link-pagename pagename>ob</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>ar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Templates: Links: 5. Generation of link text",
		"wikitext": "[[Foo|{{1x|bar}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Templates: Links: 5. Nested templates (only outermost template should be marked)",
		"wikitext": "{{1x|[[{{1x|Foo}}|bar]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template2-link-ground template-bracket>{{</><template2-link-ground template-name pagename>1x</><template2-link-ground template-delimiter>|</><template2-link-ground template>Foo</><template2-link-ground template-bracket>}}</><template-link-ground link-delimiter>|</><template-link-ground link-text>bar</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "File with template filename",
		"wikitext": "[[File:{{1x|Foobar.jpg}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foobar.jpg</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Templates: HTML Tag: 1. Generation of HTML attr. key",
		"wikitext": "<div {{1x|style}}=\"color:red;\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>style</><template-ground template-bracket>}}</><htmltag-attribute html-div>=</><htmltag-attribute-value>\"color:red;\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 2. Generation of HTML attr. value",
		"wikitext": "<div style={{1x|'color:red;'}}>foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>'color:red;'</><template-ground template-bracket>}}</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 3. Generation of HTML attr key and value",
		"wikitext": "<div {{1x|style}}={{1x|'color:red;'}}>foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>style</><template-ground template-bracket>}}</><htmltag-attribute html-div>=</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>'color:red;'</><template-ground template-bracket>}}</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 4. Generation of starting piece of HTML attr value",
		"wikitext": "<div title=\"{{1x|This is a long title}} with just one piece templated\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>This is a long title</><template-ground template-bracket>}}</><htmltag-attribute-value> with just one piece templated\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 5. Generation of middle piece of HTML attr value",
		"wikitext": "<div title=\"This is a long title with just {{1x|one piece}} templated\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"This is a long title with just </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>one piece</><template-ground template-bracket>}}</><htmltag-attribute-value> templated\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 6. Generation of end piece of HTML attr value",
		"wikitext": "<div title=\"This is a long title with just one piece {{1x|templated}}\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"This is a long title with just one piece </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>templated</><template-ground template-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 7. Generation of partial attribute key string",
		"wikitext": "<div st{{1x|yle}}=\"color:red;\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>st</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>yle</><template-ground template-bracket>}}</><htmltag-attribute html-div>=</><htmltag-attribute-value>\"color:red;\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 8. Template-generated attribute (k=v)",
		"wikitext": "<div {{1x|1=id=\"v1\"}}>bar</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>id=\"v1\"</><template-ground template-bracket>}}</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tag: 9. Multiple template-generated attributes",
		"wikitext": "<div {{1x|1=id=\"v1\" title=\"foo\"}}>bar</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>id=\"v1\" title=\"foo\"</><template-ground template-bracket>}}</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: Support for templates generating attributes and content",
		"wikitext": "{| {{mixed_attr_content_template}}\n|-\n|bar\n|}",
		"parsed": "<table-bracket>{| </><template-ground template-bracket>{{</><template-ground template-name pagename>mixed_attr_content_template</><template-ground template-bracket>}}</><table-delimiter>|-|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Templates: Support for templates generating table attributes and content (with fostered categories)",
		"wikitext": "{| {{mixed_attr_content_template_2}}\n|-\n|bar\n|}",
		"parsed": "<table-bracket>{| </><template-ground template-bracket>{{</><template-ground template-name pagename>mixed_attr_content_template_2</><template-ground template-bracket>}}</><table-delimiter>|-|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Table cell with attribute before expanded attribute",
		"wikitext": "{|\n| align=\"center\" {{attribute_from_template}} |456\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>align=\"center\" </><template-ground template-bracket>{{</><template-ground template-name pagename>attribute_from_template</><template-ground template-bracket>}}</><html-td table-definition> </><table-delimiter2>|</><table-td>456</><table-bracket>|}</>"
	},
	{
		"desc": "1. Entities and nowikis inside templated attributes should be handled correctly",
		"wikitext": "<div {{1x|style{{=}}\"background:&#35;f9f9f9;\"}}>foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>style</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>=</><template-ext-ground parserfunction-bracket>}}</><template-ground template>\"background:</><template-ground entity>&amp;#35;</><template-ground template>f9f9f9;\"</><template-ground template-bracket>}}</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. Entities and nowikis inside templated attributes should be handled correctly",
		"wikitext": "{|\n|{{table_attribs_3}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_3</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "3. Entities and nowikis inside templated attributes should be handled correctly inside templated tables",
		"wikitext": "{{tbl-start}}\n|{{table_attribs_3}}\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}</>|<template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_3</><template-ground template-bracket>}}{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "4. Entities and nowikis inside templated attributes should be handled correctly inside templated tables",
		"wikitext": "{|\n|{{table_attribs_6}} hi\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_6</><template-ground template-bracket>}}</><table-td> hi</><table-bracket>|}</>"
	},
	{
		"desc": "Extension tag in templated tag attribute",
		"wikitext": "{{1x|1=\n{{{!}} class=\"123\" <nowiki />\n{{!}} hi\n{{!}}}\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground table-bracket>{{{!}} </><template-ground table-definition html-table>class=</><template-ground table-definition-value>\"123\"</><template-ground table-definition html-table> </><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki </><template-ground exttag-bracket>/&gt</><template-ground table-delimiter>{{!}} </><template-ground table-td>hi</><template-ground table-bracket>{{!}}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 1. Generating start of a HTML table",
		"wikitext": "{{1x|<table><tr><td>foo</td>}}</tr></table>",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 2a. Generating middle of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>foo</td>}}</tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 2b. Generating middle of a HTML table",
		"wikitext": "<table>{{1x|<tr><td>foo</td></tr>}}</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 3. Generating end of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>foo</td></tr></table>}}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 4a. Generating a single tag of a HTML table",
		"wikitext": "{{1x|<table>}}<tr><td>foo</td></tr></table>",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 4b. Generating a single tag of a HTML table",
		"wikitext": "<table>{{1x|<tr>}}<td>foo</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 4c. Generating a single tag of a HTML table",
		"wikitext": "<table><tr>{{1x|<td>}}foo</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 4d. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo{{1x|</td>}}</tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 4e. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo</td>{{1x|</tr>}}</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: HTML Tables: 4f. Generating a single tag of a HTML table",
		"wikitext": "<table><tr><td>foo</td></tr>{{1x|</table>}}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: HTML Tables: 5. Proper fostering of categories from inside",
		"wikitext": "<table>[[Category:foo1]]<tr><td>foo</td></tr></table>\n<!--Two categories (T52330)-->\n<table>[[Category:bar1]][[Category:bar2]]<tr><td>foo</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:foo1</><link-ground link-bracket>]]</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</><comment>&lt;!--Two categories (T52330)--&gt</><htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:bar1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:bar2</><link-ground link-bracket>]]</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: Wiki Tables: 1a. Fostering of entire template content",
		"wikitext": "{|\n{{1x|a}}\n|}",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 1b. Fostering of entire template content",
		"wikitext": "{|\n{{1x|<div>}}\nfoo\n{{1x|</div>}}\n|}",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><error>foo</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 2. Fostering of partial template content",
		"wikitext": "{|\n{{1x|a\n<div>b</div>}}\n|}",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>b</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 3. td-content via multiple templates",
		"wikitext": "{|\n{{1x|{{pipe}}a}}{{1x|b}}\n|}",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>pipe</><template2-ground template-bracket>}}</><template-ground template>a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 4. Templated tags, no content",
		"wikitext": "{{tbl-start}}\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 5. Templated tags, regular td-tags",
		"wikitext": "{{tbl-start}}\n|foo\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}</>|foo<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 6. Templated tags, templated td-tags",
		"wikitext": "{{tbl-start}}\n{{!}}foo\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>!</><ext-ground parserfunction-bracket>}}</>foo<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Wiki Tables: 8. Fosterable meta-tags should get fostered",
		"wikitext": "{{UnclosedTableEndsWithTR}}\n<onlyinclude>\n|foo\n</onlyinclude>\n|}\n\n<noinclude>\n{{UnclosedTableEndsWithTR}}\n</noinclude>\n|foo\n|}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>UnclosedTableEndsWithTR</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude>|foo</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>|}<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude template-ground template-bracket>{{</><tag-noinclude template-ground template-name pagename>UnclosedTableEndsWithTR</><tag-noinclude template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>|foo|}"
	},
	{
		"desc": "Templates: Lists: Multi-line list-items via templates",
		"wikitext": "*{{1x|a {{nonexistent|\nunused}}}}\n*{{1x|b {{nonexistent|\nunused}}}}",
		"parsed": "<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a </><template2-ground template-bracket>{{</><template2-ground template-name pagename>nonexistent</><template2-ground template-delimiter>|</><template2-ground template>unused</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</><list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b </><template2-ground template-bracket>{{</><template2-ground template-name pagename>nonexistent</><template2-ground template-delimiter>|</><template2-ground template>unused</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 1. Quotes opened/closed across templates (1x)",
		"wikitext": "{{1x|''a}}{{1x|b''c''d}}{{1x|''e}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b</><template-ground apostrophes>''</><template-ground template>c</><template-ground apostrophes>''</><template-ground template>d</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>e</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 2. Quotes opened/closed across templates (1x_with_span)",
		"wikitext": "{{1x_with_span|''a}}{{1x_with_span|b''c''d}}{{1x_with_span|''e}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x_with_span</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x_with_span</><template-ground template-delimiter>|</><template-ground template>b</><template-ground apostrophes>''</><template-ground template>c</><template-ground apostrophes>''</><template-ground template>d</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x_with_span</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>e</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 3. Quotes opened/closed across templates (1x_with_div)",
		"wikitext": "{{1x_with_div|''a}}{{1x_with_div|b''c''d}}{{1x_with_div|''e}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x_with_div</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x_with_div</><template-ground template-delimiter>|</><template-ground template>b</><template-ground apostrophes>''</><template-ground template>c</><template-ground apostrophes>''</><template-ground template>d</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x_with_div</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>e</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly nesting: 4. Divs opened/closed across templates",
		"wikitext": "a<div>b{{1x|c</div>d}}e",
		"parsed": "a<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>b<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>c</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>d</><template-ground template-bracket>}}</>e"
	},
	{
		"desc": "Templates: Ugly templates: 3. newline-only template parameter",
		"wikitext": "foo {{1x|\n}}",
		"parsed": "foo <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 4. newline-only template parameter inconsistency",
		"wikitext": "{{1x|\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 5. Template encapsulation test: Non-trivial overlap of template ranges is properly handled",
		"wikitext": "{{1x|<table>}}\n{{1x|<div>foo}}\n{{1x|</table>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground error>&lt;/table&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Ugly templates: 6. Template encapsulation test: Cyclical nesting of template ranges is properly handled",
		"wikitext": "{{1x|<table><tr><td><table>}}\n{{1x|<div>}}\n{{1x|</div>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Parameters substituted at the top-level",
		"wikitext": "{{{foo|''who'' {{1x|me}}? '''never!'''}}}\n\n{{{foo|bar|baz}}}",
		"parsed": "<templatevariable-bracket>{{{</><templatevariable-name>foo</><templatevariable-delimiter>|</><apostrophes>''</><templatevariable em>who</><apostrophes>''</><template-ground template-bracket> {{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>me</><template-ground template-bracket>}}</><templatevariable>? </><apostrophes>'''</><templatevariable strong>never!</><apostrophes>'''</><templatevariable-bracket>}}}{{{</><templatevariable-name>foo</><templatevariable-delimiter>|</><templatevariable>bar</><templatevariable-delimiter>|</><comment>baz</><templatevariable-bracket>}}}</>"
	},
	{
		"desc": "Templates: Param with empty arg in the final position",
		"wikitext": "{{{hi|}}}",
		"parsed": "<templatevariable-bracket>{{{</><templatevariable-name>hi</><templatevariable-delimiter>|</><templatevariable-bracket>}}}</>"
	},
	{
		"desc": "Compound transclusion with template and top level templatearg",
		"wikitext": "{{1x|<table>}}\n{{{top|<td>123</td>}}}\n</table>",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><templatevariable-bracket>{{{</><templatevariable-name>top</><templatevariable-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><templatevariable>123</><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><templatevariable-bracket>}}}</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parser Functions: 1. Simple example",
		"wikitext": "{{uc:foo}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>uc</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Functions: 2. Nested use (only outermost should be marked up)",
		"wikitext": "{{uc:{{lc:FOO}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>uc</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>lc</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction>FOO</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Recognize nowiki with odd capitalization",
		"wikitext": "<noWikI ><div>[[foo]]</Nowiki >",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>noWikI </><exttag-bracket>&gt</><tag-nowiki>&lt;div&gt[[foo]]</><exttag-bracket>&lt;/</><exttag-name>Nowiki </><exttag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: Escape nowiki with trailing space in tags",
		"wikitext": "&lt;nowiki &gt; foo &lt;/nowiki &gt;\n\na&lt;nowiki /&gt;b\n\nc&lt;nowiki/ &gt;d",
		"parsed": "<entity>&amp;lt;</>nowiki <entity>&amp;gt;</> foo <entity>&amp;lt;</>/nowiki <entity>&amp;gt;</>a<entity>&amp;lt;</>nowiki /<entity>&amp;gt;</>bc<entity>&amp;lt;</>nowiki/ <entity>&amp;gt;</>d"
	},
	{
		"desc": "Parsoid: Escape weird noWikI capitalizations",
		"wikitext": "&lt;noWikI &gt; foo &lt;/NoWikI &gt;",
		"parsed": "<entity>&amp;lt;</>noWikI <entity>&amp;gt;</> foo <entity>&amp;lt;</>/NoWikI <entity>&amp;gt;</>"
	},
	{
		"desc": "message transform: magic variables",
		"wikitext": "{{SITENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SITENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "message transform: should not transform wiki markup",
		"wikitext": "''test''",
		"parsed": "<apostrophes>''</><em>test</><apostrophes>''</>"
	},
	{
		"desc": "message transform: <noinclude> in transcluded template (T6926)",
		"wikitext": "{{Includes}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Includes</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "message transform: <onlyinclude> in transcluded template (T6926)",
		"wikitext": "{{Includes2}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Includes2</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "{{#special:}} page name, known",
		"wikitext": "{{#special:Recentchanges}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Recentchanges</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#special:}} page name with subpage, known",
		"wikitext": "{{#special:Recentchanges/param}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Recentchanges/param</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#special:}} page name, unknown",
		"wikitext": "{{#special:foobar nonexistent}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foobar nonexistent</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name, known",
		"wikitext": "{{#speciale:Recentchanges}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#speciale</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Recentchanges</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name with subpage, known",
		"wikitext": "{{#speciale:Recentchanges/param}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#speciale</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Recentchanges/param</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#speciale:}} page name, unknown",
		"wikitext": "{{#speciale:foobar nonexistent}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#speciale</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foobar nonexistent</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Subpage link",
		"wikitext": "[[/subpage]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Subpage noslash link",
		"wikitext": "[[/subpage/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Relative subpage noslash link",
		"wikitext": "[[../../subpage/]]\n\n[[../../subpage]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../../subpage/</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>../../subpage</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: dot-slash prefixed wikilinks",
		"wikitext": "[[./foo]]\n\n[[././bar]]\n\n[[././baz/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>./foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>././bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>././baz/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Render invalid page names as plain text (T53090)",
		"wikitext": "[[./../foo|bar]]\n[[foo�|bar]]\n[[foo/.|bar]]\n[[foo/..|bar]]\n[[foo~~~bar]]\n[[foo>bar]]\n[[foo[bar]]\n[[.]]\n[[..]]\n[[foo././bar]]\n[[foo[http://example.com]xyz]]\n\n[[{{1x|./../foo}}|bar]]\n[[{{1x|foo/.}}|bar]]\n[[{{1x|foo/..}}|bar]]\n[[{{1x|foo~~~~bar}}]]\n[[{{1x|foo>bar}}]]\n[[{{1x|foo././bar}}]]\n[[{{1x|foo{bar}}]]\n[[{{1x|foo}bar}}]]\n[[{{1x|foo[bar}}]]\n[[{{1x|foo]bar}}]]\n[[{{1x|foo<bar}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>./../foo</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo�</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo/.</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo/..</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo~~~bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo</><link-ground error>&gt</><link-ground link-pagename pagename>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo</><link-ground error>[</><link-ground link-pagename pagename>bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>.</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>..</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo././bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>foo</><link-ground error>[</><link-ground link-pagename pagename>http://example.com</><link-ground error>]</><link-ground link-pagename pagename>xyz</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>./../foo</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo/.</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo/..</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo</><signature>~~~~</><template-link-ground template>bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo&gtbar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo././bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo{bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo}bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo[bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo]bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>foo&lt;bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Disabled subpages",
		"wikitext": "[[/subpage]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2561: {{/Subpage}}",
		"wikitext": "{{/Subpage}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>/Subpage</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Subpage with namespaces",
		"wikitext": "[[User:../subpage]]\n[[meatball:../subpage]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>User:../subpage</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:../subpage</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T335847: Resolve forward slash title",
		"wikitext": "===123===",
		"parsed": "<section-header section--3>===</><section>123</><section-header>===</>"
	},
	{
		"desc": "T335847: Resolve subpage of control title",
		"wikitext": "[[../Hi]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../Hi</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T335847: Resolve subpage of forward slash title",
		"wikitext": "[[../Hi]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../Hi</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link to category",
		"wikitext": "[[:Category:MediaWiki User's Guide]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:Category:MediaWiki User's Guide</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Simple category",
		"wikitext": "[[Category:MediaWiki User's Guide]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Simple category with whitespace as sort key",
		"wikitext": "[[Category:Foo| ]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-delimiter>| </><link-ground link-bracket>]]</>"
	},
	{
		"desc": "PAGESINCATEGORY invalid title fatal (r33546 fix)",
		"wikitext": "{{PAGESINCATEGORY:<bogus>}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGESINCATEGORY</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>&lt;bogus&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Category with different sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with identical sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki User's Guide]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-delimiter>|</><link-ground link-text>MediaWiki User's Guide</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with identical sort key, except underscores",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki_User's_Guide]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-delimiter>|</><link-ground link-text>MediaWiki_User's_Guide</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with newline in sort key",
		"wikitext": "[[Category:Wikidata:Tools|\n*]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Wikidata:Tools</><link-ground link-delimiter>|</><link-ground link-text>*</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with template-generated sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|MediaWiki {{1x|Foo}} Guide]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-delimiter>|</><link-ground link-text>MediaWiki </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foo</><template-link-ground template-bracket>}}</><link-ground link-text> Guide</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category / paragraph interactions",
		"wikitext": "Foo [[Category:Baz]] Bar\n\nFoo [[Category:Baz]]\nBar\n\nFoo\n[[Category:Baz]]\nBar\n\nFoo\n[[Category:Baz]] Bar\n\nFoo\n[[Category:Baz]]\n [[Category:Baz]]\n[[Category:Baz]]\nBar\n\n[[Category:Baz]]\n [[Category:Baz]]\n[[Category:Baz]]\n\n[[Category:Baz]]\n {{1x|[[Category:Baz]]}}\n[[Category:Baz]]",
		"parsed": "Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</> BarFoo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</>BarFoo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</>BarFoo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</> BarFoo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</><skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</>Bar<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</><skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</><skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Baz</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category / non-newline whitespace interactions (T359886)",
		"wikitext": "* Foo[[Category:Foo]]Bar\n* Foo[[Category:Foo]] Bar\n* Foo [[Category:Foo]]Bar\n* Foo [[Category:Foo]] Bar\n\n* Foo[[Category:Foo]][[Category:Bar]]Bar\n* Foo[[Category:Foo]][[Category:Bar]] Bar\n* Foo[[Category:Foo]] [[Category:Bar]]Bar\n* Foo[[Category:Foo]] [[Category:Bar]] Bar\n* Foo [[Category:Foo]][[Category:Bar]]Bar\n* Foo [[Category:Foo]][[Category:Bar]] Bar\n* Foo [[Category:Foo]] [[Category:Bar]]Bar\n* Foo [[Category:Foo]] [[Category:Bar]] Bar",
		"parsed": "<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</> Bar"
	},
	{
		"desc": "Language link / non-newline whitespace interactions (T359886)",
		"wikitext": "* Foo[[es:Foo]]Bar\n* Foo[[es:Foo]] Bar\n* Foo [[es:Foo]]Bar\n* Foo [[es:Foo]] Bar\n\n* Foo[[es:Foo]][[es:Bar]]Bar\n* Foo[[es:Foo]][[es:Bar]] Bar\n* Foo[[es:Foo]] [[es:Bar]]Bar\n* Foo[[es:Foo]] [[es:Bar]] Bar\n* Foo [[es:Foo]][[es:Bar]]Bar\n* Foo [[es:Foo]][[es:Bar]] Bar\n* Foo [[es:Foo]] [[es:Bar]]Bar\n* Foo [[es:Foo]] [[es:Bar]] Bar",
		"parsed": "<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</> Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</>Bar<list>*</> Foo <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Foo</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Bar</><link-ground link-bracket>]]</> Bar"
	},
	{
		"desc": "1. Categories and newlines: All preceding newlines should be suppressed (courtesy T2087)",
		"wikitext": "This\n   \n[[Category:Foo]] and this should be part of same paragraph (not an indent-pre)\n   \n{{1x|[[Category:Foo]] and so should this!}}",
		"parsed": "This<skipformatting> </>  <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> and this should be part of same paragraph (not an indent-pre)<skipformatting> </>  <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Foo</><template-link-ground link-bracket>]]</><template-ground template> and so should this!</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "2. Categories and newlines: All preceding newlines should be suppressed (courtesy T2087)",
		"wikitext": "* This\n   \n[[Category:Foo]] and this should be part of the same list item\n* So should this\n\n{{1x|[[Category:Foo]] and this should be part of the same list item}}",
		"parsed": "<list>*</> This<skipformatting> </>  <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</> and this should be part of the same list item<list>*</> So should this<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Foo</><template-link-ground link-bracket>]]</><template-ground template> and this should be part of the same list item</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "3. Categories and newlines: newline suppression for last list item should RT properly",
		"wikitext": "*a\n*b\n   \n[[Category:Foo]]\n   \n[[Category:Bar]]\n[[Category:Baz]]\n\n:c\n\n[[Category:C]]\n\n;d\n\n[[Category:D]]",
		"parsed": "<list>*</>a<list>*</>b<skipformatting> </>  <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><skipformatting> </>  <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</><list>:</>c<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:C</><link-ground link-bracket>]]</><list>;</><strong>d</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:D</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "4. Categories and newlines: newline suppression for last list item should RT properly",
		"wikitext": "*a\n****b\n\n[[Category:Foo]]",
		"parsed": "<list>*</>a<list>****</>b<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "5. Categories and newlines: migrateTrailingCategories dom pass should only run on the rightmost path of nested lists",
		"wikitext": "*a\n**b\n[[Category:Foo]]\n*c\n**d\n[[Category:Foo]]",
		"parsed": "<list>*</>a<list>**</>b<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><list>*</>c<list>**</>d<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "6. Categories and newlines: migrateTrailingCategories dom pass should not migrate categories not preceded by newlines",
		"wikitext": "*a [[Category:Foo]]",
		"parsed": "<list>*</>a <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "7. Categories and newlines: migrateTrailingCategories dom pass should leave template content alone",
		"wikitext": "*{{1x|a\n[[Category:Foo]]}}",
		"parsed": "<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Foo</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "8. Categories and newlines: migrateTrailingCategories dom pass should not get tripped by intervening templates",
		"wikitext": "*a\n\n{{1x|[[Category:Foo]]\n[[Category:Bar]]}}\n[[Category:Baz]]",
		"parsed": "<list>*</>a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Foo</><template-link-ground link-bracket>]][[</><template-link-ground link-pagename pagename>Category:Bar</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Categories and newlines: migrateTrailingCategories dom pass should not get tripped by comments and whitespace",
		"wikitext": "*a\n\n[[Category:Bar]]<!--boo1--> <!--boo2-->\n[[Category:Baz]]<!--boo3--> <!--boo4-->",
		"parsed": "<list>*</>a<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</><comment>&lt;!--boo1--&gt</> <comment>&lt;!--boo2--&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Baz</><link-ground link-bracket>]]</><comment>&lt;!--boo3--&gt</> <comment>&lt;!--boo4--&gt</>"
	},
	{
		"desc": "No regressions on internal links following category (T174639)",
		"wikitext": "[[Category:Foo]]<div>a\n\n[[Foo]]</div>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>a<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "11. Special case where only newlines separate links (T175416)",
		"wikitext": "[[Category:Foo]]\n\n[[Foo]][[es:Alimento]]\n\n[[Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Alimento</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category links with multiple namespaces",
		"wikitext": "[[Category:Project:Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Project:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: Serialize link to category page with colon escape",
		"wikitext": "[[:Category:Foo]]\n[[:Category:Foo|Bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Category:Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: Serialize link to file page with colon escape",
		"wikitext": "[[:File:Foo.png]]\n[[:File:Foo.png|Bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:File:Foo.png</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:File:Foo.png</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: Serialize a genuine category link without colon escape",
		"wikitext": "[[Category:Foo]]\n[[Category:Foo|Bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Normalize hrefs properly before testing for invalid link targets (T72894)",
		"wikitext": "[[Category:Toxine bactérienne]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Toxine bactérienne</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Empty templates should be handled properly without being redlinked",
		"wikitext": "{{emptytemplate}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>emptytemplate</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort",
		"wikitext": "{{DEFAULTSORT:Foo}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Foo</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort variations (T236846)",
		"wikitext": "{{DEFAULTSORT}}\n\n{{DEFAULTSORT:}}\n{{DEFAULTSORT:DOGGIE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>DOGGIE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid html2wt b/c check: Defaultsort with key content being added (T236846)",
		"wikitext": "{{DEFAULTSORT:BIRD}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>BIRD</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Defaultsort (template-generated)",
		"wikitext": "{{{{1x|DEFAULTSORT}}:Foo}}",
		"parsed": "<template-ground template-bracket>{{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>DEFAULTSORT</><template2-ground template-bracket>}}</><template-ground template-name pagename>:Foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "{{defaultsort}} should be location-independent (T353530)",
		"wikitext": "[[Category:Foo]]\n{{DEFAULTSORT:Bar}}\n[[Category:Bat]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DEFAULTSORT</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Bar</><ext-ground parserfunction-bracket>}}</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bat</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Interlanguage links",
		"wikitext": "[[es:Alimento]]\n[[fr:Nourriture]]\n[[zh:食品]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Alimento</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>fr:Nourriture</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>zh:食品</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Duplicate interlanguage links (T26502)",
		"wikitext": "[[es:1]]\n[[es:2]]\n[[fr:1]]\n[[fr:2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>fr:1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>fr:2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Single-line or multiline-comments can follow headings",
		"wikitext": "==foo==<!---->\n==bar==<!--c1-->\n==baz==<!--\nc2\nc3-->",
		"parsed": "<section-header section--2>==</><section>foo</><section-header>==</><comment>&lt;!----&gt</><section-header section--2>==</><section>bar</><section-header>==</><comment>&lt;!--c1--&gt</><section-header section--2>==</><section>baz</><section-header>==</><comment>&lt;!--c2c3--&gt</>"
	},
	{
		"desc": "T3186 news: in the middle of text",
		"wikitext": "http://en.wikinews.org/wiki/Wikinews:Workplace",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>en.wikinews.org/wiki/Wikinews:Workplace</>"
	},
	{
		"desc": "Namespaced link must have a title",
		"wikitext": "[[Project:]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Project:</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Namespaced link must have a title (bad fragment version)",
		"wikitext": "[[Project:#fragment]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Project:</><link-ground link-tosection>#fragment</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "div with no attributes",
		"wikitext": "<div>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with double-quoted attribute",
		"wikitext": "<div id=\"rock\">HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"rock\"</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with single-quoted attribute",
		"wikitext": "<div id='rock'>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>'rock'</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with unquoted attribute",
		"wikitext": "<div id=rock>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>rock</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with illegal double attributes",
		"wikitext": "<div id=\"a\" id=\"b\">HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"a\"</><htmltag-attribute html-div> id=</><htmltag-attribute-value>\"b\"</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with empty attribute value, space before equals",
		"wikitext": "<div class =>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>class =</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with multiple empty attribute values",
		"wikitext": "<div id= title=>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id= </><htmltag-attribute-value>title=</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Extension tag in attribute value",
		"wikitext": "<span title=\"<html><div>123</div></html>\">ok</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"</><html><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>123<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</></html>\">ok<error>&lt;/span&gt</>"
	},
	{
		"desc": "table with multiple empty attribute values",
		"wikitext": "{| title= id=\n|hi\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>title= </><table-definition-value>id=</><table-delimiter>|</><table-td>hi</><table-bracket>|}</>"
	},
	{
		"desc": "div with braces in attribute value",
		"wikitext": "<div title=\"{}\">Foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"{}\"</><htmltag-bracket>&gt</>Foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "div with empty attribute value, no space before equals",
		"wikitext": "<div class=>HTML rocks</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>class=</><htmltag-bracket>&gt</>HTML rocks<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML multiple attributes correction",
		"wikitext": "<p class=\"error\" class=\"awesome\">Awesome!</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p </><htmltag-attribute html-p>class=</><htmltag-attribute-value>\"error\"</><htmltag-attribute html-p> class=</><htmltag-attribute-value>\"awesome\"</><htmltag-bracket>&gt</>Awesome!<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Table multiple attributes correction",
		"wikitext": "{|\n!+ class=\"error\" class=\"awesome\"|status\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><html-th table-definition>+ class=\"error\" class=\"awesome\"</><table-delimiter2>|</><table-th>status</><table-bracket>|}</>"
	},
	{
		"desc": "DIV IN UPPERCASE",
		"wikitext": "<DIV ID=\"x\">HTML ROCKS</DIV>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>DIV </><htmltag-attribute html-div>ID=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>HTML ROCKS<htmltag-bracket>&lt;/</><htmltag-name>DIV</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Non-ASCII pseudo-tags are rendered as text",
		"wikitext": "<khyô>",
		"parsed": "<khyô>"
	},
	{
		"desc": "Pseudo-tag with URL 'name' renders as url link",
		"wikitext": "<http://example.com/>",
		"parsed": "<<free-extlink-protocol>http://</><free-extlink>example.com/</>>"
	},
	{
		"desc": "text with amp in the middle of nowhere",
		"wikitext": "Remember AT&T?",
		"parsed": "Remember AT&T?"
	},
	{
		"desc": "text with character entity: eacute",
		"wikitext": "I always thought &eacute; was a cute letter.",
		"parsed": "I always thought <entity>&amp;eacute;</> was a cute letter."
	},
	{
		"desc": "text with entity-escaped character entity-like string: eacute",
		"wikitext": "I always thought &amp;eacute; was a cute letter.",
		"parsed": "I always thought <entity>&amp;amp;</>eacute; was a cute letter."
	},
	{
		"desc": "text with undefined character entity: xacute",
		"wikitext": "I always thought &xacute; was a cute letter.",
		"parsed": "I always thought <entity>&amp;xacute;</> was a cute letter."
	},
	{
		"desc": "Text with HTML5 semicolon-less entity (should not decode)",
		"wikitext": "&ampamp;",
		"parsed": "<entity>&amp;ampamp;</>"
	},
	{
		"desc": "HTML5 tags",
		"wikitext": "<data value=\"5\">five</data>\n<time datetime=\"2000-01-01T00:00Z\">The new millenium started</time>\n<mark>This highlighted text</mark>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>data </><htmltag-attribute html-data>value=</><htmltag-attribute-value>\"5\"</><htmltag-bracket>&gt</>five<htmltag-bracket>&lt;/</><htmltag-name>data</><htmltag-bracket>&gt&lt;</><htmltag-name>time </><htmltag-attribute html-time>datetime=</><htmltag-attribute-value>\"2000-01-01T00:00Z\"</><htmltag-bracket>&gt</>The new millenium started<htmltag-bracket>&lt;/</><htmltag-name>time</><htmltag-bracket>&gt&lt;</><htmltag-name>mark</><htmltag-bracket>&gt</>This highlighted text<htmltag-bracket>&lt;/</><htmltag-name>mark</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML tag with leading space is parsed as text",
		"wikitext": "< div>foo< /div>",
		"parsed": "< div>foo< /div>"
	},
	{
		"desc": "Element with broken attribute syntax",
		"wikitext": "<div style=\" style=\"123\">hi</div>\n<div =>ho</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\" style=\"</><htmltag-attribute html-div>123\"</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>=</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Ensure that HTML adoption agency algorithm is properly implemented.",
		"wikitext": "<small>X<small>Y</small>Z</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <kbd>",
		"wikitext": "<kbd>X<kbd>Y</kbd>Z</kbd>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>kbd</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>kbd</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>kbd</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>kbd</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <em>",
		"wikitext": "<em>X<em>Y</em>Z</em>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>em</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>em</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>em</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>em</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <strong>",
		"wikitext": "<strong>X<strong>Y</strong>Z</strong>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>strong</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>strong</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>strong</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>strong</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <q>",
		"wikitext": "<q>X<q>Y</q>Z</q>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>q</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>q</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>q</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>q</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <ruby>",
		"wikitext": "<ruby>X<ruby>Y</ruby>Z</ruby>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>ruby</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>ruby</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting of <bdo>",
		"wikitext": "<bdo>X<bdo>Y</bdo>Z</bdo>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>bdo</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;</><htmltag-name>bdo</><htmltag-bracket>&gt</>Y<htmltag-bracket>&lt;/</><htmltag-name>bdo</><htmltag-bracket>&gt</>Z<htmltag-bracket>&lt;/</><htmltag-name>bdo</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Media link",
		"wikitext": "[[Media:Foobar.jpg]]\n[[Media:Video.ogv]]\n[[:Media:Video.ogv]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Media:Video.ogv</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Media:Video.ogv</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link with text",
		"wikitext": "[[Media:Foobar.jpg|A neat file to look at]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-text>A neat file to look at</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link redirect",
		"wikitext": "[[Media:Redirect to foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Redirect to foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link with nasty text",
		"wikitext": "[[Media:Foobar.jpg|Safe Link<div style=display:none>\" onmouseover=\"alert(document.cookie)\" onfoo=\"</div>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-text>Safe Link</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>div </><link-ground htmltag-attribute html-div>style=</><link-ground htmltag-attribute-value>display:none</><link-ground htmltag-bracket>&gt</><link-ground link-text>\" onmouseover=\"alert(document.cookie)\" onfoo=\"</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>div</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link from missing resource (parsoid-only)",
		"wikitext": "[[Media:Foobar.jpg|Bat!]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-text>Bat!</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link from old 1.7.0 DOM spec (crash test, parsoid-only) T198511",
		"wikitext": "This is what Parsoid would emit (and we still handle this HTML fine):\n\n[[Media:Foobar.jpg|A neat file to look at]]\n\nBut VisualEditor would mangle the rel attribute, and give us back this:\n\n[http://example.com/images/3/3a/Foobar.jpg A neat file to look at]\n\nBut at least we don't crash when trying to handle the mangled HTML!",
		"parsed": "This is what Parsoid would emit (and we still handle this HTML fine):<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-text>A neat file to look at</><link-ground link-bracket>]]</>But VisualEditor would mangle the rel attribute, and give us back this:<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/images/3/3a/Foobar.jpg</><link-ground extlink-text> A neat file to look at</><link-ground extlink-bracket>]</>But at least we don't crash when trying to handle the mangled HTML!"
	},
	{
		"desc": "Media link to nonexistent file (T3702)",
		"wikitext": "[[Media:No such.jpg]]\n[[Media:No_such file.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:No such.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Media:No_such file.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media link with nested wikilinks",
		"wikitext": "[[Media:Foobar.jpg|[[Test]]]]\n[[Media:Foobar.jpg|[[File:Foobar.jpg]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-bracket>]]</>]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>]]"
	},
	{
		"desc": "Media link with multiple options",
		"wikitext": "[[Media:Foobar.jpg|123|345]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Foobar.jpg</><link-ground link-delimiter>|</><link-ground link-text>123|345</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Character reference normalization in link text (T3938)",
		"wikitext": "[[Main Page|this&that]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>this&amp;that</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "(T21451) Links should refer to the normalized form.",
		"wikitext": "[[&#xFB2E;]]\n[[&#x5d0;&#x5b7;]]\n[[&#x5d0;ַ]]\n[[א&#x5b7;]]\n[[אַ]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>&amp;#xFB2E;</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>&amp;#x5d0;&amp;#x5b7;</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>&amp;#x5d0;ַ</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>א&amp;#x5b7;</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>אַ</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Empty attribute crash test (T4067)",
		"wikitext": "<font color=\"\">foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-attribute-value>\"\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Empty attribute crash test single-quotes (T4067)",
		"wikitext": "<font color=''>foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-attribute-value>''</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Attribute test: equals, then nothing",
		"wikitext": "<font color=>foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Attribute test: unquoted value",
		"wikitext": "<font color=x>foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-attribute-value>x</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Attribute test: unquoted but illegal value (hash)",
		"wikitext": "<font color=#x>foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-attribute-value>#x</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Attribute test: no value (T54330)",
		"wikitext": "<font color>foo</font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4095: link with three closing brackets",
		"wikitext": "[[Main Page]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>]"
	},
	{
		"desc": "T4095: link with pipe and three closing brackets",
		"wikitext": "[[Main Page|link]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>link</><link-ground link-bracket>]]</>]"
	},
	{
		"desc": "T4095: link with pipe and three closing brackets, version 2",
		"wikitext": "[[Main Page|[http://example.com/]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>[http://example.com/]</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T4304: HTML attribute safety (safe template; regression T4309)",
		"wikitext": "<div title=\"{{test}}\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"</><template-ground template-bracket>{{</><template-ground template-name pagename>test</><template-ground template-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (dangerous template; 2309)",
		"wikitext": "<div title=\"{{dangerous attribute}}\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"</><template-ground template-bracket>{{</><template-ground template-name pagename>dangerous attribute</><template-ground template-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (dangerous style template; 2309)",
		"wikitext": "<div style=\"{{dangerous style attribute}}\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"</><template-ground template-bracket>{{</><template-ground template-name pagename>dangerous style attribute</><template-ground template-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (safe parameter; 2309)",
		"wikitext": "{{div style|width: 200px}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>div style</><template-ground template-delimiter>|</><template-ground template>width: 200px</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe parameter; 2309)",
		"wikitext": "{{div style|width: expression(alert(document.cookie))}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>div style</><template-ground template-delimiter>|</><template-ground template>width: expression(alert(document.cookie))</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe breakout parameter; 2309)",
		"wikitext": "{{div style|\"><script>alert(document.cookie)</script>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>div style</><template-ground template-delimiter>|</><template-ground template>\"&gt&lt;script&gtalert(document.cookie)&lt;/script&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (unsafe breakout parameter 2; 2309)",
		"wikitext": "{{div style|\" ><script>alert(document.cookie)</script>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>div style</><template-ground template-delimiter>|</><template-ground template>\" &gt&lt;script&gtalert(document.cookie)&lt;/script&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T4304: HTML attribute safety (link)",
		"wikitext": "<div title=\"[[Main Page]]\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"[[Main Page]]\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (italics)",
		"wikitext": "<div title=\"''foobar''\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"''foobar''\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (bold)",
		"wikitext": "<div title=\"'''foobar'''\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"'''foobar'''\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (ISBN)",
		"wikitext": "<div title=\"ISBN 1234567890\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"ISBN 1234567890\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (RFC)",
		"wikitext": "<div title=\"RFC 1234\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"RFC 1234\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (PMID)",
		"wikitext": "<div title=\"PMID 1234567890\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"PMID 1234567890\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (web link)",
		"wikitext": "<div title=\"http://example.com/\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"http://example.com/\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T4304: HTML attribute safety (named web link)",
		"wikitext": "<div title=\"[http://example.com/ link]\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"[http://example.com/ link]\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T5244: HTML attribute safety (extension; safe)",
		"wikitext": "<div style=\"<nowiki>background:blue</nowiki>\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>background:blue</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T5244: HTML attribute safety (extension; unsafe)",
		"wikitext": "<div style=\"<nowiki>border-left:expression(alert(document.cookie))</nowiki>\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>border-left:expression(alert(document.cookie))</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "MSIE CSS safety test: spurious slash",
		"wikitext": "<div style=\"background-image:u\\rl(javascript:alert('boo'))\">evil</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image:u\\rl(javascript:alert('boo'))\"</><htmltag-bracket>&gt</>evil<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "MSIE CSS safety test: hex code",
		"wikitext": "<div style=\"background-image:u\\72l(javascript:alert('boo'))\">evil</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image:u\\72l(javascript:alert('boo'))\"</><htmltag-bracket>&gt</>evil<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "MSIE CSS safety test: comment in url",
		"wikitext": "<div style=\"background-image:u/**/rl(javascript:alert('boo'))\">evil</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image:u/**/rl(javascript:alert('boo'))\"</><htmltag-bracket>&gt</>evil<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "MSIE CSS safety test: comment in expression",
		"wikitext": "<div style=\"background-image:expres/**/sion(alert('boo4'))\">evil4</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image:expres/**/sion(alert('boo4'))\"</><htmltag-bracket>&gt</>evil4<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "CSS safety test (all browsers): vertical tab (T57332 / CVE-2013-4567)",
		"wikitext": "<p style=\"font-size: 100px; background-image:url\\b(https://www.google.com/images/srpr/logo6w.png)\">A</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p </><htmltag-attribute html-p>style=</><htmltag-attribute-value>\"font-size: 100px; background-image:url\\b(https://www.google.com/images/srpr/logo6w.png)\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Opera -o-link CSS",
		"wikitext": "<div\ntitle=\"&#100;&#97;&#116;&#97;&#58;&#116;&#101;&#120;&#116;&#47;&#104;&#116;&#109;&#108;&#44;&#60;&#105;&#109;&#103;&#32;&#115;&#114;&#99;&#61;&#49;&#32;&#111;&#110;&#101;&#114;&#114;&#111;&#114;&#61;&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;&#62;\"\nstyle=\"-o-link:attr(title);-o-link-source:current\">X</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"</><entity>&amp;#100;&amp;#97;&amp;#116;&amp;#97;&amp;#58;&amp;#116;&amp;#101;&amp;#120;&amp;#116;&amp;#47;&amp;#104;&amp;#116;&amp;#109;&amp;#108;&amp;#44;&amp;#60;&amp;#105;&amp;#109;&amp;#103;&amp;#32;&amp;#115;&amp;#114;&amp;#99;&amp;#61;&amp;#49;&amp;#32;&amp;#111;&amp;#110;&amp;#101;&amp;#114;&amp;#114;&amp;#111;&amp;#114;&amp;#61;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#62;</><htmltag-attribute-value>\"</><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"-o-link:attr(title);-o-link-source:current\"</><htmltag-bracket>&gt</>X<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Table attribute legitimate extension",
		"wikitext": "{|\n!+ style=\"<nowiki>color:blue</nowiki>\"|status\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><html-th table-definition>+ style=\"</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>color:blue</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><html-th table-definition>\"</><table-delimiter2>|</><table-th>status</><table-bracket>|}</>"
	},
	{
		"desc": "Table attribute safety",
		"wikitext": "{|\n!+ style=\"<nowiki>border-width:expression(0+alert(document.cookie))</nowiki>\"|status\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><html-th table-definition>+ style=\"</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>border-width:expression(0+alert(document.cookie))</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><html-th table-definition>\"</><table-delimiter2>|</><table-th>status</><table-bracket>|}</>"
	},
	{
		"desc": "CSS line continuation 1",
		"wikitext": "<div style=\"background-image: u\\&#10;rl(test.jpg);\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image: u\\</><entity>&amp;#10;</><htmltag-attribute-value>rl(test.jpg);\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "CSS line continuation 2",
		"wikitext": "<div style=\"background-image: u\\&#13;rl(test.jpg); \"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background-image: u\\</><entity>&amp;#13;</><htmltag-attribute-value>rl(test.jpg); \"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Allow aria attributes",
		"wikitext": "<span aria-describedby=\"id1\" aria-flowto=\"id2\" aria-hidden=\"true\" aria-label=\"id3\" aria-labelledby=\"id4\" aria-level=\"3\" aria-owns=\"id5\">foo</span>\n<span aria-bogus=\"stripped\">bar</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>aria-describedby=</><htmltag-attribute-value>\"id1\"</><htmltag-attribute html-span> aria-flowto=</><htmltag-attribute-value>\"id2\"</><htmltag-attribute html-span> aria-hidden=</><htmltag-attribute-value>\"true\"</><htmltag-attribute html-span> aria-label=</><htmltag-attribute-value>\"id3\"</><htmltag-attribute html-span> aria-labelledby=</><htmltag-attribute-value>\"id4\"</><htmltag-attribute html-span> aria-level=</><htmltag-attribute-value>\"3\"</><htmltag-attribute html-span> aria-owns=</><htmltag-attribute-value>\"id5\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>span </><htmltag-attribute html-span>aria-bogus=</><htmltag-attribute-value>\"stripped\"</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255)",
		"wikitext": "<div style=\"background: {{1x|#00FF00}}\">-</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background: </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>#00FF00</><template-ground template-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>-<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Expansion of multi-line parser-functions in attribute values (T8255)",
		"wikitext": "<div style=\"background: {{#if:1|#00FF00|#FF00FF}}\">-</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background: </><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>#00FF00</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>#FF00FF</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>-<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255 check)",
		"wikitext": "<div style=\"background:\n#00FF00\">-</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background:#00FF00\"</><htmltag-bracket>&gt</>-<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Expansion of multi-line templates in attribute values (T8255 check 2)",
		"wikitext": "<div style=\"background: &#10;#00FF00\">-</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"background: </><entity>&amp;#10;</><htmltag-attribute-value>#00FF00\"</><htmltag-bracket>&gt</>-<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Tags which are hidden from tidiers cannot pass through the Sanitizer",
		"wikitext": "<mw:editsection><script>alert();</script></mw:editsection>\n\n<meta property=\"mw:PageProp/toc\" />",
		"parsed": "<mw:editsection><script>alert();</script></mw:editsection><htmltag-bracket>&lt;</><htmltag-name>meta </><htmltag-attribute html-meta>property=</><htmltag-attribute-value>\"mw:PageProp/toc\"</><htmltag-attribute html-meta> </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "Nested template calls",
		"wikitext": "{{Map-one-parameter|One-parameter|param}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Map-one-parameter</><template-ground template-delimiter>|</><template-ground template>One-parameter</><template-ground template-delimiter>|</><template-ground template>param</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Sanitizer: Closing of open tags",
		"wikitext": "<s></s><table></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt&lt;/</><htmltag-name>s</><htmltag-bracket>&gt&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Sanitizer: Closing of open but not closed tags",
		"wikitext": "<s>foo",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt</>foo"
	},
	{
		"desc": "Sanitizer: Closing of closed but not open tags",
		"wikitext": "</s>",
		"parsed": "<error>&lt;/s&gt</>"
	},
	{
		"desc": "Sanitizer: Closing of closed but not open table tags",
		"wikitext": "Table not started</td></tr></table>",
		"parsed": "Table not started<error>&lt;/td&gt&lt;/tr&gt&lt;/table&gt</>"
	},
	{
		"desc": "Sanitizer: Escaping of spaces, multibyte characters, colons & other stuff in id=\"\"",
		"wikitext": "<span id=\"æ: v\">byte</span>[[#æ: v|backlink]]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"æ: v\"</><htmltag-bracket>&gt</>byte<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#æ: v</><link-ground link-delimiter>|</><link-ground link-text>backlink</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Sanitizer: Escaping of spaces, multibyte characters, colons & other stuff in id=\"\" (legacy)",
		"wikitext": "<span id=\"æ: v\">byte</span>[[#æ: v|backlink]]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"æ: v\"</><htmltag-bracket>&gt</>byte<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#æ: v</><link-ground link-delimiter>|</><link-ground link-text>backlink</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Sanitizer: Validating the contents of the id attribute (T6515)",
		"wikitext": "<br id=\"\" /><br id=\"a space\" />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>id=</><htmltag-attribute-value>\"\"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>id=</><htmltag-attribute-value>\"a space\"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "Sanitizer: Validating id attribute uniqueness (T6515, T8301)",
		"wikitext": "<br id=\"foo\" /><br id=\"foo\" />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>id=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt&lt;</><htmltag-name>br </><htmltag-attribute html-br>id=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "Sanitizer: Validating that <meta> and <link> work, but only for Microdata",
		"wikitext": "<div itemscope>\n\t<meta itemprop=\"hello\" content=\"world\">\n\t<meta http-equiv=\"refresh\" content=\"5\">\n\t<meta itemprop=\"hello\" http-equiv=\"refresh\" content=\"5\">\n\t<link itemprop=\"hello\" href=\"{{SERVER}}\">\n\t<link rel=\"stylesheet\" href=\"{{SERVER}}\">\n\t<link rel=\"stylesheet\" itemprop=\"hello\" href=\"{{SERVER}}\">\n</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>itemscope</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>meta </><htmltag-attribute html-meta>itemprop=</><htmltag-attribute-value>\"hello\"</><htmltag-attribute html-meta> content=</><htmltag-attribute-value>\"world\"</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>meta </><htmltag-attribute html-meta>http-equiv=</><htmltag-attribute-value>\"refresh\"</><htmltag-attribute html-meta> content=</><htmltag-attribute-value>\"5\"</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>meta </><htmltag-attribute html-meta>itemprop=</><htmltag-attribute-value>\"hello\"</><htmltag-attribute html-meta> http-equiv=</><htmltag-attribute-value>\"refresh\"</><htmltag-attribute html-meta> content=</><htmltag-attribute-value>\"5\"</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>itemprop=</><htmltag-attribute-value>\"hello\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SERVER</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"stylesheet\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SERVER</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>\t<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"stylesheet\"</><htmltag-attribute html-link> itemprop=</><htmltag-attribute-value>\"hello\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SERVER</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Sanitizer: Strip comments from CSS attributes",
		"wikitext": "<span style=\"margin:/*negate mbox-text padding */-0.125em -0.45em; /*rainbow*/rgba(255, 0, 0, 0.3)\">2013</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>style=</><htmltag-attribute-value>\"margin:/*negate mbox-text padding */-0.125em -0.45em; /*rainbow*/rgba(255, 0, 0, 0.3)\"</><htmltag-bracket>&gt</>2013<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Sanitizer: Avoid unnecessary percent encoded characters in interwiki links",
		"wikitext": "[[meatball:Soft\"Security]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>meatball:Soft\"Security</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Sanitizer: angle brackets are invalid, even in interwiki links (T182338)",
		"wikitext": "[[meatball:Foo<Bar]]\n[[meatball:Foo>Bar]]\n[[meatball:Foo&lt;bar]]\n[[meatball:Foo&gt;bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>meatball:Foo</><link-ground error>&lt;</><link-ground link-pagename pagename>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:Foo</><link-ground error>&gt</><link-ground link-pagename pagename>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:Foo&amp;lt;bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:Foo&amp;gt;bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Self closed html pairs (T7487)",
		"wikitext": "<center><font id=\"bug\" />Centered text</center>\n<div><font id=\"bug2\" />In div text</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>center</><htmltag-bracket>&gt&lt;</><htmltag-name>font </><htmltag-attribute html-font>id=</><htmltag-attribute-value>\"bug\"</><htmltag-attribute html-font> </><htmltag-bracket>/&gt</>Centered text<error>&lt;/center&gt</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>font </><htmltag-attribute html-font>id=</><htmltag-attribute-value>\"bug2\"</><htmltag-attribute html-font> </><htmltag-bracket>/&gt</>In div text<error>&lt;/div&gt</>"
	},
	{
		"desc": "Punctuation: nbsp before exclamation",
		"wikitext": "C'est grave !",
		"parsed": "C'est grave !"
	},
	{
		"desc": "Punctuation: CSS !important (T13874)",
		"wikitext": "<div style=\"width:50% !important\">important</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"width:50% !important\"</><htmltag-bracket>&gt</>important<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Punctuation: CSS ! important (T13874; with space after)",
		"wikitext": "<div style=\"width:50% ! important\">important</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"width:50% ! important\"</><htmltag-bracket>&gt</>important<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML bullet list, closed tags (T7497)",
		"wikitext": "<ul>\n<li>One</li>\n<li>Two</li>\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML bullet list, unclosed tags (T7497)",
		"wikitext": "<ul>\n<li>One\n<li>Two\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two<error>&lt;/ul&gt</>"
	},
	{
		"desc": "HTML ordered list, closed tags (T7497)",
		"wikitext": "<ol>\n<li>One</li>\n<li>Two</li>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML ordered list, unclosed tags (T7497)",
		"wikitext": "<ol>\n<li>One\n<li>Two\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two<error>&lt;/ol&gt</>"
	},
	{
		"desc": "HTML nested bullet list, closed tags (T7497)",
		"wikitext": "<ul>\n<li>One</li>\n<li>Two:\n<ul>\n<li>Sub-one</li>\n<li>Sub-two</li>\n</ul>\n</li>\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two:<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-one<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-two<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML nested bullet list, open tags (T7497)",
		"wikitext": "<ul>\n<li>One\n<li>Two:\n<ul>\n<li>Sub-one\n<li>Sub-two\n</ul>\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two:<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-one<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-two<error>&lt;/ul&gt&lt;/ul&gt</>"
	},
	{
		"desc": "HTML nested ordered list, closed tags (T7497)",
		"wikitext": "<ol>\n<li>One</li>\n<li>Two:\n<ol>\n<li>Sub-one</li>\n<li>Sub-two</li>\n</ol>\n</li>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two:<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-one<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-two<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML nested ordered list, open tags (T7497)",
		"wikitext": "<ol>\n<li>One\n<li>Two:\n<ol>\n<li>Sub-one\n<li>Sub-two\n</ol>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Two:<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-one<htmltag-bracket>&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>Sub-two<error>&lt;/ol&gt&lt;/ol&gt</>"
	},
	{
		"desc": "HTML ordered list item with parameters oddity",
		"wikitext": "<ol><li id=\"fragment\">One</li>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li </><htmltag-attribute html-li>id=</><htmltag-attribute-value>\"fragment\"</><htmltag-bracket>&gt</>One<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T7918: autonumbering",
		"wikitext": "[http://first/] [http://second] [ftp://ftp]\n\nftp://inlineftp\n\n[mailto:enclosed@mail.tld With target]\n\n[mailto:enclosed@mail.tld]\n\nmailto:inline@mail.tld",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>first/</><link-ground extlink-bracket>]</> <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>second</><link-ground extlink-bracket>]</> <link-ground extlink-bracket>[</><link-ground extlink-protocol>ftp://</><link-ground extlink>ftp</><link-ground extlink-bracket>]</><free-extlink-protocol>ftp://</><free-extlink>inlineftp</><link-ground extlink-bracket>[</><link-ground extlink-protocol>mailto:</><link-ground extlink>enclosed@mail.tld</><link-ground extlink-text> With target</><link-ground extlink-bracket>][</><link-ground extlink-protocol>mailto:</><link-ground extlink>enclosed@mail.tld</><link-ground extlink-bracket>]</><free-extlink-protocol>mailto:</><free-extlink>inline@mail.tld</>"
	},
	{
		"desc": "Fuzz testing: Parser13",
		"wikitext": "{| \n| http://a|",
		"parsed": "<table-bracket>{| </><table-delimiter>| </><html-td table-definition>http://a</><table-delimiter2>|</>"
	},
	{
		"desc": "Fuzz testing: Parser16",
		"wikitext": "{|\n!https://||||||",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>https://</><table-delimiter>||||||</>"
	},
	{
		"desc": "Fuzz testing: Parser21",
		"wikitext": "{|\n!irc://{{ftp://a\" onmouseover=\"alert('hello world');\"\n|",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>irc://</><template-ground template-bracket>{{</><template-ground template-name pagename>ftp://a\" onmouseover=\"alert('hello world');\"</><template-ground template-delimiter>|</>"
	},
	{
		"desc": "Fuzz testing: Parser22",
		"wikitext": "http://===r:::https://b\n\n{|",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>===r:::https://b</><table-bracket>{|</>"
	},
	{
		"desc": "Fuzz testing: Parser24 (minimized)",
		"wikitext": "{{<u {{{{[[Sx-->}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground error>&lt;</><template-ground template-name pagename>u </><template2-ground template-bracket>{{</><template3-ground template-bracket>{{</><template3-ground error>[[</><template3-ground template-name pagename>Sx--</><template3-ground error>&gt</><template3-ground template-bracket>}}</>"
	},
	{
		"desc": "Fuzz testing: Parser24",
		"wikitext": "{|\n{{{|\n<u CLASS=\n| {{{{SSSll!!!!!!!VVVV)]]][[Special:*xxxxxxx--><noinclude>}}}} >\n<br style=\"onmouseover='alert(document.cookie);' \" />\n\nMOVE YOUR MOUSE CURSOR OVER THIS TEXT\n|",
		"parsed": "<table-bracket>{|</><templatevariable-bracket>{{{</><templatevariable-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>u </><htmltag-attribute html-u>CLASS=</><templatevariable-delimiter>|</><template-ground template-bracket> {{</><template2-ground template-bracket>{{</><template2-ground template-name pagename>SSSll!!!!!!!VVVV)</><template2-ground error>]]][[</><template2-ground template-name pagename>Special:*xxxxxxx--</><template2-ground error>&gt</><comment>&lt;noinclude&gt</><templatevariable-bracket>}}}</><error>} &gt</><htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\"onmouseover='alert(document.cookie);' \"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt</><error>MOVE YOUR MOUSE CURSOR OVER THIS TEXT</><table-delimiter>|</>"
	},
	{
		"desc": "Fuzz testing: Parser25 (T8055)",
		"wikitext": "{{{\n| \n<LI CLASS=||\n >\n}}}blah\" onmouseover=\"alert('hello world');\" align=\"left\"'''MOVE MOUSE CURSOR OVER HERE",
		"parsed": "<templatevariable-bracket>{{{</><templatevariable-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>LI </><htmltag-attribute html-li>CLASS=</><templatevariable-delimiter>||</><comment> &gt</><templatevariable-bracket>}}}</>blah\" onmouseover=\"alert('hello world');\" align=\"left\"<apostrophes>'''</><strong>MOVE MOUSE CURSOR OVER HERE</>"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (with space, clean)",
		"wikitext": "http://example.com <nowiki>junk</nowiki>",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>junk</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (no space, dirty; nowiki)",
		"wikitext": "http://example.com<nowiki>junk</nowiki>",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>junk</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Fuzz testing: URL adjacent extension (no space, dirty; pre)",
		"wikitext": "http://example.com<pre>junk</pre>",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>junk</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Fuzz testing: encoded newline in generated HTML replacements (T8577)",
		"wikitext": "<pre dir=\"&#10;\"></pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>dir=</><exttag-attribute-value>\"&amp;#10;\"</><exttag-bracket>&gt&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Fuzz testing: encoded newline in generated HTML replacements, html2wt (T8577)",
		"wikitext": "<pre dir=\"\n\"></pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>dir=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Templates in extension attributes are not expanded",
		"wikitext": "<pre dir=\"{{1x|ltr}}\"></pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>dir=</><exttag-attribute-value>\"{{1x|ltr}}\"</><exttag-bracket>&gt&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Parsing optional HTML elements (T8171)",
		"wikitext": "<table>\n  <tr>\n    <td> Some tabular data</td>\n    <td> More tabular data ...\n    <td> And yet som tabular data</td>\n  </tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><skipformatting> </> <htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> Some tabular data<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> More tabular data ...<skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> And yet som tabular data<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </> <error>&lt;/tr&gt&lt;/table&gt</>"
	},
	{
		"desc": "Correct handling of <td>, <tr> (T8171)",
		"wikitext": "<table>\n  <tr>\n    <td> Some tabular data</td>\n    <td> More tabular data ...</td>\n    <td> And yet som tabular data</td>\n  </tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><skipformatting> </> <htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> Some tabular data<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> More tabular data ...<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> And yet som tabular data<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </> <htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parsing crashing regression (fr:JavaScript)",
		"wikitext": "</body></x>",
		"parsed": "</body></x>"
	},
	{
		"desc": "Inline wiki vs wiki block nesting",
		"wikitext": "'''Bold paragraph\n\nNew wiki paragraph",
		"parsed": "<apostrophes>'''</><strong>Bold paragraph</>New wiki paragraph"
	},
	{
		"desc": "Inline HTML vs wiki block nesting",
		"wikitext": "<b>Bold paragraph\n\nNew wiki paragraph",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</>Bold paragraphNew wiki paragraph"
	},
	{
		"desc": "Mixing markup for italics and bold",
		"wikitext": "'''bold''''''bold''bolditalics'''''",
		"parsed": "'<apostrophes>''</><em>bold'</><apostrophes>'''''</><strong>bold</><apostrophes>''</><strong em>bolditalics</><apostrophes>'''''</>"
	},
	{
		"desc": "Special page transclusion",
		"wikitext": "{{Special:Prefixindex/Xyzzyx}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Special:Prefixindex/Xyzzyx</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Special page transclusion twice (T7021)",
		"wikitext": "{{Special:Prefixindex/Xyzzyx}}\n{{Special:Prefixindex/Xyzzyx}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Special:Prefixindex/Xyzzyx</><template-ground template-bracket>}}{{</><template-ground template-name pagename>Special:Prefixindex/Xyzzyx</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Transclusion of default MediaWiki message",
		"wikitext": "{{MediaWiki:Mainpage}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>MediaWiki:Mainpage</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Transclusion of nonexistent MediaWiki message",
		"wikitext": "{{MediaWiki:Mainpagexxx}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>MediaWiki:Mainpagexxx</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Transclusion of MediaWiki message with underscore",
		"wikitext": "{{MediaWiki:history_short}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>MediaWiki:history_short</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Transclusion of MediaWiki message with space",
		"wikitext": "{{MediaWiki:history short}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>MediaWiki:history short</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Invalid header with following text",
		"wikitext": "= x = y",
		"parsed": "= x = y"
	},
	{
		"desc": "Section extraction test (section 0)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 1)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 2)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 3)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 4)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 5)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 6)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 7)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 8)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 9)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (section 10)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test (nonexistent section 11)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section extraction test with bogus heading (section 1)",
		"wikitext": "==a==\n==bogus== not a legal section\n==b==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</>==bogus== not a legal section<section-header section--2>==</><section>b</><section-header>==</>"
	},
	{
		"desc": "Section extraction test with bogus heading (section 2)",
		"wikitext": "==a==\n==bogus== not a legal section\n==b==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</>==bogus== not a legal section<section-header section--2>==</><section>b</><section-header>==</>"
	},
	{
		"desc": "Section extraction test with comment after heading (section 1)",
		"wikitext": "==a==\n==b== <!-- -->\n==c==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><section-header section--2>==</><section>b</><section-header>== </><comment>&lt;!-- --&gt</><section-header section--2>==</><section>c</><section-header>==</>"
	},
	{
		"desc": "Section extraction test with comment after heading (section 2)",
		"wikitext": "==a==\n==b== <!-- -->\n==c==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><section-header section--2>==</><section>b</><section-header>== </><comment>&lt;!-- --&gt</><section-header section--2>==</><section>c</><section-header>==</>"
	},
	{
		"desc": "Section extraction test with bogus <nowiki> heading (section 1)",
		"wikitext": "==a==\n==bogus== <nowiki>not a legal section</nowiki>\n==b==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</>==bogus== <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>not a legal section</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header section--2>==</><section>b</><section-header>==</>"
	},
	{
		"desc": "Section extraction test with bogus <nowiki> heading (section 2)",
		"wikitext": "==a==\n==bogus== <nowiki>not a legal section</nowiki>\n==b==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</>==bogus== <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>not a legal section</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header section--2>==</><section>b</><section-header>==</>"
	},
	{
		"desc": "Section extraction prefixed by comment (section 1)",
		"wikitext": "<!-- -->==sec1==\n==sec2==",
		"parsed": "<comment>&lt;!-- --&gt</>==sec1==<section-header section--2>==</><section>sec2</><section-header>==</>"
	},
	{
		"desc": "Section extraction prefixed by comment (section 2)",
		"wikitext": "<!-- -->==sec1==\n==sec2==",
		"parsed": "<comment>&lt;!-- --&gt</>==sec1==<section-header section--2>==</><section>sec2</><section-header>==</>"
	},
	{
		"desc": "Section extraction, mixed wiki and html (section 1)",
		"wikitext": "<h2>unmarked</h2>\nunmarked\n==1==\none\n==2==\ntwo",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>unmarked<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt</>unmarked<section-header section--2>==</><section>1</><section-header>==</>one<section-header section--2>==</><section>2</><section-header>==</>two"
	},
	{
		"desc": "Section extraction, mixed wiki and html (section 2)",
		"wikitext": "<h2>unmarked</h2>\nunmarked\n==1==\none\n==2==\ntwo",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>unmarked<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt</>unmarked<section-header section--2>==</><section>1</><section-header>==</>one<section-header section--2>==</><section>2</><section-header>==</>two"
	},
	{
		"desc": "Section extraction, heading surrounded by <noinclude>",
		"wikitext": "<noinclude>==unmarked==</noinclude>\n==marked==",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>==unmarked==</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><section-header section--2>==</><section>marked</><section-header>==</>"
	},
	{
		"desc": "Sectiion with all-equals",
		"wikitext": "=== \nThe line above must have a trailing space\n=== <!--\n--> <!-- -->\nBut just in case it doesn't...",
		"parsed": "<section-header section--1>=</><section>=</><section-header>= </>The line above must have a trailing space<section-header section--1>=</><section>=</><section-header>= </><comment>&lt;!----&gt</> <comment>&lt;!-- --&gt</>But just in case it doesn't..."
	},
	{
		"desc": "Section replacement test (section 0)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 1)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 2)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 3)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 4)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 5)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 6)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 7)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 8)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 9)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test (section 10)",
		"wikitext": "start\n==a==\n===aa===\n====aaa====\n==b==\n===ba===\n===bb===\n====bba====\n===bc===\n==c==\n===ca===",
		"parsed": "start<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>aa</><section-header>===</><section-header section--4>====</><section>aaa</><section-header>====</><section-header section--2>==</><section>b</><section-header>==</><section-header section--3>===</><section>ba</><section-header>===</><section-header section--3>===</><section>bb</><section-header>===</><section-header section--4>====</><section>bba</><section-header>====</><section-header section--3>===</><section>bc</><section-header>===</><section-header section--2>==</><section>c</><section-header>==</><section-header section--3>===</><section>ca</><section-header>===</>"
	},
	{
		"desc": "Section replacement test with initial whitespace (T15728)",
		"wikitext": " Preformatted initial line\n==a==\n===a===",
		"parsed": "<skipformatting> </>Preformatted initial line<section-header section--2>==</><section>a</><section-header>==</><section-header section--3>===</><section>a</><section-header>===</>"
	},
	{
		"desc": "Section extraction, heading followed by pre with 20 spaces (T8398)",
		"wikitext": "==a==\n                    a",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><skipformatting> </>                   a"
	},
	{
		"desc": "Section extraction, heading followed by pre with 19 spaces (T8398 check)",
		"wikitext": "==a==\n                   a",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><skipformatting> </>                  a"
	},
	{
		"desc": "Section extraction, <pre> around bogus header (T12309)",
		"wikitext": "== Section One ==\n<pre>\n=======\n</pre>\n\n== Section Two ==\nstuff",
		"parsed": "<section-header section--2>==</><section> Section One </><section-header>==</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>=======</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><section-header section--2>==</><section> Section Two </><section-header>==</>stuff"
	},
	{
		"desc": "Section replacement, <pre> around bogus header (T12309)",
		"wikitext": "== Section One ==\n<pre>\n=======\n</pre>\n\n== Section Two ==\nstuff",
		"parsed": "<section-header section--2>==</><section> Section One </><section-header>==</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>=======</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><section-header section--2>==</><section> Section Two </><section-header>==</>stuff"
	},
	{
		"desc": "Handling of &#x0A; in URLs",
		"wikitext": "*irc://&#x0A;a",
		"parsed": "<list>*</>irc://<entity>&amp;#x0A;</>a"
	},
	{
		"desc": "Handling of %0A in URLs",
		"wikitext": "*irc://%0Aa",
		"parsed": "<list>*</>irc://%0Aa"
	},
	{
		"desc": "5 quotes, code coverage +1 line",
		"wikitext": "'''''",
		"parsed": "<apostrophes>'''''</>"
	},
	{
		"desc": "Special:Search page linking.",
		"wikitext": "{{Special:search}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Special:search</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "{{!}} is a magic word",
		"wikitext": "{{!}} is a magic word there and {{!}} is still a magic word here\n| is not a magic word here but {{!}} is still a magic word here",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>!</><ext-ground parserfunction-bracket>}}</> is a magic word there and <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>!</><ext-ground parserfunction-bracket>}}</> is still a magic word here| is not a magic word here but <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>!</><ext-ground parserfunction-bracket>}}</> is still a magic word here"
	},
	{
		"desc": "Single {{!}} in table cell",
		"wikitext": "{|\n| colspan=\"1\" |foo {{!}} bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>colspan=\"1\" </><table-delimiter2>|</><table-td>foo </><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>!</><ext-ground parserfunction-bracket>}}</><table-td> bar</><table-bracket>|}</>"
	},
	{
		"desc": "Using {{!}} in wikilinks (T290526)",
		"wikitext": "[[Main Page{{!}}Something else]]\n\n[[{{T290526}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>!</><ext-link-ground parserfunction-bracket>}}</><link-ground link-pagename pagename>Something else</><link-ground link-bracket>]][[</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>T290526</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Using {{!}} in template arguments (T290526)",
		"wikitext": "{{1x|Main Page{{!}}Something else}}\n\n{{1x|{{T290526}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Main Page</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>Something else</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>T290526</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Using {{!}} in template arguments, part 2 (T290526)",
		"wikitext": "{{ Main Page|Something else }}\n\n{{ {{T290526}} }}",
		"parsed": "<template-ground template-bracket>{{ </><template-ground template-name pagename>Main Page</><template-ground template-delimiter>|</><template-ground template>Something else </><template-ground template-bracket>}}{{ </><template2-ground template-bracket>{{</><template2-ground template-name pagename>T290526</><template2-ground template-bracket>}}</><template-ground template-bracket> }}</>"
	},
	{
		"desc": "Say the magic word",
		"wikitext": "*{{PAGENAME}}\n*{{PAGENAMEE}}\n*{{FULLPAGENAME}}\n*{{FULLPAGENAMEE}}\n*{{BASEPAGENAME}}\n*{{BASEPAGENAMEE}}\n*{{SUBPAGENAME}}\n*{{SUBPAGENAMEE}}\n*{{ROOTPAGENAME}}\n*{{ROOTPAGENAMEE}}\n*{{TALKPAGENAME}}\n*{{TALKPAGENAMEE}}\n*{{SUBJECTPAGENAME}}\n*{{SUBJECTPAGENAMEE}}\n*{{NAMESPACEE}}\n*{{NAMESPACE}}\n*{{NAMESPACENUMBER}}\n*{{TALKSPACE}}\n*{{TALKSPACEE}}\n*{{SUBJECTSPACE}}\n*{{SUBJECTSPACEE}}\n*{{Dynamic|{{NUMBEROFUSERS}}|{{NUMBEROFPAGES}}|{{CURRENTVERSION}}|{{CONTENTLANGUAGE}}|{{DIRECTIONMARK}}|{{CURRENTTIMESTAMP}}|{{NUMBEROFARTICLES}}}}",
		"parsed": "<list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>FULLPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>FULLPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>BASEPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>BASEPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ROOTPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ROOTPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTPAGENAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTPAGENAMEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACENUMBER</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACEE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACE</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACEE</><ext-ground parserfunction-bracket>}}</><list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>Dynamic</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>NUMBEROFUSERS</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>NUMBEROFPAGES</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>CURRENTVERSION</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>CONTENTLANGUAGE</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>DIRECTIONMARK</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>CURRENTTIMESTAMP</><template-ext-ground parserfunction-bracket>}}</><template-ground template-delimiter>|</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>NUMBEROFARTICLES</><template-ext-ground parserfunction-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "HTML Hex character encoding (spells the word \"JavaScript\")",
		"wikitext": "&#x4A;&#x061;&#x0076;&#x00061;&#x000053;&#x0000063;&#114;&#x0000069;&#00000112;&#x0000000074;",
		"parsed": "<entity>&amp;#x4A;&amp;#x061;&amp;#x0076;&amp;#x00061;&amp;#x000053;&amp;#x0000063;&amp;#114;&amp;#x0000069;&amp;#00000112;&amp;#x0000000074;</>"
	},
	{
		"desc": "HTML Hex character encoding bogus encoding (T28437 regression check)",
		"wikitext": "&#xsee;&#XSEE;",
		"parsed": "&#xsee;&#XSEE;"
	},
	{
		"desc": "HTML Hex character encoding mixed case",
		"wikitext": "&#xEE;&#Xee;",
		"parsed": "<entity>&amp;#xEE;&amp;#Xee;</>"
	},
	{
		"desc": "Illegal character references (T106578, T113194)",
		"wikitext": "; Null: &#00;\n; FF: &#xC;\n; CR: &#xD;\n; Control (low): &#8;\n; Control (high): &#x7F; &#x9F;\n; Unsupported legacy: &#128; &#130; &#131; &#150; &#159;\n; Surrogate: &#xD83D;&#xDCA9;\n; Invalid characters: &#xfffe; &#xffff;\n; This is an okay astral character: &#x1F4A9;\n; This is an okay multi-codepoint HTML5 entity: &acE;\n; This are valid wikitext-specific entities: &רלמ; &رلم;\n; Highest valid characters: &#x10fffd; &#x10fffe; &#x10ffff;",
		"parsed": "<list>;</><strong> Null</><list>:</> <entity>&amp;#00;</><list>;</><strong> FF</><list>:</> <entity>&amp;#xC;</><list>;</><strong> CR</><list>:</> <entity>&amp;#xD;</><list>;</><strong> Control (low)</><list>:</> <entity>&amp;#8;</><list>;</><strong> Control (high)</><list>:</> <entity>&amp;#x7F;</> <entity>&amp;#x9F;</><list>;</><strong> Unsupported legacy</><list>:</> <entity>&amp;#128;</> <entity>&amp;#130;</> <entity>&amp;#131;</> <entity>&amp;#150;</> <entity>&amp;#159;</><list>;</><strong> Surrogate</><list>:</> <entity>&amp;#xD83D;&amp;#xDCA9;</><list>;</><strong> Invalid characters</><list>:</> <entity>&amp;#xfffe;</> <entity>&amp;#xffff;</><list>;</><strong> This is an okay astral character</><list>:</> <entity>&amp;#x1F4A9;</><list>;</><strong> This is an okay multi-codepoint HTML5 entity</><list>:</> <entity>&amp;acE;</><list>;</><strong> This are valid wikitext-specific entities</><list>:</> &רלמ; &رلم;<list>;</><strong> Highest valid characters</><list>:</> <entity>&amp;#x10fffd;</> <entity>&amp;#x10fffe;</> <entity>&amp;#x10ffff;</>"
	},
	{
		"desc": "ISBN code coverage",
		"wikitext": "ISBN  978-0-1234-56&#x20;789",
		"parsed": "<magic-link>ISBN  978-0-1234-56</><entity>&amp;#x20;</>789"
	},
	{
		"desc": "ISBN followed by 5 spaces",
		"wikitext": "ISBN",
		"parsed": "ISBN"
	},
	{
		"desc": "Double ISBN",
		"wikitext": "ISBN ISBN 1234567890",
		"parsed": "ISBN <magic-link>ISBN 1234567890</>"
	},
	{
		"desc": "ISBN with an X",
		"wikitext": "ISBN 3-462-04561-X\nISBN 3-462-04561-x\nISBN 080442957X\nISBN 080442957x\nISBN 978080442957X\nISBN 978080442957x",
		"parsed": "<magic-link>ISBN 3-462-04561-XISBN 3-462-04561-xISBN 080442957XISBN 080442957xISBN 978080442957XISBN 978080442957x</>"
	},
	{
		"desc": "ISBN with empty prefix (parsoid test)",
		"wikitext": "ISBN 1234567890",
		"parsed": "<magic-link>ISBN 1234567890</>"
	},
	{
		"desc": "T24905: <abbr> followed by ISBN followed by </a>",
		"wikitext": "<abbr>(fr)</abbr> ISBN 2753300917 [http://www.example.com example.com]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>abbr</><htmltag-bracket>&gt</>(fr)<htmltag-bracket>&lt;/</><htmltag-name>abbr</><htmltag-bracket>&gt</> <magic-link>ISBN 2753300917</> <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text> example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Double RFC",
		"wikitext": "RFC RFC 1234",
		"parsed": "RFC <magic-link>RFC 1234</>"
	},
	{
		"desc": "Double RFC with a wiki link",
		"wikitext": "RFC [[RFC 1234]]",
		"parsed": "RFC <link-ground link-bracket>[[</><link-ground link-pagename pagename>RFC 1234</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "RFC code coverage",
		"wikitext": "RFC   983&#x20;987",
		"parsed": "<magic-link>RFC   983</><entity>&amp;#x20;</>987"
	},
	{
		"desc": "Another italics / bold test",
		"wikitext": " ''' ''x'",
		"parsed": "<skipformatting> </>'<apostrophes>''</><em> </><apostrophes>''</>x'"
	},
	{
		"desc": "dt/dd/dl test",
		"wikitext": ":;;;::",
		"parsed": "<list>:;;;::</>"
	},
	{
		"desc": "[Before] HTML without raw HTML enabled ($wgRawHtml==false)",
		"wikitext": "<html><script>alert(1);</script></html>",
		"parsed": "<html><script>alert(1);</script></html>"
	},
	{
		"desc": "HTML with raw HTML ($wgRawHtml==true)",
		"wikitext": "<html><script>alert(1);</script></html>",
		"parsed": "<html><script>alert(1);</script></html>"
	},
	{
		"desc": "Empty tag w/ raw HTML ($wgRawHtml==true)",
		"wikitext": "<html />",
		"parsed": "<html />"
	},
	{
		"desc": "Parents of subpages, one level up",
		"wikitext": "[[../|L2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../</><link-ground link-delimiter>|</><link-ground link-text>L2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parents of subpages, one level up, not named",
		"wikitext": "[[../]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parents of subpages, two levels up",
		"wikitext": "[[../../|L1]]2\n\n[[../../|L1]]l",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../../</><link-ground link-delimiter>|</><link-ground link-text>L1</><link-ground link-bracket>]]</>2<link-ground link-bracket>[[</><link-ground link-pagename pagename>../../</><link-ground link-delimiter>|</><link-ground link-text>L1</><link-ground link-bracket>]]</>l"
	},
	{
		"desc": "Parents of subpages, two levels up, without trailing slash or name.",
		"wikitext": "[[../..]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../..</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parents of subpages, two levels up, with lots of extra trailing slashes.",
		"wikitext": "[[../../////]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>../../////</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Transclusion of a sibling page (one level up)",
		"wikitext": "{{../L3Sibling}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>../L3Sibling</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Transclusion of a child page",
		"wikitext": "{{/L3Sibling}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>/L3Sibling</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Non-transclusion because of too many up levels",
		"wikitext": "{{../../../../More than parent}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>../../../../More than parent</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Definition list code coverage",
		"wikitext": ";title   :def\n;title :def\n;title:def",
		"parsed": "<list>;</><strong>title   </><list>:</>def<list>;</><strong>title </><list>:</>def<list>;</><strong>title</><list>:</>def"
	},
	{
		"desc": "Don't fall for the self-closing div",
		"wikitext": "<div>hello world</div/>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>hello world<htmltag-bracket>&lt;/</><htmltag-name>div</><error>/</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "MSGNW magic word",
		"wikitext": "{{MSGNW:msg}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>MSGNW</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>msg</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "RAW magic word",
		"wikitext": "{{RAW:QUERTY}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>RAW</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>QUERTY</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Always escape literal '>' in output, not just after '<'",
		"wikitext": "><>",
		"parsed": "><>"
	},
	{
		"desc": "Template caching",
		"wikitext": "{{Test}}\n{{Test}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Test</><template-ground template-bracket>}}{{</><template-ground template-name pagename>Test</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "ISBN with a dummy number",
		"wikitext": "ISBN ---",
		"parsed": "ISBN ---"
	},
	{
		"desc": "ISBN with space-delimited number",
		"wikitext": "ISBN 92 9017 032 8",
		"parsed": "<magic-link>ISBN 92 9017 032 8</>"
	},
	{
		"desc": "ISBN with multiple spaces, no number",
		"wikitext": "ISBN  foo",
		"parsed": "ISBN  foo"
	},
	{
		"desc": "ISBN length",
		"wikitext": "ISBN 123456789\n\nISBN 1234567890\n\nISBN 12345678901",
		"parsed": "ISBN 123456789<magic-link>ISBN 1234567890</>ISBN 12345678901"
	},
	{
		"desc": "ISBN with trailing year (T9110)",
		"wikitext": "ISBN 1-234-56789-0 - 2006\n\nISBN 1 234 56789 0 - 2006",
		"parsed": "<magic-link>ISBN 1-234-56789-0</> - 2006<magic-link>ISBN 1 234 56789 0</> - 2006"
	},
	{
		"desc": "anchorencode",
		"wikitext": "{{anchorencode:foo bar©#%n}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo bar©#%n</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "anchorencode (legacy)",
		"wikitext": "{{anchorencode:foo bar©#%n}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo bar©#%n</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "anchorencode trims spaces",
		"wikitext": "{{anchorencode: __pretty__please__}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> __pretty__please__</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "anchorencode deals with links",
		"wikitext": "{{anchorencode: [[hello|world]] [[hi]]}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-link-ground link-bracket>[[</><ext-link-ground link-pagename pagename>hello</><ext-link-ground link-delimiter>|</><ext-link-ground link-text>world</><ext-link-ground link-bracket>]]</><ext-ground parserfunction> </><ext-link-ground link-bracket>[[</><ext-link-ground link-pagename pagename>hi</><ext-link-ground link-bracket>]]</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "anchorencode deals with templates",
		"wikitext": "{{anchorencode: {{Foo}} x}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><template-ext-ground template-bracket>{{</><template-ext-ground template-name pagename>Foo</><template-ext-ground template-bracket>}}</><ext-ground parserfunction> x</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "anchorencode encodes like the TOC generator: (T20431)",
		"wikitext": "===_ +:.3A%3A _ &&amp;]] x===\n{{anchorencode: _ +:.3A%3A _ &&amp;]] x}}\n\n__NOEDITSECTION__",
		"parsed": "<section-header section--3>===</><section>_ +:.3A%3A _ &amp;</><entity>&amp;amp;</><section>]] x</><section-header>===</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> _ +:.3A%3A _ &amp;</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>]] x</><ext-ground parserfunction-bracket>}}</><double-underscore>__NOEDITSECTION__</>"
	},
	{
		"desc": "anchorencode encodes like the TOC generator: (T20431) (legacy)",
		"wikitext": "===_ +:.3A%3A&&amp;]]===\n{{anchorencode: _ +:.3A%3A&&amp;]] }}\n__NOEDITSECTION__",
		"parsed": "<section-header section--3>===</><section>_ +:.3A%3A&amp;</><entity>&amp;amp;</><section>]]</><section-header>===</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> _ +:.3A%3A&amp;</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>]] </><ext-ground parserfunction-bracket>}}</><double-underscore>__NOEDITSECTION__</>"
	},
	{
		"desc": "T8200: blockquotes and paragraph formatting",
		"wikitext": "<blockquote>\nfoo\n</blockquote>\n\nbar\n\n baz",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>bar<skipformatting> </>baz"
	},
	{
		"desc": "T10293: Use of center tag ruins paragraph formatting",
		"wikitext": "<center>\nfoo\n</center>\n\nbar\n\n baz",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>center</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>center</><htmltag-bracket>&gt</>bar<skipformatting> </>baz"
	},
	{
		"desc": "Parsing of overlapping (improperly nested) inline html tags",
		"wikitext": "<span><s>x</span></s>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>s</><htmltag-bracket>&gt</>x<error>&lt;/span&gt</><htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T2529: Uncovered bullet",
		"wikitext": "*Foo {{bullet}}",
		"parsed": "<list>*</>Foo <template-ground template-bracket>{{</><template-ground template-name pagename>bullet</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2529: Uncovered bullet in a deeply nested list",
		"wikitext": "*******Foo {{bullet}}",
		"parsed": "<list>*******</>Foo <template-ground template-bracket>{{</><template-ground template-name pagename>bullet</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T2529: Uncovered table already at line-start",
		"wikitext": "x\n\n{{table}}\ny",
		"parsed": "x<template-ground template-bracket>{{</><template-ground template-name pagename>table</><template-ground template-bracket>}}</>y"
	},
	{
		"desc": "T2529: Uncovered bullet in parser function result",
		"wikitext": "*Foo{{lc:{{bullet}} }}",
		"parsed": "<list>*</>Foo<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>lc</><ext-ground parserfunction-delimiter>:</><template-ext-ground template-bracket>{{</><template-ext-ground template-name pagename>bullet</><template-ext-ground template-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T7678: Double-parsed template argument",
		"wikitext": "{{lc:{{{1}}}|hello}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>lc</><ext-ground parserfunction-delimiter>:</><ext-ground templatevariable-bracket>{{{</><ext-ground templatevariable-name>1</><ext-ground templatevariable-bracket>}}}</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>hello</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T7678: Double-parsed template invocation",
		"wikitext": "{{lc:{{paramtest {{!}} param = hello }} }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>lc</><ext-ground parserfunction-delimiter>:</><template-ext-ground template-bracket>{{</><template-ext-ground template-name pagename>paramtest </><template-ext2-ground parserfunction-bracket>{{</><template-ext2-ground parserfunction-name>!</><template-ext2-ground parserfunction-bracket>}}</><template-ext-ground template-name pagename> param = hello </><template-ext-ground template-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Paragraphs inside divs (no extra line breaks)",
		"wikitext": "<div>Line one\n\nLine two</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on open)",
		"wikitext": "<div>\nLine one\n\nLine two</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on close)",
		"wikitext": "<div>Line one\n\nLine two\n</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside divs (extra line break on open and close)",
		"wikitext": "<div>\nLine one\n\nLine two\n</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Nesting tags, paragraphs on lines which begin with <div>",
		"wikitext": "<div></div><strong>A\nB</strong>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>strong</><htmltag-bracket>&gt</>AB<htmltag-bracket>&lt;/</><htmltag-name>strong</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (no extra line breaks)",
		"wikitext": "<blockquote>Line one\n\nLine two</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on open)",
		"wikitext": "<blockquote>\nLine one\n\nLine two</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on close)",
		"wikitext": "<blockquote>Line one\n\nLine two\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T8200: paragraphs inside blockquotes (extra line break on open and close)",
		"wikitext": "<blockquote>\nLine one\n\nLine two\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (no extra line breaks)",
		"wikitext": "<blockquote><div>Line one\n\nLine two</div></blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on open)",
		"wikitext": "<blockquote><div>\nLine one\n\nLine two</div></blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on close)",
		"wikitext": "<blockquote><div>Line one\n\nLine two\n</div></blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Paragraphs inside blockquotes/divs (extra line break on open and close)",
		"wikitext": "<blockquote><div>\nLine one\n\nLine two\n</div></blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>Line oneLine two<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Interwiki links trounced by handleExternalLinks after early LinkHolderArray expansion",
		"wikitext": "[[meatball:1]]\n[[meatball:2]]\n[[meatball:3]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>meatball:1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>meatball:3</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Multibyte character in padleft",
		"wikitext": "{{padleft:-Hello|7|Æ}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>-Hello</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>7</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Æ</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Multibyte character in padright",
		"wikitext": "{{padright:Hello-|7|Æ}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Hello-</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>7</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Æ</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "formatdate parser function",
		"wikitext": "{{#formatdate:2009-03-24}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>2009-03-24</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "formatdate parser function, with default format",
		"wikitext": "{{#formatdate:2009-03-24|mdy}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>2009-03-24</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>mdy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Spacing of numbers in formatted dates",
		"wikitext": "{{#formatdate:January 15}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>January 15</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "formatdate with invalid month",
		"wikitext": "{{#formatdate:2019-22-22|dmy}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>2019-22-22</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>dmy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "formatdate uses correct capitalisation in English",
		"wikitext": "{{#formatdate:june 3|dmy}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>june 3</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>dmy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "formatdate formats ISO year 0 as 1 BC",
		"wikitext": "{{#formatdate:-0001-12-31|mdy}}\n{{#formatdate:0000-12-31|mdy}}\n{{#formatdate:0001-12-31|mdy}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>-0001-12-31</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>mdy</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>0000-12-31</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>mdy</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#formatdate</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>0001-12-31</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>mdy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Edit comment with link",
		"wikitext": "I like the [[Main Page]] a lot",
		"parsed": "I like the <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</> a lot"
	},
	{
		"desc": "Edit comment with link and link text",
		"wikitext": "I like the [[Main Page|best pages]] a lot",
		"parsed": "I like the <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>best pages</><link-ground link-bracket>]]</> a lot"
	},
	{
		"desc": "Edit comment with link and link text with suffix",
		"wikitext": "I like the [[Main Page|best page]]s a lot",
		"parsed": "I like the <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>best page</><link-ground link-bracket>]]</>s a lot"
	},
	{
		"desc": "Edit comment with section link (non-local, eg in history list)",
		"wikitext": "/* External links */ removed bogus entries",
		"parsed": "/* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link and text before it (non-local, eg in history list)",
		"wikitext": "pre-comment text /* External links */ removed bogus entries",
		"parsed": "pre-comment text /* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link (local, eg in diff view)",
		"wikitext": "/* External links */ removed bogus entries",
		"parsed": "/* External links */ removed bogus entries"
	},
	{
		"desc": "Edit comment with section link that has a link in it",
		"wikitext": "/* [[A link]] */",
		"parsed": "/* <link-ground link-bracket>[[</><link-ground link-pagename pagename>A link</><link-ground link-bracket>]]</> */"
	},
	{
		"desc": "Edit comment with section link that has a template in it",
		"wikitext": "/* {{foobar|param}} */",
		"parsed": "/* <template-ground template-bracket>{{</><template-ground template-name pagename>foobar</><template-ground template-delimiter>|</><template-ground template>param</><template-ground template-bracket>}}</> */"
	},
	{
		"desc": "Edit comment with subpage link (T16080)",
		"wikitext": "Poked at a [[/subpage]] here...",
		"parsed": "Poked at a <link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage</><link-ground link-bracket>]]</> here..."
	},
	{
		"desc": "Edit comment with subpage link and link text (T16080)",
		"wikitext": "Poked at a [[/subpage|neat little page]] here...",
		"parsed": "Poked at a <link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage</><link-ground link-delimiter>|</><link-ground link-text>neat little page</><link-ground link-bracket>]]</> here..."
	},
	{
		"desc": "Edit comment with bogus subpage link in non-subpage NS (T16080)",
		"wikitext": "Poked at a [[/subpage]] here...",
		"parsed": "Poked at a <link-ground link-bracket>[[</><link-ground link-pagename pagename>/subpage</><link-ground link-bracket>]]</> here..."
	},
	{
		"desc": "Edit comment with bare anchor link (local, as on diff)",
		"wikitext": "[[#section]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#section</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Edit comment with bare anchor link (non-local, as on history)",
		"wikitext": "[[#section]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#section</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Anchor starting with underscore",
		"wikitext": "[[#_ref|One]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#_ref</><link-ground link-delimiter>|</><link-ground link-text>One</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Id starting with underscore",
		"wikitext": "<div id=\"_ref\"></div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"_ref\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Edit comment with link with more than one pipe (T99346)",
		"wikitext": "[[Main Page|Many|pipes]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>Many|pipes</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Complex edit comment with link with more than one pipe (T99346)",
		"wikitext": "Created page with \"<noinclude>[[Category:Requests for permissions/Bot|{{subst:#titleparts:{{subst:PAGENAME}}|1|3}}]]</noinclude> === [[User:MineoBot|]] 8=== {{Request for permissions/links|Mineo...\"",
		"parsed": "Created page with \"<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude link-ground link-bracket>[[</><tag-noinclude link-ground link-pagename pagename>Category:Requests for permissions/Bot</><tag-noinclude link-ground link-delimiter>|</><tag-noinclude ext-link-ground parserfunction-bracket>{{</><tag-noinclude ext-link-ground parserfunction-name>subst</><tag-noinclude ext-link-ground parserfunction-delimiter>:</><tag-noinclude ext-link-ground parserfunction>#titleparts:</><tag-noinclude ext2-link-ground parserfunction-bracket>{{</><tag-noinclude ext2-link-ground parserfunction-name>subst</><tag-noinclude ext2-link-ground parserfunction-delimiter>:</><tag-noinclude ext2-link-ground parserfunction>PAGENAME</><tag-noinclude ext2-link-ground parserfunction-bracket>}}</><tag-noinclude ext-link-ground parserfunction-delimiter>|</><tag-noinclude ext-link-ground parserfunction>1</><tag-noinclude ext-link-ground parserfunction-delimiter>|</><tag-noinclude ext-link-ground parserfunction>3</><tag-noinclude ext-link-ground parserfunction-bracket>}}</><tag-noinclude link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</> === <link-ground link-bracket>[[</><link-ground link-pagename pagename>User:MineoBot</><link-ground link-delimiter>|</><link-ground link-bracket>]]</> 8=== <template-ground template-bracket>{{</><template-ground template-name pagename>Request for permissions/links</><template-ground template-delimiter>|</><template-ground template>Mineo...\"</>"
	},
	{
		"desc": "Space normalisation on autocomment (T24784)",
		"wikitext": "/* __hello__world__ */",
		"parsed": "/* __hello__world__ */"
	},
	{
		"desc": "percent-encoding and + signs in comments (T28410)",
		"wikitext": "[[ABC%33D% ++]] [[ABC%33D% ++|+%20]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>ABC%33D% ++</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>ABC%33D% ++</><link-ground link-delimiter>|</><link-ground link-text>+%20</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) no displaytitle",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=false",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:whatever}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>whatever</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=true mismatch",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:whatever}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>whatever</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) RestrictDisplayTitle=true matching",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:screen}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>screen</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) AllowDisplayTitle=false",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:screen}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>screen</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle works (T24501) AllowDisplayTitle=false no DISPLAYTITLE",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "Verify that displaytitle handles inline CSS styles (T28547) - rejected value",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:<span style=\"display: none;\">s</span>creen}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground htmltag-bracket>&lt;</><ext-ground htmltag-name>span </><ext-ground htmltag-attribute html-span>style=</><ext-ground htmltag-attribute-value>\"display: none;\"</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>s</><ext-ground htmltag-bracket>&lt;/</><ext-ground htmltag-name>span</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>creen</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle handles inline CSS styles (T28547) - accepted value",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:<span style=\"color: red;\">s</span>creen}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground htmltag-bracket>&lt;</><ext-ground htmltag-name>span </><ext-ground htmltag-attribute html-span>style=</><ext-ground htmltag-attribute-value>\"color: red;\"</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>s</><ext-ground htmltag-bracket>&lt;/</><ext-ground htmltag-name>span</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>creen</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle encodes & to &amp; (T291985)",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:art&copy}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>art&amp;copy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that displaytitle encodes &amp; to &amp; (T291985)",
		"wikitext": "this is not the title\n{{DISPLAYTITLE:art&amp;copy}}",
		"parsed": "this is not the title<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>DISPLAYTITLE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>art</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>copy</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Verify that without displaytitle the title encodes & to &amp; (T291985)",
		"wikitext": "this is not the title",
		"parsed": "this is not the title"
	},
	{
		"desc": "preload: check <noinclude> and <includeonly>",
		"wikitext": "Hello <noinclude>cruel</noinclude><includeonly>kind</includeonly> world.",
		"parsed": "Hello <exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>cruel</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>kind</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</> world."
	},
	{
		"desc": "preload: check <onlyinclude>",
		"wikitext": "Goodbye <onlyinclude>Hello world</onlyinclude>",
		"parsed": "Goodbye <exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude>Hello world</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>"
	},
	{
		"desc": "preload: can pass tags through if we want to",
		"wikitext": "<includeonly><</includeonly>includeonly>Hello world<includeonly><</includeonly>/includeonly>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>&lt;</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>includeonly>Hello world<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>&lt;</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>/includeonly>"
	},
	{
		"desc": "preload: check that it doesn't try to do tricks",
		"wikitext": "* <!-- Hello --> ''{{world}}'' {{<includeonly>subst:</includeonly>How are you}}{{ {{{|safesubst:}}} #if:1|2|3}}",
		"parsed": "<list>*</> <comment>&lt;!-- Hello --&gt</> <apostrophes>''</><template-ground template-bracket>{{</><template-ground template-name pagename>world</><template-ground template-bracket>}}</><apostrophes>''</> <template-ground template-bracket>{{</><exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>subst:</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>How are you}}<template-ground template-bracket>{{ </><template-ground templatevariable-bracket>{{{</><template-ground templatevariable-delimiter>|</><template-ground templatevariable>safesubst:</><template-ground templatevariable-bracket>}}}</><template-ground error> #if:1</><template-ground template-delimiter>|</><template-ground template>2</><template-ground template-delimiter>|</><template-ground template>3</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Play a bit with r67090 and T5158",
		"wikitext": "<div style=\"width:50% !important\">&nbsp;</div>\n<div style=\"width:50%&nbsp;!important\">&nbsp;</div>\n<div style=\"width:50%&#160;!important\">&nbsp;</div>\n<div style=\"border : solid;\">&nbsp;</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"width:50% !important\"</><htmltag-bracket>&gt</><entity>&amp;nbsp;</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"width:50%</><entity>&amp;nbsp;</><htmltag-attribute-value>!important\"</><htmltag-bracket>&gt</><entity>&amp;nbsp;</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"width:50%</><entity>&amp;#160;</><htmltag-attribute-value>!important\"</><htmltag-bracket>&gt</><entity>&amp;nbsp;</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"border : solid;\"</><htmltag-bracket>&gt</><entity>&amp;nbsp;</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "French spaces in wikitext",
		"wikitext": "foo ! bar ? bat 50 % is less than 75 %.\n\nHello : this ; is « something ‹ else › again »",
		"parsed": "foo ! bar ? bat 50 % is less than 75 %.Hello : this ; is « something ‹ else › again »"
	},
	{
		"desc": "Corner case: french spaces in definition list",
		"wikitext": ";foo : bar",
		"parsed": "<list>;</><strong>foo </><list>:</> bar"
	},
	{
		"desc": "T5158: Test for French spaces in attributes",
		"wikitext": "<br style=\" clear : both ; \" />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-attribute html-br>style=</><htmltag-attribute-value>\" clear : both ; \"</><htmltag-attribute html-br> </><htmltag-bracket>/&gt</>"
	},
	{
		"desc": "HTML5 data attributes",
		"wikitext": "<span data-foo=\"bar\">Baz</span>\n<p data-abc-def_hij=\"\">Quuz</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>data-foo=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>&gt</>Baz<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>p </><htmltag-attribute html-p>data-abc-def_hij=</><htmltag-attribute-value>\"\"</><htmltag-bracket>&gt</>Quuz<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Strip reserved data attributes",
		"wikitext": "<div data-mw=\"foo\" data-parsoid=\"bar\" data-mw-someext=\"baz\" data-ok=\"fred\" data-object-id=\"123\" data-ooui=\"xyzzy\" data-bad:ns=\"ns\">d</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>data-mw=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-div> data-parsoid=</><htmltag-attribute-value>\"bar\"</><htmltag-attribute html-div> data-mw-someext=</><htmltag-attribute-value>\"baz\"</><htmltag-attribute html-div> data-ok=</><htmltag-attribute-value>\"fred\"</><htmltag-attribute html-div> data-object-id=</><htmltag-attribute-value>\"123\"</><htmltag-attribute html-div> data-ooui=</><htmltag-attribute-value>\"xyzzy\"</><htmltag-attribute html-div> data-bad:ns=</><htmltag-attribute-value>\"ns\"</><htmltag-bracket>&gt</>d<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "percent-encoding and + signs in internal links (T28410)",
		"wikitext": "[[User:+%]] [[Page+title%]]\n[[%+]] [[%+|%20]] [[%+ ]] [[%+r]]\n[[%]] [[+]] [[File:%+abc%39|foo|[[bar]]]]\n[[%33%45]] [[%33%45+]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>User:+%</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Page+title%</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>%+</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>%+</><link-ground link-delimiter>|</><link-ground link-text>%20</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>%+ </><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>%+r</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>%</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>+</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>File:%+abc%39</><link-ground link-delimiter>|</><link-ground file-text>foo</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>bar</><link-ground link-bracket>]]]][[</><link-ground link-pagename pagename>%33%45</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>%33%45+</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Confirm that 'apos' named character reference doesn't make it to output (not legal in HTML 4)",
		"wikitext": "Text&apos;s been normalized?",
		"parsed": "Text<entity>&amp;apos;</>s been normalized?"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate free external links",
		"wikitext": "http://www.example.org/　<-- U+3000 (vim: ^Vu3000)",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.org/</>　<-- U+3000 (vim: ^Vu3000)"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate bracketed external links",
		"wikitext": "[http://www.example.org/　ideograms]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.org/</><link-ground extlink-text>　ideograms</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T21052 U+3000 IDEOGRAPHIC SPACE should terminate external images links",
		"wikitext": "http://www.example.org/pic.png　<-- U+3000 (vim: ^Vu3000)",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.org/pic.png</>　<-- U+3000 (vim: ^Vu3000)"
	},
	{
		"desc": "T33098 Template which includes system messages which includes the template",
		"wikitext": "{{Identical}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Identical</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T33490 ucfırst (with a dotless i) with English language",
		"wikitext": "{{ucfırst:blah}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>ucfırst:blah</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T34057: Title needed when expanding <h> nodes.",
		"wikitext": "{{int:T34057}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>int</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>T34057</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Title needed when expanding templates.",
		"wikitext": "{{Template with pagename}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Template with pagename</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Strip marker in urlencode",
		"wikitext": "{{urlencode:x<nowiki/>y}}\n{{urlencode:x<nowiki/>y|wiki}}\n{{urlencode:x<nowiki/>y|path}}\n{{urlencode:x<pre id=\"one\">two</pre>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>wiki</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>path</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>urlencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>pre </><ext-ground exttag-attribute ext-pre>id=</><ext-ground exttag-attribute-value>\"one\"</><ext-ground exttag-bracket>&gt</><tag-pre>two</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>pre</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in lc",
		"wikitext": "{{lc:x<nowiki/>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>lc</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in uc",
		"wikitext": "{{uc:x<nowiki/>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>uc</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in formatNum",
		"wikitext": "{{formatnum:1<nowiki/>2}}\n{{formatnum:1<nowiki/>2|R}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>formatnum</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>formatnum</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>R</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Wrong option for formatNum (T58199)",
		"wikitext": "{{formatnum:1,234.56|Random}}\n{{formatnum:1,234.56|EVERYTHING}}\n{{formatnum:1234.56|any argument that has the string 'NOSEP'}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>formatnum</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1,234.56</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Random</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>formatnum</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1,234.56</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>EVERYTHING</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>formatnum</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1234.56</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>any argument that has the string 'NOSEP'</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in padleft",
		"wikitext": "{{padleft:|2|x<nowiki/>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in padright",
		"wikitext": "{{padright:|2|x<nowiki/>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Strip marker in anchorencode",
		"wikitext": "{{anchorencode:x<nowiki/>y}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>x</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction>y</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "new support for bdi element (T33817)",
		"wikitext": "<p dir=\"rtl\" lang=\"he\">ולדימיר לנין (ברוסית: <bdi lang=\"ru\">Владимир Ленин</bdi>, 24 באפריל 1870–22 בינואר 1924) הוא מנהיג פוליטי קומוניסטי רוסי.</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p </><htmltag-attribute html-p>dir=</><htmltag-attribute-value>\"rtl\"</><htmltag-attribute html-p> lang=</><htmltag-attribute-value>\"he\"</><htmltag-bracket>&gt</>ולדימיר לנין (ברוסית: <htmltag-bracket>&lt;</><htmltag-name>bdi </><htmltag-attribute html-bdi>lang=</><htmltag-attribute-value>\"ru\"</><htmltag-bracket>&gt</>Владимир Ленин<htmltag-bracket>&lt;/</><htmltag-name>bdi</><htmltag-bracket>&gt</>, 24 באפריל 1870–22 בינואר 1924) הוא מנהיג פוליטי קומוניסטי רוסי.<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Ignore pipe between table row attributes",
		"wikitext": "{|\n|quux\n|- id=foo | style='color: red'\n|bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>quux</><table-delimiter>|- </><table-definition html-tr>id=</><table-definition-value>foo</><table-definition html-tr> | style=</><table-definition-value>'color: red'</><table-delimiter>|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Language parser function",
		"wikitext": "{{#language:ar}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#language</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ar</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Padleft and padright (default 0-padding)",
		"wikitext": "{{padleft:xyz|5}}\n{{padright:xyz|5}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>xyz</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>5</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>xyz</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>5</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Padleft and padright (partial fill)",
		"wikitext": "{{padleft:xyz|6|ab}}\n{{padright:xyz|6|ab}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>xyz</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>6</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>ab</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>xyz</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>6</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>ab</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Padleft and padright as substr",
		"wikitext": "{{padleft:|3|abcde}}\n{{padright:|3|abcde}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>abcde</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>abcde</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Padleft and padright with non-numerical length (T180403)",
		"wikitext": "{{padleft:abcdef|junk}}\n{{padright:abcdef|junk}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>padleft</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>abcdef</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>junk</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>padright</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>abcdef</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>junk</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Special parser function",
		"wikitext": "{{#special:RandomPage}}\n{{#special:BaDtItLe}}\n{{#special:Foobar}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>RandomPage</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>BaDtItLe</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#special</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Foobar</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Using {{=}} when it expands to \"=\" should not create a tracking category",
		"wikitext": "This uses {{=}} and {{Template:=}}.",
		"parsed": "This uses <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>=</><ext-ground parserfunction-bracket>}}</> and <template-ground template-bracket>{{</><template-ground template-name pagename>Template:=</><template-ground template-bracket>}}</>."
	},
	{
		"desc": "Using {{=}} when it expands to \"=\" should not create a tracking category (cat)",
		"wikitext": "This uses {{=}} and {{Template:=}}.",
		"parsed": "This uses <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>=</><ext-ground parserfunction-bracket>}}</> and <template-ground template-bracket>{{</><template-ground template-name pagename>Template:=</><template-ground template-bracket>}}</>."
	},
	{
		"desc": "T36939 - Case insensitive link parsing ([HttP://])",
		"wikitext": "[HttP://MediaWiki.Org/]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>HttP://</><link-ground extlink>MediaWiki.Org/</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T36939 - Case insensitive link parsing ([HttP:// title])",
		"wikitext": "[HttP://MediaWiki.Org/ MediaWiki]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>HttP://</><link-ground extlink>MediaWiki.Org/</><link-ground extlink-text> MediaWiki</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T36939 - Case insensitive link parsing (HttP://)",
		"wikitext": "HttP://MediaWiki.Org/",
		"parsed": "<free-extlink-protocol>HttP://</><free-extlink>MediaWiki.Org/</>"
	},
	{
		"desc": "1. SOL-sensitive wikitext tokens as template-args",
		"wikitext": "{{1x|*a}}\n{{1x|#a}}\n{{1x|:a}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>*a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>#a</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>:a</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Wikilink with only closing tag in target",
		"wikitext": "[[Test|</span>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-delimiter>|</><link-ground error>&lt;/span&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "LST Sections: Backwards compatibility",
		"wikitext": "<section begin=\"2011-05-16\" />\n<section end=\"2014-04-10 (MW 1.23wmf22)\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>section </><exttag-attribute ext-section>begin=</><exttag-attribute-value>\"2011-05-16\"</><exttag-attribute ext-section> </><exttag-bracket>/&gt&lt;</><exttag-name>section </><exttag-attribute ext-section>end=</><exttag-attribute-value>\"2014-04-10 (MW 1.23wmf22)\"</><exttag-attribute ext-section> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "LST Sections: Newfangled approach",
		"wikitext": "<section begin=\"2011-05-16\" />\n<section end=\"2014-04-10 (MW 1.23wmf22)\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>section </><exttag-attribute ext-section>begin=</><exttag-attribute-value>\"2011-05-16\"</><exttag-attribute ext-section> </><exttag-bracket>/&gt&lt;</><exttag-name>section </><exttag-attribute ext-section>end=</><exttag-attribute-value>\"2014-04-10 (MW 1.23wmf22)\"</><exttag-attribute ext-section> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "LST Sections: Fostering",
		"wikitext": "{|\n<section name=\"testing\"/>\n| 123\n|}",
		"parsed": "<table-bracket>{|</><exttag-bracket>&lt;</><exttag-name>section </><exttag-attribute ext-section>name=</><exttag-attribute-value>\"testing\"</><exttag-bracket>/&gt</><table-delimiter>| </><table-td>123</><table-bracket>|}</>"
	},
	{
		"desc": "Empty LI and TR nodes should be stripped from template content",
		"wikitext": "{{EmptyLITest}}\n{{EmptyTRTest}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>EmptyLITest</><template-ground template-bracket>}}{{</><template-ground template-name pagename>EmptyTRTest</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Empty LI and TR nodes should not be stripped from top-level content",
		"wikitext": "*a\n*\n*b\n\n{|\n|-\n|-\n|foo\n|}",
		"parsed": "<list>*</>a<list>**</>b<table-bracket>{|</><table-delimiter>|-|-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Empty TR nodes should not be stripped if they have any attributes set",
		"wikitext": "{{EmptyTRWithHTMLAttrTest}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>EmptyTRWithHTMLAttrTest</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "\nTag-like HTML structures are passed through as text",
		"wikitext": "<x y>\n\n<x.y>\n\n<x-y>\n\n1>2\n\nx<y\n\na>b\n\n1<d e>f",
		"parsed": "<x y><x.y><x-y>1>2x<ya>b1<d e>f"
	},
	{
		"desc": "HTML tag with necessary entities in attributes",
		"wikitext": "<span title=\"&amp;amp;\">foo</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"</><entity>&amp;amp;</><htmltag-attribute-value>amp;\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML tag with 'unnecessary' entity encoding in attributes",
		"wikitext": "<span title=\"&amp;\">foo</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"</><entity>&amp;amp;</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "HTML tag with broken attribute value quoting",
		"wikitext": "<span title=\"Hello world>Foo</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"Hello world</><htmltag-bracket>&gt</>Foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Self-closed tag with broken attribute value quoting",
		"wikitext": "<div title=\"Hello world />Foo",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>title=</><htmltag-attribute-value>\"Hello world </><htmltag-bracket>/&gt</>Foo"
	},
	{
		"desc": "Table with broken attribute value quoting",
		"wikitext": "{|\n| title=\"Hello world|Foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>title=\"Hello world</><table-delimiter2>|</><table-td>Foo</><table-bracket>|}</>"
	},
	{
		"desc": "Table with broken attribute value quoting on consecutive lines",
		"wikitext": "{|\n| title=\"Hello world|Foo\n| style=\"color:red|Bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>title=\"Hello world</><table-delimiter2>|</><table-td>Foo</><table-delimiter>| </><html-td table-definition>style=\"color:red</><table-delimiter2>|</><table-td>Bar</><table-bracket>|}</>"
	},
	{
		"desc": "Accept empty td cell attribute",
		"wikitext": "{|\n| align=\"center\" |foo||  |\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>align=\"center\" </><table-delimiter2>|</><table-td>foo</><table-delimiter>||  </><table-delimiter2>|</><table-bracket>|}</>"
	},
	{
		"desc": "Non-empty attributes in th-cells",
		"wikitext": "{|\n!Foo!! style=\"color: red\" |Bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>Foo</><table-delimiter>!! </><html-th table-definition>style=\"color: red\" </><table-delimiter2>|</><table-th>Bar</><table-bracket>|}</>"
	},
	{
		"desc": "Accept empty attributes in th-cells",
		"wikitext": "{|\n!|foo!!|bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-delimiter2>|</><table-th>foo</><table-delimiter>!!</><table-delimiter2>|</><table-th>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Empty table rows go away",
		"wikitext": "{|\n|Hello\n|there\n|- class=\"foo\"\n|-\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>Hello</><table-delimiter>|</><table-td>there</><table-delimiter>|- </><table-definition html-tr>class=</><table-definition-value>\"foo\"</><table-delimiter>|-</><table-bracket>|}</>"
	},
	{
		"desc": "RT-ed inter-element separators should be valid separators",
		"wikitext": "{|\n|- [[foo]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|- </><table-definition html-tr>[[foo]]</><table-bracket>|}</>"
	},
	{
		"desc": "Trailing newlines in a deep dom-subtree that ends a wikitext line should be migrated out",
		"wikitext": "{|\n|<small>foo\nbar\n|}\n\n{|\n|<small>foo<small>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><table-td>foobar</><table-bracket>|}{|</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><table-td>foo</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Empty TD followed by TD with tpl-generated attribute",
		"wikitext": "{|\n|-\n|\n|{{1x|style='color:red'}}|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-||</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>style=</><template-ground template>'color:red'</><template-ground template-bracket>}}</><table-delimiter2>|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Indented table with an empty td",
		"wikitext": " {|\n |-\n |\n |foo\n |}",
		"parsed": "<table-bracket>{|</><table-delimiter> |- | |</><table-td>foo</><table-bracket> |}</>"
	},
	{
		"desc": "Indented table with blank lines in between (T85627)",
		"wikitext": " {|\n |foo\n \n \n |}",
		"parsed": "<table-bracket>{|</><table-delimiter> |</><table-td>foo  </><table-bracket> |}</>"
	},
	{
		"desc": "Indented block & table",
		"wikitext": " <div>foo</div>\n {|\n |foo\n |}",
		"parsed": "<skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>{|</><table-delimiter> |</><table-td>foo</><table-bracket> |}</>"
	},
	{
		"desc": "Indent and comment before table row",
		"wikitext": "{|\n <!--hi-->|-\n |there\n|}",
		"parsed": "<table-bracket>{|</><comment> &lt;!--hi--&gt</><error>|-</><table-delimiter> |</><table-td>there</><table-bracket>|}</>"
	},
	{
		"desc": "Empty TR followed by a template-generated TR",
		"wikitext": "{|\n|-\n{{1x|<tr><td>foo</td></tr>}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Empty TR followed by mixed-ws-comment line should RT correctly",
		"wikitext": "{|\n|-\n <!--c-->\n|-\n<!--c--> <!--d-->\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><comment> &lt;!--c--&gt</><table-delimiter>|-</><comment>&lt;!--c--&gt</><error> </><comment>&lt;!--d--&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Multi-line image caption generated by templates with/without trailing newlines",
		"wikitext": "[[File:Foobar.jpg|thumb|300x300px|foo\\n{{1x|A}}\\n{{1x|B}}\\n{{1x|C}}]]\n[[File:Foobar.jpg|thumb|300x300px|foo\\n{{1x|A}}\\n{{1x|B}}\\n{{1x|C}}\\n\\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>300x300px</><link-ground link-delimiter>|</><link-ground file-text>foo\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>A</><template-link-ground template-bracket>}}</><link-ground file-text>\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>B</><template-link-ground template-bracket>}}</><link-ground file-text>\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>C</><template-link-ground template-bracket>}}</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>300x300px</><link-ground link-delimiter>|</><link-ground file-text>foo\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>A</><template-link-ground template-bracket>}}</><link-ground file-text>\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>B</><template-link-ground template-bracket>}}</><link-ground file-text>\\n</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>C</><template-link-ground template-bracket>}}</><link-ground file-text>\\n\\n</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New element inserted (without intervening newlines) after an old sol-transparent node should serialize correctly",
		"wikitext": "<includeonly>foo</includeonly>\nnew para\n\n[[Category:Foo]]\n\n= new heading =",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly>foo</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>new para<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><section-header section--1>=</><section> new heading </><section-header>=</>"
	},
	{
		"desc": "Improperly nested inline or quotes tags with whitespace in between",
		"wikitext": "<span> <s>x</s></span><s> </s>\n''' ''x'''''",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</> <htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt</>x<htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>s</><htmltag-bracket>&gt</> <htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</><apostrophes>'''</><strong> </><apostrophes>''</><strong em>x</><apostrophes>'''''</>"
	},
	{
		"desc": "Encapsulate protected attributes from wt",
		"wikitext": "<div typeof=\"mw:placeholder stuff\" data-mw=\"whoo\" data-parsoid=\"weird\" data-parsoid-other=\"no\" about=\"time\" rel=\"mw:true\">foo</div>\n\n{| typeof=\"mw:placeholder stuff\" data-mw=\"whoo\" data-parsoid=\"weird\" data-parsoid-other=\"no\" about=\"time\" rel=\"mw:true\"\n|ok\n|}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>typeof=</><htmltag-attribute-value>\"mw:placeholder stuff\"</><htmltag-attribute html-div> data-mw=</><htmltag-attribute-value>\"whoo\"</><htmltag-attribute html-div> data-parsoid=</><htmltag-attribute-value>\"weird\"</><htmltag-attribute html-div> data-parsoid-other=</><htmltag-attribute-value>\"no\"</><htmltag-attribute html-div> about=</><htmltag-attribute-value>\"time\"</><htmltag-attribute html-div> rel=</><htmltag-attribute-value>\"mw:true\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>{| </><table-definition html-table>typeof=</><table-definition-value>\"mw:placeholder stuff\"</><table-definition html-table> data-mw=</><table-definition-value>\"whoo\"</><table-definition html-table> data-parsoid=</><table-definition-value>\"weird\"</><table-definition html-table> data-parsoid-other=</><table-definition-value>\"no\"</><table-definition html-table> about=</><table-definition-value>\"time\"</><table-definition html-table> rel=</><table-definition-value>\"mw:true\"</><table-delimiter>|</><table-td>ok</><table-bracket>|}</>"
	},
	{
		"desc": "Ensure ParagraphWrapper can deal with stray closing pre tags",
		"wikitext": "plain text</pre>",
		"parsed": "plain text<error>&lt;/pre&gt</>"
	},
	{
		"desc": "1. Ensure fostered text content is wrapped in element nodes",
		"wikitext": "<table>hi</table><table>ho</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>table</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. Ensure fostered text content is wrapped in element nodes (traps regressions around fostered marker on the element getting lost)",
		"wikitext": "<table>\n<tr> || ||\n<td> a\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</> || ||<htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> a<error>&lt;/table&gt</>"
	},
	{
		"desc": "Encapsulation properly handles null DSR information from foster box",
		"wikitext": "{{1x|<table>foo<tr><td>bar</td></tr></table>}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>bar</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "1. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|foo<tr><td>bar</td></tr>}}</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>bar</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div>{{1x|foo}}</div><tr><td>bar</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div><p>{{1x|foo</p></div><tr><td>}}bar</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>bar<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><div><p>{{1x|foo</p></div><tr><td>}}bar</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>bar<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "5. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><tr><td><div><p>{{1x|foo</p></div></td>foo}}</tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground template-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "6. Encapsulate foster-parented transclusion content",
		"wikitext": "<table><tr><td><div><p>{{1x|foo</p></div></td>foo</tr></table>}}<p>ok</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</>ok<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "7. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|<p>foo</p>}}<td>bar</td></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template>foo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>p</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "8. Encapsulate foster-parented transclusion content",
		"wikitext": "{{1x|a\n}}{|{{1x|style='color:red'}}\n|-\n|b\n|}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template-bracket>}}</>{|<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>style=</><template-ground template>'color:red'</><template-ground template-bracket>}}</>|-|b|}"
	},
	{
		"desc": "9. Encapsulate foster-parented transclusion content",
		"wikitext": "<table>{{1x|hi</table>hello}}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template>hello</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Table in fosterable position",
		"wikitext": "{{OpenTable}}\n<div>\n{|\n|}\n</div>\n|}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>OpenTable</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>{||}</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>|}"
	},
	{
		"desc": "Properly encapsulate empty-content transclusions in fosterable positions",
		"wikitext": "<table>\n{{#if:|\n<td>foo</td>\n}}\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:|</><ext-ground htmltag-bracket>&lt;</><ext-ground htmltag-name>td</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>foo</><ext-ground htmltag-bracket>&lt;/</><ext-ground htmltag-name>td</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction-bracket>}}</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Always encapsulate foster box when template range is expanded to table",
		"wikitext": "{|\nhello\n{{OpenTable}}\n|}",
		"parsed": "<table-bracket>{|</><error>hello</><template-ground template-bracket>{{</><template-ground template-name pagename>OpenTable</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "T115289: Unclosed table",
		"wikitext": "{{1x|<table>}}<!--c-->[[Category:Two]]",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>table</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><comment>&lt;!--c--&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Two</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T115289: Don't migrate newlines out of tables with fostered content",
		"wikitext": "<table><td></td>{{1x|<tr>[[Category:One]]}}<!--c-->[[Category:Two]]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:One</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</><comment>&lt;!--c--&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Two</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T73074: More fostering fun",
		"wikitext": "<table><td></td>{{1x|<tr>}}<!--c-->[[Category:Two]]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>tr</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><comment>&lt;!--c--&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Two</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Fostered content with a dom fragment token starting with a transclusion",
		"wikitext": "{|\n[[File:Foobar.jpg|right|{{1x|<div>123</div>}}]]\n|}",
		"parsed": "<table-bracket>{|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground htmltag-bracket>&lt;</><template-link-ground htmltag-name>div</><template-link-ground htmltag-bracket>&gt</><template-link-ground template>123</><template-link-ground htmltag-bracket>&lt;/</><template-link-ground htmltag-name>div</><template-link-ground htmltag-bracket>&gt</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "1. Template wrapping shouldn't ignore fostered content",
		"wikitext": "{|\n{{tr}}\n{{1x|\n}}\n\nhiho",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>tr</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</><error>hiho</>"
	},
	{
		"desc": "2. Template wrapping shouldn't ignore fostered content",
		"wikitext": "{|\n{{tr}}\n{{1x|\n }}\n\nhiho",
		"parsed": "<table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>tr</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket> }}</><error>hiho</>"
	},
	{
		"desc": "Support <object> element with .data attribute",
		"wikitext": "<object data=\"test.swf\"></object>",
		"parsed": "<object data=\"test.swf\"></object>"
	},
	{
		"desc": "T72867: Don't block XML namespace declaration",
		"wikitext": "<span xmlns:dct=\"http://purl.org/dc/terms/\" property=\"dct:title\">MediaWiki</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>xmlns:dct=</><htmltag-attribute-value>\"http://purl.org/dc/terms/\"</><htmltag-attribute html-span> property=</><htmltag-attribute-value>\"dct:title\"</><htmltag-bracket>&gt</>MediaWiki<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Ignore rel attribute in a-tags during serialization to url-links",
		"wikitext": "http://en.wikipedia.org/wiki/Foobar\nhttp://en.wikipedia.org/wiki/Foobar\nhttp://en.wikipedia.org/wiki/Foobar",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>en.wikipedia.org/wiki/Foobar</><free-extlink-protocol>http://</><free-extlink>en.wikipedia.org/wiki/Foobar</><free-extlink-protocol>http://</><free-extlink>en.wikipedia.org/wiki/Foobar</>"
	},
	{
		"desc": "Serialize interwiki links pointing to the current wiki as plain wiki links (T67869)",
		"wikitext": "[[Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid should accept interwiki shortcuts",
		"wikitext": "[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]\n\n[[:fr:Foo|Foo]]\n[[:fr:Foo|Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:fr:Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid should not accept invalid interwiki shortcuts",
		"wikitext": "[news:Foo Foo]\n[news:Foo Foo]\n[news:Foo Foo]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>news:</><link-ground extlink>Foo</><link-ground extlink-text> Foo</><link-ground extlink-bracket>][</><link-ground extlink-protocol>news:</><link-ground extlink>Foo</><link-ground extlink-text> Foo</><link-ground extlink-bracket>][</><link-ground extlink-protocol>news:</><link-ground extlink>Foo</><link-ground extlink-text> Foo</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "New wikilinks should be serialized properly",
		"wikitext": "[[Foo]]\n[[Foo]]\n[[:en:Foo|//en.wikipedia.org/wiki/Foo]]\nhttp://en.wikipedia.org/wiki/Foo\n[[:en:Foo_bar|//en.wikipedia.org/wiki/Foo bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:en:Foo</><link-ground link-delimiter>|</><link-ground link-text>//en.wikipedia.org/wiki/Foo</><link-ground link-bracket>]]</><free-extlink-protocol>http://</><free-extlink>en.wikipedia.org/wiki/Foo</><link-ground link-bracket>[[</><link-ground link-pagename pagename>:en:Foo_bar</><link-ground link-delimiter>|</><link-ground link-text>//en.wikipedia.org/wiki/Foo bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New wiki links (href variations)",
		"wikitext": "[[Foo_bar]]\n[[Foo_bar]]\n[[Foo_bar]]\n[[Toxine bactérienne]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo_bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo_bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo_bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Toxine bactérienne</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New wiki links (content string variations)",
		"wikitext": "[[Foo_bar]]\n[[Foo bar]]\n[[Foo_bar|./Foo_bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo_bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo_bar</><link-ground link-delimiter>|</><link-ground link-text>./Foo_bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New category links (href variations)",
		"wikitext": "[[Category:Toxine bactérienne]]\n[[Category:Toxine bactérienne]]\n[[Category:Toxine bactérienne]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Toxine bactérienne</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Toxine bactérienne</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Toxine bactérienne</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New interlanguage links (href variations)",
		"wikitext": "[[es:Toxine bactérienne]]\n[[es:Toxine_bactérienne]]\n[[es:Toxine_bactérienne]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>es:Toxine bactérienne</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Toxine_bactérienne</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>es:Toxine_bactérienne</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Emit simple non-piped link where possible",
		"wikitext": "[[VisualEditor]]\n[[visualEditor]]\n[[VisualEditor link]]\n[[visualEditor link]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>VisualEditor</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>visualEditor</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>VisualEditor link</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>visualEditor link</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Lists: Serialize correctly even when list content is wrapped in p-tags (like VE does)",
		"wikitext": "* foo",
		"parsed": "<list>*</> foo"
	},
	{
		"desc": "Lists: Serialize correctly even when list tags has unneeded whitespace between tags",
		"wikitext": "* foo",
		"parsed": "<list>*</> foo"
	},
	{
		"desc": "Don't strip leading whitespace when handling indent-pre suppressing tags",
		"wikitext": "{|\n  | indented row\n|}\n<blockquote>\n '''This is very bold of you!'''\n\n{|\n|\n indented cell (no pre-wrapping!)\n|}\n</blockquote>\nfoo\n <div>bar</div>",
		"parsed": "<table-bracket>{|</><table-delimiter>  | </><table-td>indented row</><table-bracket>|}</><htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </><apostrophes>'''</><strong>This is very bold of you!</><apostrophes>'''</><table-bracket>{|</><table-delimiter>|</><table-td> indented cell (no pre-wrapping!)</><table-bracket>|}</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>foo<skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Strip leading whitespace when handling indent-pre inducing tags",
		"wikitext": "foo\n \n<span>bar</span>\n\n<span>foo2\n</span>bar2\n\n<div>foo</div>\n<span>bar</span>\n\n<div>\n<span>foo</span>\n</div>",
		"parsed": "foo<skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>foo2<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>bar2<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>bar<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Lists: Dont insert newlines in a serialized list item.",
		"wikitext": "* a<br />b\n* c",
		"parsed": "<list>*</> a<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-bracket>/&gt</>b<list>*</> c"
	},
	{
		"desc": "Headings: Force sol-transparent links and behavior switches to serialize before/after",
		"wikitext": "== hello there ==\n[[Category:A1]]\n[[Category:A2]]\n\n== hi pal ==\n\n<!--foo-->  [[Category:A3]]\n\n== how goes it ==\n\n== it goes well ==\n[[Category:A4]]  <!--bar-->\n\n__TOC__\n\n== ok ==",
		"parsed": "<section-header section--2>==</><section> hello there </><section-header>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:A1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:A2</><link-ground link-bracket>]]</><section-header section--2>==</><section> hi pal </><section-header>==</><comment>&lt;!--foo--&gt</>  <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:A3</><link-ground link-bracket>]]</><section-header section--2>==</><section> how goes it </><section-header>==</><section-header section--2>==</><section> it goes well </><section-header>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:A4</><link-ground link-bracket>]]</>  <comment>&lt;!--bar--&gt</><double-underscore>__TOC__</><section-header section--2>==</><section> ok </><section-header>==</>"
	},
	{
		"desc": "Headings: Don't hoist metas that come from templates",
		"wikitext": "== {{1x|foo [[Category:Foo]]}} ==",
		"parsed": "<section-header section--2>==</><section> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:Foo</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</><section> </><section-header>==</>"
	},
	{
		"desc": "Parsoid: Serialize positional parameters with = in them as named parameter",
		"wikitext": "{{1x|1=f=oo}}\n\n{{1x|1=f=oo|2=bar}}\n\n<!--Orig params with data-parsoid has heuristics for handling = chars-->\n<!--FIXME: But maybe the heuristic needs fixing to apply to new params as well-->\n{{1x|<nowiki>f=oo</nowiki>|bar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>f=oo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>f=oo</><template-ground template-delimiter>|</><template-ground template-argument-name>2=</><template-ground template>bar</><template-ground template-bracket>}}</><comment>&lt;!--Orig params with data-parsoid has heuristics for handling = chars--&gt&lt;!--FIXME: But maybe the heuristic needs fixing to apply to new params as well--&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><tag-nowiki>f=oo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>nowiki</><template-ground exttag-bracket>&gt</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Serialize positional parameters with = in extlink as named parameter",
		"wikitext": "{{1x|1=http://stuff?is=ok}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template>http://stuff?is=ok</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Parsoid: Correctly serialize block-node children when they are a combination of text and p-nodes",
		"wikitext": "<div>a\nb\n</div>\n<div>a\nb\n</div>\n<div>\na\n\nb\n</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Substrings resembling wikitext in hrefs should not get nowiki escapes",
		"wikitext": "[[Foo''bar''baz]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo''bar''baz</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Ignore single-line context for wikilinks",
		"wikitext": "* [[Foo|\nbar]]\n\n== [[Foo|\nbar]] ==\n\n* [[Foo|bar\n<span style=\"background-color:green;\ncolor:blue\">x</span>]]",
		"parsed": "<list>*</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]]</>== <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]]</> ==<list>*</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>style=</><link-ground htmltag-attribute-value>\"background-color:green;color:blue\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>x</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Selser: Ignore single-line context for wikilinks",
		"wikitext": "* [[Foo|\nbar]]",
		"parsed": "<list>*</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "1. I/B quote minimization: wikitext-only tags should be combined",
		"wikitext": "''AB''\n\n'''AB'''\n\n''A'''B'''''\n\n'''A''B'''''\n\n'''A''BC''D'''\n\n'''''AB'''''\n\n'''''AB'''''\n\n'''''AB'''''",
		"parsed": "<apostrophes>''</><em>AB</><apostrophes>'''''</><strong>AB</><apostrophes>'''''</><em>A</><apostrophes>'''</><strong em>B</><apostrophes>''''''''</><strong>A</><apostrophes>''</><strong em>B</><apostrophes>''''''''</><strong>A</><apostrophes>''</><strong em>BC</><apostrophes>''</><strong>D</><apostrophes>''''''''</><strong em>AB</><apostrophes>''''''''''</><strong em>AB</><apostrophes>''''''''''</><strong em>AB</><apostrophes>'''''</>"
	},
	{
		"desc": "2. I/B quote minimization: wikitext and html tags should not be combined",
		"wikitext": "''A''<i>B</i>\n\n''A''<nowiki/>'''<i>B</i>'''",
		"parsed": "<apostrophes>''</><em>A</><apostrophes>''</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</>B<htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><apostrophes>''</><em>A</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</><strong>B</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><apostrophes>'''</>"
	},
	{
		"desc": "3. I/B quote minimization: templated content stops minimization",
		"wikitext": "''A''{{1x|''B''}}\n\n''A''{{1x|'''''B'''''}}",
		"parsed": "<apostrophes>''</><em>A</><apostrophes>''</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>B</><template-ground apostrophes>''</><template-ground template-bracket>}}</><apostrophes>''</><em>A</><apostrophes>''</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground apostrophes>'''''</><template-ground template>B</><template-ground apostrophes>'''''</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "4. I/B quote minimization: new content should be mimimized with adjacent old content",
		"wikitext": "''AB''\n\n'''AB'''\n\n''A'''B'''''",
		"parsed": "<apostrophes>''</><em>AB</><apostrophes>'''''</><strong>AB</><apostrophes>'''''</><em>A</><apostrophes>'''</><strong em>B</><apostrophes>'''''</>"
	},
	{
		"desc": "5a. Merge adjacent quote nodes if they've been edited",
		"wikitext": "''a''b''c''",
		"parsed": "<apostrophes>''</><em>a</><apostrophes>''</>b<apostrophes>''</><em>c</><apostrophes>''</>"
	},
	{
		"desc": "5b. Merge adjacent quote nodes if they've been edited",
		"wikitext": "''a''<span id=\"x\">b</span>''c''",
		"parsed": "<apostrophes>''</><em>a</><apostrophes>''</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>''</><em>c</><apostrophes>''</>"
	},
	{
		"desc": "1. Merge adjacent link nodes as long as at least one element is new",
		"wikitext": "[[Football]]\n[[Football]]\n[[Football|Foot]][[Football|ball]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Football</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Football</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Football</><link-ground link-delimiter>|</><link-ground link-text>Foot</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Football</><link-ground link-delimiter>|</><link-ground link-text>ball</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "2. Merge adjacent link nodes and enable additional normalizations",
		"wikitext": "''[[Football]]''",
		"parsed": "<apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Football</><link-ground link-bracket>]]</><apostrophes>''</>"
	},
	{
		"desc": "1. Move format tags outside of WikiLink",
		"wikitext": "''[[Football]]''\n'''''[[Football]]'''''\n<u>'''''[[Football]]'''''</u>",
		"parsed": "<apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Football</><link-ground link-bracket>]]</><apostrophes>'''''''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong em>Football</><link-ground link-bracket>]]</><apostrophes>'''''</><htmltag-bracket>&lt;</><htmltag-name>u</><htmltag-bracket>&gt</><apostrophes>'''''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong em>Football</><link-ground link-bracket>]]</><apostrophes>'''''</><htmltag-bracket>&lt;/</><htmltag-name>u</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2. Move format tags outside of WikiLink with mergable A tags",
		"wikitext": "'''''[[Football]]'''''",
		"parsed": "<apostrophes>'''''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong em>Football</><link-ground link-bracket>]]</><apostrophes>'''''</>"
	},
	{
		"desc": "3. Move format tags outside of WikiLink while preserving formats already outside WikiLink",
		"wikitext": "<font color=\"red\"><u>'''[[Foo]]'''</u></font>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>color=</><htmltag-attribute-value>\"red\"</><htmltag-bracket>&gt&lt;</><htmltag-name>u</><htmltag-bracket>&gt</><apostrophes>'''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>Foo</><link-ground link-bracket>]]</><apostrophes>'''</><htmltag-bracket>&lt;/</><htmltag-name>u</><htmltag-bracket>&gt&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. Do not move format tags outside of WikiLink which includes attributes color, style and class",
		"wikitext": "[[Foo|<font color=\"red\">Foo</font>]]\n[[Foo|<span style=\"color: blue; font-size: 46px;\">Foo></span>]]\n[[Foo|<span class=\"Bar\">Foo</span>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>font </><link-ground htmltag-attribute html-font>color=</><link-ground htmltag-attribute-value>\"red\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>Foo</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>font</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>style=</><link-ground htmltag-attribute-value>\"color: blue; font-size: 46px;\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>Foo&gt</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>class=</><link-ground htmltag-attribute-value>\"Bar\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>Foo</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "5. T194083 Regression test: Manual edit test to move format tags outside wikilinks",
		"wikitext": "[[Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "6. Regression test: Manual edit test to ensure diff markers are not lost",
		"wikitext": "''Foo''",
		"parsed": "<apostrophes>''</><em>Foo</><apostrophes>''</>"
	},
	{
		"desc": "7. T194083 Regression test: Manual edit test to ensure nested diff markers aren't inserted",
		"wikitext": "<div>placeholder</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>placeholder<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T192913 Regression test: 1. html2wt of links should not trip on parser functions found in target",
		"wikitext": "[[Category:Bugs-{{#if:blah|Regression|None}}]]\n[[Category:Bugs-{{#if:blah|Regression|None}}|{{#if:blah|2020|None}}-#fragment]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bugs-</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>Regression</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bugs-</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>Regression</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-delimiter>|</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>2020</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-text>-#fragment</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T192913 Regression test: 2. html2wt of links should not trip on parser functions found in target (2)",
		"wikitext": "[[Category:Bugs-{{#if:blah|Regression|None}}|fragment]]\n[[Category:Bugs-{{#if:blah|Regression|None}}-{{#if:blah|2020|None}}|fragment]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bugs-</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>Regression</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>fragment</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:Bugs-</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>Regression</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-pagename pagename>-</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>#if</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>blah</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>2020</><ext-link-ground parserfunction-delimiter>|</><ext-link-ground parserfunction>None</><ext-link-ground parserfunction-bracket>}}</><link-ground link-delimiter>|</><link-ground link-text>fragment</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T56262: New entities",
		"wikitext": "&nbsp;",
		"parsed": "<entity>&amp;nbsp;</>"
	},
	{
		"desc": "Consecutive <pre>s should not get merged",
		"wikitext": " a\n\n b\n\n c\n\n d\n\n e\n \n\n \n f",
		"parsed": "<skipformatting> </>a<skipformatting> </>b<skipformatting> </>c<skipformatting> </>d<skipformatting> </>e<skipformatting>   </>f"
	},
	{
		"desc": "Edited ISBN links not serializable as ISBN links should serialize as wikilinks",
		"wikitext": "[[Special:BookSources/1234567890|ISBN 1234567895]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Special:BookSources/1234567890</><link-ground link-delimiter>|</><link-ground link-text>ISBN 1234567895</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Edited RFC links not serializable as RFC links should serialize as extlinks",
		"wikitext": "[https://tools.ietf.org/html/rfc123 New RFC]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>tools.ietf.org/html/rfc123</><link-ground extlink-text> New RFC</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Edited PMID links not serializable as PMID links should serialize as extlinks",
		"wikitext": "[//www.ncbi.nlm.nih.gov/pubmed/123?dopt=Abstract New PMID]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>www.ncbi.nlm.nih.gov/pubmed/123?dopt=Abstract</><link-ground extlink-text> New PMID</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "WTS of autolinks with trailing/surrounding context",
		"wikitext": "http://cscott.net'''foo'''\n\nhttp://cscott.net<b>foo</b>\n\n'''http://cscott.net'''\n\n'''http://cscott.net '''\n\n'''http://cscott.net<nowiki/>x'''\n\nhttp://cscott.net<nowiki/>x",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>cscott.net</><apostrophes>'''</><strong>foo</><apostrophes>'''</><free-extlink-protocol>http://</><free-extlink>cscott.net</><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</><apostrophes>'''</><strong>http://cscott.net</><apostrophes>''''''</><strong>http://cscott.net </><apostrophes>''''''</><strong>http://cscott.net</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><strong>x</><apostrophes>'''</><free-extlink-protocol>http://</><free-extlink>cscott.net</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>x"
	},
	{
		"desc": "WTS of autolinks with nowikis (round-trip)",
		"wikitext": "x<nowiki/>http://cscott.net<nowiki/>x",
		"parsed": "x<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>http://cscott.net<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>x"
	},
	{
		"desc": "WTS of autolinks with escapes (editing)",
		"wikitext": "x<nowiki/>http://cscott.net<nowiki/>x",
		"parsed": "x<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>http://cscott.net<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>x"
	},
	{
		"desc": "WTS of edited autolink-like text (T103364)",
		"wikitext": "Not a link: <nowiki>http://example.com</nowiki>.",
		"parsed": "Not a link: <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>http://example.com</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>."
	},
	{
		"desc": "WTS of newly-authored autolink-like text (T103364)",
		"wikitext": "<nowiki>http://example.com</nowiki> is not a link.",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>http://example.com</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> is not a link."
	},
	{
		"desc": "WTS of autolink-like text after an autolink (T108563)",
		"wikitext": "http://example.com <nowiki>http://example.com</nowiki> is not a link.",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>http://example.com</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> is not a link."
	},
	{
		"desc": "WTS of an autolink surrounded by square brackets (T220018)",
		"wikitext": "<nowiki>[</nowiki>http://example.com]",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>http://example.com]"
	},
	{
		"desc": "WTS of edited autolink surrounded by square brackets (T220018)",
		"wikitext": "http://example.com",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</>"
	},
	{
		"desc": "WTS of an external link surrounded by square brackets (T220018)",
		"wikitext": "<nowiki>[</nowiki>[http://example.com foo]]",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> foo</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "WTS of edited external link surrounded by square brackets (T220018)",
		"wikitext": "[http://example.com foo]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> foo</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Magic links inside links (not autolinked)",
		"wikitext": "[[Foo|http://example.com]]\n[[Foo|RFC 1234]]\n[[Foo|PMID 1234]]\n[[Foo|ISBN 123456789x]]\n\n[http://foo.com http://example.com]\n[http://foo.com RFC 1234]\n[http://foo.com PMID 1234]\n[http://foo.com ISBN 123456789x]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>http://example.com</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>RFC 1234</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>PMID 1234</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>ISBN 123456789x</><link-ground link-bracket>]]</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> http://example.com</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> RFC 1234</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> PMID 1234</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> ISBN 123456789x</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "WTS of magic word text (T109371)",
		"wikitext": "<nowiki>RFC 1234</nowiki>\n\n[http://foo.com RFC 1234]\n\n[[Foo|RFC 1234]]",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>RFC 1234</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> RFC 1234</><link-ground extlink-bracket>]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>RFC 1234</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Edited Redirect link should emit a non-piped wikitext link",
		"wikitext": "#REDIRECT [[Bar]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T75121: Infer extension name from typeOf if data-mw is not present",
		"wikitext": "<foo />",
		"parsed": "<foo />"
	},
	{
		"desc": "T88318: p-wrapped dash in table.",
		"wikitext": "{|\n!-\n!- \n|-\n|<nowiki>-</nowiki>\n|<nowiki>- </nowiki>\n|-\n|<small>-</small>\n|<br />\n-\n|<br />-\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>-</><table-delimiter>!</><table-th>- </><table-delimiter>|-|</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>-</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>|</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>- </><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>|-|</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><table-td>-</><htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-bracket>/&gt</><table-td>-</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-bracket>/&gt</><table-td>-</><table-bracket>|}</>"
	},
	{
		"desc": "T149209: WTS: Handle newlines in table cells properly",
		"wikitext": "{|\n|a\nb\n|c\n|-\n|x\n{{!}}y\n|}\n{|\n!a\nb\n!c\n|-\n!x\n!y\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>ab</><table-delimiter>|</><table-td>c</><table-delimiter>|-|</><table-td>x</><table-delimiter>{{!}}</><table-td>y</><table-bracket>|}{|</><table-delimiter>!</><table-th>ab</><table-delimiter>!</><table-th>c</><table-delimiter>|-!</><table-th>x</><table-delimiter>!</><table-th>y</><table-bracket>|}</>"
	},
	{
		"desc": "T149209: Selser: Handle newlines in table cells properly",
		"wikitext": "{|\n! id=\"h1\" |edit-me!!1\n|-\n! id=\"h2\" |edit-me||2\n|-\n| id=\"c1\" |edit-me||3\n|-\n| id=\"c2\" |edit-me||4\n|-\n| id=\"c3\" |edit-me||p||q||r\n|-\n| id=\"c4\" |edit-me||p||q||r\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>! </><html-th table-definition>id=\"h1\" </><table-delimiter2>|</><table-th>edit-me</><table-delimiter>!!</><table-th>1</><table-delimiter>|-! </><html-th table-definition>id=\"h2\" </><table-delimiter2>|</><table-th>edit-me</><table-delimiter>||</><table-th>2</><table-delimiter>|-| </><html-td table-definition>id=\"c1\" </><table-delimiter2>|</><table-td>edit-me</><table-delimiter>||</><table-td>3</><table-delimiter>|-| </><html-td table-definition>id=\"c2\" </><table-delimiter2>|</><table-td>edit-me</><table-delimiter>||</><table-td>4</><table-delimiter>|-| </><html-td table-definition>id=\"c3\" </><table-delimiter2>|</><table-td>edit-me</><table-delimiter>||</><table-td>p</><table-delimiter>||</><table-td>q</><table-delimiter>||</><table-td>r</><table-delimiter>|-| </><html-td table-definition>id=\"c4\" </><table-delimiter2>|</><table-td>edit-me</><table-delimiter>||</><table-td>p</><table-delimiter>||</><table-td>q</><table-delimiter>||</><table-td>r</><table-bracket>|}</>"
	},
	{
		"desc": "HTML id attribute with Parsoid-like element ids should not be serialized to wikitext",
		"wikitext": "{|\n|foo\n| id=\"serialize-this\" |bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>| </><html-td table-definition>id=\"serialize-this\" </><table-delimiter2>|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Parsoid-like element ids should not be serialized to wikitext unless shadowed",
		"wikitext": "<div id=\"hello\">ok</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"hello\"</><htmltag-bracket>&gt</>ok<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Testing serialization after deletion of table cells",
		"wikitext": "{|\n!h1 !!h2 !!h3\n| id=\"x\" |c1 {{!}}{{!}}{{!}}c2 |||c3\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>h1 </><table-delimiter>!!</><table-th>h2 </><table-delimiter>!!</><table-th>h3</><table-delimiter>| </><html-td table-definition>id=\"x\" </><table-delimiter2>|</><table-td>c1 </><table-delimiter>{{!}}{{!}}</><table-delimiter2>{{!}}</><table-td>c2 </><table-delimiter>||</><table-delimiter2>|</><table-td>c3</><table-bracket>|}</>"
	},
	{
		"desc": "Testing selser after addition of new row before first row (T125419)",
		"wikitext": "{|\n|a\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><table-bracket>|}</>"
	},
	{
		"desc": "Serialize new table rows in a HTML table using HTML tags",
		"wikitext": "<table><tr><td>a</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Serialize new table cells in a HTML row using HTML tags",
		"wikitext": "<table><tr><td>a</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Serialize wikitext list items as HTML list items when embedded in a HTML list",
		"wikitext": "<ul>\n<li>a</li>\n<li>b</li>\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Wikitext lists can be nested inside HTML lists",
		"wikitext": "<ul>\n<li>a\n* b\n</li>\n</ul>\n\n<ul>\n<li>x\n* y\n</li>\n</ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>a<list>*</> b<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>x<list>*</> y<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "WTS change modes",
		"wikitext": "<span id=\"xyz\">hello</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"xyz\"</><htmltag-bracket>&gt</>hello<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Never serialize a-tag as html, regardless of what data-parsoid has to say",
		"wikitext": "[[Foo]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Never serialize a-tag as html, no matter what attributes it has",
		"wikitext": "[http://boo.org http://boohoo.org]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>boo.org</><link-ground extlink-text> http://boohoo.org</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Strip span tags added to mark misnested links",
		"wikitext": "[http://test.com][[one]] two three",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>test.com</><link-ground extlink-bracket>]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>one</><link-ground link-bracket>]]</> two three"
	},
	{
		"desc": "Catch regression when unpacking misnested links",
		"wikitext": "{{1x|hi}}[http://example.com [[ho]]]",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground template-bracket>}}</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>ho</><link-ground link-bracket>]]</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Use data-parsoid.firstWikitextNode to compute newline constraints for template content",
		"wikitext": "{{1x|a}}\n{|{{1x|c\n{{!}}d\n}}\n|}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template-bracket>}}</><table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>c</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>d</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "data-parsoid.firstWikitextNode should be computed properly in the presence of fostered content",
		"wikitext": "<div id=\"x\">foo</div>\n{|\n{{1x|<div>boo</div>\n{{!}}b}}\n|c\n|}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>{|</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template>boo</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>b</><template-ground template-bracket>}}</><table-delimiter>|</><table-td>c</><table-bracket>|}</>"
	},
	{
		"desc": "Serialize multi-line indent-pre starting with wikitext syntax",
		"wikitext": " * 1\n ** 2\n * 3",
		"parsed": "<skipformatting> </>* 1<skipformatting> </>** 2<skipformatting> </>* 3"
	},
	{
		"desc": "1. Categories should always be serialized on their own line",
		"wikitext": "foo\n[[Category:Foo]]\nbar",
		"parsed": "foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>bar"
	},
	{
		"desc": "2. Categories that are part of templates should not introduce a line break",
		"wikitext": "foo {{1x|<span>bar</span> [[Category:baz]]}} bar",
		"parsed": "foo <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt</><template-ground template>bar</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt</><template-ground template> </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:baz</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</> bar"
	},
	{
		"desc": "RTL (\\u200f) and LTR (\\u200e) markers around category tags should be stripped",
		"wikitext": "[[קטגוריה:טקסים]]\n[[קטגוריה: שיטות משפט]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>קטגוריה:טקסים</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>קטגוריה: שיטות משפט</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "RTL (\\u200f) and LTR (\\u200e) markers should not be stripped if followed by a text node",
		"wikitext": "[[קטגוריה:טקסים]]\n‏y",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>קטגוריה:טקסים</><link-ground link-bracket>]]</>‏y"
	},
	{
		"desc": "Lists: Add space after bullets",
		"wikitext": "* foo\n* bar\n* <span> baz</span>",
		"parsed": "<list>*</> foo<list>*</> bar<list>*</> <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</> baz<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "1. Headings: Add space before/after == (T53744)",
		"wikitext": "== foo ==\n\n== bar ==\n\n== baz ==\n\n== <span> baz</span> ==",
		"parsed": "<section-header section--2>==</><section> foo </><section-header>==</><section-header section--2>==</><section> bar </><section-header>==</><section-header section--2>==</><section> baz </><section-header>==</><section-header section--2>==</><section> </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><section> baz</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section> </><section-header>==</>"
	},
	{
		"desc": "2. Headings: Add space before/after == even after hoisted content",
		"wikitext": "[[Category:A2]]\n\n== ok ==",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:A2</><link-ground link-bracket>]]</><section-header section--2>==</><section> ok </><section-header>==</>"
	},
	{
		"desc": "2. Headings: suppress empty headings on edits",
		"wikitext": "==<span id=\"x\">foo</span>==",
		"parsed": "<section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><section>foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Headings: Replace <br/> with a single whitespace char",
		"wikitext": "== foo bar ==\n\n== foo <span> bar</span> baz ==",
		"parsed": "<section-header section--2>==</><section> foo bar </><section-header>==</><section-header section--2>==</><section> foo </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><section> bar</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section> baz </><section-header>==</>"
	},
	{
		"desc": "2. WT Quote Tags: suppress empty style tags on edits",
		"wikitext": "'''<span id=\"x\">foo</span>'''",
		"parsed": "<apostrophes>'''</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><strong>foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>'''</>"
	},
	{
		"desc": "2. Anchors: suppress empty anchors on edits",
		"wikitext": "[[Test|<span id=\"x\">foo</span>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>id=</><link-ground htmltag-attribute-value>\"x\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>foo</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "3a. Anchors: do not suppress numbered extlinks",
		"wikitext": "[http://foo.com]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "3b. Anchors: do not suppress numbered extlinks",
		"wikitext": "[http://foo.com <span id=\"x\">foo</span>]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>foo.com</><link-ground extlink-text> </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>id=</><link-ground htmltag-attribute-value>\"x\"</><link-ground htmltag-bracket>&gt</><link-ground extlink-text>foo</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Normalizations should be restricted to edited content",
		"wikitext": "a\n= =\nb",
		"parsed": "a<section-header section--1>=</><section> </><section-header>=</>b"
	},
	{
		"desc": "1. Multiple normalizations (html2wt)",
		"wikitext": "[[foo]]\nx",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>foo</><link-ground link-bracket>]]</>x"
	},
	{
		"desc": "2. Multiple normalizations (selser)",
		"wikitext": "<div id=\"x\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "1. Indent Pre Nowiki: suppress whitespace at the start of new paragraph",
		"wikitext": "hi\n\nhello",
		"parsed": "hihello"
	},
	{
		"desc": "2. Indent Pre Nowiki: suppress whitespace after newlines in new paragraph or table cell",
		"wikitext": "Foo\nbar\nbaz\n\n{|\n|Foo\nbar\nbaz bang\n|}\n\n<!--boo-->foo\nbar\n\nfoo\nbar<span>boo</span>",
		"parsed": "Foobarbaz<table-bracket>{|</><table-delimiter>|</><table-td>Foobarbaz bang</><table-bracket>|}</><comment>&lt;!--boo--&gt</>foobarfoobar<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>boo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. Indent Pre Nowiki: suppress leading whitespace in edited paragraphs",
		"wikitext": "xyz",
		"parsed": "xyz"
	},
	{
		"desc": "New links that end in spaces",
		"wikitext": "[[Berlin]] is the capital of Germany.\n\n[[Foo]] '''bar'''\n\n[[Boston]] is a city.",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Berlin</><link-ground link-bracket>]]</> is the capital of Germany.<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</> <apostrophes>'''</><strong>bar</><apostrophes>'''</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Boston</><link-ground link-bracket>]]</> is a city."
	},
	{
		"desc": "1. Table cells with escapable prefixes",
		"wikitext": "{|\n|a\n|-\n| -\n|-\n| +\n|-\n| }\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><table-delimiter>|-| </><table-td>-</><table-delimiter>|-| </><table-td>+</><table-delimiter>|-| </><table-td>}</><table-bracket>|}</>"
	},
	{
		"desc": "2a. Table cells with escapable prefixes after edits",
		"wikitext": "{|\n|a||-\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><table-delimiter>||</><table-td>-</><table-bracket>|}</>"
	},
	{
		"desc": "2b. Table cells with escapable prefixes after edits",
		"wikitext": "{|\n|pqr\n|<span id=\"x\">foo</span>+\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>pqr</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><table-td>foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><table-td>+</><table-bracket>|}</>"
	},
	{
		"desc": "3a. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n| id=\"x\" |abcd\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>id=\"x\" </><table-delimiter2>|</><table-td>abcd</><table-bracket>|}</>"
	},
	{
		"desc": "3b. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n|a||b\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><table-delimiter>||</><table-td>b</><table-bracket>|}</>"
	},
	{
		"desc": "3c. Table cells without escapable prefixes after edits",
		"wikitext": "{|\n|-\n<!--foo--> |a||-\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><comment>&lt;!--foo--&gt</><error> |a||-</><table-bracket>|}</>"
	},
	{
		"desc": "3d. Table cells without escapable prefixes after edits",
		"wikitext": "<table>\n<tr><td>a</td></tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. font tags without attributes should be dropped",
		"wikitext": "foo\nbar\n<font class=\"x\">boo</font>",
		"parsed": "foobar<htmltag-bracket>&lt;</><htmltag-name>font </><htmltag-attribute html-font>class=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>boo<htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Normalize empty paragraphs to HTML form that html2wt expects",
		"wikitext": "<div>1</div>\na\n\n\nb\n<div>2</div>\na\n\n\nb\n<div>3</div>\na\n\n\n\n\n\nb\n<div>4</div>\na\n\n<div>foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>1<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>2<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>3<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>ab<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>4<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templated content should be skipped over by normalization",
		"wikitext": "{{SomeTemplate1|boo}}{{SomeTemplate2|booboo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>SomeTemplate1</><template-ground template-delimiter>|</><template-ground template>boo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>SomeTemplate2</><template-ground template-delimiter>|</><template-ground template>booboo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Escape DOM elements",
		"wikitext": "&lt;nowiki&gt;''foo''&lt;/nowiki&gt;\n&lt;noinclude&gt;''foo''&lt;/noinclude&gt;\n&lt;includeonly&gt;''foo''&lt;/includeonly&gt;",
		"parsed": "<entity>&amp;lt;</>nowiki<entity>&amp;gt;</><apostrophes>''</><em>foo</><apostrophes>''</><entity>&amp;lt;</>/nowiki<entity>&amp;gt;&amp;lt;</>noinclude<entity>&amp;gt;</><apostrophes>''</><em>foo</><apostrophes>''</><entity>&amp;lt;</>/noinclude<entity>&amp;gt;&amp;lt;</>includeonly<entity>&amp;gt;</><apostrophes>''</><em>foo</><apostrophes>''</><entity>&amp;lt;</>/includeonly<entity>&amp;gt;</>"
	},
	{
		"desc": "Don't escape pre elements that fail to parse as extension tags",
		"wikitext": "<pre>closed is extension tag, so everything is <span>text</span></pre>\n<pre>unclosed is not, so these are <span>tags</span>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>closed is extension tag, so everything is &lt;span&gttext&lt;/span&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>unclosed is not, so these are &lt;span&gttags&lt;/span&gt</>"
	},
	{
		"desc": "New list is serialized on newlines",
		"wikitext": "The quick brown fox jumps over the lazy dog.\n\n* Yesterday\n* Today\n* Tomorrow\n\nThe quick onyx goblin jumps over the lazy dwarf.",
		"parsed": "The quick brown fox jumps over the lazy dog.<list>*</> Yesterday<list>*</> Today<list>*</> TomorrowThe quick onyx goblin jumps over the lazy dwarf."
	},
	{
		"desc": "New lists in formatting elements serialized w/o newlines",
		"wikitext": "<small>\n* 123\n</small>\n\n<small>\n* hi\n</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><list>*</> 123<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><list>*</> hi<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "New list in table doesn't need newlines",
		"wikitext": "{|\n|\n* test\n* 123\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><list>*</><table-td> test</><list>*</><table-td> 123</><table-bracket>|}</>"
	},
	{
		"desc": "Newly inserted noinclude tags do not need newlines before/after",
		"wikitext": "a<noinclude>b</noinclude>c",
		"parsed": "a<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude>b</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</>c"
	},
	{
		"desc": "Bare inline nodes not wrapped inside p-tags should be treated as p-wrapped",
		"wikitext": "a\n\nb\n\n'''c'''\n\nd\n{|\n|a\nb\n|'''c'''\nd\n|}",
		"parsed": "ab<apostrophes>'''</><strong>c</><apostrophes>'''</>d<table-bracket>{|</><table-delimiter>|</><table-td>ab</><table-delimiter>|</><apostrophes>'''</><table-td strong>c</><apostrophes>'''</><table-td>d</><table-bracket>|}</>"
	},
	{
		"desc": "Anchor without href scenarios",
		"wikitext": "dice\n<span name=\"foo\"></span>",
		"parsed": "dice<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>name=</><htmltag-attribute-value>\"foo\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "New transclusion added after a list should be serialized after the list",
		"wikitext": "* a\n{{1x|foo}}",
		"parsed": "<list>*</> a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Only html p-tag is strong indent pre suppressing",
		"wikitext": "test2<span>\ntest3\n</span>",
		"parsed": "test2<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>test3<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T238721: New transclusion without the \"i\" property for a template part should be handled properly",
		"wikitext": "{{1x}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Selser: New comments should not be lost",
		"wikitext": "<span id=\"a\">a</span>\n\n<span id=\"b\">b</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"a\"</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"b\"</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Selser: Check for validity of DSR before using it",
		"wikitext": "<span id=\"a\">a</span>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"a\"</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "DOMDiff: Edits to content nested in elements with templated attributes should not be lost (T139388)",
		"wikitext": "<div style=\"{{1x|color:red;}}%\">foo</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>color:red;</><template-ground template-bracket>}}</><htmltag-attribute-value>%\"</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Empty LI (T49673)",
		"wikitext": "*a\n* \n*\n*b",
		"parsed": "<list>*</>a<list>*</> <list>**</>b"
	},
	{
		"desc": "unclosed internal link XSS (T137264)",
		"wikitext": "[[#%3Cscript%3Ealert(1)%3C/script%3E|",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-tosection>#%3Cscript%3Ealert(1)%3C/script%3E</><link-ground link-delimiter>|</>"
	},
	{
		"desc": "Validating that <style> isn't eaten by tidy (T167349)",
		"wikitext": "<div class=\"foo\">\n<style>.foo::before { content: \"<foo>\"; }</style>\n<style data-mw-foobar=\"baz\">.foo::after { content: \"<bar>\"; }</style>\n</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>class=</><htmltag-attribute-value>\"foo\"</><htmltag-bracket>&gt</><style>.foo::before { content: \"<foo>\"; }</style><style data-mw-foobar=\"baz\">.foo::after { content: \"<bar>\"; }</style><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Validating that <style> isn't wrapped in a paragraph (T186965)",
		"wikitext": "A style tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\n\n<style>.foo::before { content: \"<foo>\"; }</style>\n\n<style>.foo::before { content: \"<foo>\"; }</style> <link rel=\"foo\" href=\"bar\"/><style>.foo::before { content: \"<foo>\"; }</style>\n\nBut if it's on a line with other content, let it be wrapped.\n\n<style>.foo::before { content: \"<foo>\"; }</style> bar\n\nfoo <style>.foo::before { content: \"<foo>\"; }</style>\n\nfoo <style>.foo::before { content: \"<foo>\"; }</style> bar\n\nAnd the same if we have non-paragraph-breaking whitespace\n\nfoo\n<style>.foo::before { content: \"<foo>\"; }</style>\nbar",
		"parsed": "A style tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph<style>.foo::before { content: \"<foo>\"; }</style><style>.foo::before { content: \"<foo>\"; }</style> <htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</><style>.foo::before { content: \"<foo>\"; }</style>But if it's on a line with other content, let it be wrapped.<style>.foo::before { content: \"<foo>\"; }</style> barfoo <style>.foo::before { content: \"<foo>\"; }</style>foo <style>.foo::before { content: \"<foo>\"; }</style> barAnd the same if we have non-paragraph-breaking whitespacefoo<style>.foo::before { content: \"<foo>\"; }</style>bar"
	},
	{
		"desc": "Validating that <link> isn't wrapped in a paragraph (T186965)",
		"wikitext": "A link tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph\n\n<link rel=\"foo\" href=\"bar\"/>\n\n<link rel=\"foo\" href=\"bar\"/> <style>.foo::before { content: \"<foo>\"; }</style><link rel=\"foo\" href=\"bar\"/>\n\nBut if it's on a line with other content, let it be wrapped.\n\n<link rel=\"foo\" href=\"bar\"/> bar\n\nfoo <link rel=\"foo\" href=\"bar\"/>\n\nfoo <link rel=\"foo\" href=\"bar\"/> bar\n\nAnd the same if we have non-paragraph-breaking whitespace\n\nfoo\n<link rel=\"foo\" href=\"bar\"/>\nbar",
		"parsed": "A link tag, by itself or with other style/link tags, shouldn't be wrapped in a paragraph<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</> <style>.foo::before { content: \"<foo>\"; }</style><htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</>But if it's on a line with other content, let it be wrapped.<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</> barfoo <htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</>foo <htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</> barAnd the same if we have non-paragraph-breaking whitespacefoo<htmltag-bracket>&lt;</><htmltag-name>link </><htmltag-attribute html-link>rel=</><htmltag-attribute-value>\"foo\"</><htmltag-attribute html-link> href=</><htmltag-attribute-value>\"bar\"</><htmltag-bracket>/&gt</>bar"
	},
	{
		"desc": "Extension returning multiple nodes starting with a style tag roundtrips",
		"wikitext": "<table>\n{{1x|<html><style>.hi { color: red; }</style>\n</html>}}\n<tr><td class=\"hi\">ho</td></tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>&lt;html&gt&lt;style&gt.hi { color: red; }&lt;/style&gt&lt;/html&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td </><htmltag-attribute html-td>class=</><htmltag-attribute-value>\"hi\"</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Decoding of HTML entities in embedded HTML tags",
		"wikitext": "<table class=\"1&2&amp;3&amp;amp;4&amp;amp;amp;5\"><tr><td>x</td></tr></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table </><htmltag-attribute html-table>class=</><htmltag-attribute-value>\"1&amp;2</><entity>&amp;amp;</><htmltag-attribute-value>3</><entity>&amp;amp;</><htmltag-attribute-value>amp;4</><entity>&amp;amp;</><htmltag-attribute-value>amp;amp;5\"</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>x<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T51672: Test for brackets in attributes of elements in external link texts",
		"wikitext": "[http://example.com/ link <span title=\"title with [brackets]\">span</span>]\n[http://example.com/ link <span title=\"title with &#91;brackets&#93;\">span</span>]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text> link </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>title=</><link-ground htmltag-attribute-value>\"title with [brackets]\"</><link-ground htmltag-bracket>&gt</><link-ground extlink-text>span</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text> link </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>title=</><link-ground htmltag-attribute-value>\"title with </><link-ground entity>&amp;#91;</><link-ground htmltag-attribute-value>brackets</><link-ground entity>&amp;#93;</><link-ground htmltag-attribute-value>\"</><link-ground htmltag-bracket>&gt</><link-ground extlink-text>span</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T72875: Test for brackets in attributes of elements in internal link texts",
		"wikitext": "[[Foo|link <span title=\"title with [[double brackets]]\">span</span>]]\n[[Foo|link <span title=\"title with &#91;&#91;double brackets&#93;&#93;\">span</span>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>link </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>title=</><link-ground htmltag-attribute-value>\"title with [[double brackets]]\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>span</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>link </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span </><link-ground htmltag-attribute html-span>title=</><link-ground htmltag-attribute-value>\"title with </><link-ground entity>&amp;#91;&amp;#91;</><link-ground htmltag-attribute-value>double brackets</><link-ground entity>&amp;#93;&amp;#93;</><link-ground htmltag-attribute-value>\"</><link-ground htmltag-bracket>&gt</><link-ground link-text>span</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T199926: html arrow wt: Parsoid sometimes trips up on verticalbar chars in hrefs",
		"wikitext": "[https://stats.wikimedia.org/v2/#/fr.wikipedia.org/reading/page-views-by-country/normal|map|2-Year~2016060100~2018071100|~total 9]\n[[stats:v2/#/fr.wikipedia.org/reading/page-views-by-country/normal%7Cmap%7C2-Year~2016060100~2018071100%7C~total|10]]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>stats.wikimedia.org/v2/#/fr.wikipedia.org/reading/page-views-by-country/normal|map|2-Year~2016060100~2018071100|~total</><link-ground extlink-text> 9</><link-ground extlink-bracket>]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>stats:v2/</><link-ground link-tosection>#/fr.wikipedia.org/reading/page-views-by-country/normal%7Cmap%7C2-Year~2016060100~2018071100%7C~total</><link-ground link-delimiter>|</><link-ground link-text>10</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T199926: Hash only interwiki link",
		"wikitext": "[[meatball:Test#1/2]]\n[[gerrit:#/q/project:mediawiki/services/parsoid|Gerrit]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>meatball:Test</><link-ground link-tosection>#1/2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>gerrit:</><link-ground link-tosection>#/q/project:mediawiki/services/parsoid</><link-ground link-delimiter>|</><link-ground link-text>Gerrit</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T179544: {{anchorencode:}} output should be always usable in links",
		"wikitext": "<span id=\"{{anchorencode:[foo]}}\"></span>[[#{{anchorencode:[foo]}}]]",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>[foo]</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#</><ext-link-ground parserfunction-bracket>{{</><ext-link-ground parserfunction-name>anchorencode</><ext-link-ground parserfunction-delimiter>:</><ext-link-ground parserfunction>[foo]</><ext-link-ground parserfunction-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Trim whitespace in wikitext headings, list items, table captions, headings, and cells",
		"wikitext": "__NOTOC__\n==    <!--c1-->  <!--c2--> Spaces   <!--c3--> <!--c4-->  ==\n==\t\t<!--c1-->\t<!--c2--> Tabs\t\t<!--c3--><!--c4-->\t==\n== <!--Headings with fallback ids--> Личная жизнь ==\n*     <!--c1-->   <!--c2-->  List item <!--c3--> <!--c4-->\n; <!--term to define--> term : <!--term's definition--> definition\n{|\n|+ <!--c1--> <!--c2--> Table Caption <!--c3--> <!--c4-->\n|-\n!  <!--c1--> <!--c2--> Table Heading 1 <!--c3--> <!--c4--> !!   Table Heading 2 <!--c5-->\n|-\n| <!--c1--> <!--c2--> Table Cell 1 <!--c3--> <!--c4--> ||   Table Cell 2 <!--c5-->\n|-\n| class=\"foo\" || <!--c1--> <!--c2--> Table Cell 3 <!--c3--> <!--c4-->\n|-\n| <!--c1--> testing [[one|two]] <!--c2--> | <!--c3--> some content\n|}\n: {|\n  |  <!--c1--> <!--c2--> Table Cell 1 <!--c3--> <!--c4--> ||   Table Cell 2 <!--c5-->\n  |} foo   <!--c1-->",
		"parsed": "<double-underscore>__NOTOC__</><section-header section--2>==</><section>    </><comment>&lt;!--c1--&gt</><section>  </><comment>&lt;!--c2--&gt</><section> Spaces   </><comment>&lt;!--c3--&gt</><section> </><comment>&lt;!--c4--&gt</><section>  </><section-header>==</><section-header section--2>==</><section>\t\t</><comment>&lt;!--c1--&gt</><section>\t</><comment>&lt;!--c2--&gt</><section> Tabs\t\t</><comment>&lt;!--c3--&gt&lt;!--c4--&gt</><section>\t</><section-header>==</><section-header section--2>==</><section> </><comment>&lt;!--Headings with fallback ids--&gt</><section> Личная жизнь </><section-header>==</><list>*</>     <comment>&lt;!--c1--&gt</>   <comment>&lt;!--c2--&gt</>  List item <comment>&lt;!--c3--&gt</> <comment>&lt;!--c4--&gt</><list>;</><strong> </><comment>&lt;!--term to define--&gt</><strong> term </><list>:</> <comment>&lt;!--term's definition--&gt</> definition<table-bracket>{|</><table-delimiter>|+ </><comment>&lt;!--c1--&gt</><table-caption> </><comment>&lt;!--c2--&gt</><table-caption> Table Caption </><comment>&lt;!--c3--&gt</><table-caption> </><comment>&lt;!--c4--&gt</><table-delimiter>|-!  </><comment>&lt;!--c1--&gt</><table-th> </><comment>&lt;!--c2--&gt</><table-th> Table Heading 1 </><comment>&lt;!--c3--&gt</><table-th> </><comment>&lt;!--c4--&gt</><table-th> </><table-delimiter>!!   </><table-th>Table Heading 2 </><comment>&lt;!--c5--&gt</><table-delimiter>|-| </><comment>&lt;!--c1--&gt</><table-td> </><comment>&lt;!--c2--&gt</><table-td> Table Cell 1 </><comment>&lt;!--c3--&gt</><table-td> </><comment>&lt;!--c4--&gt</><table-td> </><table-delimiter>||   </><table-td>Table Cell 2 </><comment>&lt;!--c5--&gt</><table-delimiter>|-| </><table-td>class=\"foo\" </><table-delimiter>|| </><comment>&lt;!--c1--&gt</><table-td> </><comment>&lt;!--c2--&gt</><table-td> Table Cell 3 </><comment>&lt;!--c3--&gt</><table-td> </><comment>&lt;!--c4--&gt</><table-delimiter>|-| </><comment>&lt;!--c1--&gt</><table-td> testing </><link-ground link-bracket>[[</><link-ground link-pagename pagename>one</><link-ground link-delimiter>|</><link-ground link-text>two</><link-ground link-bracket>]]</><table-td> </><comment>&lt;!--c2--&gt</><table-td> | </><comment>&lt;!--c3--&gt</><table-td> some content</><table-bracket>|}</><list>: </><table-bracket>{|</><table-delimiter>  |  </><comment>&lt;!--c1--&gt</><table-td> </><comment>&lt;!--c2--&gt</><table-td> Table Cell 1 </><comment>&lt;!--c3--&gt</><table-td> </><comment>&lt;!--c4--&gt</><table-td> </><table-delimiter>||   </><table-td>Table Cell 2 </><comment>&lt;!--c5--&gt</><table-bracket>  |}</> foo   <comment>&lt;!--c1--&gt</>"
	},
	{
		"desc": "Do not trim whitespace in HTML headings, list items, table captions, headings, and cells",
		"wikitext": "__NOTOC__\n<h2>    <!--c1-->   <!--c2--> Heading    <!--c3--> <!--c4-->  </h2>\n<ul><li>     <!--c1-->   <!--c2-->  List item <!--c3--> <!--c4-->  </li></ul>\n<table>\n<tr><th> <!--c1--> <!--c2--> Table Heading <!--c3--> <!--c4--> <th></tr>\n<tr><td> <!--c1--> <!--c2--> Table Cell <!--c3--> <!--c4--> <th></tr>\n</table>",
		"parsed": "<double-underscore>__NOTOC__</><htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>    <comment>&lt;!--c1--&gt</>   <comment>&lt;!--c2--&gt</> Heading    <comment>&lt;!--c3--&gt</> <comment>&lt;!--c4--&gt</>  <htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</>     <comment>&lt;!--c1--&gt</>   <comment>&lt;!--c2--&gt</>  List item <comment>&lt;!--c3--&gt</> <comment>&lt;!--c4--&gt</>  <htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>th</><htmltag-bracket>&gt</> <comment>&lt;!--c1--&gt</> <comment>&lt;!--c2--&gt</> Table Heading <comment>&lt;!--c3--&gt</> <comment>&lt;!--c4--&gt</> <htmltag-bracket>&lt;</><htmltag-name>th</><htmltag-bracket>&gt</><error>&lt;/tr&gt</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</> <comment>&lt;!--c1--&gt</> <comment>&lt;!--c2--&gt</> Table Cell <comment>&lt;!--c3--&gt</> <comment>&lt;!--c4--&gt</> <htmltag-bracket>&lt;</><htmltag-name>th</><htmltag-bracket>&gt</><error>&lt;/tr&gt&lt;/table&gt</>"
	},
	{
		"desc": "Do not trim whitespace in links and quotes",
		"wikitext": "foo ''  <!--c1--> italic <!--c2-->   '' and '''  <!--c3-->  bold  <!--c4-->  '''\n[[Foo|  some text  ]]",
		"parsed": "foo <apostrophes>''</><em>  </><comment>&lt;!--c1--&gt</><em> italic </><comment>&lt;!--c2--&gt</><em>   </><apostrophes>''</> and <apostrophes>'''</><strong>  </><comment>&lt;!--c3--&gt</><strong>  bold  </><comment>&lt;!--c4--&gt</><strong>  </><apostrophes>'''</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|  </><link-ground link-text>some text  </><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Remove p tags surrounding a single element in a figcaption",
		"wikitext": "[[File:Foobar.jpg|right|200x200px|Caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>200x200px</><link-ground link-delimiter>|</><link-ground file-text>Caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Selser preserves lack of newline before list and allows newline after the list",
		"wikitext": "header\n*foo\n*bar",
		"parsed": "header<list>*</>foo<list>*</>bar"
	},
	{
		"desc": "Selser does not introduce newlines between unedited paragraph preceding the list",
		"wikitext": "{|\n|\nheader\n*foo\n*bar\nfooter\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>header</><list>*</><table-td>foo</><list>*</><table-td>barfooter</><table-bracket>|}</>"
	},
	{
		"desc": "Selser does not introduce newlines between unedited paragraph following the list",
		"wikitext": "{|\n|\nheader\n*foo\n*bar\nfooter\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>header</><list>*</><table-td>foo</><list>*</><table-td>barfooter</><table-bracket>|}</>"
	},
	{
		"desc": "Remove a list item but do not insert newline above list",
		"wikitext": "header\n*foo\n*bar\nfooter",
		"parsed": "header<list>*</>foo<list>*</>barfooter"
	},
	{
		"desc": "Spaced heading with element",
		"wikitext": "=== hi <span id=\"x\">hi</span> hi ho ===",
		"parsed": "<section-header section--3>===</><section> hi </><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><section>hi</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section> hi ho </><section-header>===</>"
	},
	{
		"desc": "Allow tabindex 0",
		"wikitext": "<div tabindex=\"0\">A</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>tabindex=</><htmltag-attribute-value>\"0\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Don't allow tabindex -1",
		"wikitext": "<div tabindex=\"-1\">A</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>tabindex=</><htmltag-attribute-value>\"-1\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Don't Allow tabindex > 0",
		"wikitext": "<div tabindex=\"3\">A</div>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>tabindex=</><htmltag-attribute-value>\"3\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "aside tag is not allowed directly in wikitext (T278565)",
		"wikitext": "<aside>This aside tag in wikitext should be escaped</aside>",
		"parsed": "<aside>This aside tag in wikitext should be escaped</aside>"
	},
	{
		"desc": "Stripped tag in list",
		"wikitext": ":<i>hi</i></b>",
		"parsed": "<list>:</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><error>&lt;/b&gt</>"
	},
	{
		"desc": "Misnested link nested in span",
		"wikitext": ": [http://google.com <span>[[Lala]]:</span>ok]-hi",
		"parsed": "<list>:</> <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-text> </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Lala</><link-ground link-bracket>]]</><link-ground extlink-text>:</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground extlink-text>ok</><link-ground extlink-bracket>]</>-hi"
	},
	{
		"desc": "Preserve the order invalid attributes",
		"wikitext": "<div width=\"95%\" style=\"border: 3px solid darkblue\">hi",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>width=</><htmltag-attribute-value>\"95%\"</><htmltag-attribute html-div> style=</><htmltag-attribute-value>\"border: 3px solid darkblue\"</><htmltag-bracket>&gt</>hi"
	},
	{
		"desc": "badCharacters"
	},
	{
		"desc": "External links: invalid character NUL (stripped)",
		"wikitext": "[http://www.example.com\u0000 test]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com\u0000</><link-ground extlink-text> test</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: invalid character backspace (preserved)",
		"wikitext": "[http://www.example.com\b test]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com\b</><link-ground extlink-text> test</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Magic link: invalid character NUL (stripped)",
		"wikitext": "http://www.example.com\u0000 test",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com\u0000</> test"
	},
	{
		"desc": "Magic link: invalid character backspace (preserved)",
		"wikitext": "http://www.example.com\b test",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com\b</> test"
	},
	{
		"desc": "External links: tab character",
		"wikitext": "[http://www.example.com Alice in\tWonderland]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text> Alice in\tWonderland</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Stray carriage return in text",
		"wikitext": "hiho",
		"parsed": "hiho"
	},
	{
		"desc": "bookReferencing"
	},
	{
		"desc": "Book Referencing attribute rejected by default",
		"wikitext": "<ref name=\"parent\">[foo]</ref>\n<ref extends=\"parent\">[bar]</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"parent\"</><exttag-bracket>&gt</><tag-ref>[foo]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"parent\"</><exttag-bracket>&gt</><tag-ref>[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Book Referencing attribute allowed with feature flag set",
		"wikitext": "<ref name=\"parent\">[foo]</ref>\n<ref extends=\"parent\">[bar]</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"parent\"</><exttag-bracket>&gt</><tag-ref>[foo]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"parent\"</><exttag-bracket>&gt</><tag-ref>[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T240424 - Subreference reused as normal ref before its full definition",
		"wikitext": "<ref name=\"b\" />\n<ref name=\"b\" extends=\"a\">page 2</ref>\n<ref name=\"a\">book</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T240424 - Extended reference reused before defined in the <references> section",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\" />\n<references>\n<ref name=\"b\" extends=\"a\">page 2</ref>\n<ref name=\"a\">book</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"b\"</><tag-references exttag-attribute ext-ref> extends=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>page 2</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>book</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is forbidden, even if the content is the same",
		"wikitext": "<ref name=p20>page 20</ref>\n<ref extends=book name=p20>page 20</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>p20</><exttag-bracket>&gt</><tag-ref>page 20</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>book</><exttag-attribute ext-ref> name=</><exttag-attribute-value>p20</><exttag-bracket>&gt</><tag-ref>page 20</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>book</><tag-references exttag-bracket>&gt</><tag-references tag-ref>book</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is forbidden, especially when the content conflicts",
		"wikitext": "<ref name=p20>page 20</ref>\n<ref extends=book name=p20>different content</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>p20</><exttag-bracket>&gt</><tag-ref>page 20</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>book</><exttag-attribute ext-ref> name=</><exttag-attribute-value>p20</><exttag-bracket>&gt</><tag-ref>different content</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>book</><tag-references exttag-bracket>&gt</><tag-references tag-ref>book</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T367749 - Turning a top-level ref into a subref is fine when the content is an empty string",
		"wikitext": "<ref name=p20></ref>\n<ref extends=book name=p20>page 20</ref>\n<references>\n<ref name=book>book</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>p20</><exttag-bracket>&gt&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>book</><exttag-attribute ext-ref> name=</><exttag-attribute-value>p20</><exttag-bracket>&gt</><tag-ref>page 20</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>book</><tag-references exttag-bracket>&gt</><tag-references tag-ref>book</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - Naming book references is fine",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"a\" name=\"c\">page 3</ref>\n<ref name=\"b\" />\n<ref name=\"c\" />\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>page 3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Extending a reference that doesn't exist #1",
		"wikitext": "<ref extends=\"a\">page 1</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - Extending a reference that doesn't exist #2",
		"wikitext": "<ref>book</ref>\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - Reference with the same name defined twice",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref name=\"a\">magazine</ref>\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>magazine</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - Can't reuse a name for two book references",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"a\" name=\"b\">page 3</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Can't extend a book reference (no nesting)",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref extends=\"b\">section 3</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>section 3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Can't extend a book reference (no nesting), specified in reverse order",
		"wikitext": "<ref extends=\"b\">section 3</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref name=\"a\">book</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>section 3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Named reference without text",
		"wikitext": "<ref name=\"a\" />\n<ref extends=\"a\">page 1</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - No text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Empty text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\"></ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - De-facto empty text for a book reference",
		"wikitext": "<ref name=\"foo\">book</ref>\n<ref extends=\"foo\"> </ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T236256 - Everything in the same group",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref group=\"g1\" extends=\"a\" name=\"b\">page</ref>\n<ref group=\"g1\" name=\"b\" />\n<references group=\"g1\"/>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g1\"</><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Base and book reference in different groups don't collide",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref group=\"g2\" extends=\"a\">page</ref>\n<references group=\"g1\"/>\n<references group=\"g2\"/>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g2\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g1\"</><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g2\"</><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Extending in the unnamed default group doesn't collide with refs from other groups",
		"wikitext": "<ref group=\"g1\" name=\"a\">book</ref>\n<ref extends=\"a\">page</ref>\n<references group=\"g1\"/>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g1\"</><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Extends in named group doesn't conflict with default group",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref group=\"g1\" extends=\"a\">page</ref>\n<references group=\"g1\"/>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g1\"</><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Extending a multi-part ref should be fine",
		"wikitext": "<ref name=\"a\">part 1</ref>\n<ref follow=\"a\">part 2</ref>\n<ref extends=\"a\">ok</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>part 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>part 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>ok</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Dont allow splitting a book reference for now",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref extends=\"a\" name=\"b\">page 2</ref>\n<ref follow=\"b\">and page 3 the same time?</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>and page 3 the same time?</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Can't be a follow up and a book reference the same time",
		"wikitext": "<ref name=\"a\">book 1</ref>\n<ref follow=\"a\" extends=\"a\">huh?</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>huh?</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T236256 - Can't be a follow up and a book reference the same time, even when referencing 2 different bases",
		"wikitext": "<ref name=\"a\">book 1</ref>\n<ref name=\"b\">book 2</ref>\n<ref follow=\"a\" extends=\"b\">huh?</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book 1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>book 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>huh?</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Extending a <ref> that doesn't appear in the text, but in <references>",
		"wikitext": "<ref extends=\"a\">Page 2</ref>\n<references>\n<ref name=\"a\">Book</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>Page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>Book</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T239810: Extending a <ref> that doesn't appear in the text, but in {{#tag:references}}",
		"wikitext": "<ref extends=\"a\">Page 2</ref>\n{{#tag:references|\n<ref name=\"a\">Book</ref>\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>Page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>Book</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Extends <ref> defined in <references> called with #tag",
		"wikitext": "<ref name=\"foo\">BAR</ref>\n<ref name=\"footwo\" />\n{{#tag:references|\n<ref name=\"footwo\" extends=\"foo\">p. 10</ref>\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>BAR</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"footwo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"footwo\"</><ext-ground exttag-attribute ext-ref> extends=</><ext-ground exttag-attribute-value>\"foo\"</><ext-ground exttag-bracket>&gt</><tag-ref>p. 10</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Extends parent <ref> defined in <references> called with #tag",
		"wikitext": "<ref>BAR</ref>\n<ref name=\"footwo\" extends=\"foo\">page 7</ref>\n<ref name=\"foo\" />\n{{#tag:references|\n<ref name=\"foo\">book name</ref>\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>BAR</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"footwo\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>page 7</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"foo\"</><ext-ground exttag-bracket>&gt</><tag-ref>book name</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Interleaved extends groups",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref name=\"c\">text-c</ref>\n\n<ref extends=\"a\">page b</ref>\n<ref extends=\"c\">page d</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text-a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>text-c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>page d</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple groups with extends",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n<references />\n\n<ref name=\"c\">text-c</ref>\n<ref extends=\"c\">page d</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text-a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>text-c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>page d</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple groups with extends, duplicated names across groups",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n<references />\n\n<ref name=\"a\">text-c</ref>\n<ref extends=\"a\">page d</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text-a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text-c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page d</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Intervening ref before extends",
		"wikitext": "<ref name=\"a\">book</ref>\n<ref>another</ref>\n<ref extends=\"a\">page 2</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>book</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>another</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Normal refs after extends",
		"wikitext": "<ref name=\"a\">text-a</ref>\n<ref extends=\"a\">page b</ref>\n\n<ref name=\"c\">text-c</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text-a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>page b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>text-c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T242110: Copy-pasted, named sub-references should be merged and not mess with the numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T242110: Reused sub-references should be merged and not mess with the numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\" />\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Reused sub-references can be rolled back without messing up numbering",
		"wikitext": "<ref name=\"a1\" extends=\"a\" />\n<ref group=\"g\" name=\"a1\" extends=\"a\" />\n{{#tag:references|\n<ref name=\"a\">a in group</ref>\n<ref name=\"a1\" extends=\"a\">a1 in group</ref>\n|group=g}}\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>a in group</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a1\"</><ext-ground exttag-attribute ext-ref> extends=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>a1 in group</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>group=</><ext-ground parserfunction>g</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T242110: Bad extends attributes on reused sub-references should report an error",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"unknown\" />\n<references>\n<ref name=\"a\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"unknown\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T242110: Copy-pasted, named sub-references should appear in proper order",
		"wikitext": "<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"a1\" extends=\"a\">a1</ref>\n<ref name=\"b1\" extends=\"b\">b1</ref>\n<ref name=\"b1\" extends=\"b\" />\n<ref name=\"c1\" extends=\"c\">c1</ref>\n<ref name=\"c1\" />\n<references>\n<ref name=\"a\">a</ref>\n<ref name=\"b\">a</ref>\n<ref name=\"c\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>a1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>b1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c1\"</><exttag-attribute ext-ref> extends=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>c1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c1\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"b\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"c\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "citeParserTests"
	},
	{
		"desc": "Simple <ref>, no <references/>",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>",
		"parsed": "Wikipedia rocks!<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Proceeds of Rockology, vol. XXI</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Simple <ref>, no <references/>, page ends in a list",
		"wikitext": "blah<ref>foo</ref> --Matma Rex 17:35, 31 March 2020 (UTC)\n* bleh --Matma Rex 17:35, 31 March 2020 (UTC)",
		"parsed": "blah<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> --Matma Rex 17:35, 31 March 2020 (UTC)<list>*</> bleh --Matma Rex 17:35, 31 March 2020 (UTC)"
	},
	{
		"desc": "Simple <ref>, with <references/>",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>\n\n<references />",
		"parsed": "Wikipedia rocks!<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Proceeds of Rockology, vol. XXI</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> with a simple template",
		"wikitext": "Templating<ref>{{simple template}}</ref>\n\n<references />",
		"parsed": "Templating<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>simple template</><tag-ref template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> with a <nowiki>",
		"wikitext": "Templating<ref><nowiki>{{simple template}}</nowiki></ref>\n\n<references />",
		"parsed": "Templating<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref exttag-bracket>&lt;</><tag-ref exttag-name>nowiki</><tag-ref exttag-bracket>&gt</><tag-ref tag-nowiki>{{simple template}}</><tag-ref exttag-bracket>&lt;/</><tag-ref exttag-name>nowiki</><tag-ref exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> in a <nowiki>",
		"wikitext": "Templating<nowiki><ref>{{simple template}}</ref></nowiki>\n\n<references />",
		"parsed": "Templating<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;ref&gt{{simple template}}&lt;/ref&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> in a <!--comment-->",
		"wikitext": "Templating<!--<ref>{{simple template}}</ref>-->\n\n<references />",
		"parsed": "Templating<comment>&lt;!--&lt;ref&gt{{simple template}}&lt;/ref&gt--&gt</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<!--comment--> in a <ref> (T7384)",
		"wikitext": "Templating<ref>Text<!--comment--></ref>\n\n<references />",
		"parsed": "Templating<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Text</><tag-ref comment>&lt;!--comment--&gt</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> in an ignored caption (T235656)",
		"wikitext": "[[File:Foobar.jpg|frameless|ignored caption with a ref<ref>boo</ref>]]\n\n<references />",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>ignored caption with a ref</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><tag-ref>boo</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> in expanded attributes of tags (legitimate or otherwise)",
		"wikitext": "{|\n|- <ref>boo</ref>\n|x\n|}\n<references />",
		"parsed": "<table-bracket>{|</><table-delimiter>|- </><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>boo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><table-delimiter>|</><table-td>x</><table-bracket>|}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<references> after <gallery> (bug 6164)",
		"wikitext": "<ref>one</ref>\n\n<gallery>Image:Foobar.jpg</gallery>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>one</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>Image:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "{{REVISIONID}} on page with <ref> (bug 6299)",
		"wikitext": "{{REVISIONID}}<ref>elite</ref>",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>elite</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "{{REVISIONID}} on page without <ref> (bug 6299 sanity check)",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Ref with content followed by blank ref",
		"wikitext": "<ref name=\"blank\">content</ref>\n\n<ref name=\"blank\" />\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>content</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Blank ref followed by ref with content",
		"wikitext": "<ref name=\"blank\" />\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>content</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Regression: non-blank ref \"0\" followed by ref with content",
		"wikitext": "<ref name=\"blank\">0</ref>\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>0</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>content</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Regression sanity check: non-blank ref \"1\" followed by ref with content",
		"wikitext": "<ref name=\"blank\">1</ref>\n\n<ref name=\"blank\">content</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blank\"</><exttag-bracket>&gt</><tag-ref>content</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref names containing a number",
		"wikitext": "<ref name=\"test123test\">One</ref>\n<ref name=\"123test\">Two</ref>\n<ref name=\"test123\">Three</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test123test\"</><exttag-bracket>&gt</><tag-ref>One</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"123test\"</><exttag-bracket>&gt</><tag-ref>Two</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test123\"</><exttag-bracket>&gt</><tag-ref>Three</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T184912: Consistent normalization of consecutive underscores",
		"wikitext": "<ref name=\"test_123\">example</ref>\n<ref name=\"test__123\">example</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test_123\"</><exttag-bracket>&gt</><tag-ref>example</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test__123\"</><exttag-bracket>&gt</><tag-ref>example</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Erroneous refs",
		"wikitext": "<ref name=\"0\">Zero</ref>\n\n<ref>Also zero, but differently! (Normal ref)</ref>\n\n<ref />\n\n<ref name=\"foo\" name=\"bar\" />\n\n<ref name=\"blankwithnoreference\" />\n\n<references name=\"quasit\" />\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"0\"</><exttag-bracket>&gt</><tag-ref>Zero</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Also zero, but differently! (Normal ref)</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"bar\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"blankwithnoreference\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>name=</><exttag-attribute-value>\"quasit\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Can't have name=\"…\" and follow=\"…\" the same time",
		"wikitext": "<ref name=\"theName\" follow=\"theFollows\">theValue</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"theFollows\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Conflicting name=\"…\" and follow=\"…\" together with another invalid parameter",
		"wikitext": "<ref name=\"theName\" follow=\"theFollows\" dummy=\"dummy\">theValue</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"theFollows\"</><exttag-attribute ext-ref> dummy=</><exttag-attribute-value>\"dummy\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "It's not possible to follow=\"…\" a <ref> defined in the <references> section",
		"wikitext": "<ref follow=\"theName\">theFollows</ref>\n<references>\n<ref name=\"theName\">theValue</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theFollows</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"theName\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>theValue</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "A follow=\"…\" before its parent is not merged",
		"wikitext": "<ref follow=\"theName\">''theFollows''</ref>\n<ref name=\"theName\">''theValue''</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref apostrophes>''</><tag-ref em>theFollows</><tag-ref apostrophes>''</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref apostrophes>''</><tag-ref em>theValue</><tag-ref apostrophes>''</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "\"follow\" after a named ref but before its parent",
		"wikitext": "<ref name=\"first\">First</ref>\n<ref follow=\"third\">Second</ref>\n<ref name=\"third\">Third</ref>\n<hr />\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"first\"</><exttag-bracket>&gt</><tag-ref>First</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"third\"</><exttag-bracket>&gt</><tag-ref>Second</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"third\"</><exttag-bracket>&gt</><tag-ref>Third</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><htmltag-bracket>&lt;</><htmltag-name>hr </><htmltag-bracket>/&gt</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "\"follow\" after an anonymous ref but before its parent",
		"wikitext": "<ref>First</ref>\n<ref follow=\"third\">Second</ref>\n<ref name=\"third\">Third</ref>\n<hr />\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>First</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"third\"</><exttag-bracket>&gt</><tag-ref>Second</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"third\"</><exttag-bracket>&gt</><tag-ref>Third</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><htmltag-bracket>&lt;</><htmltag-name>hr </><htmltag-bracket>/&gt</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Valid follow=\"…\" after it's parent",
		"wikitext": "<ref name=\"theName\">theValue</ref>\n<ref follow=\"theName\">theFollows</ref>\n<ref>Should be 2</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theFollows</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Should be 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Forward-referenced ref with follow",
		"wikitext": "<ref name=\"theName\" />\n<ref follow=\"theName\">theFollows</ref>\n<references>\n<ref name=\"theName\">theValue</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theFollows</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"theName\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>theValue</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Follow following a named ref with multiple definitions",
		"wikitext": "<ref name=\"test\">123</ref>\n<ref name=\"test\">234</ref>\n<ref follow=\"test\">345</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test\"</><exttag-bracket>&gt</><tag-ref>123</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test\"</><exttag-bracket>&gt</><tag-ref>234</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"test\"</><exttag-bracket>&gt</><tag-ref>345</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple follow after refs without content and trailing ref with content in references section",
		"wikitext": "ADD<ref name=\"theName\" />\nSUB<ref name=\"theName\"></ref>\nMUL<ref follow=\"theName\">theFollowValue</ref>\nMOD<ref follow=\"theName\">anotherFollowValue</ref>\n<references>\n<ref name=\"theName\"> theValue</ref>\n</references>",
		"parsed": "ADD<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>SUB<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>MUL<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theFollowValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>MOD<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>anotherFollowValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"theName\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref> theValue</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Report bad attributes in ref tags",
		"wikitext": "<ref name=\"theName\" group=\"theGroup\" dummy=\"dummy\">theValue</ref>\n<references group=\"theGroup\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"theGroup\"</><exttag-attribute ext-ref> dummy=</><exttag-attribute-value>\"dummy\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"theGroup\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Simple <ref>, with <references/> in group",
		"wikitext": "Wikipedia rocks!<ref>Proceeds of Rockology, vol. XXI</ref>\nWikipedia rocks!<ref group=\"note\">Proceeds of Rockology, vol. XXI</ref>\n\n<references />\n<references group=\"note\" />",
		"parsed": "Wikipedia rocks!<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Proceeds of Rockology, vol. XXI</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>Wikipedia rocks!<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"note\"</><exttag-bracket>&gt</><tag-ref>Proceeds of Rockology, vol. XXI</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"note\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Simple <ref>, with <references/> in group, with groupname in Chinese",
		"wikitext": "AAA<ref group=\"参\">ref a</ref>BBB<ref group=\"注\">note b</ref>CCC<ref group=\"参\">ref c</ref>\n\n;refs\n<references group=\"参\" />\n\n;notes\n<references group=\"注\" />",
		"parsed": "AAA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"参\"</><exttag-bracket>&gt</><tag-ref>ref a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>BBB<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"注\"</><exttag-bracket>&gt</><tag-ref>note b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>CCC<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"参\"</><exttag-bracket>&gt</><tag-ref>ref c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><list>;</><strong>refs</><exttag-bracket>&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"参\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</><list>;</><strong>notes</><exttag-bracket>&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"注\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Attributes are trimmed by the parser, see Sanitizer::decodeTagAttributes()",
		"wikitext": "<ref group=\"g\" name=\"n1\">in group g</ref>\n<ref group=\" g \" name=\" n2 \">in group \" g \"</ref>\n<references group=\"g\" />\n<references group=\" g \" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"n1\"</><exttag-bracket>&gt</><tag-ref>in group g</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\" g \"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\" n2 \"</><exttag-bracket>&gt</><tag-ref>in group \" g \"</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\" g \"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> defined in <references>",
		"wikitext": "<ref name=\"foo\" />\n\n<references>\n<ref name=\"foo\">BAR</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>BAR</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<ref> defined in <references> called with #tag",
		"wikitext": "<ref name=\"foo\" />\n\n{{#tag:references|\n<Ref name=\"foo\">BAR</ref>\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>Ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"foo\"</><ext-ground exttag-bracket>&gt</><tag-ref>BAR</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, outer tag function with LDR",
		"wikitext": "<ref name=\"foo\" />\n{{#tag:references|\n  <ref name=\"foo\">bar</ref>\n\n  <References />\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>  </><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"foo\"</><ext-ground exttag-bracket>&gt</><tag-ref>bar</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction>  </><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>References </><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, outer tag function, inner LDR",
		"wikitext": "<ref name=\"foo\" />\n{{#tag:references|\n  <references>\n    <ref name=\"foo\">bar</ref>\n  </references>\n}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>  </><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>references</><ext-ground exttag-bracket>&gt</><tag-references comment>    </><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>bar</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><tag-references comment>  </><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>references</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T242437 - Nested references edge case, inner tag function with LDR",
		"wikitext": "<ref name=\"foo\" />\n\n<references>\n  {{#tag:references|\n    <ref name=\"foo\">bar</ref>\n  }}\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references comment>  {{#tag:references|    </><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>bar</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><tag-references comment>  }}</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<ref> defined in <references> error conditions",
		"wikitext": "<ref name=\"foo\" group=\"2\" />\n\n<references group=\"2\">\n<ref name=\"foo\" />\n<ref name=\"unused\">BAR</ref>\n<ref name=\"foo\" group=\"1\">bad group</ref>\n<ref name=\"bar\" group=\"1\" />\n<ref>BAR BAR</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"2\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"2\"</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-attribute ext-ref> </><tag-references exttag-bracket>/&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"unused\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>BAR</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-attribute ext-ref> group=</><tag-references exttag-attribute-value>\"1\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>bad group</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"bar\"</><tag-references exttag-attribute ext-ref> group=</><tag-references exttag-attribute-value>\"1\"</><tag-references exttag-attribute ext-ref> </><tag-references exttag-bracket>/&gt&lt;</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><tag-references tag-ref>BAR BAR</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<ref> ungrouped and grouped refs with and without content defined",
		"wikitext": "ONE<ref name=\"foo\" />\n<references />\nTWO<ref group=\"NOTES\" name=\"foo\" />\nTHREE<ref group=\"NOTES\" name=\"bar\">CONTENT</ref>\n<references group=\"NOTES\" />",
		"parsed": "ONE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>TWO<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>THREE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"bar\"</><exttag-bracket>&gt</><tag-ref>CONTENT</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Error conditions on non-visible content",
		"wikitext": "<ref name=\"a\">x</ref>\n<ref name=\"b\"> </ref>\n<ref name=\"c\" />\n<references>\n<ref name=\"a\" />\n<ref name=\"b\" />\n<ref name=\"c\"> </ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>x</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-attribute ext-ref> </><tag-references exttag-bracket>/&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"b\"</><tag-references exttag-attribute ext-ref> </><tag-references exttag-bracket>/&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"c\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref> </><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<ref> with custom group link with number names in Klingon",
		"wikitext": "Wikipedia rocks!<ref group=\"klingon\">Proceeds of Rockology, vol. XXI</ref>\n\n<references group=\"klingon\" />",
		"parsed": "Wikipedia rocks!<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"klingon\"</><exttag-bracket>&gt</><tag-ref>Proceeds of Rockology, vol. XXI</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"klingon\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Consecutive whitespace in custom link label message should not create empty []",
		"wikitext": "<ref group=\"klingon\">1st</ref>\n<ref group=\"klingon\">2nd</ref>\n<references group=\"klingon\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"klingon\"</><exttag-bracket>&gt</><tag-ref>1st</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"klingon\"</><exttag-bracket>&gt</><tag-ref>2nd</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"klingon\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Bug 31374 regression check: nested strip items",
		"wikitext": "{{#tag:ref|note<ref>reference</ref>|group=Note}}\n<references group=\"Note\" />\n<references />",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ref</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>note</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><tag-ref>reference</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>group=</><ext-ground parserfunction>Note</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"Note\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Bug 13073 regression check: wrapped <references>",
		"wikitext": "<ref>\nfoo\n</ref>\n<div><references /></div>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "<ref> with no name and no content.",
		"wikitext": "Bla.<ref></ref>\nfoo.<ref />\nzero{{1x|<ref />}}\n<references />",
		"parsed": "Bla.<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>foo.<exttag-bracket>&lt;</><exttag-name>ref </><exttag-bracket>/&gt</>zero<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref </><template-ground exttag-bracket>/&gt</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> with an empty-string name parameter and no content.",
		"wikitext": "Bla.<ref name=\"\"> </ref>\n<references />",
		"parsed": "Bla.<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> with whitespace only name parameter and no content.",
		"wikitext": "Hi <ref name=\" \"> </ref>\nHo <ref name=\" \" />",
		"parsed": "Hi <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\" \"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>Ho <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\" \"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> with a non-empty name parameter and no content.",
		"wikitext": "Bla.<ref name=\"void\"> </ref>\n<references />",
		"parsed": "Bla.<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"void\"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Whitespace only doesn't set content for named ref",
		"wikitext": "Hi <ref name=\"ho\"> </ref>\nHi <ref name=\"ho\">Off to work we go!</ref>\n<references />",
		"parsed": "Hi <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"ho\"</><exttag-bracket>&gt</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>Hi <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"ho\"</><exttag-bracket>&gt</><tag-ref>Off to work we go!</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple definition (outside <references/>)",
		"wikitext": "<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>abc</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>def</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple definition (inside <references/>)",
		"wikitext": "<ref name=\"a\" />\n<references>\n<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>abc</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>def</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Multiple definition (mixed outside/inside)",
		"wikitext": "<ref name=\"a\">abc</ref>\n<references>\n<ref name=\"a\">def</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>abc</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>def</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T202593: Conflicting dir attributes",
		"wikitext": "<ref name=\"a\" dir=\"ltr\" />\n<ref name=\"a\" dir=\"rtl\">abc</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"ltr\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"rtl\"</><exttag-bracket>&gt</><tag-ref>abc</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T202593: Conflicting dir attributes with the full ref first",
		"wikitext": "<ref name=\"a\" dir=\"ltr\">abc</ref>\n<ref name=\"a\" dir=\"rtl\" />\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"ltr\"</><exttag-bracket>&gt</><tag-ref>abc</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"rtl\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T202593: Identical dir attributes are pointless, but should not generate an error",
		"wikitext": "<ref name=\"a\" dir=\"RTL\" />\n<ref name=\"a\" dir=\"rtl\">abc</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"RTL\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"rtl\"</><exttag-bracket>&gt</><tag-ref>abc</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple definition (inside {{#tag:references}})",
		"wikitext": "<ref name=\"a\" />\n{{#tag:references|\n<ref name=\"a\">abc</ref>\n<ref name=\"a\">def</ref>\n}}\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>abc</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>def</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T29694 - [] in reference names in HTML5 fragment mode",
		"wikitext": "<ref name=\"[#foo] {bar} <baz>\">[bar]</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"[#foo] {bar} &lt;baz</><exttag-bracket>&gt</><tag-ref>\"&gt[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T29694 - [] in reference names in HTML5 fragment mode (tidied)",
		"wikitext": "<ref name=\"[#foo] {bar} <baz&gt;\">[bar]</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"[#foo] {bar} &lt;baz&amp;gt;\"</><exttag-bracket>&gt</><tag-ref>[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 1. ref-location should be replaced with an index span",
		"wikitext": "A <ref>foo</ref>\nB <ref name=\"x\">foo</ref>\nC <ref name=\"y\" />\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>C <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"y\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 2. ref-tags with identical names should all get the same index",
		"wikitext": "A <ref name=\"x\">foo</ref>\nB <ref name=\"x\" />\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"x\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 3. spaces in ref-names should be ignored",
		"wikitext": "A <ref name=\"x\">foo</ref>\nB <ref name=\" x \" />\nC <ref name= x  />\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\" x \"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>C <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name= </><exttag-attribute-value>x</><exttag-attribute ext-ref>  </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 4. 'constructor' should be accepted as a valid ref-name",
		"wikitext": "A <ref name=\"constructor\">foo</ref>\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"constructor\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 5. body should accept generic wikitext",
		"wikitext": "A <ref>\n This is a '''[[bolded link]]''' and this is a {{1x|transclusion}}\n</ref>\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref skipformatting> </><tag-ref>This is a </><tag-ref apostrophes>'''</><tag-ref link-ground link-bracket>[[</><tag-ref link-ground link-pagename pagename strong>bolded link</><tag-ref link-ground link-bracket>]]</><tag-ref apostrophes>'''</><tag-ref> and this is a </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>transclusion</><tag-ref template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 6. indent-pres should not be output in ref-body",
		"wikitext": "A <ref>\n foo\n bar\n baz\n</ref>\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref skipformatting> </><tag-ref>foo</><tag-ref skipformatting> </><tag-ref>bar</><tag-ref skipformatting> </><tag-ref>baz</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 7. No p-wrapping in ref-body",
		"wikitext": "A <ref>\nfoo\n\nbar\n\n\nbaz\n\n\n\nbooz\n</ref>\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foobarbazbooz</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 8. transclusion wikitext has lower precedence",
		"wikitext": "A <ref> foo {{1x|</ref> B C}}\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref> foo </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> B C}}<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 9. unclosed comments should not leak out of ref-body",
		"wikitext": "A <ref> foo <!--</ref> B C\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref> foo </><tag-ref comment>&lt;!--</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> B C<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 10. Unclosed HTML tags should not leak out of ref-body",
		"wikitext": "A <ref> <b> foo </ref> B C\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref> </><tag-ref htmltag-bracket>&lt;</><tag-ref htmltag-name>b</><tag-ref htmltag-bracket>&gt</><tag-ref> foo </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> B C<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 11. ref-tags acts like an inline element wrt P-wrapping",
		"wikitext": "A <ref>foo</ref> B\nC <ref>bar</ref> D\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> BC <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> D<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 12. ref-tags act as trailing newline migration barrier",
		"wikitext": "<!--the newline at the end of this line moves out of the p tag-->a\n\nb<!--the newline at the end of this line stays inside the p tag--> <ref>foo</ref>\n<ref>bar</ref>\n\nc\n<references />",
		"parsed": "<comment>&lt;!--the newline at the end of this line moves out of the p tag--&gt</>ab<comment>&lt;!--the newline at the end of this line stays inside the p tag--&gt</> <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>c<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 13. ref-tags are not SOL-transparent and block indent-pres",
		"wikitext": "<ref>foo</ref> A\n<ref>bar\n</ref> B\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> A<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> B<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 14. A nested ref-tag should be emitted as plain text",
		"wikitext": "<ref>foo <ref>bar</ref> baz</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo &lt;ref&gtbar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> baz<error>&lt;/ref&gt</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 15. ref-tags with identical names should get identical indexes",
		"wikitext": "A1 <ref name=\"a\">foo</ref> A2 <ref name=\"a\" />\nB1 <ref name=\"b\" /> B2 <ref name=\"b\">bar</ref>\n\n<references />",
		"parsed": "A1 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> A2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>B1 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</> B2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 16. Tokenizer should accept non-standard whitespace in <ref> and </ref> tags",
		"wikitext": "A <ref >foo</ref >\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref </><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 17. Generate valid HTML5 id/about attributes",
		"wikitext": "<ref name=\"a b\">foo</ref>\n<ref name=\":0\">ve-created name</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a b\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\":0\"</><exttag-bracket>&gt</><tag-ref>ve-created name</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 18. T58916: Extension attributes should be parsed as plain text",
		"wikitext": "<ref name=\"{{1x|a}}\">foo</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"{{1x|a}}\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 19. ref-tags with identical name encodings should get identical indexes",
		"wikitext": "1 <ref name=\"a & b\">foo</ref> 2 <ref name=\"a &amp; b\" />\n\n<references />",
		"parsed": "1 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a &amp; b\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> 2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a &amp;amp; b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref: 20. ref-tags with identical names but different content should keep it",
		"wikitext": "A <ref name=\"foo\">Foo one</ref>\nB <ref name=\"foo\">Foo two</ref>\nC <ref name=\"foo\" />\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>Foo one</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>Foo two</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>C <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Verify invalid use of a numeric character in a ref name",
		"wikitext": "PRE <ref>preValue</ref>\nTHEVALUE <ref name=\"1\">theValue</ref>\nPOST <ref>postValue</ref>\n<references />",
		"parsed": "PRE <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>preValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>THEVALUE <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"1\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>POST <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>postValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Verify invalid use of a numeric character in a ref name and follow",
		"wikitext": "<ref name=\"1\">theValue</ref>\n<ref follow=\"1\">theFollow</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"1\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>follow=</><exttag-attribute-value>\"1\"</><exttag-bracket>&gt</><tag-ref>theFollow</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 1a. references tag without any refs should be handled properly",
		"wikitext": "<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 1b. references tag without any refs should be handled properly",
		"wikitext": "<references></references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>references</><exttag-bracket>&gt&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "References: 2. references tag with group only outputs references from that group",
		"wikitext": "A <ref group=\"a\">foo</ref>\nB <ref group=\"b\">bar</ref>\nC <ref>baz</ref>\n\n<references group=\"a\" />\n<references />\n<references group=\"b\" />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>C <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>baz</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 3. ref list should be cleared after processing references",
		"wikitext": "A <ref>foo</ref>\n\n<references />\n\nB <ref>bar</ref>\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>B <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Counters should be cleared after processing named <references group=\"…\">",
		"wikitext": "A <ref group=\"g\">foo</ref>\n\n<references group=\"g\" />\n\nB <ref group=\"g\">bar</ref>\n\n<references group=\"g\" />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g\"</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"g\"</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 4. only referenced group should be cleared after processing references",
		"wikitext": "A <ref group=\"a\">afoo</ref>\nB <ref>bfoo</ref>\n\n<references group=\"a\" />\n\nC <ref>cfoo</ref>\n\n<references />",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>afoo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bfoo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>C <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>cfoo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 5. ref tags in references should be processed while ignoring all other content",
		"wikitext": "A <ref name=\"a\" />\nB <ref name=\"b\">bar</ref>\n\n<references>\n<ref name=\"a\">foo</ref>\nThis should just get lost.\n</references>",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>foo</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><tag-references comment>This should just get lost.</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "References: 6. <references /> from a transclusion",
		"wikitext": "<ref>Foo</ref> {{1x|<references />}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>references </><template-ground exttag-bracket>/&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "References: 7. Multiple references tags (one without and one with nested refs) should be correctly handled",
		"wikitext": "A <ref>foo bar for a</ref>\nB <ref group=\"X\" name=\"b\" />\n\n<references />\n\n<references group=\"X\">\n<ref name=\"b\">foo</ref>\n</references>",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo bar for a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"X\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"X\"</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"b\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>foo</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "References: 7b. Multiple references tags some with errors should be correctly handled",
		"wikitext": "ALPHA<ref name=\"foo\" />\nBETA<ref name=\"foo\" />\nONE<ref group=\"NOTES\" name=\"foo\" />\nTWO<ref group=\"NOTES\" name=\"foo\">food</ref>\n<references group=\"NOTES\" />\n<references />\nTHREE<ref group=\"NOTES\" name=\"bar\">CONTENT</ref>\nFOUR<ref group=\"NOTES\" name=\"foo\" />\nFIVE<ref group=\"NOTES\" name=\"foo\" />\nSIX<ref name=\"foo\" />\n<references group=\"NOTES\" />\n<references>\n<ref name=\"foo\">NOGROUPCONTENT</ref>\n</references>\nSEVEN<ref group=\"NOTES\" name=\"bar\" />\nEIGHT<ref group=\"NOTES\" name=\"foo\" />\n<references group=\"NOTES\" />\nNINE<ref group=\"NOTES\" name=\"bar\">NINECONTENT</ref>\nTEN<ref group=\"NOTES\" name=\"foo\">TENCONTENT</ref>\n<references group=\"NOTES\" />",
		"parsed": "ALPHA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>BETA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>ONE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>TWO<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>food</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>THREE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"bar\"</><exttag-bracket>&gt</><tag-ref>CONTENT</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>FOUR<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>FIVE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>SIX<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>NOGROUPCONTENT</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>SEVEN<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"bar\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>EIGHT<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>NINE<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"bar\"</><exttag-bracket>&gt</><tag-ref>NINECONTENT</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>TEN<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"foo\"</><exttag-bracket>&gt</><tag-ref>TENCONTENT</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"NOTES\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 8. T88019: Remove <meta>s from templates inside <ref> that's itself inside a template",
		"wikitext": "X{{1x|<ref>foo {{1x|<b>bar</b>}} and {{1x|baz}} boo</ref>}}\n<references />",
		"parsed": "X<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><tag-ref>foo </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground htmltag-bracket>&lt;</><tag-ref template-ground htmltag-name>b</><tag-ref template-ground htmltag-bracket>&gt</><tag-ref template-ground template>bar</><tag-ref template-ground htmltag-bracket>&lt;/</><tag-ref template-ground htmltag-name>b</><tag-ref template-ground htmltag-bracket>&gt</><tag-ref template-ground template-bracket>}}</><tag-ref> and </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>baz</><tag-ref template-ground template-bracket>}}</><tag-ref> boo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "References: 9. Generate missing references list at the end",
		"wikitext": "A <ref>foo</ref>\nB <ref group=\"inexistent\">bar</ref>",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"inexistent\"</><exttag-bracket>&gt</><tag-ref>bar</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "References: 10.1. New <references/> shouldn't be added for unrelated edits.",
		"wikitext": "Unrelated text<span id=\"x\"> that's going to disappear</span>.\nA <ref>foo</ref>",
		"parsed": "Unrelated text<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</> that's going to disappear<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>.A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "References: 10.2. New <references/> shouldn't be added for unrelated edits.",
		"wikitext": "Unrelated text<span id=\"x\"> that's going to disappear</span>.\nA <ref>foo</ref>",
		"parsed": "Unrelated text<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</> that's going to disappear<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>.A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Grouped references with follow rendered in mixed order",
		"wikitext": "AA<ref group=\"a\" name=\"name_a\">group_a_name_a</ref>\nBA<ref group=\"b\" name=\"name_a\">group_b_name_a</ref>\nCA<ref group=\"c\" name=\"name_a\">group_c_name_a</ref>\nBB<ref group=\"b\" name=\"name_b\">group_b_name_b</ref>\nFBA<ref group=\"b\" follow=\"name_a\">group_b_follow_a</ref>\nFAA<ref group=\"a\" follow=\"name_a\">group_a_follow_a</ref>\nFBB<ref group=\"b\" follow=\"name_b\">group_b_follow_b</ref>\nFCA<ref group=\"c\" follow=\"name_a\">group_c_follow_a</ref>\n<references group=\"b\" />\n<references group=\"c\" />\n<references group=\"a\" />",
		"parsed": "AA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_a_name_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>BA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_b_name_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>CA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"c\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_c_name_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>BB<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"name_b\"</><exttag-bracket>&gt</><tag-ref>group_b_name_b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>FBA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_b_follow_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>FAA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_a_follow_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>FBB<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"name_b\"</><exttag-bracket>&gt</><tag-ref>group_b_follow_b</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>FCA<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"c\"</><exttag-attribute ext-ref> follow=</><exttag-attribute-value>\"name_a\"</><exttag-bracket>&gt</><tag-ref>group_c_follow_a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"c\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Grouped references with automatic group references generating errors",
		"wikitext": "GROUP <ref group=\"theGroup\" name=\"theName\">theValue</ref>\nGROUP3 <ref group=\"theGroup3\" name=\"theName3\">theValue3</ref>\nGROUP2 <ref group=\"theGroup2\" name=\"theName2\">theValue2</ref>\naDifferentNameGROUP3 <ref group=\"theGroup3\" name=\"theName\">anotherValue3differentName</ref>\naDifferentNameGROUP2 <ref group=\"theGroup2\" name=\"anotherName2\">anotherValue2DifferentName</ref>\nanotherGROUP3 <ref group=\"theGroup3\" name=\"theName3\">anotherValue3</ref>\naDifferentNameGROUP <ref group=\"theGroup\" name=\"anotherName2\">anotherValueDifferentName</ref>\n<references group=\"theGroup3\" />",
		"parsed": "GROUP <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>GROUP3 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup3\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"theName3\"</><exttag-bracket>&gt</><tag-ref>theValue3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>GROUP2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup2\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"theName2\"</><exttag-bracket>&gt</><tag-ref>theValue2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>aDifferentNameGROUP3 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup3\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>anotherValue3differentName</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>aDifferentNameGROUP2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup2\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"anotherName2\"</><exttag-bracket>&gt</><tag-ref>anotherValue2DifferentName</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>anotherGROUP3 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup3\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"theName3\"</><exttag-bracket>&gt</><tag-ref>anotherValue3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>aDifferentNameGROUP <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"anotherName2\"</><exttag-bracket>&gt</><tag-ref>anotherValueDifferentName</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"theGroup3\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Entities in ref name",
		"wikitext": "<ref name=\"test &amp; me {{1x|foo}}\">hi</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"test &amp;amp; me {{1x|foo}}\"</><exttag-bracket>&gt</><tag-ref>hi</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Generate references for unclosed references tag",
		"wikitext": "a<ref>foo</ref>\n\n<references>",
		"parsed": "a<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "New reference serializes on its own line",
		"wikitext": "foo\n<references />",
		"parsed": "foo<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref in ref: nested in top level ref",
		"wikitext": "test <ref>hi {{refinref|ho}}</ref>\n<references />",
		"parsed": "test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>hi </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>refinref</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>ho</><tag-ref template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref in ref: top level ref nested in transclusion",
		"wikitext": "test {{refinref|456<ref>123</ref>}}\n<references />",
		"parsed": "test <template-ground template-bracket>{{</><template-ground template-name pagename>refinref</><template-ground template-delimiter>|</><template-ground template>456</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><tag-ref>123</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref in ref: top level ref nested in parser function",
		"wikitext": "test {{#tag:ref|456<ref>123</ref>}}\n<references />",
		"parsed": "test <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ref</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>456</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><tag-ref>123</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref in ref: Multiple levels of nesting in parser function",
		"wikitext": "one{{#tag:ref|two{{#tag:ref|three<ref>four</ref>}}}}",
		"parsed": "one<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ref</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>two</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#tag</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction>ref</><ext2-ground parserfunction-delimiter>|</><ext2-ground parserfunction>three</><ext2-ground exttag-bracket>&lt;</><ext2-ground exttag-name>ref</><ext2-ground exttag-bracket>&gt</><tag-ref>four</><ext2-ground exttag-bracket>&lt;/</><ext2-ground exttag-name>ref</><ext2-ground exttag-bracket>&gt</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Ref in ref: self-referential",
		"wikitext": "{{#tag:ref|<ref name=\"x\" />|name=x}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ref</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"x\"</><ext-ground exttag-attribute ext-ref> </><ext-ground exttag-bracket>/&gt</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>name=</><ext-ground parserfunction>x</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Nested ref with forward slash",
		"wikitext": "test {{nestedrefslash}}\n<references />",
		"parsed": "test <template-ground template-bracket>{{</><template-ground template-name pagename>nestedrefslash</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, autogenerated",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Responsive references: enabled, autogenerated",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Responsive references: enabled, autogenerated, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Responsive references: disabled",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, explicit",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"\" />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>responsive=</><exttag-attribute-value>\"\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: disabled, explicit, exceed",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"\" />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>responsive=</><exttag-attribute-value>\"\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: enabled, explicit off",
		"wikitext": "Test <ref>1</ref><ref>2</ref>\n<references responsive=\"0\" />",
		"parsed": "Test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>responsive=</><exttag-attribute-value>\"0\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Responsive references: roundtrip templates",
		"wikitext": "test <ref>123</ref>\n\n{{1x|haha<references/>}}",
		"parsed": "test <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>123</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>haha</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>references</><template-ground exttag-bracket>/&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "CircularRef",
		"wikitext": "<ref>Hi {{CircularRef}}</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>Hi </><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>CircularRef</><tag-ref template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"rtl\"",
		"wikitext": "<ref dir=\"rtl\">TEST</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"rtl\"</><exttag-bracket>&gt</><tag-ref>TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"ltr\"",
		"wikitext": "<ref dir=\"ltr\">TEST</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"ltr\"</><exttag-bracket>&gt</><tag-ref>TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"LTR\", keeps upper case",
		"wikitext": "<ref dir=\"LTR\">TEST</ref>\n\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"LTR\"</><exttag-bracket>&gt</><tag-ref>TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T15673: <ref> with direction \"nonsense\" and \"\" (empty), strip invalid dir attribute and shows error",
		"wikitext": "<ref dir=\"nonsense\">NONSENSE_DIR_TEST</ref>\n<ref dir=\"\">EMPTY_DIR_TEST</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"nonsense\"</><exttag-bracket>&gt</><tag-ref>NONSENSE_DIR_TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt</><tag-ref>EMPTY_DIR_TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T15673: Direction is supported when specifying name and group",
		"wikitext": "<ref dir=\"ltr\" name=\"a\" group=\"note\">TEST</ref>\n\n<references group=\"note\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>dir=</><exttag-attribute-value>\"ltr\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"note\"</><exttag-bracket>&gt</><tag-ref>TEST</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"note\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Ref with block content in formatting tag",
		"wikitext": "''hi<ref><div>ho</div></ref>''\n<references />",
		"parsed": "<apostrophes>''</><em>hi</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref htmltag-bracket>&lt;</><tag-ref htmltag-name>div</><tag-ref htmltag-bracket>&gt</><tag-ref>ho</><tag-ref htmltag-bracket>&lt;/</><tag-ref htmltag-name>div</><tag-ref htmltag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T196827: Use the dir parameter only from the full definition of a named ref tag",
		"wikitext": "abc<ref name=\"r1\" />def\n\nghi<ref name=\"r1\" dir=\"rtl\">jkl</ref>mno\n\n<references />",
		"parsed": "abc<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"r1\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>defghi<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"r1\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"rtl\"</><exttag-bracket>&gt</><tag-ref>jkl</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>mno<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T196827: Ignore the dir parameter from the first use, which is not a full definition, and use the dir value from the full definition of a named ref tag",
		"wikitext": "abc<ref name=\"r1\" dir=\"rtl\" />def\n\nghi<ref name=\"r1\">jkl</ref>mno\n\n<references />",
		"parsed": "abc<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"r1\"</><exttag-attribute ext-ref> dir=</><exttag-attribute-value>\"rtl\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>defghi<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"r1\"</><exttag-bracket>&gt</><tag-ref>jkl</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>mno<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Similarly named refs with identical bodies",
		"wikitext": "1 <ref name=\"one\">1</ref> 2 <ref name=\"one\">1</ref>\n\n<references />",
		"parsed": "1 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"one\"</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> 2 <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"one\"</><exttag-bracket>&gt</><tag-ref>1</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T220196 - Reference names with high-bit characters, html5 mode",
		"wikitext": "<ref name=\"füllen\">[bar]</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"füllen\"</><exttag-bracket>&gt</><tag-ref>[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T220196 - Reference names with high-bit characters, legacy mode",
		"wikitext": "<ref name=\"füllen\">[bar]</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"füllen\"</><exttag-bracket>&gt</><tag-ref>[bar]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Transclusion parameter spacing is lost without data-parsoid",
		"wikitext": "<ref>{{1x|\nHi ho\n}}</ref>\n\n<!-- Traverse with an encapsulation where the root isn't a native extension -->\n{{1x|<div><references /></div>}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>Hi ho</><tag-ref template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><comment>&lt;!-- Traverse with an encapsulation where the root isn't a native extension --&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>references </><template-ground exttag-bracket>/&gt</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T269531: Generic error message when a list-defined reference is not used in the text",
		"wikitext": "<references>\n<ref name=\"foo\">foo</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"foo\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>foo</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T269531: Special case when a named group is entirely unused in the text",
		"wikitext": "<references group=\"g\">\n<ref name=\"a\" group=\"g\">a</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g\"</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-attribute ext-ref> group=</><tag-references exttag-attribute-value>\"g\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>a</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T242437 - Blank ref name in #tag regression",
		"wikitext": "{{#tag:references|\n<ref name=\"\">foo</ref>\n}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"\"</><ext-ground exttag-bracket>&gt</><tag-ref>foo</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T48140 - Make sure rollback/redo does not consume numbers",
		"wikitext": "<ref>should be [1]</ref>\n<ref name=\"a\" group=\"g\" />\n{{#tag:references|\n<ref name=\"a\">a</ref>\n|group=g}}\n<ref>should be [2]</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>should be [1]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>a</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>group=</><ext-ground parserfunction>g</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>should be [2]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Numbers in the default group need to start with 1, independent from other groups",
		"wikitext": "<ref name=\"a\" group=\"g\" />\n{{#tag:references|\n<ref name=\"a\">a</ref>\n|group=g}}\n<ref name=\"c\">c</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"g\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>references</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>ref </><ext-ground exttag-attribute ext-ref>name=</><ext-ground exttag-attribute-value>\"a\"</><ext-ground exttag-bracket>&gt</><tag-ref>a</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>ref</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>group=</><ext-ground parserfunction>g</><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"c\"</><exttag-bracket>&gt</><tag-ref>c</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Serialize reference tags by themselves on a line",
		"wikitext": "hi <ref>ho</ref>\n<references />\nhi ho",
		"parsed": "hi <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>ho</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>hi ho"
	},
	{
		"desc": "T93580: 1. Templated <ref> inside block images",
		"wikitext": "[[File:Foobar.jpg|thumb|Caption with templated ref: {{1x|<ref>foo</ref>}}]]\n\n<references />",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Caption with templated ref: </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground exttag-bracket>&lt;</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><tag-ref>foo</><template-link-ground exttag-bracket>&lt;/</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T93580: 2. <ref> inside inline images",
		"wikitext": "[[File:Foobar.jpg|Undisplayed caption in inline image with ref: <ref>foo</ref>]]\n\n<references />",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>Undisplayed caption in inline image with ref: </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><tag-ref>foo</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T93580: 3. Templated <ref> inside inline images",
		"wikitext": "[[File:Foobar.jpg|Undisplayed caption in inline image with ref: {{1x|<ref>{{1x|foo}}</ref>}}]]\n\n<references />",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>Undisplayed caption in inline image with ref: </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground exttag-bracket>&lt;</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>foo</><tag-ref template-ground template-bracket>}}</><template-link-ground exttag-bracket>&lt;/</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Report bad attributes in reference tags",
		"wikitext": "<ref>noGroupOrNameValue</ref>\n<references badattrib=\"invalidAttribute\" />\n<ref name=\"theName\">theNameValue</ref>\n<references name=\"theName\" badattrib=\"invalidNameAttribute\" />\n<ref group=\"theGroup\">theGroupValue</ref>\n<references group=\"theGroup\" badattrib=\"invalidGroupAttribute\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>noGroupOrNameValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>badattrib=</><exttag-attribute-value>\"invalidAttribute\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"theName\"</><exttag-bracket>&gt</><tag-ref>theNameValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>name=</><exttag-attribute-value>\"theName\"</><exttag-attribute ext-references> badattrib=</><exttag-attribute-value>\"invalidNameAttribute\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"theGroup\"</><exttag-bracket>&gt</><tag-ref>theGroupValue</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"theGroup\"</><exttag-attribute ext-references> badattrib=</><exttag-attribute-value>\"invalidGroupAttribute\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Check Cite handing of different types of whitespace in reference names",
		"wikitext": "test space<ref name=\"a b\">testSpaceRef</ref>\nblah space<ref name=\"a b\" />\n\ntest underbar<ref name=\"a_b\">testUnderbarRef</ref>\nblah underbar<ref name=\"a_b\" />\n\ntest unicode u2028 whitespace<ref name=\"ab\">testUnicodeWhitespaceRef</ref>\nblah unicode u2028 whitespace<ref name=\"ab\" />\n<references />",
		"parsed": "test space<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a b\"</><exttag-bracket>&gt</><tag-ref>testSpaceRef</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>blah space<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>test underbar<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a_b\"</><exttag-bracket>&gt</><tag-ref>testUnderbarRef</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>blah underbar<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a_b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt</>test unicode u2028 whitespace<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"ab\"</><exttag-bracket>&gt</><tag-ref>testUnicodeWhitespaceRef</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>blah unicode u2028 whitespace<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"ab\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Check Cite handing of linefeed whitespace in reference names",
		"wikitext": "test linefeed<ref name=\"a\nb\">testLinefeedRef</ref>\n<references />",
		"parsed": "test linefeed<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"ab\"</><exttag-bracket>&gt</><tag-ref>testLinefeedRef</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "<ref> in a link should hoist the link outside the link (T301293)",
		"wikitext": "[[Foo|''x<ref>y</ref>z'']]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground apostrophes>''</><link-ground link-text em>x</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><tag-ref>y</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><link-ground link-text em>z</><link-ground apostrophes>''</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Hoisting a reference should not break template continuity",
		"wikitext": "{{1x|hello [[Foo|''x<ref>y</ref>z'']] world}}\n<references />",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hello </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template-link-ground apostrophes>''</><template-link-ground link-text em>x</><template-link-ground exttag-bracket>&lt;</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><tag-ref>y</><template-link-ground exttag-bracket>&lt;/</><template-link-ground exttag-name>ref</><template-link-ground exttag-bracket>&gt</><template-link-ground link-text em>z</><template-link-ground apostrophes>''</><template-link-ground link-bracket>]]</><template-ground template> world</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Hoisting multiple references should keep references in order",
		"wikitext": "[[Foo|hello <ref>note 1</ref><ref>note 2</ref>]]<ref>note 3</ref>\n<references />",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>hello </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><tag-ref>note 1</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt&lt;</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><tag-ref>note 2</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>ref</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>note 3</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Red links in templated references",
		"wikitext": "<ref>[[Not_existing_article]]</ref>\n\n{{1x|<references />}}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref link-ground link-bracket>[[</><tag-ref link-ground link-pagename pagename>Not_existing_article</><tag-ref link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>references </><template-ground exttag-bracket>/&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Broken wikitext making a ref as extended attribute and a duplicated fragment",
		"wikitext": "<i <ref>y</ref>>\n\nz\n<references />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>i </><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>y</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><htmltag-bracket>&gt</>z<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Broken wikitext making a ref as extended attribute and a duplicated fragment (with 2wt tests)",
		"wikitext": "<i title=\"<ref>y</ref>\">a\n\nz\n<references />",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>i </><htmltag-attribute html-i>title=</><htmltag-attribute-value>\"</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>y</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><htmltag-attribute-value>\"</><htmltag-bracket>&gt</>az<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Templates: Wiki Tables: 7. Fosterable <ref>s should get fostered",
		"wikitext": "{{PartialTable}}<ref>foo</ref>\n|}\n\n<references />",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>PartialTable</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>|}<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Template nested in extension tag in template",
		"wikitext": "{{1x|hi<ref>[[ho|{{1x|hi}}]]</ref>}}\n{{1x|hi<ref>[http://test.com?q={{1x|ho}}]</ref>}}\n{{1x|hi<ref>-{ho|{{1x|hi}}}-</ref>}}\n<references />",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><tag-ref link-ground link-bracket>[[</><tag-ref link-ground link-pagename pagename>ho</><tag-ref link-ground link-delimiter>|</><tag-ref template-link-ground template-bracket>{{</><tag-ref template-link-ground template-name pagename>1x</><tag-ref template-link-ground template-delimiter>|</><tag-ref template-link-ground template>hi</><tag-ref template-link-ground template-bracket>}}</><tag-ref link-ground link-bracket>]]</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><tag-ref link-ground extlink-bracket>[</><tag-ref link-ground extlink-protocol>http://</><tag-ref link-ground extlink>test.com?q=</><tag-ref template-link-ground template-bracket>{{</><tag-ref template-link-ground template-name pagename>1x</><tag-ref template-link-ground template-delimiter>|</><tag-ref template-link-ground template>ho</><tag-ref template-link-ground template-bracket>}}</><tag-ref link-ground extlink-bracket>]</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><tag-ref convert-bracket>-{</><tag-ref convert-flag>ho</><tag-ref convert-delimiter>|</><tag-ref template-ground template-bracket>{{</><tag-ref template-ground template-name pagename>1x</><tag-ref template-ground template-delimiter>|</><tag-ref template-ground template>hi</><tag-ref template-ground template-bracket>}}</><tag-ref convert-bracket>}-</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>ref</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Headings: Category in ref isn't hoisted",
		"wikitext": "== foo <ref>bar \n[[Category:Baz]] </ref> ==\n\n<references />",
		"parsed": "== foo <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>bar </><tag-ref link-ground link-bracket>[[</><tag-ref link-ground link-pagename pagename>Category:Baz</><tag-ref link-ground link-bracket>]]</><tag-ref> </><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</> ==<exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Testing serialization after deletion in references",
		"wikitext": "hi <ref><div id=\"x\">ho</div></ref>\n\n<references />",
		"parsed": "hi <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref htmltag-bracket>&lt;</><tag-ref htmltag-name>div </><tag-ref htmltag-attribute html-div>id=</><tag-ref htmltag-attribute-value>\"x\"</><tag-ref htmltag-bracket>&gt</><tag-ref>ho</><tag-ref htmltag-bracket>&lt;/</><tag-ref htmltag-name>div</><tag-ref htmltag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Catch regression when unpacking with trailing content",
		"wikitext": "{{1x|Foo <references/> bar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>Foo </><template-ground exttag-bracket>&lt;</><template-ground exttag-name>references</><template-ground exttag-bracket>/&gt</><template-ground template> bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "1. DOMDiff: Changes to <ref> content should be looked up using id",
		"wikitext": "X <ref><span id=\"X\">foo</span></ref>\nY <ref name=\"a\" />\n<references>\n<ref name=\"a\"><span id=\"Y\">foo</span></ref>\n</references>",
		"parsed": "X <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref htmltag-bracket>&lt;</><tag-ref htmltag-name>span </><tag-ref htmltag-attribute html-span>id=</><tag-ref htmltag-attribute-value>\"X\"</><tag-ref htmltag-bracket>&gt</><tag-ref>foo</><tag-ref htmltag-bracket>&lt;/</><tag-ref htmltag-name>span</><tag-ref htmltag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>Y <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref htmltag-bracket>&lt;</><tag-references tag-ref htmltag-name>span </><tag-references tag-ref htmltag-attribute html-span>id=</><tag-references tag-ref htmltag-attribute-value>\"Y\"</><tag-references tag-ref htmltag-bracket>&gt</><tag-references tag-ref>foo</><tag-references tag-ref htmltag-bracket>&lt;/</><tag-references tag-ref htmltag-name>span</><tag-references tag-ref htmltag-bracket>&gt</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "2. DOMDiff: Changes to <ref> content should be looked up using id",
		"wikitext": "A <ref>foo bar for a</ref>\nB <ref group=\"X\" name=\"b\" />\n\n<references />\n\n<references group=\"X\">\n<ref name=\"b\"><span id=\"Z\">foo</span></ref>\n</references>",
		"parsed": "A <exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>foo bar for a</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>B <exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>group=</><exttag-attribute-value>\"X\"</><exttag-attribute ext-ref> name=</><exttag-attribute-value>\"b\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"X\"</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"b\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref htmltag-bracket>&lt;</><tag-references tag-ref htmltag-name>span </><tag-references tag-ref htmltag-attribute html-span>id=</><tag-references tag-ref htmltag-attribute-value>\"Z\"</><tag-references tag-ref htmltag-bracket>&gt</><tag-references tag-ref>foo</><tag-references tag-ref htmltag-bracket>&lt;/</><tag-references tag-ref htmltag-name>span</><tag-references tag-ref htmltag-bracket>&gt</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "T107652: <ref>s in templates that also generate table cell attributes should be rendered properly",
		"wikitext": "{|\n|{{table_attribs_7}}\n|}\n<references />",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_7</><template-ground template-bracket>}}</><table-bracket>|}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Handle extension content in section headers properly",
		"wikitext": "==c<ref>d</ref>==",
		"parsed": "<section-header section--2>==</><section>c</><exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>d</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "citeSmokeTests"
	},
	{
		"desc": "Smoke test for duplicated references with the same text",
		"wikitext": "<ref name=\"a\">text</ref>\n<ref name=\"a\">text</ref>\n<ref name=\"b\">other</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>other</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Smoke test for duplicated references with conflicting text",
		"wikitext": "<ref name=\"a\">text</ref>\n<ref name=\"a\">bad</ref>\n<ref name=\"b\">other</ref>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>text</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-bracket>&gt</><tag-ref>bad</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>other</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Smoke test for references that are reused *before* defined in <references>",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"a\" />\n<ref name=\"b\">other</ref>\n<references>\n<ref name=\"a\">text</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>other</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>text</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "It should be impossible to roll back a follow=\"…\", because it can't have a name",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\">should be 2</ref>\n<references>\n<ref name=\"a\">should be 1</ref>\n<ref name=\"c\" follow=\"other page\">is invalid</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>should be 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>should be 1</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"c\"</><tag-references exttag-attribute ext-ref> follow=</><tag-references exttag-attribute-value>\"other page\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>is invalid</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "It should be impossible to roll back a follow=\"…\", because it must have a name",
		"wikitext": "<ref name=\"a\" />\n<ref name=\"b\">should be 2</ref>\n<references>\n<ref name=\"a\">should be 1</ref>\n<ref follow=\"other page\">is invalid</ref>\n</references>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a\"</><exttag-attribute ext-ref> </><exttag-bracket>/&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"b\"</><exttag-bracket>&gt</><tag-ref>should be 2</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references</><exttag-bracket>&gt</><tag-references exttag-bracket>&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>name=</><tag-references exttag-attribute-value>\"a\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>should be 1</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt&lt;</><tag-references exttag-name>ref </><tag-references exttag-attribute ext-ref>follow=</><tag-references exttag-attribute-value>\"other page\"</><tag-references exttag-bracket>&gt</><tag-references tag-ref>is invalid</><tag-references exttag-bracket>&lt;/</><tag-references exttag-name>ref</><tag-references exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>references</><exttag-bracket>&gt</>"
	},
	{
		"desc": "comments"
	},
	{
		"desc": "Comments and Indent-Pre",
		"wikitext": "<!-- comment 1 --> asdf\n\n<!-- comment 1 --> asdf\n<!-- comment 2 -->\n\n<!-- comment 1 --> asdf\n<!-- comment 2 -->xyz\n\n<!-- comment 1 --> asdf\n<!-- comment 2 --> xyz",
		"parsed": "<comment>&lt;!-- comment 1 --&gt</> asdf<comment>&lt;!-- comment 1 --&gt</> asdf<comment>&lt;!-- comment 2 --&gt&lt;!-- comment 1 --&gt</> asdf<comment>&lt;!-- comment 2 --&gt</>xyz<comment>&lt;!-- comment 1 --&gt</> asdf<comment>&lt;!-- comment 2 --&gt</> xyz"
	},
	{
		"desc": "Comment test 2a",
		"wikitext": "asdf\n<!-- comment 1 -->\njkl",
		"parsed": "asdf<comment>&lt;!-- comment 1 --&gt</>jkl"
	},
	{
		"desc": "Comment test 2b",
		"wikitext": "asdf\n<!-- comment 1 -->\n\njkl",
		"parsed": "asdf<comment>&lt;!-- comment 1 --&gt</>jkl"
	},
	{
		"desc": "Comment test 3",
		"wikitext": "asdf\n<!-- comment 1 -->\n<!-- comment 2 -->\njkl",
		"parsed": "asdf<comment>&lt;!-- comment 1 --&gt&lt;!-- comment 2 --&gt</>jkl"
	},
	{
		"desc": "Comment test 4",
		"wikitext": "asdf<!-- comment 1 -->jkl",
		"parsed": "asdf<comment>&lt;!-- comment 1 --&gt</>jkl"
	},
	{
		"desc": "Comment spacing",
		"wikitext": "a\n <!-- foo --> b <!-- bar -->\nc",
		"parsed": "a<skipformatting> </><comment>&lt;!-- foo --&gt</> b <comment>&lt;!-- bar --&gt</>c"
	},
	{
		"desc": "Comment whitespace",
		"wikitext": "<!-- returns a single newline, not nothing, since the newline after > is not stripped -->",
		"parsed": "<comment>&lt;!-- returns a single newline, not nothing, since the newline after &gt is not stripped --&gt</>"
	},
	{
		"desc": "Comment semantics and delimiters",
		"wikitext": "<!-- --><!----><!-----><!------>",
		"parsed": "<comment>&lt;!-- --&gt&lt;!----&gt&lt;!-----&gt&lt;!------&gt</>"
	},
	{
		"desc": "Comment semantics and delimiters, redux",
		"wikitext": "<!-- In SGML every \"foo\" here would actually show up in the text -- foo -- bar\n-- foo -- funky huh? ... -->",
		"parsed": "<comment>&lt;!-- In SGML every \"foo\" here would actually show up in the text -- foo -- bar-- foo -- funky huh? ... --&gt</>"
	},
	{
		"desc": "Comment semantics and delimiters: directors cut",
		"wikitext": "<!-- ... However we like to keep things simple and somewhat XML-ish so we eat\neverything starting with < followed by !-- until the first -- and > we see,\nthat wouldn't be valid XML however, since in XML -- has to terminate a comment\n-->-->",
		"parsed": "<comment>&lt;!-- ... However we like to keep things simple and somewhat XML-ish so we eateverything starting with &lt; followed by !-- until the first -- and &gt we see,that wouldn't be valid XML however, since in XML -- has to terminate a comment--&gt</>-->"
	},
	{
		"desc": "Comment semantics: nesting",
		"wikitext": "<!--<!-- no, we're not going to do anything fancy here -->-->",
		"parsed": "<comment>&lt;!--&lt;!-- no, we're not going to do anything fancy here --&gt</>-->"
	},
	{
		"desc": "Comment semantics: unclosed comment at end",
		"wikitext": "<!--This comment will run out to the end of the document",
		"parsed": "<comment>&lt;!--This comment will run out to the end of the document</>"
	},
	{
		"desc": "Comment semantics: normalize comments to play nice with XML and browsers",
		"wikitext": "<!-- Browsers --!> think this is closed -->\n<!--> This would normally be text -->\n<!---> As would this -->\n<!-- XML doesn't like trailing dashes -------->\n<!-- Nor doubled hyphens -- anywhere in the data -->\nBut this is not a comment.",
		"parsed": "<comment>&lt;!-- Browsers --!&gt think this is closed --&gt&lt;!--&gt This would normally be text --&gt&lt;!---&gt As would this --&gt&lt;!-- XML doesn't like trailing dashes --------&gt&lt;!-- Nor doubled hyphens -- anywhere in the data --&gt</>But this is not a comment."
	},
	{
		"desc": "Comment semantics: round-trip even text which contains encoded -->",
		"wikitext": "<!-- hello & goodbye - > --&gt; --&amp;gt; --&xx -->",
		"parsed": "<comment>&lt;!-- hello &amp; goodbye - &gt --&amp;gt; --&amp;amp;gt; --&amp;xx --&gt</>"
	},
	{
		"desc": "Comment in template title",
		"wikitext": "{{f<!---->oo}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>f</><template-ground comment>&lt;!----&gt</><template-ground template-name pagename>oo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Comment on its own line post-expand",
		"wikitext": "a\n{{blank}}<!---->\nb",
		"parsed": "a<template-ground template-bracket>{{</><template-ground template-name pagename>blank</><template-ground template-bracket>}}</><comment>&lt;!----&gt</>b"
	},
	{
		"desc": "Comment on its own line post-expand with non-significant whitespace",
		"wikitext": "a\n {{blank}} <!----> \nb",
		"parsed": "a<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>blank</><template-ground template-bracket>}}</> <comment>&lt;!----&gt</> b"
	},
	{
		"desc": "Multiple comments should still parse as SOL-transparent",
		"wikitext": "<!--c1-->*a\n<!--c2--><!--c3--><!--c4-->*b",
		"parsed": "<comment>&lt;!--c1--&gt</>*a<comment>&lt;!--c2--&gt&lt;!--c3--&gt&lt;!--c4--&gt</>*b"
	},
	{
		"desc": "IE conditional comments",
		"wikitext": "<!--[if lt IE 9]>\n\t<script>alert('hi');</script>\n<![endif]-->",
		"parsed": "<comment>&lt;!--[if lt IE 9]&gt\t&lt;script&gtalert('hi');&lt;/script&gt&lt;![endif]--&gt</>"
	},
	{
		"desc": "Comment with valid json",
		"wikitext": "hi <!--{\"hi\":\"ho\"}--> ho",
		"parsed": "hi <comment>&lt;!--{\"hi\":\"ho\"}--&gt</> ho"
	},
	{
		"desc": "definitionLists"
	},
	{
		"desc": "Simple definition",
		"wikitext": ";name :Definition",
		"parsed": "<list>;</><strong>name </><list>:</>Definition"
	},
	{
		"desc": "Definition list for indentation only",
		"wikitext": ":Indented text",
		"parsed": "<list>:</>Indented text"
	},
	{
		"desc": "Definition list with no space",
		"wikitext": ";name:Definition",
		"parsed": "<list>;</><strong>name</><list>:</>Definition"
	},
	{
		"desc": "Definition list with URL link",
		"wikitext": ";http://example.com/ :definition",
		"parsed": "<list>;</><strong>http</><list>:</>//example.com/ :definition"
	},
	{
		"desc": "Definition list with bracketed URL link",
		"wikitext": ";[http://www.example.com/ Example]:Something about it",
		"parsed": "<list>;</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/</><link-ground extlink-text strong> Example</><link-ground extlink-bracket>]</><list>:</>Something about it"
	},
	{
		"desc": "Definition list with wikilink containing colon",
		"wikitext": ";[[Help:FAQ]]:The least-read page on Wikipedia",
		"parsed": "<list>;</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>Help:FAQ</><link-ground link-bracket>]]</><list>:</>The least-read page on Wikipedia"
	},
	{
		"desc": "Definition list with news link containing colon",
		"wikitext": ";news:alt.wikipedia.rox :This isn't even a real newsgroup!",
		"parsed": "<list>;</><strong>news</><list>:</>alt.wikipedia.rox :This isn't even a real newsgroup!"
	},
	{
		"desc": "Malformed definition list with colon",
		"wikitext": ";news:alt.wikipedia.rox -- don't crash or enter an infinite loop",
		"parsed": "<list>;</><strong>news</><list>:</>alt.wikipedia.rox -- don't crash or enter an infinite loop"
	},
	{
		"desc": "Definition lists: colon in external link text",
		"wikitext": ";[http://www.wikipedia2.org/ Wikipedia :The Next Generation] :OK, I made that up",
		"parsed": "<list>;</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.wikipedia2.org/</><link-ground extlink-text strong> Wikipedia :The Next Generation</><link-ground extlink-bracket>]</><strong> </><list>:</>OK, I made that up"
	},
	{
		"desc": "Definition lists: colon in HTML attribute",
		"wikitext": ";<b style=\"display: inline\">bold</b>",
		"parsed": "<list>;</><htmltag-bracket>&lt;</><htmltag-name>b </><htmltag-attribute html-b>style=</><htmltag-attribute-value>\"display: inline\"</><htmltag-bracket>&gt</><strong>bold</><htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Definition lists: self-closed tag",
		"wikitext": ";one<br/>two :two-line fun",
		"parsed": "<list>;</><strong>one</><htmltag-bracket>&lt;</><htmltag-name>br</><htmltag-bracket>/&gt</><strong>two </><list>:</>two-line fun"
	},
	{
		"desc": "Definition lists: ignore colons inside tags",
		"wikitext": ";one <b>two : tag <i>fun:</i>:</b>:def",
		"parsed": "<list>;</><strong>one </><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</><strong>two : tag </><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</><strong>fun:</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><strong>:</><htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</><list>:</>def"
	},
	{
		"desc": "Definition lists: excess closed tags",
		"wikitext": ";one</b>two :bad tag fun",
		"parsed": "<list>;</><strong>one</><error>&lt;/b&gt</><strong>two </><list>:</>bad tag fun"
	},
	{
		"desc": "T13748: Literal closing tags",
		"wikitext": "<dl>\n<dt>test 1</dt>\n<dd>test test test test test</dd>\n<dt>test 2</dt>\n<dd>test test test test test</dd>\n</dl>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>dl</><htmltag-bracket>&gt&lt;</><htmltag-name>dt</><htmltag-bracket>&gt</>test 1<htmltag-bracket>&lt;/</><htmltag-name>dt</><htmltag-bracket>&gt&lt;</><htmltag-name>dd</><htmltag-bracket>&gt</>test test test test test<htmltag-bracket>&lt;/</><htmltag-name>dd</><htmltag-bracket>&gt&lt;</><htmltag-name>dt</><htmltag-bracket>&gt</>test 2<htmltag-bracket>&lt;/</><htmltag-name>dt</><htmltag-bracket>&gt&lt;</><htmltag-name>dd</><htmltag-bracket>&gt</>test test test test test<htmltag-bracket>&lt;/</><htmltag-name>dd</><htmltag-bracket>&gt&lt;/</><htmltag-name>dl</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Definition and unordered list using wiki syntax nested in unordered list using html tags.",
		"wikitext": "<ul><li>\n;term :description\n*unordered\n</li></ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</><list>;</><strong>term </><list>:</>description<list>*</>unordered<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Definition list with empty definition and following paragraph",
		"wikitext": ";term:\n\nParagraph text",
		"parsed": "<list>;</><strong>term</><list>:</>Paragraph text"
	},
	{
		"desc": "Nested definition lists using html syntax",
		"wikitext": "<dl><dt>x</dt>\n<dd>a</dd>\n<dd>b</dd></dl>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>dl</><htmltag-bracket>&gt&lt;</><htmltag-name>dt</><htmltag-bracket>&gt</>x<htmltag-bracket>&lt;/</><htmltag-name>dt</><htmltag-bracket>&gt&lt;</><htmltag-name>dd</><htmltag-bracket>&gt</>a<htmltag-bracket>&lt;/</><htmltag-name>dd</><htmltag-bracket>&gt&lt;</><htmltag-name>dd</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>dd</><htmltag-bracket>&gt&lt;/</><htmltag-name>dl</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Definition Lists: No nesting: Multiple dd's",
		"wikitext": ";x\n:a\n:b",
		"parsed": "<list>;</><strong>x</><list>:</>a<list>:</>b"
	},
	{
		"desc": "Definition Lists: Indentation: Regular",
		"wikitext": ":i1\n::i2\n:::i3",
		"parsed": "<list>:</>i1<list>::</>i2<list>:::</>i3"
	},
	{
		"desc": "Definition Lists: Indentation: Missing 1st level",
		"wikitext": "::i2\n:::i3",
		"parsed": "<list>::</>i2<list>:::</>i3"
	},
	{
		"desc": "Definition Lists: Indentation: Multi-level indent",
		"wikitext": ":::i3",
		"parsed": "<list>:::</>i3"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables",
		"wikitext": "::{|\n|foo\n|bar\n|}\nthis text\nshould be left alone",
		"parsed": "<list>::</><table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>|</><table-td>bar</><table-bracket>|}</>this textshould be left alone"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (with content following table)",
		"wikitext": ":{|\n|foo\n|bar\n|} <!--c1--> this text should be part of the dl",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>|</><table-td>bar</><table-bracket>|}</> <comment>&lt;!--c1--&gt</> this text should be part of the dl"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables, with comments (T65979)",
		"wikitext": "<!-- foo -->\n::{|\n|foo\n|bar\n|}<!-- bar -->\nthis text\nshould be left alone",
		"parsed": "<comment>&lt;!-- foo --&gt</><list>::</><table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>|</><table-td>bar</><table-bracket>|}</><comment>&lt;!-- bar --&gt</>this textshould be left alone"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables, with comment before table",
		"wikitext": "::<!-- foo -->{|\n|foo\n|}",
		"parsed": "<list>::</><comment>&lt;!-- foo --&gt</>{||foo|}"
	},
	{
		"desc": "Definition Lists: Hack use to indent tables, in a nested list context (T262943)",
		"wikitext": "This is a discussion thread.\n\n:Parent comment.\n::Child comment\n::{|\n|With a\n|Table!\n|}",
		"parsed": "This is a discussion thread.<list>:</>Parent comment.<list>::</>Child comment<list>::</><table-bracket>{|</><table-delimiter>|</><table-td>With a</><table-delimiter>|</><table-td>Table!</><table-bracket>|}</>"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (WS-insensitive)",
		"wikitext": ":{|\n|a\n|}",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|</><table-td>a</><table-bracket>|}</>"
	},
	{
		"desc": "Definition Lists: Hacky use to indent tables (nl-insensitive)",
		"wikitext": ":{|\n\n\n|a\n|}",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|</><table-td>a</><table-bracket>|}</>"
	},
	{
		"desc": "Table / list interaction: indented table with lists in table contents",
		"wikitext": ":{|\n|-\n|a\n\n*b\n|-\n|c\n\n*d\n|}",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|-|</><table-td>a</><list>*</><table-td>b</><table-delimiter>|-|</><table-td>c</><list>*</><table-td>d</><table-bracket>|}</>"
	},
	{
		"desc": "Table / list interaction: lists nested in tables nested in indented lists",
		"wikitext": ":{|\n|\n:a\n:b\n|\n*c\n*d\n|}\n\n*e\n*f",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|</><list>:</><table-td>a</><list>:</><table-td>b</><table-delimiter>|</><list>*</><table-td>c</><list>*</><table-td>d</><table-bracket>|}</><list>*</>e<list>*</>f"
	},
	{
		"desc": "Definition Lists: Nesting: Multi-level (Parsoid only)",
		"wikitext": ";t1:d1\n;;t2::d2\n;;;t3:::d3",
		"parsed": "<list>;</><strong>t1</><list>:</>d1<list>;;</><strong>t2</><list>::</>d2<list>;;;</><strong>t3</><list>:::</>d3"
	},
	{
		"desc": "Definition Lists: Nesting: Test 2",
		"wikitext": ";t1\n::d2",
		"parsed": "<list>;</><strong>t1</><list>::</>d2"
	},
	{
		"desc": "Definition Lists: Nesting: Test 3",
		"wikitext": ":;t1\n::::d2",
		"parsed": "<list>:;</><strong>t1</><list>::::</>d2"
	},
	{
		"desc": "Definition Lists: Nesting: Test 4",
		"wikitext": "::;t3\n:::d3",
		"parsed": "<list>::;</><strong>t3</><list>:::</>d3"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 1",
		"wikitext": ":;*foo\n::*bar\n:;baz",
		"parsed": "<list>:;*</><strong>foo</><list>::*</>bar<list>:;</><strong>baz</>"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 2",
		"wikitext": "*:d1\n*:d2",
		"parsed": "<list>*:</>d1<list>*:</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 3",
		"wikitext": "*:::d1\n*:::d2",
		"parsed": "<list>*:::</>d1<list>*:::</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 4",
		"wikitext": "*;d1 :d2\n*;d3 :d4",
		"parsed": "<list>*;</><strong>d1 </><list>:</>d2<list>*;</><strong>d3 </><list>:</>d4"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 5",
		"wikitext": "*:d1\n*::d2",
		"parsed": "<list>*:</>d1<list>*::</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 6",
		"wikitext": "#*:d1\n#*:::d3",
		"parsed": "<list>#*:</>d1<list>#*:::</>d3"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 7",
		"wikitext": ":*d1\n:*d2",
		"parsed": "<list>:*</>d1<list>:*</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 8",
		"wikitext": ":*d1\n::*d2",
		"parsed": "<list>:*</>d1<list>::*</>d2"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 9",
		"wikitext": "*;foo :bar",
		"parsed": "<list>*;</><strong>foo </><list>:</>bar"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 10",
		"wikitext": "*#;foo :bar",
		"parsed": "<list>*#;</><strong>foo </><list>:</>bar"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 11",
		"wikitext": ";a\n:*b",
		"parsed": "<list>;</><strong>a</><list>:*</>b"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 12",
		"wikitext": "*#*#;*;;foo :bar\n*#*#;boo :baz",
		"parsed": "<list>*#*#;*;;</><strong>foo </><list>:</><strong>bar</><list>*#*#;</><strong>boo </><list>:</>baz"
	},
	{
		"desc": "Definition Lists: Mixed Lists: Test 13",
		"wikitext": "*#*#;*;;foo : bar\n*#*#;boo : baz",
		"parsed": "<list>*#*#;*;;</><strong>foo </><list>:</><strong> bar</><list>*#*#;</><strong>boo </><list>:</> baz"
	},
	{
		"desc": "Definition Lists: Weird Ones: Test 1",
		"wikitext": "*#;*::;;foo :bar (who uses this?)",
		"parsed": "<list>*#;*::;;</><strong>foo </><list>:</><strong>bar (who uses this?)</>"
	},
	{
		"desc": "Definition Lists: colons occurring in tags",
		"wikitext": ";a:b\n;'''a:b'''\n;<i>a:b</i>\n;<span>a:b</span>\n;<div>a:b</div>\n;<div>a\n:b</div>\n;{{1x|a:b}}\n;{{1x|''a:b''}}\n;;;''a:b''",
		"parsed": "<list>;</><strong>a</><list>:</>b<list>;</><apostrophes>'''</><strong>a:b</><apostrophes>'''</><list>;</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</><strong>a:b</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><list>;</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><strong>a:b</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>;</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><strong>a:b</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><list>;</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><strong>a</><list>:</>b<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><list>;</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template strong>:</><template-ground template>b</><template-ground template-bracket>}}</><list>;</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground apostrophes>''</><template-ground template>a</><template-ground template strong em>:</><template-ground template>b</><template-ground apostrophes>''</><template-ground template-bracket>}}</><list>;;;</><apostrophes>''</><strong em>a:b</><apostrophes>''</>"
	},
	{
		"desc": "Definition Lists: colons and tables 1",
		"wikitext": ":{|\n|x\n|}\n:{|\n|y\n|}",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>|</><table-td>x</><table-bracket>|}</><list>:</><table-bracket>{|</><table-delimiter>|</><table-td>y</><table-bracket>|}</>"
	},
	{
		"desc": "Definition Lists: template interaction",
		"wikitext": "::{{definition_list}}\n\n:one\n::{{definition_list}}\n:::two\n:::three\n::four",
		"parsed": "<list>::</><template-ground template-bracket>{{</><template-ground template-name pagename>definition_list</><template-ground template-bracket>}}</><list>:</>one<list>::</><template-ground template-bracket>{{</><template-ground template-name pagename>definition_list</><template-ground template-bracket>}}</><list>:::</>two<list>:::</>three<list>::</>four"
	},
	{
		"desc": "extLinks"
	},
	{
		"desc": "External links: non-bracketed",
		"wikitext": "Non-bracketed: http://example.com",
		"parsed": "Non-bracketed: <free-extlink-protocol>http://</><free-extlink>example.com</>"
	},
	{
		"desc": "External links: numbered",
		"wikitext": "Numbered: [http://example.com]\nNumbered: [http://example.net]\nNumbered: [http://example.com]",
		"parsed": "Numbered: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-bracket>]</>Numbered: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.net</><link-ground extlink-bracket>]</>Numbered: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: specified text",
		"wikitext": "Specified text: [http://example.com link]",
		"parsed": "Specified text: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: trail",
		"wikitext": "Linktrails should not work for external links: [http://example.com link]s",
		"parsed": "Linktrails should not work for external links: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>s"
	},
	{
		"desc": "External links: dollar sign in URL",
		"wikitext": "http://example.com/1$2345",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com/1$2345</>"
	},
	{
		"desc": "External links: dollar sign in URL (autonumber)",
		"wikitext": "[http://example.com/1$2345]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/1$2345</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (T6377)",
		"wikitext": "http://example.com/1[2345",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com/1</>[2345"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (named) (T6377)",
		"wikitext": "[http://example.com/1[2345]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/1</><link-ground extlink-text>[2345</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: open square bracket forbidden in URL (named) (T6377)\nParsoid variant.",
		"wikitext": "[http://example.com/1 [2345]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/1</><link-ground extlink-text> [2345</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: nowiki in URL link text (T8230)",
		"wikitext": "[http://example.com/ <nowiki>''example site''</nowiki>]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text> </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>''example site''</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: newline forbidden in text (T8230 regression check)",
		"wikitext": "[http://example.com/ first\nsecond]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text> first</>second]"
	},
	{
		"desc": "External links: Pipe char between url and text",
		"wikitext": "[http://example.com | link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> | link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in brackets",
		"wikitext": "[//example.com/ Test]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>example.com/</><link-ground extlink-text> Test</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in brackets without text",
		"wikitext": "[//example.com]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: protocol-relative URL in free text is left alone",
		"wikitext": "//example.com/Foo",
		"parsed": "//example.com/Foo"
	},
	{
		"desc": "External links: protocol-relative URL in the middle of a word is left alone (T32269)",
		"wikitext": "foo//example.com/Foo",
		"parsed": "foo//example.com/Foo"
	},
	{
		"desc": "External links: with no contents",
		"wikitext": "[http://en.wikipedia.org/wiki/Foo]\n\n[[wikipedia:Foo|Bar]]\n\n[[wikipedia:Foo|<span>Bar</span>]]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>en.wikipedia.org/wiki/Foo</><link-ground extlink-bracket>]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>wikipedia:Foo</><link-ground link-delimiter>|</><link-ground link-text>Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>wikipedia:Foo</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-text>Bar</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "External links: Free with trailing punctuation",
		"wikitext": "http://example.com,\nhttp://example.com;\nhttp://example.com\\\nhttp://example.com.\nhttp://example.com:\nhttp://example.com!\nhttp://example.com?\nhttp://example.com)\nhttp://example.com/url_with_(brackets)\n(http://example.com/url_without_brackets)\nhttp://example.com/url_with_entity&amp;\nhttp://example.com/url_with_entity&#x26;\nhttp://example.com/url_with_entity&#038;\nhttp://example.com/url_with_entity&nbsp;\nhttp://example.com/url_with_entity&#xA0;\nhttp://example.com/url_with_entity&#160;\nhttp://example.com/url_with_entity&lt;\nhttp://example.com/url_with_entity&#x3C;\nhttp://example.com/url_with_entity&#60;",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</>,<free-extlink-protocol>http://</><free-extlink>example.com</>;<free-extlink-protocol>http://</><free-extlink>example.com</>\\<free-extlink-protocol>http://</><free-extlink>example.com</>.<free-extlink-protocol>http://</><free-extlink>example.com</>:<free-extlink-protocol>http://</><free-extlink>example.com</>!<free-extlink-protocol>http://</><free-extlink>example.com</>?<free-extlink-protocol>http://</><free-extlink>example.com</>)<free-extlink-protocol>http://</><free-extlink>example.com/url_with_(brackets)</>(<free-extlink-protocol>http://</><free-extlink>example.com/url_without_brackets</>)<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;amp</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#x26</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#038</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;nbsp</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#xA0</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#160</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity</><entity>&amp;lt;</><free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#x3C</>;<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;#60</>;"
	},
	{
		"desc": "External links: tricky Parsoid html2html case",
		"wikitext": "http://example.com/url_with_entity&amp;amp;",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com/url_with_entity&amp;amp;amp</>;"
	},
	{
		"desc": "External links: html2html with trailing dot (T263203)",
		"wikitext": "test [http://example.com/test. http://example.com/test.] test\n\ntest http://example.com/test. test",
		"parsed": "test <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/test.</><link-ground extlink-text> http://example.com/test.</><link-ground extlink-bracket>]</> testtest <free-extlink-protocol>http://</><free-extlink>example.com/test</>. test"
	},
	{
		"desc": "External links: Free with trailing quotes (T113666)",
		"wikitext": "'''News:''' Stuff here\n\nnews:'a'b''c''d e",
		"parsed": "<apostrophes>'''</><strong>News:</><apostrophes>'''</> Stuff here<free-extlink-protocol>news:</><free-extlink>'a'b</><apostrophes>''</><em>c</><apostrophes>''</>d e"
	},
	{
		"desc": "External links: with entity",
		"wikitext": "[http://&#x20;www.librarieswithoutborders.org Libraries without borders]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>&amp;#x20;www.librarieswithoutborders.org</><link-ground extlink-text> Libraries without borders</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: Lone protocols are never linked (T105697)",
		"wikitext": "http://\nhttp://;\n(http://)\nbitcoin:\nbitcoin:;\n(bitcoin:)",
		"parsed": "http://<free-extlink-protocol>http://</>;(<free-extlink-protocol>http://</>)bitcoin:<free-extlink-protocol>bitcoin:</>;(<free-extlink-protocol>bitcoin:</>)"
	},
	{
		"desc": "External links: No preceding word characters allowed (T67278)",
		"wikitext": "NOPEhttp://example.com\nN0http://example.com\nok:http://example.com\nok-http://example.com",
		"parsed": "NOPEhttp://example.comN0http://example.comok:<free-extlink-protocol>http://</><free-extlink>example.com</>ok-<free-extlink-protocol>http://</><free-extlink>example.com</>"
	},
	{
		"desc": "External links: nofollow domain exception",
		"wikitext": "A [https://no-nofollow.org/foobar link], and another [https://example.org link].",
		"parsed": "A <link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>no-nofollow.org/foobar</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>, and another <link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>example.org</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>."
	},
	{
		"desc": "External image",
		"wikitext": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image: <free-extlink-protocol>http://</><free-extlink>meta.wikimedia.org/upload/f/f1/Ncwikicol.png</>"
	},
	{
		"desc": "External image from https",
		"wikitext": "External image from https: https://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image from https: <free-extlink-protocol>https://</><free-extlink>meta.wikimedia.org/upload/f/f1/Ncwikicol.png</>"
	},
	{
		"desc": "External image (when not allowed)",
		"wikitext": "External image: http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png",
		"parsed": "External image: <free-extlink-protocol>http://</><free-extlink>meta.wikimedia.org/upload/f/f1/Ncwikicol.png</>"
	},
	{
		"desc": "Link to non-http image, no img tag",
		"wikitext": "Link to non-http image, no img tag: ftp://example.com/test.jpg",
		"parsed": "Link to non-http image, no img tag: <free-extlink-protocol>ftp://</><free-extlink>example.com/test.jpg</>"
	},
	{
		"desc": "External links: terminating separator",
		"wikitext": "Terminating separator: http://example.com/thing,",
		"parsed": "Terminating separator: <free-extlink-protocol>http://</><free-extlink>example.com/thing</>,"
	},
	{
		"desc": "External links: intervening separator",
		"wikitext": "Intervening separator: http://example.com/1,2,3",
		"parsed": "Intervening separator: <free-extlink-protocol>http://</><free-extlink>example.com/1,2,3</>"
	},
	{
		"desc": "External links: old bug with URL in query",
		"wikitext": "Old bug with URL in query: [http://example.com/thing?url=http://example.com link]",
		"parsed": "Old bug with URL in query: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/thing?url=http://example.com</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: old URL-in-URL bug, mixed protocols",
		"wikitext": "And again with mixed protocols: [ftp://example.com?url=http://example.com link]",
		"parsed": "And again with mixed protocols: <link-ground extlink-bracket>[</><link-ground extlink-protocol>ftp://</><link-ground extlink>example.com?url=http://example.com</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: URL in text",
		"wikitext": "URL in text: [http://example.com http://example.com]",
		"parsed": "URL in text: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> http://example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: Clickable images",
		"wikitext": "ja-style clickable images: [http://example.com http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png]",
		"parsed": "ja-style clickable images: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> http://meta.wikimedia.org/upload/f/f1/Ncwikicol.png</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: raw ampersand",
		"wikitext": "Old &amp; use: http://x&y",
		"parsed": "Old <entity>&amp;amp;</> use: <free-extlink-protocol>http://</><free-extlink>x&amp;y</>"
	},
	{
		"desc": "External links: encoded ampersand",
		"wikitext": "Old &amp; use: http://x&amp;y",
		"parsed": "Old <entity>&amp;amp;</> use: <free-extlink-protocol>http://</><free-extlink>x&amp;amp;y</>"
	},
	{
		"desc": "External links: encoded equals (T8102)",
		"wikitext": "http://example.com/?foo&#61;bar",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com/?foo&amp;#61;bar</>"
	},
	{
		"desc": "External links: [raw ampersand]",
		"wikitext": "Old &amp; use: [http://x&y]",
		"parsed": "Old <entity>&amp;amp;</> use: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>x&amp;y</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: [encoded ampersand]",
		"wikitext": "Old &amp; use: [http://x&amp;y]",
		"parsed": "Old <entity>&amp;amp;</> use: <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>x&amp;amp;y</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: [raw equals]",
		"wikitext": "[http://example.com/?foo=bar]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/?foo=bar</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: [encoded equals] (T8102)",
		"wikitext": "[http://example.com/?foo&#61;bar]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/?foo&amp;#61;bar</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: [IDN ignored character reference in hostname; strip it right off]",
		"wikitext": "[http://e&zwnj;xample.com/]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>e&amp;zwnj;xample.com/</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: IDN ignored character reference in hostname; strip it right off",
		"wikitext": "http://e&zwnj;xample.com/",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>e&amp;zwnj;xample.com/</>"
	},
	{
		"desc": "External links: www.jpeg.org (T2554)",
		"wikitext": "http://www.jpeg.org",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.jpeg.org</>"
	},
	{
		"desc": "External links: URL within URL (T2002)",
		"wikitext": "[http://www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.unausa.org/newindex.asp?place=http://www.unausa.org/programs/mun.asp</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T2361: URL inside bracketed URL",
		"wikitext": "[http://www.example.com/foo http://www.example.com/bar]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/foo</><link-ground extlink-text> http://www.example.com/bar</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T2361: URL within URL, not bracketed",
		"wikitext": "http://www.example.com/foo?=http://www.example.com/bar",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/foo?=http://www.example.com/bar</>"
	},
	{
		"desc": "T2289: \">\"-token in URL-tail",
		"wikitext": "http://www.example.com/<hello>",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/</><hello>"
	},
	{
		"desc": "T2289: literal \">\"-token in URL-tail",
		"wikitext": "http://www.example.com/<b>html</b>",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/</><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</>html<htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T2289: \">\"-token in bracketed URL",
		"wikitext": "[http://www.example.com/<hello> stuff]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/</><link-ground extlink-text>&lt;hello&gt stuff</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T2289: literal \">\"-token in bracketed URL",
		"wikitext": "[http://www.example.com/<b>html</b> stuff]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>b</><link-ground htmltag-bracket>&gt</><link-ground extlink-text>html</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>b</><link-ground htmltag-bracket>&gt</><link-ground extlink-text> stuff</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T2289: literal double quote at end of URL",
		"wikitext": "http://www.example.com/\"hello\"",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/</>\"hello\""
	},
	{
		"desc": "T2289: literal double quote in bracketed URL",
		"wikitext": "[http://www.example.com/\"hello\" stuff]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/</><link-ground extlink-text>\"hello\" stuff</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: multiple legal whitespace is fine, Magnus. Don't break it please. (T7081)",
		"wikitext": "[http://www.example.com  test]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text>  test</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: link text with spaces",
		"wikitext": "[http://www.example.com a b c]\n[http://www.example.com ''a'' ''b'']",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text> a b c</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com</><link-ground extlink-text> </><link-ground apostrophes>''</><link-ground extlink-text em>a</><link-ground apostrophes>''</><link-ground extlink-text> </><link-ground apostrophes>''</><link-ground extlink-text em>b</><link-ground apostrophes>''</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External links: wiki links within external link (T5695)",
		"wikitext": "[http://example.com [[wikilink]] embedded in ext link]\n\n[http://example.com test [[wikilink]] embedded in ext link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>wikilink</><link-ground link-bracket>]]</><link-ground extlink-text> embedded in ext link</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> test </><link-ground link-bracket>[[</><link-ground link-pagename pagename>wikilink</><link-ground link-bracket>]]</><link-ground extlink-text> embedded in ext link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T2787: Links with one slash after the url protocol are invalid",
		"wikitext": "http:/example.com\n\n[http:/example.com title]",
		"parsed": "http:/example.com[http:/example.com title]"
	},
	{
		"desc": "Bracketed external links with template-generated invalid target",
		"wikitext": "[{{1x|http:/example.com}} title]",
		"parsed": "[<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>http:/example.com</><template-ground template-bracket>}}</> title]"
	},
	{
		"desc": "T6781: %26 in URL",
		"wikitext": "http://www.example.com/?title=AT%26T",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/?title=AT%26T</>"
	},
	{
		"desc": "T6781, T7267: %25 in URL",
		"wikitext": "http://www.example.com/?title=100%25_Bran",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/?title=100%25_Bran</>"
	},
	{
		"desc": "T6781, T7267: %28, %29 in URL",
		"wikitext": "http://www.example.com/?title=Ben-Hur_%281959_film%29",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>www.example.com/?title=Ben-Hur_%281959_film%29</>"
	},
	{
		"desc": "T6781: %26 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=AT%26T]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=AT%26T</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T6781, T7267: %26 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=100%25_Bran]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=100%25_Bran</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T6781, T7267: %28, %29 in autonumber URL",
		"wikitext": "[http://www.example.com/?title=Ben-Hur_%281959_film%29]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=Ben-Hur_%281959_film%29</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T6781: %26 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=AT%26T link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=AT%26T</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T6781, T7267: %25 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=100%25_Bran link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=100%25_Bran</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "T6781, T7267: %28, %29 in bracketed URL",
		"wikitext": "[http://www.example.com/?title=Ben-Hur_%281959_film%29 link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.example.com/?title=Ben-Hur_%281959_film%29</><link-ground extlink-text> link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External link containing a period in the anchor. (T65947)",
		"wikitext": "[//foo.org/bar#baz. bang]\n\n[//foo.org/bar. bang]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>foo.org/bar#baz.</><link-ground extlink-text> bang</><link-ground extlink-bracket>][</><link-ground extlink-protocol>//</><link-ground extlink>foo.org/bar.</><link-ground extlink-text> bang</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External link containing a single quote. (T65947)",
		"wikitext": "[//foo.org/bar'baz]\n\n[//foo.org/bar'baz bang]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>//</><link-ground extlink>foo.org/bar'baz</><link-ground extlink-bracket>][</><link-ground extlink-protocol>//</><link-ground extlink>foo.org/bar'baz</><link-ground extlink-text> bang</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External link containing double-single-quotes in text '' (T6598 check)",
		"wikitext": "Some [http://example.com/ pretty ''italics'' and stuff]!",
		"parsed": "Some <link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text> pretty </><link-ground apostrophes>''</><link-ground extlink-text em>italics</><link-ground apostrophes>''</><link-ground extlink-text> and stuff</><link-ground extlink-bracket>]</>!"
	},
	{
		"desc": "External link containing double-single-quotes in text embedded in italics (T6598 check)",
		"wikitext": "''Some [http://example.com/ pretty ''italics'' and stuff]!''",
		"parsed": "<apostrophes>''</><em>Some </><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/</><link-ground extlink-text em> pretty </><link-ground apostrophes>''</><link-ground extlink-text>italics</><link-ground apostrophes>''</><link-ground extlink-text em> and stuff</><link-ground extlink-bracket>]</><em>!</><apostrophes>''</>"
	},
	{
		"desc": "External link containing double-single-quotes with no space separating the url from text in italics",
		"wikitext": "[http://www.musee-picasso.fr/pages/page_id18528_u1l2.htm''La muerte de Casagemas'' (1901) en el sitio de [[Museo Picasso (París)|Museo Picasso]].]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.musee-picasso.fr/pages/page_id18528_u1l2.htm</><link-ground apostrophes>''</><link-ground extlink-text em>La muerte de Casagemas</><link-ground apostrophes>''</><link-ground extlink-text> (1901) en el sitio de </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Museo Picasso (París)</><link-ground link-delimiter>|</><link-ground link-text>Museo Picasso</><link-ground link-bracket>]]</><link-ground extlink-text>.</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External link with comments in link text",
		"wikitext": "[http://www.google.com Google <!-- comment -->]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.google.com</><link-ground extlink-text> Google </><link-ground comment>&lt;!-- comment --&gt</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "External link to bare IPv4 address",
		"wikitext": "[http://192.168.0.1 Link]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>192.168.0.1</><link-ground extlink-text> Link</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "URL-encoding in URL functions (single parameter)",
		"wikitext": "{{localurl:Some page|amp=&}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>localurl</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Some page</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>amp=&amp;</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "URL-encoding in URL functions (multiple parameters)",
		"wikitext": "{{localurl:Some page|q=?&amp=&}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>localurl</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Some page</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>q=?&amp;amp=&amp;</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Brackets in urls",
		"wikitext": "http://example.com/index.php?foozoid%5B%5D=bar\n\nhttp://example.com/index.php?foozoid&#x5B;&#x5D;=bar",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com/index.php?foozoid%5B%5D=bar</><free-extlink-protocol>http://</><free-extlink>example.com/index.php?foozoid&amp;#x5B;&amp;#x5D;=bar</>"
	},
	{
		"desc": "IPv6 urls, autolink format (T23261)",
		"wikitext": "http://[2404:130:0:1000::187:2]/index.php\n\nExamples from RFC 2373, section 2.2:\n\n*http://[1080::8:800:200C:417A]/unicast\n*http://[FF01::101]/multicast\n*http://[::1]/loopback\n*http://[::]/unspecified\n*http://[::13.1.68.3]/ipv4compat\n*http://[::FFFF:129.144.52.38]/ipv4compat\n\nExamples from RFC 2732, section 2:\n\n*http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html\n*http://[1080:0:0:0:8:800:200C:417A]/index.html\n*http://[3ffe:2a00:100:7031::1]\n*http://[1080::8:800:200C:417A]/foo\n*http://[::192.9.5.5]/ipng\n*http://[::FFFF:129.144.52.38]:80/index.html\n*http://[2010:836B:4179::836B:4179]",
		"parsed": "http://[2404:130:0:1000::187:2]/index.phpExamples from <magic-link>RFC 2373</>, section 2.2:<list>*</>http://[1080::8:800:200C:417A]/unicast<list>*</>http://[FF01::101]/multicast<list>*</>http://[::1]/loopback<list>*</>http://[::]/unspecified<list>*</>http://[::13.1.68.3]/ipv4compat<list>*</>http://[::FFFF:129.144.52.38]/ipv4compatExamples from <magic-link>RFC 2732</>, section 2:<list>*</>http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html<list>*</>http://[1080:0:0:0:8:800:200C:417A]/index.html<list>*</>http://[3ffe:2a00:100:7031::1]<list>*</>http://[1080::8:800:200C:417A]/foo<list>*</>http://[::192.9.5.5]/ipng<list>*</>http://[::FFFF:129.144.52.38]:80/index.html<list>*</>http://[2010:836B:4179::836B:4179]"
	},
	{
		"desc": "Unicode text around autolinks",
		"wikitext": "größhttps://foo.org\n\ngröß https://foo.org\n\n아들 고건 사진https://foo.org\n\n💩https://foo.org",
		"parsed": "größhttps://foo.orggröß <free-extlink-protocol>https://</><free-extlink>foo.org</>아들 고건 사진https://foo.org💩<free-extlink-protocol>https://</><free-extlink>foo.org</>"
	},
	{
		"desc": "IPv6 urls, bracketed format (T23261)",
		"wikitext": "[http://[2404:130:0:1000::187:2]/index.php test]\n\nExamples from RFC 2373, section 2.2:\n\n*[http://[1080::8:800:200C:417A] unicast]\n*[http://[FF01::101] multicast]\n*[http://[::1]/ loopback]\n*[http://[::] unspecified]\n*[http://[::13.1.68.3] ipv4compat]\n*[http://[::FFFF:129.144.52.38] ipv4compat]\n\nExamples from RFC 2732, section 2:\n\n*[http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html 1]\n*[http://[1080:0:0:0:8:800:200C:417A]/index.html 2]\n*[http://[3ffe:2a00:100:7031::1] 3]\n*[http://[1080::8:800:200C:417A]/foo 4]\n*[http://[::192.9.5.5]/ipng 5]\n*[http://[::FFFF:129.144.52.38]:80/index.html 6]\n*[http://[2010:836B:4179::836B:4179] 7]",
		"parsed": "[http://[2404:130:0:1000::187:2]/index.php test]Examples from <magic-link>RFC 2373</>, section 2.2:<list>*</>[http://[1080::8:800:200C:417A] unicast]<list>*</>[http://[FF01::101] multicast]<list>*</>[http://[::1]/ loopback]<list>*</>[http://[::] unspecified]<list>*</>[http://[::13.1.68.3] ipv4compat]<list>*</>[http://[::FFFF:129.144.52.38] ipv4compat]Examples from <magic-link>RFC 2732</>, section 2:<list>*</>[http://[FEDC:BA98:7654:3210:FEDC:BA98:7654:3210]:80/index.html 1]<list>*</>[http://[1080:0:0:0:8:800:200C:417A]/index.html 2]<list>*</>[http://[3ffe:2a00:100:7031::1] 3]<list>*</>[http://[1080::8:800:200C:417A]/foo 4]<list>*</>[http://[::192.9.5.5]/ipng 5]<list>*</>[http://[::FFFF:129.144.52.38]:80/index.html 6]<list>*</>[http://[2010:836B:4179::836B:4179] 7]"
	},
	{
		"desc": "Non-extlinks in brackets",
		"wikitext": "[foo]\n[foo bar]\n[foo ''bar'']\n[fool's] errand\n[fool's errand]\n[{{1x|foo}}]\n[{{1x|foo}} bar]\n[{{1x|foo}} ''bar'']\n[{{1x|foo}}l's] errand\n[{{1x|foo}}l's errand]\n[url={{1x|foo}}]\n[url=http://example.com]\n[http:// bare protocols don't count]",
		"parsed": "[foo][foo bar][foo <apostrophes>''</><em>bar</><apostrophes>''</>][fool's] errand[fool's errand][<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>][<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</> bar][<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</> <apostrophes>''</><em>bar</><apostrophes>''</>][<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>l's] errand[<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>l's errand][url=<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>][url=<free-extlink-protocol>http://</><free-extlink>example.com</>][http:// bare protocols don't count]"
	},
	{
		"desc": "Percent encoding in external links",
		"wikitext": "[https://github.com/search?l=&q=ResourceLoader+%40wikimedia Search]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>github.com/search?l=&amp;q=ResourceLoader+%40wikimedia</><link-ground extlink-text> Search</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Use url link syntax for links where the content is equal the link target",
		"wikitext": "http://example.com",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</>"
	},
	{
		"desc": "Parenthesis in external links, especially URL links",
		"wikitext": "http://example.com)\n\nhttp://example.com/test)\n\nhttp://example.com/(test)\n\nhttp://example.com/((test)\n\n(http://example.com/(test))\n\n(http://example.com/(test)))))\n\nhttp://example.com/a)b\n\n[http://example.com) foo]",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</>)<free-extlink-protocol>http://</><free-extlink>example.com/test</>)<free-extlink-protocol>http://</><free-extlink>example.com/(test)</><free-extlink-protocol>http://</><free-extlink>example.com/((test)</>(<free-extlink-protocol>http://</><free-extlink>example.com/(test))</>(<free-extlink-protocol>http://</><free-extlink>example.com/(test)))))</><free-extlink-protocol>http://</><free-extlink>example.com/a)b</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com)</><link-ground extlink-text> foo</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Parenthesis in external links, w/ transclusion or comment",
		"wikitext": "(http://example.com/{{1x|hi}})\n\n(http://example.com<!-- hi -->)",
		"parsed": "(<free-extlink-protocol>http://</><free-extlink>example.com/</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground template-bracket>}}</>)(<free-extlink-protocol>http://</><free-extlink>example.com</><comment>&lt;!-- hi --&gt</>)"
	},
	{
		"desc": "mw:ExtLink linking to a interwiki URL can be round-tripped losslessly (T94723)",
		"wikitext": "[http://en.wikipedia.org/wiki/European_Robin European Robin]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>en.wikipedia.org/wiki/European_Robin</><link-ground extlink-text> European Robin</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Parsoid extlink with _blank target",
		"wikitext": "[https://www.example.com]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>www.example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Parsoid extlink with _self target",
		"wikitext": "[https://www.example.com]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>www.example.com</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Extlink in square brackets with entity",
		"wikitext": "[&nbsp;[http://test.com 123]&nbsp;]\n\n[http://test.com [123]",
		"parsed": "[<entity>&amp;nbsp;</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>test.com</><link-ground extlink-text> 123</><link-ground extlink-bracket>]</><entity>&amp;nbsp;</>]<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>test.com</><link-ground extlink-text> [123</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "fragmentModes"
	},
	{
		"desc": "Legacy fragment encoding",
		"wikitext": "<ref name=\"nature%20phylo\">A</ref>\n<ref name=\"Mininova%2E26%2E11%2E2009\">B</ref>\n<ref name=\"%c8%98tiri_2019\">C</ref>\n<ref name=\"play%21\">D</ref>\n<ref name=\"Terry+O%26rsquo%3BN…</ref\">E</ref>\n<ref name=\"9&nbsp;pm\">F</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"nature%20phylo\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"Mininova%2E26%2E11%2E2009\"</><exttag-bracket>&gt</><tag-ref>B</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"%c8%98tiri_2019\"</><exttag-bracket>&gt</><tag-ref>C</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"play%21\"</><exttag-bracket>&gt</><tag-ref>D</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"Terry+O%26rsquo%3BN…&lt;/ref\"</><exttag-bracket>&gt</><tag-ref>E</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"9&amp;nbsp;pm\"</><exttag-bracket>&gt</><tag-ref>F</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T298278: Collection of test cases in HTML5 mode",
		"wikitext": "<ref name=\"nature%20phylo\">A</ref>\n<ref name=\"Mininova%2E26%2E11%2E2009\">B</ref>\n<ref name=\"%c8%98tiri_2019\">C</ref>\n<ref name=\"play%21\">D</ref>\n<ref name=\"Terry+O%26rsquo%3BN…</ref\">E</ref>\n<ref name=\"9&nbsp;pm\">F</ref>\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"nature%20phylo\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"Mininova%2E26%2E11%2E2009\"</><exttag-bracket>&gt</><tag-ref>B</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"%c8%98tiri_2019\"</><exttag-bracket>&gt</><tag-ref>C</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"play%21\"</><exttag-bracket>&gt</><tag-ref>D</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"Terry+O%26rsquo%3BN…&lt;/ref\"</><exttag-bracket>&gt</><tag-ref>E</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"9&amp;nbsp;pm\"</><exttag-bracket>&gt</><tag-ref>F</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "URL encoded strings accidentally copy-pasted in legacy mode",
		"wikitext": "<ref name=\"n%25%32%30n\" group=\"g%25%32%30g\">A</ref>\n<references group=\"g%25%32%30g\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"n%25%32%30n\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"g%25%32%30g\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g%25%32%30g\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "T298278: URL encoded strings accidentally copy-pasted in HTML5 mode",
		"wikitext": "<ref name=\"n%25%32%30n\" group=\"g%25%32%30g\">A</ref>\n<references group=\"g%25%32%30g\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"n%25%32%30n\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"g%25%32%30g\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"g%25%32%30g\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple, partly encoded spaces in legacy mode",
		"wikitext": "<ref name=\"a_ %20a\" group=\"b_ %20b\">A</ref>\n<references group=\"b_ %20b\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a_ %20a\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"b_ %20b\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"b_ %20b\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Multiple, partly encoded spaces in HTML5 mode",
		"wikitext": "<ref name=\"a_ %20a\" group=\"b_ %20b\">A</ref>\n<references group=\"b_ %20b\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref </><exttag-attribute ext-ref>name=</><exttag-attribute-value>\"a_ %20a\"</><exttag-attribute ext-ref> group=</><exttag-attribute-value>\"b_ %20b\"</><exttag-bracket>&gt</><tag-ref>A</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt&lt;</><exttag-name>references </><exttag-attribute ext-references>group=</><exttag-attribute-value>\"b_ %20b\"</><exttag-attribute ext-references> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "funcsParserTests"
	},
	{
		"desc": "Input times are UTC, not local time",
		"wikitext": "{{#time:c|15 January 2001}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>c</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>15 January 2001</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Time test in traditional range...",
		"wikitext": "{{#time:Y|15 January 2001}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>15 January 2001</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Time test prior to 1970 Unix creation myth",
		"wikitext": "{{#time:Y|5 April 1967}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>5 April 1967</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Time test after the 2038 32-bit Apocalype",
		"wikitext": "{{#time:Y|28 July 2061}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>28 July 2061</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: UTC",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 UTC }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y-m-d H:i</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 2011-11-12 23:00 UTC </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: Europe/Paris (UTC+1)",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 Europe/Paris }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y-m-d H:i</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 2011-11-12 23:00 Europe/Paris </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Explicitly specified timezone: America/New_York (UTC-5)",
		"wikitext": "{{#time:Y-m-d H:i| 2011-11-12 23:00 America/New_York }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Y-m-d H:i</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 2011-11-12 23:00 America/New_York </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Explicitely specified output language (Dutch)",
		"wikitext": "{{#time:d F Y|1988-02-28|nl}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#time</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>d F Y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1988-02-28</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>nl</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#titleparts",
		"wikitext": "{{#titleparts:A/b/c/d}}\n{{#titleparts:A/b/c/d|1}}\n{{#titleparts:A/b/c/d|2}}\n{{#titleparts:A/b/c/d|-3}}\n{{#titleparts:A/b/c/d||1}}\n{{#titleparts:A/b/c/d||2}}\n{{#titleparts:A/b/c/d||-2}}\n{{#titleparts:A/b/c/d|1|1}}\n{{#titleparts:A/b/c/d|1|2}}\n{{#titleparts:A/b/c/d|1|-2}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>-3</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction>-2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>-2</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#titleparts stops splitting after 25 parts",
		"wikitext": "{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|24}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|25}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!|-1}}\n{{#titleparts:A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!||-1}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>24</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>25</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>-1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#titleparts</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>A/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/!/!/!</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction>-1</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Zero parameters in #if and such",
		"wikitext": "[{{#ifexpr:}},{{#if:}},{{#ifeq:}},{{#switch:}},{{#ifexist:}}]",
		"parsed": "[<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}</>]"
	},
	{
		"desc": "Empty condition in #if and such",
		"wikitext": "Empty ifexpr is {{#ifexpr:|true|false}}\nEmpty if is {{#if:|true|false}}\nEmpty ifeq is {{#ifeq:||equal|not equal}}\nEmpty switch is {{#switch:|=empty|#default=something else}}\nEmpty ifexist is {{#ifexist:|true|false}}",
		"parsed": "Empty ifexpr is <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>true</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>false</><ext-ground parserfunction-bracket>}}</>Empty if is <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>true</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>false</><ext-ground parserfunction-bracket>}}</>Empty ifeq is <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:||</><ext-ground parserfunction>equal</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>not equal</><ext-ground parserfunction-bracket>}}</>Empty switch is <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:|</><ext-ground template-argument-name>=</><ext-ground parserfunction>empty</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>#default=</><ext-ground parserfunction>something else</><ext-ground parserfunction-bracket>}}</>Empty ifexist is <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>true</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>false</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Missing or all-empty outputs",
		"wikitext": "[{{#ifexpr: 1}},{{#ifexpr: 1|}},{{#ifexpr: 1||}}]\n[{{#if: 1}},{{#if: 1|}},{{#if: 1||}}]\n[{{#ifeq: 1|1}},{{#ifeq: 1|1|}},{{#ifeq: 1|1||}}]\n[{{#switch: 1}},{{#switch: 1|}}]\n[{{#ifexist: ParserFunctions page}},{{#ifexist: ParserFunctions page|}},{{#ifexist: ParserFunctions page||}}]",
		"parsed": "[<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction-bracket>}}</>][<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction-bracket>}}</>][<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction-bracket>}}</>][<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction-bracket>}}</>][<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> ParserFunctions page</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> ParserFunctions page</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction-bracket>}}</>,<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> ParserFunctions page</><ext-ground parserfunction-delimiter>||</><ext-ground parserfunction-bracket>}}</>]"
	},
	{
		"desc": "Preserve tags in #switch default value",
		"wikitext": "{{#switch:a|b|<div>c</div>}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>a</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>b</><ext-ground parserfunction-delimiter>|</><ext-ground htmltag-bracket>&lt;</><ext-ground htmltag-name>div</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>c</><ext-ground htmltag-bracket>&lt;/</><ext-ground htmltag-name>div</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Bug 19093: Default values don't fall through in switch",
		"wikitext": "<{{#switch: foo | bar | #default = DEF }}>\n<{{#switch: foo | #default | bar = DEF }}>",
		"parsed": "<<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> bar </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> #default =</><ext-ground parserfunction> DEF </><ext-ground parserfunction-bracket>}}</>><<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> #default </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> bar =</><ext-ground parserfunction> DEF </><ext-ground parserfunction-bracket>}}</>>"
	},
	{
		"desc": "{{#ifexist}}",
		"wikitext": "{{#ifexist:Media:Foobar.jpg|Found|Not found}}\n{{#ifexist:ParserFunctions page|Found|Not found}}\n{{#ifexist:Missing|Found|Not found}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Media:Foobar.jpg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ParserFunctions page</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Missing</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "{{#ifexist:}} media redirect (bug 32031)",
		"wikitext": "{{#ifexist:Media:Redirect_to_Foobar.jpg|Found|Not found}}\n{{#ifexist:Media:Redirect_to_nowhere.jpg|Found|Not found}}\n{{#ifexist:Media:Missing file.jpg|Found|Not found}}\n{{#ifexist:Media:Dionysos-Brunnen am Kölner Dom.jpg|Found|Not found}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Media:Redirect_to_Foobar.jpg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Media:Redirect_to_nowhere.jpg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Media:Missing file.jpg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexist</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Media:Dionysos-Brunnen am Kölner Dom.jpg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Found</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Not found</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#if",
		"wikitext": "{{#if: | yes | no}}\n{{#if: string | yes | no}}\n{{#if:      | yes | no}}\n{{#if:\n\n\n| yes | no}}\n{{#if: 1==2 | yes | no}}\n{{#if: foo | yes }}\n{{#if: | yes }}(empty)\n{{#if: foo | | no}}(empty)\n{{#if: {{{1}}} | yes | no}}\n{{#if: {{{1|}}} | yes | no}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> string </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>      </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1==2 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-bracket>}}</>(empty)<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}</>(empty)<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-ground templatevariable-bracket>{{{</><ext-ground templatevariable-name>1</><ext-ground templatevariable-bracket>}}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-ground templatevariable-bracket>{{{</><ext-ground templatevariable-name>1</><ext-ground templatevariable-delimiter>|</><ext-ground templatevariable-bracket>}}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#ifeq",
		"wikitext": "{{#ifeq: 01 | 1 | yes | no}}\n{{#ifeq: 0 | -0 | yes | no}}\n{{#ifeq: foo | bar | yes | no}}\n{{#ifeq: foo | Foo | yes | no}}\n{{#ifeq: \"01\" | \"1\" | yes | no}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 01 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 1 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> -0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> bar </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> Foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> \"01\" </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> \"1\" </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#ifeq entities",
		"wikitext": "{{#ifeq: {{PAGENAME:*foo&bar}} | *foo&bar | yes | no}}\n{{#ifeq: a'b | a&#39;b | yes | no}}\n{{#ifeq: a'b | a&amp;#39;b | yes | no}}\n{{#ifeq: foo | Foo | *yes | *no}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction>*foo&amp;bar</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> *foo&amp;bar </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> a'b </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> a</><ext-ground entity>&amp;#39;</><ext-ground parserfunction>b </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> a'b </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> a</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>#39;b </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> Foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> *yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> *no</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#iferror",
		"wikitext": "{{#iferror: {{#expr: 1 + 2 }} | error | correct }}\n{{#iferror: {{#expr: 1 + X }} | error | correct }}\n{{#iferror: {{#expr: 1 + 2 }} | error }}\n{{#iferror: {{#expr: 1 + X }} | error }}\n{{#iferror: {{#expr: 1 + 2 }} }}\n{{#iferror: {{#expr: 1 + X }} }}empty",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + 2 </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> error </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> correct </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + X </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> error </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> correct </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + 2 </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> error </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + X </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> error </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + 2 </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#iferror</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> 1 + X </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-bracket>}}</>empty"
	},
	{
		"desc": "#ifexpr",
		"wikitext": "{{#ifexpr: | yes | no}}\n{{#ifexpr: 1 > 0 | yes }}\n{{#ifexpr: 1 < 0 | yes }}empty\n{{#ifexpr: 1 > 0 | | no}}empty\n{{#ifexpr: 1 < 0 | | no}}\n{{#ifexpr: 1 > 0 }}empty",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 &gt 0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 &lt; 0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> yes </><ext-ground parserfunction-bracket>}}</>empty<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 &gt 0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}</>empty<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 &lt; 0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 &gt 0 </><ext-ground parserfunction-bracket>}}</>empty"
	},
	{
		"desc": "Bug 22866: #ifexpr should evaluate \"-0\" as false",
		"wikitext": "{{#ifexpr: (-1)*0 | true | false }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifexpr</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> (-1)*0 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> true </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> false </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Templates: Parser functions don't strip whitespace from positional parameters",
		"wikitext": "{{#if: {{foo}}\n| no-pre-then\n| no-pre-else\n}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><template-ext-ground template-bracket>{{</><template-ext-ground template-name pagename>foo</><template-ext-ground template-bracket>}}</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no-pre-then</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no-pre-else</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#switch",
		"wikitext": "{{#switch:foo&bar|foo&amp;bar=yes|no}}\n{{#switch:foo&bar|fred=1|foo&amp;bar|g=yes|no}}\n{{#switch:foo&bar|fred=1|foo&amp;&#39;bar|g=yes|no}}\n{{#switch:foo|bar|baz=no|*default}}\n{{#switch:none|foo=1|bar=2|#default=no match|baz=3}}\n{{#switch:none|foo=1|bar=2|#default=ignored|baz=3|Second default}}\n{{#switch:|a&amp;#39;b}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo&amp;bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>foo&amp;amp;bar=</><ext-ground parserfunction>yes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo&amp;bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>fred=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>foo</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>g=</><ext-ground parserfunction>yes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo&amp;bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>fred=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>foo</><ext-ground entity>&amp;amp;&amp;#39;</><ext-ground parserfunction>bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>g=</><ext-ground parserfunction>yes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>bar</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>baz=</><ext-ground parserfunction>no</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>*default</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>none</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>foo=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>bar=</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>#default=</><ext-ground parserfunction>no match</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>baz=</><ext-ground parserfunction>3</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>none</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>foo=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>bar=</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>#default=</><ext-ground parserfunction>ignored</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>baz=</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Second default</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:|</><ext-ground parserfunction>a</><ext-ground entity>&amp;amp;</><ext-ground parserfunction>#39;b</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#switch #default should match next and not last named parameter",
		"wikitext": "<{{#switch: foo | #default | bar = DEF }}>\n<{{#switch: foo | #default | bar = DEF | baz = GHI }}>",
		"parsed": "<<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> #default </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> bar =</><ext-ground parserfunction> DEF </><ext-ground parserfunction-bracket>}}</>><<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> #default </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> bar =</><ext-ground parserfunction> DEF </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> baz =</><ext-ground parserfunction> GHI </><ext-ground parserfunction-bracket>}}</>>"
	},
	{
		"desc": "#switch should not match #default as a prefix",
		"wikitext": "<{{#switch: foo | #defaultWTF? = This is crazy }}>\n<{{#switch: foo | #defaultWTF? | bar = This is crazy }}>",
		"parsed": "<<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> #defaultWTF? =</><ext-ground parserfunction> This is crazy </><ext-ground parserfunction-bracket>}}</>><<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> #defaultWTF? </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> bar =</><ext-ground parserfunction> This is crazy </><ext-ground parserfunction-bracket>}}</>>"
	},
	{
		"desc": "#switch Test php truthy",
		"wikitext": "{{#switch: 01 | 1 = yes | no}}\n{{#switch: 0 | -0 = yes | no}}\n{{#switch: foo | bar = yes | no}}\n{{#switch: foo | Foo = yes | no}}\n{{#switch: \"01\" | \"1\" = yes | no}}\n{{#switch: 1 | 02 | 01 = yes | no}}\n{{#switch: 1 | \"01\" | \"1\" = yes | no}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 01 </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> 1 =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 0 </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> -0 =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> bar =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> foo </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> Foo =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> \"01\" </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> \"1\" =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 02 </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> 01 =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#switch</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> 1 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> \"01\" </><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name> \"1\" =</><ext-ground parserfunction> yes </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> no</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "headings"
	},
	{
		"desc": "Basic test",
		"wikitext": "==h1==\n===h1.1===\n==h2==\n===h2.1===\n====h2.1.1====\n===h2.2===\n====h2.2.1====\n====h2.2.2====\n==h3==",
		"parsed": "<section-header section--2>==</><section>h1</><section-header>==</><section-header section--3>===</><section>h1.1</><section-header>===</><section-header section--2>==</><section>h2</><section-header>==</><section-header section--3>===</><section>h2.1</><section-header>===</><section-header section--4>====</><section>h2.1.1</><section-header>====</><section-header section--3>===</><section>h2.2</><section-header>===</><section-header section--4>====</><section>h2.2.1</><section-header>====</><section-header section--4>====</><section>h2.2.2</><section-header>====</><section-header section--2>==</><section>h3</><section-header>==</>"
	},
	{
		"desc": "HTML headings should get TOC entries with some empty properties",
		"wikitext": "==a==\n<h2>b</h2>\n<h3>c</h3>\n===d===\n<h2>e</h2>",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt&lt;</><htmltag-name>h3</><htmltag-bracket>&gt</>c<htmltag-bracket>&lt;/</><htmltag-name>h3</><htmltag-bracket>&gt</><section-header section--3>===</><section>d</><section-header>===</><htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>e<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Literal html heading from template",
		"wikitext": "{{1x|\n<h2>hi</h2>\nho\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>h2</><template-ground htmltag-bracket>&gt</><template-ground template>hi</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>h2</><template-ground htmltag-bracket>&gt</><template-ground template>ho</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Duplicate headings should get unique anchors",
		"wikitext": "==a==\n==a==\n==b==",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><section-header section--2>==</><section>a</><section-header>==</><section-header section--2>==</><section>b</><section-header>==</>"
	},
	{
		"desc": "Templated sections (heading from template content)",
		"wikitext": "==a==\n{{Test}}",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><template-ground template-bracket>{{</><template-ground template-name pagename>Test</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Ensure headings with html tags get the right anchors",
		"wikitext": "==<span>x</span>==\n==<strike>y</strike>==",
		"parsed": "<section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><section>x</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>strike</><htmltag-bracket>&gt</><section>y</><htmltag-bracket>&lt;/</><htmltag-name>strike</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Ensure unallowed tag wrappers in headings get stripped",
		"wikitext": "==<div>b</div>==\n==<font>c</font>==",
		"parsed": "<section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><section>b</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>font</><htmltag-bracket>&gt</><section>c</><htmltag-bracket>&lt;/</><htmltag-name>font</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Ensure disallowed attributes are stripped, but dir attribute in a span is left behind",
		"wikitext": "==<span dir='ltr' title='x'>a</span>==\n==<span dir='rtl' title='x'>b</span>==\n==<i dir='rtl' title='ha'>c</i>==",
		"parsed": "<section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>dir=</><htmltag-attribute-value>'ltr'</><htmltag-attribute html-span> title=</><htmltag-attribute-value>'x'</><htmltag-bracket>&gt</><section>a</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>dir=</><htmltag-attribute-value>'rtl'</><htmltag-attribute html-span> title=</><htmltag-attribute-value>'x'</><htmltag-bracket>&gt</><section>b</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>i </><htmltag-attribute html-i>dir=</><htmltag-attribute-value>'rtl'</><htmltag-attribute html-i> title=</><htmltag-attribute-value>'ha'</><htmltag-bracket>&gt</><section>c</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Ensure empty tags are stripped",
		"wikitext": "==<span><div></div></span>x==\n==<span dir='ltr'><i dir='ltr'></i></span>y==",
		"parsed": "<section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section>x</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>dir=</><htmltag-attribute-value>'ltr'</><htmltag-bracket>&gt&lt;</><htmltag-name>i </><htmltag-attribute html-i>dir=</><htmltag-attribute-value>'ltr'</><htmltag-bracket>&gt&lt;/</><htmltag-name>i</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section>y</><section-header>==</>"
	},
	{
		"desc": "Ensure comments in toc lines are stripped",
		"wikitext": "==hi<html><!--ho--></html>==",
		"parsed": "<section-header section--2>==</><section>hi&lt;html&gt</><comment>&lt;!--ho--&gt</><section>&lt;/html&gt</><section-header>==</>"
	},
	{
		"desc": "Handle links in heading content",
		"wikitext": "==[[Cat]]==\n==[[Dog]]s==\n==[[Cat|I love my ''cat'']]==",
		"parsed": "<section-header section--2>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Cat</><link-ground link-bracket>]]</><section-header>==</><section-header section--2>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Dog</><link-ground link-bracket>]]</><section>s</><section-header>==</><section-header section--2>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Cat</><link-ground link-delimiter>|</><link-ground link-text>I love my </><link-ground apostrophes>''</><link-ground link-text em>cat</><link-ground apostrophes>''</><link-ground link-bracket>]]</><section-header>==</>"
	},
	{
		"desc": "Ensure headings with special chars get the right anchors",
		"wikitext": "===a=\n=''x''=",
		"parsed": "<section-header section--1>=</><section>==a</><section-header>=</><section-header section--1>=</><apostrophes>''</><section>x</><apostrophes>''</><section-header>=</>"
	},
	{
		"desc": "Templated sections (heading from template arg)",
		"wikitext": "==a==\n{{1x|1=\n==b==\n}}",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground section-header section--2>==</><template-ground section>b</><template-ground section-header>==</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Offsets in toc metadata should be unicode codepoints, not bytes or UCS-2",
		"wikitext": "==One 💩==\n==Two 💩==\n==Three 💩==",
		"parsed": "<section-header section--2>==</><section>One 💩</><section-header>==</><section-header section--2>==</><section>Two 💩</><section-header>==</><section-header section--2>==</><section>Three 💩</><section-header>==</>"
	},
	{
		"desc": "Handle multi-part content transclusion blocks",
		"wikitext": "<div>\n{{1x|1=\n==foo==\n</div>\n}}\n==bar==",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground section-header section--2>==</><template-ground section>foo</><template-ground section-header>==</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>div</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><section-header section--2>==</><section>bar</><section-header>==</>"
	},
	{
		"desc": "Handle parser functions generating sections",
		"wikitext": "{{#if:1|<h2>foo</h2>|unused}}\n==bar==",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#if</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground htmltag-bracket>&lt;</><ext-ground htmltag-name>h2</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction>foo</><ext-ground htmltag-bracket>&lt;/</><ext-ground htmltag-name>h2</><ext-ground htmltag-bracket>&gt</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>unused</><ext-ground parserfunction-bracket>}}</><section-header section--2>==</><section>bar</><section-header>==</>"
	},
	{
		"desc": "Handle top-level template args generating sections",
		"wikitext": "{{{foo|\n==tplarg==\n|abcd}}}",
		"parsed": "<templatevariable-bracket>{{{</><templatevariable-name>foo</><templatevariable-delimiter>|</><section-header section--2>==</><section>tplarg</><section-header>==</><templatevariable-delimiter>|</><comment>abcd</><templatevariable-bracket>}}}</>"
	},
	{
		"desc": "Basic section headings",
		"wikitext": "==Headline 1==\nSome text\n\n==Headline 2==\nMore\n===Smaller headline===\nBlah blah",
		"parsed": "<section-header section--2>==</><section>Headline 1</><section-header>==</>Some text<section-header section--2>==</><section>Headline 2</><section-header>==</>More<section-header section--3>===</><section>Smaller headline</><section-header>===</>Blah blah"
	},
	{
		"desc": "Section headings with TOC",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n=====Skipping a level=====\n======Skipping a level======\n\n==Headline 2==\nSome text\n===Another headline===",
		"parsed": "<section-header section--2>==</><section>Headline 1</><section-header>==</><section-header section--3>===</><section>Subheadline 1</><section-header>===</><section-header section--5>=====</><section>Skipping a level</><section-header>=====</><section-header section--6>======</><section>Skipping a level</><section-header>======</><section-header section--2>==</><section>Headline 2</><section-header>==</>Some text<section-header section--3>===</><section>Another headline</><section-header>===</>"
	},
	{
		"desc": "Section headings with TOC and language conversion (T295187, T306862)",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n==Headline 2==\nSome text\n===Another headline===",
		"parsed": "<section-header section--2>==</><section>Headline 1</><section-header>==</><section-header section--3>===</><section>Subheadline 1</><section-header>===</><section-header section--2>==</><section>Headline 2</><section-header>==</>Some text<section-header section--3>===</><section>Another headline</><section-header>===</>"
	},
	{
		"desc": "Section headings with TOC and language conversion disabled (T295187)",
		"wikitext": "==Headline 1==\n===Subheadline 1===\n==Headline 2==\nSome text\n===Another headline===\n__NOCONTENTCONVERT__",
		"parsed": "<section-header section--2>==</><section>Headline 1</><section-header>==</><section-header section--3>===</><section>Subheadline 1</><section-header>===</><section-header section--2>==</><section>Headline 2</><section-header>==</>Some text<section-header section--3>===</><section>Another headline</><section-header>===</><double-underscore>__NOCONTENTCONVERT__</>"
	},
	{
		"desc": "Section headings with TOC, language conversion rules, and displaytitle\n(T306862, T331316, T26072)",
		"wikitext": "<!--\n-->-{H|Foo=>en:Boo;Foo=>en-x-piglatin:Bob;}-<!--\n-->-{H|Bar=>en:Bat;Bar=>en-x-piglatin:Ball;}-<!--\n-->-{T|en:Foo;en-x-piglatin:Bar;}-<!--\n-->\nIntroduction.\n-{A|en:Do; en-x-piglatin:Re;}-\n== Foo ==\nFoo Do\n== Bar ==\nBar Re\n== -{Foo Bar}- ==",
		"parsed": "<comment>&lt;!----&gt</><convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>Foo=>en:Boo;Foo=>en-x-piglatin:Bob<convert-delimiter>;</><convert-bracket>}-</><comment>&lt;!----&gt</><convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>Bar=>en:Bat;Bar=>en-x-piglatin:Ball<convert-delimiter>;</><convert-bracket>}-</><comment>&lt;!----&gt</><convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</>en:Foo;en-x-piglatin:Bar<convert-delimiter>;</><convert-bracket>}-</><comment>&lt;!----&gt</>Introduction.<convert-bracket>-{</><convert-flag>A</><convert-delimiter>|</>en:Do; en-x-piglatin:Re<convert-delimiter>;</><convert-bracket>}-</><section-header section--2>==</><section> Foo </><section-header>==</>Foo Do<section-header section--2>==</><section> Bar </><section-header>==</>Bar Re<section-header section--2>==</><section> </><convert-bracket>-{</><section>Foo Bar</><convert-bracket>}-</><section> </><section-header>==</>"
	},
	{
		"desc": "TOC anchors don't collide",
		"wikitext": "__FORCETOC__\n==Headline 2==\n==Headline==\n==Headline 2==\n==Headline==",
		"parsed": "<double-underscore>__FORCETOC__</><section-header section--2>==</><section>Headline 2</><section-header>==</><section-header section--2>==</><section>Headline</><section-header>==</><section-header section--2>==</><section>Headline 2</><section-header>==</><section-header section--2>==</><section>Headline</><section-header>==</>"
	},
	{
		"desc": "Handling of sections up to level 6 and beyond",
		"wikitext": "=Level 1 Heading=\n==Level 2 Heading==\n===Level 3 Heading===\n====Level 4 Heading====\n=====Level 5 Heading=====\n======Level 6 Heading======\n=======Level 7 Heading=======\n========Level 8 Heading========\n=========Level 9 Heading=========\n==========Level 10 Heading==========",
		"parsed": "<section-header section--1>=</><section>Level 1 Heading</><section-header>=</><section-header section--2>==</><section>Level 2 Heading</><section-header>==</><section-header section--3>===</><section>Level 3 Heading</><section-header>===</><section-header section--4>====</><section>Level 4 Heading</><section-header>====</><section-header section--5>=====</><section>Level 5 Heading</><section-header>=====</><section-header section--6>======</><section>Level 6 Heading</><section-header>======</><section-header section--6>======</><section>=Level 7 Heading=</><section-header>======</><section-header section--6>======</><section>==Level 8 Heading==</><section-header>======</><section-header section--6>======</><section>===Level 9 Heading===</><section-header>======</><section-header section--6>======</><section>====Level 10 Heading====</><section-header>======</>"
	},
	{
		"desc": "TOC regression (T11764)",
		"wikitext": "==title 1==\n===title 1.1===\n====title 1.1.1====\n===title 1.2===\n==title 2==\n===title 2.1===",
		"parsed": "<section-header section--2>==</><section>title 1</><section-header>==</><section-header section--3>===</><section>title 1.1</><section-header>===</><section-header section--4>====</><section>title 1.1.1</><section-header>====</><section-header section--3>===</><section>title 1.2</><section-header>===</><section-header section--2>==</><section>title 2</><section-header>==</><section-header section--3>===</><section>title 2.1</><section-header>===</>"
	},
	{
		"desc": "TOC for heading containing <span id=\"...\"></span> (T96153)",
		"wikitext": "__FORCETOC__\n==<span id=\"old-anchor\"></span>New title==",
		"parsed": "<double-underscore>__FORCETOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"old-anchor\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section>New title</><section-header>==</>"
	},
	{
		"desc": "TOC with wgMaxTocLevel=3 (T8204)",
		"wikitext": "==title 1==\n===title 1.1===\n====title 1.1.1====\n===title 1.2===\n==title 2==\n===title 2.1===",
		"parsed": "<section-header section--2>==</><section>title 1</><section-header>==</><section-header section--3>===</><section>title 1.1</><section-header>===</><section-header section--4>====</><section>title 1.1.1</><section-header>====</><section-header section--3>===</><section>title 1.2</><section-header>===</><section-header section--2>==</><section>title 2</><section-header>==</><section-header section--3>===</><section>title 2.1</><section-header>===</>"
	},
	{
		"desc": "TOC with wgMaxTocLevel=3 and two level four headings (T8204)",
		"wikitext": "==Section 1==\n===Section 1.1===\n====Section 1.1.1====\n====Section 1.1.1.1====\n==Section 2==",
		"parsed": "<section-header section--2>==</><section>Section 1</><section-header>==</><section-header section--3>===</><section>Section 1.1</><section-header>===</><section-header section--4>====</><section>Section 1.1.1</><section-header>====</><section-header section--4>====</><section>Section 1.1.1.1</><section-header>====</><section-header section--2>==</><section>Section 2</><section-header>==</>"
	},
	{
		"desc": "Resolving duplicate section names",
		"wikitext": "==Foo bar==\n==Foo bar==",
		"parsed": "<section-header section--2>==</><section>Foo bar</><section-header>==</><section-header section--2>==</><section>Foo bar</><section-header>==</>"
	},
	{
		"desc": "Resolving duplicate section names with differing case (T12721)",
		"wikitext": "==Foo bar==\n==Foo Bar==",
		"parsed": "<section-header section--2>==</><section>Foo bar</><section-header>==</><section-header section--2>==</><section>Foo Bar</><section-header>==</>"
	},
	{
		"desc": "Template with sections, __NOTOC__",
		"wikitext": "__NOTOC__\n==Section 0==\n{{sections}}\n==Section 4==",
		"parsed": "<double-underscore>__NOTOC__</><section-header section--2>==</><section>Section 0</><section-header>==</><template-ground template-bracket>{{</><template-ground template-name pagename>sections</><template-ground template-bracket>}}</><section-header section--2>==</><section>Section 4</><section-header>==</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, but __FORCETOC__",
		"wikitext": "__FORCETOC__",
		"parsed": "<double-underscore>__FORCETOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, but __TOC__",
		"wikitext": "__TOC__",
		"parsed": "<double-underscore>__TOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: no sections, and __NOTOC__",
		"wikitext": "__NOTOC__",
		"parsed": "<double-underscore>__NOTOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections",
		"wikitext": "== One ==",
		"parsed": "<section-header section--2>==</><section> One </><section-header>==</>"
	},
	{
		"desc": "T352467: synthetic sections shouldn't count towards \"enough\" sections",
		"wikitext": "<div>\n==a==\n==b==\n</div>\n==c==",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><section-header section--2>==</><section>a</><section-header>==</><section-header section--2>==</><section>b</><section-header>==</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><section-header section--2>==</><section>c</><section-header>==</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, but __FORCETOC__",
		"wikitext": "__FORCETOC__\n== One ==",
		"parsed": "<double-underscore>__FORCETOC__</><section-header section--2>==</><section> One </><section-header>==</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, but __TOC__",
		"wikitext": "== One ==\n__TOC__",
		"parsed": "<section-header section--2>==</><section> One </><section-header>==</><double-underscore>__TOC__</>"
	},
	{
		"desc": "T307691: show-toc flag: not \"enough\" sections, and __NOTOC__",
		"wikitext": "__NOTOC__\n== One ==",
		"parsed": "<double-underscore>__NOTOC__</><section-header section--2>==</><section> One </><section-header>==</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections",
		"wikitext": "== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<section-header section--2>==</><section> One </><section-header>==</><section-header section--3>===</><section> Two </><section-header>===</><section-header section--2>==</><section> Three </><section-header>==</><section-header section--3>===</><section> Four </><section-header>===</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections and __FORCETOC__",
		"wikitext": "__FORCETOC__\n== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<double-underscore>__FORCETOC__</><section-header section--2>==</><section> One </><section-header>==</><section-header section--3>===</><section> Two </><section-header>===</><section-header section--2>==</><section> Three </><section-header>==</><section-header section--3>===</><section> Four </><section-header>===</>"
	},
	{
		"desc": "T307691: show-toc flag: \"enough\" sections and __NOTOC__",
		"wikitext": "__NOTOC__\n== One ==\n=== Two ===\n== Three ==\n=== Four ===",
		"parsed": "<double-underscore>__NOTOC__</><section-header section--2>==</><section> One </><section-header>==</><section-header section--3>===</><section> Two </><section-header>===</><section-header section--2>==</><section> Three </><section-header>==</><section-header section--3>===</><section> Four </><section-header>===</>"
	},
	{
		"desc": "__NOEDITSECTION__ keyword",
		"wikitext": "__NOEDITSECTION__\n==Section 1==\n==Section 2==",
		"parsed": "<double-underscore>__NOEDITSECTION__</><section-header section--2>==</><section>Section 1</><section-header>==</><section-header section--2>==</><section>Section 2</><section-header>==</>"
	},
	{
		"desc": "Link inside a section heading",
		"wikitext": "==Section with a [[Main Page|link]] in it==",
		"parsed": "<section-header section--2>==</><section>Section with a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>link</><link-ground link-bracket>]]</><section> in it</><section-header>==</>"
	},
	{
		"desc": "TOC regression (T14077)",
		"wikitext": "__TOC__\n==title 1==\n===title 1.1===\n==title 2==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>title 1</><section-header>==</><section-header section--3>===</><section>title 1.1</><section-header>===</><section-header section--2>==</><section>title 2</><section-header>==</>"
	},
	{
		"desc": "__FORCETOC__ override",
		"wikitext": "__NEWSECTIONLINK__\n__FORCETOC__",
		"parsed": "<double-underscore>__NEWSECTIONLINK____FORCETOC__</>"
	},
	{
		"desc": "T28375: TOC with italics",
		"wikitext": "__TOC__\n==''Lost'' episodes==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><apostrophes>''</><section>Lost</><apostrophes>''</><section> episodes</><section-header>==</>"
	},
	{
		"desc": "T28375: TOC with bold",
		"wikitext": "__TOC__\n=='''should be bold''' then normal text==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><apostrophes>'''</><section>should be bold</><apostrophes>'''</><section> then normal text</><section-header>==</>"
	},
	{
		"desc": "T35845: Headings become cursive in TOC when they contain an image",
		"wikitext": "__TOC__\n==Image [[Image:foobar.jpg]]==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>Image </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-bracket>]]</><section-header>==</>"
	},
	{
		"desc": "T35845 (2): Headings become bold in TOC when they contain a blockquote",
		"wikitext": "__TOC__\n==<blockquote>Quote</blockquote>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><section>Quote</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Unclosed tags in TOC",
		"wikitext": "__TOC__\n==Proof: 2 < 3==\n<small>Hanc marginis exiguitas non caperet.</small>\nQED",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>Proof: 2 &lt; 3</><section-header>==</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</>Hanc marginis exiguitas non caperet.<htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>QED"
	},
	{
		"desc": "Multiple tags in TOC",
		"wikitext": "__TOC__\n==<i>Foo</i> <b>Bar</b>==\n\n==<i>Foo</i> <blockquote>Bar</blockquote>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</><section>Foo</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><section> </><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</><section>Bar</><htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</><section>Foo</><htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><section> </><htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><section>Bar</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "Tags with parameters in TOC",
		"wikitext": "__TOC__\n==<sup class=\"in-h2\">Hello</sup>==\n\n==<sup class=\"a > b\">Evilbye</sup>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>sup </><htmltag-attribute html-sup>class=</><htmltag-attribute-value>\"in-h2\"</><htmltag-bracket>&gt</><section>Hello</><htmltag-bracket>&lt;/</><htmltag-name>sup</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>sup </><htmltag-attribute html-sup>class=</><htmltag-attribute-value>\"a </><htmltag-bracket>&gt</><section> b\"&gtEvilbye</><htmltag-bracket>&lt;/</><htmltag-name>sup</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "span tags with directionality in TOC",
		"wikitext": "__TOC__\n==<span dir=\"ltr\">C++</span>==\n\n==<span dir=\"rtl\">זבנג!</span>==\n\n==<span style=\"font-style: italic\" dir=\"ltr\" title=\"hello\">Attributes other than dir</span>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>dir=</><htmltag-attribute-value>\"ltr\"</><htmltag-bracket>&gt</><section>C++</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>dir=</><htmltag-attribute-value>\"rtl\"</><htmltag-bracket>&gt</><section>זבנג!</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>style=</><htmltag-attribute-value>\"font-style: italic\"</><htmltag-attribute html-span> dir=</><htmltag-attribute-value>\"ltr\"</><htmltag-attribute html-span> title=</><htmltag-attribute-value>\"hello\"</><htmltag-bracket>&gt</><section>Attributes other than dir</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "T74884: bdi element in ToC",
		"wikitext": "__TOC__\n==<bdi>test</bdi>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>bdi</><htmltag-bracket>&gt</><section>test</><htmltag-bracket>&lt;/</><htmltag-name>bdi</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "T35715: s/strike element in ToC",
		"wikitext": "__TOC__\n==<s>test</s> test <strike>test</strike>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt</><section>test</><htmltag-bracket>&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</><section> test </><htmltag-bracket>&lt;</><htmltag-name>strike</><htmltag-bracket>&gt</><section>test</><htmltag-bracket>&lt;/</><htmltag-name>strike</><htmltag-bracket>&gt</><section-header>==</>"
	},
	{
		"desc": "T198618: style element in ToC",
		"wikitext": "__TOC__\n==<style>.foo {}</style>Style<style>.bar {}</style>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>&lt;style&gt.foo {}&lt;/style&gtStyle&lt;style&gt.bar {}&lt;/style&gt</><section-header>==</>"
	},
	{
		"desc": "T198618: script element in ToC",
		"wikitext": "__TOC__\n==<html><script>alert(1);</script></html>Script<html><script>alert(1);</script></html>==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>&lt;html&gt&lt;script&gtalert(1);&lt;/script&gt&lt;/html&gtScript&lt;html&gt&lt;script&gtalert(1);&lt;/script&gt&lt;/html&gt</><section-header>==</>"
	},
	{
		"desc": "Empty <p> tag in TOC, removed by Sanitizer (T92892)",
		"wikitext": "__TOC__\n==x==",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section>x</><section-header>==</>"
	},
	{
		"desc": "Disable TOC",
		"wikitext": "Lead\n==Section 1==\n==Section 2==\n==Section 3==\n==Section 4==\n==Section 5==",
		"parsed": "Lead<section-header section--2>==</><section>Section 1</><section-header>==</><section-header section--2>==</><section>Section 2</><section-header>==</><section-header section--2>==</><section>Section 3</><section-header>==</><section-header section--2>==</><section>Section 4</><section-header>==</><section-header section--2>==</><section>Section 5</><section-header>==</>"
	},
	{
		"desc": "Short headings with trailing space should match behavior of Parser::doHeadings (T21910)",
		"wikitext": "=== \nThe line above must have a trailing space!\n=== <!--\n--> <!-- -->\nBut just in case it doesn't...",
		"parsed": "<section-header section--1>=</><section>=</><section-header>= </>The line above must have a trailing space!<section-header section--1>=</><section>=</><section-header>= </><comment>&lt;!----&gt</> <comment>&lt;!-- --&gt</>But just in case it doesn't..."
	},
	{
		"desc": "Header with special characters (T27462)",
		"wikitext": "The tooltips shall not show entities to the user (ie. be double escaped)\n\n==text > text==\nsection 1\n\n==text < text==\nsection 2\n\n==text & text==\nsection 3\n\n==text ' text==\nsection 4\n\n==text \" text==\nsection 5",
		"parsed": "The tooltips shall not show entities to the user (ie. be double escaped)<section-header section--2>==</><section>text &gt text</><section-header>==</>section 1<section-header section--2>==</><section>text &lt; text</><section-header>==</>section 2<section-header section--2>==</><section>text &amp; text</><section-header>==</>section 3<section-header section--2>==</><section>text ' text</><section-header>==</>section 4<section-header section--2>==</><section>text \" text</><section-header>==</>section 5"
	},
	{
		"desc": "Header with space, plus and underscore as entity",
		"wikitext": "Id should not contain + for spaces\n\n==Space between Text==\nsection 1\n\n==Space-Entity&#32;between&#32;Text==\nsection 2\n\n==Plus+between+Text==\nsection 3\n\n==Plus-Entity&#43;between&#43;Text==\nsection 4\n\n==Underscore_between_Text==\nsection 5\n\n==Underscore-Entity&#95;between&#95;Text==\nsection 6\n\n[[#Space between Text]]\n[[#Space-Entity&#32;between&#32;Text]]\n[[#Plus+between+Text]]\n[[#Plus-Entity&#43;between&#43;Text]]\n[[#Underscore_between_Text]]\n[[#Underscore-Entity&#95;between&#95;Text]]",
		"parsed": "Id should not contain + for spaces<section-header section--2>==</><section>Space between Text</><section-header>==</>section 1<section-header section--2>==</><section>Space-Entity</><entity>&amp;#32;</><section>between</><entity>&amp;#32;</><section>Text</><section-header>==</>section 2<section-header section--2>==</><section>Plus+between+Text</><section-header>==</>section 3<section-header section--2>==</><section>Plus-Entity</><entity>&amp;#43;</><section>between</><entity>&amp;#43;</><section>Text</><section-header>==</>section 4<section-header section--2>==</><section>Underscore_between_Text</><section-header>==</>section 5<section-header section--2>==</><section>Underscore-Entity</><entity>&amp;#95;</><section>between</><entity>&amp;#95;</><section>Text</><section-header>==</>section 6<link-ground link-bracket>[[</><link-ground link-tosection>#Space between Text</><link-ground link-bracket>]][[</><link-ground link-tosection>#Space-Entity&amp;#32;between&amp;#32;Text</><link-ground link-bracket>]][[</><link-ground link-tosection>#Plus+between+Text</><link-ground link-bracket>]][[</><link-ground link-tosection>#Plus-Entity&amp;#43;between&amp;#43;Text</><link-ground link-bracket>]][[</><link-ground link-tosection>#Underscore_between_Text</><link-ground link-bracket>]][[</><link-ground link-tosection>#Underscore-Entity&amp;#95;between&amp;#95;Text</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Headers with excess '=' characters\n(Are similar tests necessary beyond the 1st level?)",
		"wikitext": "=foo==\n==foo=\n=''italic'' heading==\n==''italic'' heading=",
		"parsed": "<section-header section--1>=</><section>foo=</><section-header>=</><section-header section--1>=</><section>=foo</><section-header>=</><section-header section--1>=</><apostrophes>''</><section>italic</><apostrophes>''</><section> heading=</><section-header>=</><section-header section--1>=</><section>=</><apostrophes>''</><section>italic</><apostrophes>''</><section> heading</><section-header>=</>"
	},
	{
		"desc": "HTML headers vs TOC (T25393)\n(__NOEDITSECTION__ for clearer output, doesn't matter here)",
		"wikitext": "<h1>Header 1</h1>\n==Header 1.1==\n==Header 1.2==\n\n<h1>Header 2\n</h1>\n==Header 2.1==\n==Header 2.2==\n__NOEDITSECTION__",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>h1</><htmltag-bracket>&gt</>Header 1<htmltag-bracket>&lt;/</><htmltag-name>h1</><htmltag-bracket>&gt</><section-header section--2>==</><section>Header 1.1</><section-header>==</><section-header section--2>==</><section>Header 1.2</><section-header>==</><htmltag-bracket>&lt;</><htmltag-name>h1</><htmltag-bracket>&gt</>Header 2<htmltag-bracket>&lt;/</><htmltag-name>h1</><htmltag-bracket>&gt</><section-header section--2>==</><section>Header 2.1</><section-header>==</><section-header section--2>==</><section>Header 2.2</><section-header>==</><double-underscore>__NOEDITSECTION__</>"
	},
	{
		"desc": "Out-of-order TOC heading levels",
		"wikitext": "==2==\n======6======\n===3===\n=1=\n=====5=====\n==2==",
		"parsed": "<section-header section--2>==</><section>2</><section-header>==</><section-header section--6>======</><section>6</><section-header>======</><section-header section--3>===</><section>3</><section-header>===</><section-header section--1>=</><section>1</><section-header>=</><section-header section--5>=====</><section>5</><section-header>=====</><section-header section--2>==</><section>2</><section-header>==</>"
	},
	{
		"desc": "TOC with HTML entities which are not wikitext entities (T355386)",
		"wikitext": "__TOC__\n== F&GT ==\nTest",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section> F&amp;GT </><section-header>==</>Test"
	},
	{
		"desc": "TOC with french spacing (T324763)",
		"wikitext": "__TOC__\n== Renommer la page « Informatique durable » en « Numérique responsable » ? ==\nOui.",
		"parsed": "<double-underscore>__TOC__</><section-header section--2>==</><section> Renommer la page « Informatique durable » en « Numérique responsable » ? </><section-header>==</>Oui."
	},
	{
		"desc": "TOC data when heading content is equal to an id already set on the page",
		"wikitext": "<span id=\"hiho\">hiho</span>\n=== hiho ===",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"hiho\"</><htmltag-bracket>&gt</>hiho<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><section-header section--3>===</><section> hiho </><section-header>===</>"
	},
	{
		"desc": "TOC data when heading already has an id",
		"wikitext": "<h3 id=\"asdf\">odd</h3>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>h3 </><htmltag-attribute html-h3>id=</><htmltag-attribute-value>\"asdf\"</><htmltag-bracket>&gt</>odd<htmltag-bracket>&lt;/</><htmltag-name>h3</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Extra newlines followed by heading",
		"wikitext": "a\n\n\n=b=\n[[a]]\n\n\n=b=",
		"parsed": "a<section-header section--1>=</><section>b</><section-header>=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>a</><link-ground link-bracket>]]</><section-header section--1>=</><section>b</><section-header>=</>"
	},
	{
		"desc": "Extra newlines between heading and content are swallowed (Parsoid does not)",
		"wikitext": "=b=\n\n\n\n[[a]]",
		"parsed": "<section-header section--1>=</><section>b</><section-header>=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>a</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Heading with line break in nowiki",
		"wikitext": "==A <nowiki>B\nC</nowiki>==",
		"parsed": "==A <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>BC</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>=="
	},
	{
		"desc": "Heading with nonbreaking space in prefix/suffix (T235684)",
		"wikitext": "== &nbsp; A &nbsp; B &nbsp; ==",
		"parsed": "<section-header section--2>==</><section> </><entity>&amp;nbsp;</><section> A </><entity>&amp;nbsp;</><section> B </><entity>&amp;nbsp;</><section> </><section-header>==</>"
	},
	{
		"desc": "Heading with literal wikitext - the wikitext is not parsed in section edit link tooltip",
		"wikitext": "== <nowiki>{{PAGENAME}}</nowiki> ==\n== &#123;&#123;PAGENAME}} ==",
		"parsed": "<section-header section--2>==</><section> </><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>{{PAGENAME}}</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section> </><section-header>==</><section-header section--2>==</><section> </><entity>&amp;#123;&amp;#123;</><section>PAGENAME}} </><section-header>==</>"
	},
	{
		"desc": "T8563: Edit link generation for section shown by <includeonly>",
		"wikitext": "{{includeonly section}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>includeonly section</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T8563: Edit link generation for section suppressed by <includeonly>",
		"wikitext": "<includeonly>\n==Includeonly section==\n</includeonly>\n==Section 1==",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly section-header section--2>==</><tag-includeonly section>Includeonly section</><tag-includeonly section-header>==</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><section-header section--2>==</><section>Section 1</><section-header>==</>"
	},
	{
		"desc": "Fuzz testing: Parser14",
		"wikitext": "==onmouseover===\nhttp://__TOC__",
		"parsed": "<section-header section--2>==</><section>onmouseover=</><section-header>==</><free-extlink-protocol>http://</><free-extlink>__TOC__</>"
	},
	{
		"desc": "Fuzz testing: Parser14-table",
		"wikitext": "==a==\n{| STYLE=__TOC__",
		"parsed": "<section-header section--2>==</><section>a</><section-header>==</><table-bracket>{| </><table-definition html-table>STYLE=</><table-definition-value>__TOC__</>"
	},
	{
		"desc": "Inclusion of !userCanEdit() content",
		"wikitext": "{{MediaWiki:Fake}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>MediaWiki:Fake</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Morwen/13: Unclosed link followed by heading",
		"wikitext": "[[link\n==heading==",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>link</><section-header section--2>==</><section>heading</><section-header>==</>"
	},
	{
		"desc": "HHP2.1: Heuristics for headings in preprocessor parenthetical structures",
		"wikitext": "{{foo|\n=heading=",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>foo</><template-ground template-delimiter>|</><template-ground section-header section--1>=</><template-ground section>heading</><template-ground section-header>=</>"
	},
	{
		"desc": "HHP2.2: Heuristics for headings in preprocessor parenthetical structures",
		"wikitext": "{{foo|\n==heading==",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>foo</><template-ground template-delimiter>|</><template-ground section-header section--2>==</><template-ground section>heading</><template-ground section-header>==</>"
	},
	{
		"desc": "nowiki inside link inside heading (T20295)",
		"wikitext": "==[[foo|x<nowiki>y</nowiki>z]]==",
		"parsed": "<section-header section--2>==</><link-ground link-bracket>[[</><link-ground link-pagename pagename>foo</><link-ground link-delimiter>|</><link-ground link-text>x</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>y</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-text>z</><link-ground link-bracket>]]</><section-header>==</>"
	},
	{
		"desc": "Decoding of HTML entities in headings and links for IDs and link fragments (T103714)",
		"wikitext": "==A&B&amp;C&amp;amp;D&amp;amp;amp;E==\n[[#A&B&amp;C&amp;amp;D&amp;amp;amp;E]]",
		"parsed": "<section-header section--2>==</><section>A&amp;B</><entity>&amp;amp;</><section>C</><entity>&amp;amp;</><section>amp;D</><entity>&amp;amp;</><section>amp;amp;E</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#A&amp;B&amp;amp;C&amp;amp;amp;D&amp;amp;amp;amp;E</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Decoding of HTML entities in headings and links for IDs and link fragments (T103714) (legacy)",
		"wikitext": "==A&B&amp;C&amp;amp;D&amp;amp;amp;E==\n[[#A&B&amp;C&amp;amp;D&amp;amp;amp;E]]",
		"parsed": "<section-header section--2>==</><section>A&amp;B</><entity>&amp;amp;</><section>C</><entity>&amp;amp;</><section>amp;D</><entity>&amp;amp;</><section>amp;amp;E</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#A&amp;B&amp;amp;C&amp;amp;amp;D&amp;amp;amp;amp;E</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "HTML5 ids: fallback to legacy",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Тест==\n\n==Тест==\n\n==тест==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Тест]] [[#тест]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:💩}} <span id=\"{{anchorencode:💩}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#啤酒]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<section-header section--2>==</><section>Foo bar</><section-header>==</><section-header section--2>==</><section>foo Bar</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>тест</><section-header>==</><section-header section--2>==</><section>Hey &lt; # \" &gt % : '</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#Foo bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#foo Bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Hey &lt; # \" &gt % : '</><link-ground link-bracket>]]</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</> <htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><comment>&lt;!-- These two links should produce identical HTML --&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#啤酒</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#%E5%95%A4%E9%85%92</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "HTML5 ids: legacy with a fallback to modern",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Тест==\n\n==Тест==\n\n==тест==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Тест]] [[#тест]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:💩}} <span id=\"{{anchorencode:💩}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#啤酒]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<section-header section--2>==</><section>Foo bar</><section-header>==</><section-header section--2>==</><section>foo Bar</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>тест</><section-header>==</><section-header section--2>==</><section>Hey &lt; # \" &gt % : '</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#Foo bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#foo Bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Hey &lt; # \" &gt % : '</><link-ground link-bracket>]]</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</> <htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><comment>&lt;!-- These two links should produce identical HTML --&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#啤酒</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#%E5%95%A4%E9%85%92</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "HTML5 ids: no legacy",
		"wikitext": "==Foo bar==\n\n==foo Bar==\n\n==Тест==\n\n==Тест==\n\n==тест==\n\n==Hey < # \" > % : '==\n[[#Foo bar]] [[#foo Bar]] [[#Тест]] [[#тест]] [[#Hey < # \" > % : ']]\n\n{{anchorencode:💩}} <span id=\"{{anchorencode:💩}}\"></span>\n\n<!-- These two links should produce identical HTML -->\n[[#啤酒]] [[#%E5%95%A4%E9%85%92]]",
		"parsed": "<section-header section--2>==</><section>Foo bar</><section-header>==</><section-header section--2>==</><section>foo Bar</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>Тест</><section-header>==</><section-header section--2>==</><section>тест</><section-header>==</><section-header section--2>==</><section>Hey &lt; # \" &gt % : '</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#Foo bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#foo Bar</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#тест</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#Hey &lt; # \" &gt % : '</><link-ground link-bracket>]]</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</> <htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>id=</><htmltag-attribute-value>\"</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>anchorencode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>💩</><ext-ground parserfunction-bracket>}}</><htmltag-attribute-value>\"</><htmltag-bracket>&gt&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><comment>&lt;!-- These two links should produce identical HTML --&gt</><link-ground link-bracket>[[</><link-ground link-tosection>#啤酒</><link-ground link-bracket>]]</> <link-ground link-bracket>[[</><link-ground link-tosection>#%E5%95%A4%E9%85%92</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T90902: Normalize weird characters in section IDs",
		"wikitext": "==Foo&nbsp;bar==\n[[#Foo&nbsp;bar]]",
		"parsed": "<section-header section--2>==</><section>Foo</><entity>&amp;nbsp;</><section>bar</><section-header>==</><link-ground link-bracket>[[</><link-ground link-tosection>#Foo&amp;nbsp;bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "mw-heading wrapper edge cases",
		"wikitext": "==Normal heading!==\n\n<h2>HTML heading!</h2>\n\n<h2 style=\"border: 1px solid green; background: lightgreen; padding: 5px; font-size: 1.5em;\">HTML heading with attributes!</h2>\n\n<div class=\"mw-heading mw-heading2\">\n==Normal heading with existing wrapper!==\n</div>",
		"parsed": "<section-header section--2>==</><section>Normal heading!</><section-header>==</><htmltag-bracket>&lt;</><htmltag-name>h2</><htmltag-bracket>&gt</>HTML heading!<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt&lt;</><htmltag-name>h2 </><htmltag-attribute html-h2>style=</><htmltag-attribute-value>\"border: 1px solid green; background: lightgreen; padding: 5px; font-size: 1.5em;\"</><htmltag-bracket>&gt</>HTML heading with attributes!<htmltag-bracket>&lt;/</><htmltag-name>h2</><htmltag-bracket>&gt&lt;</><htmltag-name>div </><htmltag-attribute html-div>class=</><htmltag-attribute-value>\"mw-heading mw-heading2\"</><htmltag-bracket>&gt</><section-header section--2>==</><section>Normal heading with existing wrapper!</><section-header>==</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T365413: Headings with dollar signs",
		"wikitext": "==$text==\n\n==$ text==\n\n==text $text==\n\n==\\$text==\n\n==$$text==",
		"parsed": "<section-header section--2>==</><section>$text</><section-header>==</><section-header section--2>==</><section>$ text</><section-header>==</><section-header section--2>==</><section>text $text</><section-header>==</><section-header section--2>==</><section>\\$text</><section-header>==</><section-header section--2>==</><section>$$text</><section-header>==</>"
	},
	{
		"desc": "T368334: Headings from template titles that would need uri encoding",
		"wikitext": "{{With a section?}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>With a section?</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "indentPre"
	},
	{
		"desc": "Preformatted text",
		"wikitext": " This is some\n Preformatted text\n With ''italic''\n And '''bold'''\n And a [[Main Page|link]]",
		"parsed": "<skipformatting> </>This is some<skipformatting> </>Preformatted text<skipformatting> </>With <apostrophes>''</><em>italic</><apostrophes>''</><skipformatting> </>And <apostrophes>'''</><strong>bold</><apostrophes>'''</><skipformatting> </>And a <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>link</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Tabs don't trigger preformatted text",
		"wikitext": "\tThis is not\n\t preformatted text.\n This is preformatted text.\n \tSo is this.",
		"parsed": "\tThis is not\t preformatted text.<skipformatting> </>This is preformatted text.<skipformatting> </>\tSo is this."
	},
	{
		"desc": "Space before tab needs nowiki pre protection",
		"wikitext": "a",
		"parsed": "a"
	},
	{
		"desc": "Indent preformatting with inline content",
		"wikitext": " a\n ''b''",
		"parsed": "<skipformatting> </>a<skipformatting> </><apostrophes>''</><em>b</><apostrophes>''</>"
	},
	{
		"desc": "<pre> with <nowiki> inside (compatibility with 1.6 and earlier)",
		"wikitext": "<pre><nowiki>\n<b>\n<cite>\n<em>\n</nowiki></pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>&lt;nowiki&gt&lt;b&gt&lt;cite&gt&lt;em&gt&lt;/nowiki&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Regression with preformatted in <center>",
		"wikitext": "<center>\n Blah\n</center>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>center</><htmltag-bracket>&gt</><skipformatting> </>Blah<htmltag-bracket>&lt;/</><htmltag-name>center</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T54763: Preformatted in <blockquote>",
		"wikitext": "<blockquote>\n Blah\n{|\n|\n indented cell (no pre-wrapping!)\n|}\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </>Blah<table-bracket>{|</><table-delimiter>|</><table-td> indented cell (no pre-wrapping!)</><table-bracket>|}</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1a. Templates that break a line should suppress <pre>",
		"wikitext": " {{1x|}}",
		"parsed": "<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1b. Templates that break a line should suppress <pre>",
		"wikitext": " {{1x|\nfoo}}",
		"parsed": "<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1c: Wrapping should be based on expanded content",
		"wikitext": " {{1x|a\nb}}",
		"parsed": "<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>ab</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1d: Wrapping should be based on expanded content",
		"wikitext": " {{1x|a\nb\nc\n d\ne\n}}",
		"parsed": "<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>abc de</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1e. Wrapping should be based on expanded content",
		"wikitext": "{{1x| foo}}\n\n{{1x| foo}}{{1x| bar}}\n\n{{1x| foo}}\n{{1x| bar}}\n\n{{1x|<!--cmt--> foo}}\n\n<!--cmt-->{{1x| foo}}\n\n{{1x|{{1x| }}bar}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> bar</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> bar</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground comment>&lt;!--cmt--&gt</><template-ground template> foo</><template-ground template-bracket>}}</><comment>&lt;!--cmt--&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> foo</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template-bracket> }}</><template-ground template>bar</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates: Indent-Pre: 1f: Wrapping should be based on expanded content",
		"wikitext": "{{1x| }}a\n\n{{1x|\n }}a\n\n{{1x|\n b}}\n\n{{1x|a\n }}b\n\n{{1x|a\n}} b",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket> }}</>a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket> }}</>a<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> b</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template-bracket> }}</>b<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>a</><template-ground template-bracket>}}</> b"
	},
	{
		"desc": "Off-by-1 DSR values: Regression test for indent-pre usages",
		"wikitext": " {{1x|\n}} ''{{1x|\n}} X'' {{1x|<span></span>\n}} Y",
		"parsed": "<skipformatting> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</> <apostrophes>''</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-bracket>}}</> X<apostrophes>''</><em> </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt&lt;/</><template-ground htmltag-name>span</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</> Y"
	},
	{
		"desc": "Ensure DSR values for mw:DisplaySpace spans are computed correctly",
		"wikitext": " x\n y :)",
		"parsed": "<skipformatting> </>x<skipformatting> </>y :)"
	},
	{
		"desc": "pwrap test",
		"wikitext": "{{T1}}{{T1}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>T1</><template-ground template-bracket>}}{{</><template-ground template-name pagename>T1</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "1a. Indent-Pre and Comments",
		"wikitext": " a\n<!--a-->\nc",
		"parsed": "<skipformatting> </>a<comment>&lt;!--a--&gt</>c"
	},
	{
		"desc": "1b. Indent-Pre and Comments",
		"wikitext": " a\n <!--a-->\nc",
		"parsed": "<skipformatting> </>a<skipformatting> </><comment>&lt;!--a--&gt</>c"
	},
	{
		"desc": "1c. Indent-Pre and Comments",
		"wikitext": "<!--a-->  a\n\n <!--a--> a",
		"parsed": "<comment>&lt;!--a--&gt</>  a<skipformatting> </><comment>&lt;!--a--&gt</> a"
	},
	{
		"desc": "1d. Indent-Pre and Comments\n(Pre-handler currently cannot distinguish between comment/ws order and normalizes them to [comment,ws] order)",
		"wikitext": "<!--a--> a\n\n <!--b-->b",
		"parsed": "<comment>&lt;!--a--&gt</> a<skipformatting> </><comment>&lt;!--b--&gt</>b"
	},
	{
		"desc": "2a. Indent-Pre and tables",
		"wikitext": " {|\n |-\n !h1!!h2\n |foo||bar\n |}",
		"parsed": "<table-bracket>{|</><table-delimiter> |- !</><table-th>h1</><table-delimiter>!!</><table-th>h2</><table-delimiter> |</><table-td>foo</><table-delimiter>||</><table-td>bar</><table-bracket> |}</>"
	},
	{
		"desc": "2b. Indent-Pre and tables",
		"wikitext": "  {|\n |-\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter> |-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "2c. Indent-Pre and tables (T44252)",
		"wikitext": "{|\n |+foo\n !  |bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter> |+</><table-caption>foo</><table-delimiter> !  </><table-delimiter2>|</><table-th>bar</><table-bracket>|}</>"
	},
	{
		"desc": "2d. Indent-Pre and tables",
		"wikitext": " a\n {|\n |b\n |}",
		"parsed": "<skipformatting> </>a<table-bracket>{|</><table-delimiter> |</><table-td>b</><table-bracket> |}</>"
	},
	{
		"desc": "2e. Indent-Pre and table-line syntax",
		"wikitext": " a\n | b\n | c",
		"parsed": "<skipformatting> </>a<skipformatting> </>| b<skipformatting> </>| c"
	},
	{
		"desc": "2f. Indent-pre started by table-line syntax",
		"wikitext": "a\n | b\n | c",
		"parsed": "a<skipformatting> </>| b<skipformatting> </>| c"
	},
	{
		"desc": "2g. Indented table markup mixed with indented pre content (proposed in T8200)",
		"wikitext": " <table>\n <tr>\n <td>\n Text that should be rendered preformatted\n </td>\n </tr>\n </table>",
		"parsed": "<skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt</><skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </>Text that should be rendered preformatted<skipformatting> </><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </><htmltag-bracket>&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt</><skipformatting> </><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "2h. Indent pre in tables",
		"wikitext": "{|\n !\n foo\n !\n bar\n |-\n |\n baz\n {{!}}\n bam\n |}",
		"parsed": "<table-bracket>{|</><table-delimiter> !</><table-th> foo</><table-delimiter> !</><table-th> bar</><table-delimiter> |- |</><table-td> baz</><table-delimiter> {{!}}</><table-td> bam</><table-bracket> |}</>"
	},
	{
		"desc": "3a. Indent-Pre and block tags (single-line html)",
		"wikitext": " a <p> foo </p>\n b <div> foo </div>\n c <blockquote> foo </blockquote>\n <span> foo </span>",
		"parsed": "<skipformatting> </>a <htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</><skipformatting> </>b <htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><skipformatting> </>c <htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3b. Indent-Pre and block tags (multi-line html)",
		"wikitext": " a <span>foo</span>\n<!-- comment --> b <div> foo </div>",
		"parsed": "<skipformatting> </>a <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><comment>&lt;!-- comment --&gt</> b <htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3c. Indent-Pre and block tags (pre-content on separate line)",
		"wikitext": "<p>\n foo\n</p>\n\n<div>\n foo\n</div>\n\n<center>\n foo\n</center>\n\n<blockquote>\n foo\n</blockquote>\n\n<blockquote>\n<pre>\nfoo\n</pre>\n</blockquote>\n\n<table><tr><td>\n foo\n</td></tr></table>\n\n<ul><li>\n  foo\n</li></ul>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><skipformatting> </>foo<htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><skipformatting> </>foo<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt&lt;</><htmltag-name>center</><htmltag-bracket>&gt</><skipformatting> </>foo<htmltag-bracket>&lt;/</><htmltag-name>center</><htmltag-bracket>&gt&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </>foo<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><skipformatting> </>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>ul</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</><skipformatting> </> foo<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ul</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "5. Indent-Pre and html pre",
		"wikitext": " <pre class=\"123\">hi</pre>",
		"parsed": "<skipformatting> </><exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>class=</><exttag-attribute-value>\"123\"</><exttag-bracket>&gt</><tag-pre>hi</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Serializing indent pre at sol",
		"wikitext": " hi",
		"parsed": "<skipformatting> </>hi"
	},
	{
		"desc": "Render paragraphs when indent-pre is suppressed in blocklevels",
		"wikitext": "<blockquote>\n foo\n\n bar\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </>foo<skipformatting> </>bar<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. Multiple spaces at start-of-line",
		"wikitext": "    <p> foo </p>\n    foo\n\t{|\n|foo\n|}",
		"parsed": "<skipformatting> </>   <htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</> foo <htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</><skipformatting> </>   foo<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "5a. White-space in indent-pre",
		"wikitext": " a<br />\n \n b",
		"parsed": "<skipformatting> </>a<htmltag-bracket>&lt;</><htmltag-name>br </><htmltag-bracket>/&gt</><skipformatting>  </>b"
	},
	{
		"desc": "5b. White-space in indent-pre",
		"wikitext": " a\n \n b\n \n \n c",
		"parsed": "<skipformatting> </>a<skipformatting>  </>b<skipformatting>   </>c"
	},
	{
		"desc": "5c. White-space in indent-pre",
		"wikitext": " ''a''\n  ''b''\n   ''c''",
		"parsed": "<skipformatting> </><apostrophes>''</><em>a</><apostrophes>''</><skipformatting> </> <apostrophes>''</><em>b</><apostrophes>''</><skipformatting> </>  <apostrophes>''</><em>c</><apostrophes>''</>"
	},
	{
		"desc": "6. Pre-blocks should extend across lines with leading WS even when there is no wrappable content",
		"wikitext": " a\n \n <!-- continue -->\n b\n\n c\n \nd",
		"parsed": "<skipformatting> </>a<skipformatting>  </><comment>&lt;!-- continue --&gt</><skipformatting> </>b<skipformatting> </>c<skipformatting> </>d"
	},
	{
		"desc": "7a. Indent-pre and category links",
		"wikitext": " [[Category:foo]] <!-- No pre-wrapping -->\n{{1x| [[Category:foo]]}} <!-- No pre-wrapping -->",
		"parsed": "<skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:foo</><link-ground link-bracket>]]</> <comment>&lt;!-- No pre-wrapping --&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Category:foo</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</> <comment>&lt;!-- No pre-wrapping --&gt</>"
	},
	{
		"desc": "7b. Indent-pre and category links",
		"wikitext": " [[Category:foo]] a\n [[Category:foo]] {{1x|b}}",
		"parsed": "<skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:foo</><link-ground link-bracket>]]</> a<skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:foo</><link-ground link-bracket>]]</> <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Indent-Pre: Newlines in comments shouldn't affect sol state",
		"wikitext": "a <!--\nfoo\n--> b",
		"parsed": "a <comment>&lt;!--foo--&gt</> b"
	},
	{
		"desc": "Indent pre with leading colon",
		"wikitext": " :foo",
		"parsed": "<skipformatting> </>:foo"
	},
	{
		"desc": "Indent-Pre regression test: Trailing whitespace after sol-transparent content",
		"wikitext": "[[Category:Foo]]   \n[[Category:Bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>   <link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Preserving leading whitespace in indent-pre suppressing contexts",
		"wikitext": "<ol>\n<li>\n foo\n bar\n</li>\n</ol>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>ol</><htmltag-bracket>&gt&lt;</><htmltag-name>li</><htmltag-bracket>&gt</><skipformatting> </>foo<skipformatting> </>bar<htmltag-bracket>&lt;/</><htmltag-name>li</><htmltag-bracket>&gt&lt;/</><htmltag-name>ol</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "indicators"
	},
	{
		"desc": "Page status indicators: Empty name is invalid",
		"wikitext": "<indicator name=\" \"></indicator>\n<indicator></indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\" \"</><exttag-bracket>&gt&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator</><exttag-bracket>&gt&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Page status indicators: Weird syntaxes that are okay",
		"wikitext": "<indicator name=\"empty\" />\n<indicator name=\"name\"></indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"empty\"</><exttag-attribute ext-indicator> </><exttag-bracket>/&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"name\"</><exttag-bracket>&gt&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Page status indicators: Stress test",
		"wikitext": "<indicator name=\"01\">hello world</indicator>\n<indicator name=\"02\">[[Main Page]]</indicator>\n<indicator name=\"03\">[[File:Foobar.jpg|25px|link=]]</indicator>\n<indicator name=\"04\">[[File:Foobar.jpg|25px]]</indicator>\n<indicator name=\"05\">*foo\n*bar</indicator>\n<indicator name=\"06\"><nowiki>foo</nowiki></indicator>\n<indicator name=\"07\"> Preformatted</indicator>\n<indicator name=\"08\"><div>Broken tag</indicator>\n<indicator name=\"09\">{| class=wikitable\n|cell\n|}</indicator>\n<indicator name=\"10\">Two\n\nparagraphs</indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"01\"</><exttag-bracket>&gt</><tag-indicator>hello world</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"02\"</><exttag-bracket>&gt</><tag-indicator link-ground link-bracket>[[</><tag-indicator link-ground link-pagename pagename>Main Page</><tag-indicator link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"03\"</><exttag-bracket>&gt</><tag-indicator link-ground link-bracket>[[</><tag-indicator link-ground link-pagename pagename>File:Foobar.jpg</><tag-indicator link-ground link-delimiter>|</><tag-indicator link-ground image-parameter>25px</><tag-indicator link-ground link-delimiter>|</><tag-indicator link-ground image-parameter>link=</><tag-indicator link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"04\"</><exttag-bracket>&gt</><tag-indicator link-ground link-bracket>[[</><tag-indicator link-ground link-pagename pagename>File:Foobar.jpg</><tag-indicator link-ground link-delimiter>|</><tag-indicator link-ground image-parameter>25px</><tag-indicator link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"05\"</><exttag-bracket>&gt</><tag-indicator>*foo</><tag-indicator list>*</><tag-indicator>bar</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"06\"</><exttag-bracket>&gt</><tag-indicator exttag-bracket>&lt;</><tag-indicator exttag-name>nowiki</><tag-indicator exttag-bracket>&gt</><tag-indicator tag-nowiki>foo</><tag-indicator exttag-bracket>&lt;/</><tag-indicator exttag-name>nowiki</><tag-indicator exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"07\"</><exttag-bracket>&gt</><tag-indicator> Preformatted</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"08\"</><exttag-bracket>&gt</><tag-indicator htmltag-bracket>&lt;</><tag-indicator htmltag-name>div</><tag-indicator htmltag-bracket>&gt</><tag-indicator>Broken tag</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"09\"</><exttag-bracket>&gt</><tag-indicator>{| class=wikitable|cell|}</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"10\"</><exttag-bracket>&gt</><tag-indicator>Twoparagraphs</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Decoding of HTML entities in indicator names for IDs (T104196)",
		"wikitext": "<indicator name=\"1&2&amp;3&amp;amp;4&amp;amp;amp;5\">Indicator</indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"1&amp;2&amp;amp;3&amp;amp;amp;4&amp;amp;amp;amp;5\"</><exttag-bracket>&gt</><tag-indicator>Indicator</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Decoding of HTML entities in indicator names for IDs (unambiguous) (T104196)",
		"wikitext": "<indicator name=\"1&2&3&amp;amp;4&amp;amp;amp;5\">Indicator</indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"1&amp;2&amp;3&amp;amp;amp;4&amp;amp;amp;amp;5\"</><exttag-bracket>&gt</><tag-indicator>Indicator</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Indicators with duplicate names: Last one wins",
		"wikitext": "<indicator name=\"x\">foo</indicator>\n<indicator name=\"x\">bar</indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-indicator>foo</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-indicator>bar</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Templates where an indicator is the leading content (1)",
		"wikitext": "abcd\n{{1x|<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>indicator </><template-ground exttag-attribute ext-indicator>name=</><template-ground exttag-attribute-value>\"x\"</><template-ground exttag-bracket>&gt</><tag-indicator>foo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>indicator</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates where an indicator is the leading content (2)",
		"wikitext": "abcd\n<indicator name=\"x\">bar</indicator>\n{{1x|<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-indicator>bar</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>indicator </><template-ground exttag-attribute ext-indicator>name=</><template-ground exttag-attribute-value>\"x\"</><template-ground exttag-bracket>&gt</><tag-indicator>foo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>indicator</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates where an indicator is not the leading content (1)",
		"wikitext": "abcd\n{{1x|efgh<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>efgh</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>indicator </><template-ground exttag-attribute ext-indicator>name=</><template-ground exttag-attribute-value>\"x\"</><template-ground exttag-bracket>&gt</><tag-indicator>foo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>indicator</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templates where an indicator is not the leading content (2)",
		"wikitext": "abcd\n<indicator name=\"x\">bar</indicator>\n{{1x|efgh<indicator name=\"x\">foo</indicator>}}",
		"parsed": "abcd<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-indicator>bar</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>efgh</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>indicator </><template-ground exttag-attribute ext-indicator>name=</><template-ground exttag-attribute-value>\"x\"</><template-ground exttag-bracket>&gt</><tag-indicator>foo</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>indicator</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Indicator in fosterable position should not dirty-diff in selser mode",
		"wikitext": "{|\n<indicator name='x'>foo</indicator>\n|x\n|}",
		"parsed": "<table-bracket>{|</><exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>'x'</><exttag-bracket>&gt</><tag-indicator>foo</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</><table-delimiter>|</><table-td>x</><table-bracket>|}</>"
	},
	{
		"desc": "Indicator with comments should not be <p>-wrapped",
		"wikitext": "<indicator name=\"x\"><!-- hello -->\n<span>some stuff</span>\n<!-- second comment--></indicator>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>indicator </><exttag-attribute ext-indicator>name=</><exttag-attribute-value>\"x\"</><exttag-bracket>&gt</><tag-indicator comment>&lt;!-- hello --&gt</><tag-indicator htmltag-bracket>&lt;</><tag-indicator htmltag-name>span</><tag-indicator htmltag-bracket>&gt</><tag-indicator>some stuff</><tag-indicator htmltag-bracket>&lt;/</><tag-indicator htmltag-name>span</><tag-indicator htmltag-bracket>&gt</><tag-indicator comment>&lt;!-- second comment--&gt</><exttag-bracket>&lt;/</><exttag-name>indicator</><exttag-bracket>&gt</>"
	},
	{
		"desc": "langParserTests"
	},
	{
		"desc": "Language converter: output gets cut off unexpectedly (T7757)",
		"wikitext": "this bit is safe: }-\n\nbut if we add a conversion instance: -{zh-cn:xxx;zh-tw:yyy}-\n\nthen we get cut off here: }-\n\nall additional text is vanished",
		"parsed": "this bit is safe: }-but if we add a conversion instance: <convert-bracket>-{</><convert-lang>zh-cn:</>xxx<convert-delimiter>;</><convert-lang>zh-tw:</>yyy<convert-bracket>}-</>then we get cut off here: }-all additional text is vanished"
	},
	{
		"desc": "Don't convert blue categorylinks to another variant (T35210)",
		"wikitext": "[[A]][[Category:分类]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>A</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Category:分类</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Explicit definition of language variant alternatives",
		"wikitext": "-{zh:China;zh-tw:Taiwan}-, not China",
		"parsed": "<convert-bracket>-{</><convert-lang>zh:</>China<convert-delimiter>;</><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>, not China"
	},
	{
		"desc": "Explicit definition of language variant alternatives (BCP 47 codes)",
		"wikitext": "-{zh:China;zh-Hant-TW:Taiwan}-, not China",
		"parsed": "<convert-bracket>-{</><convert-lang>zh:</>China;zh-Hant-TW:Taiwan<convert-bracket>}-</>, not China"
	},
	{
		"desc": "Filter syntax for language variants",
		"wikitext": "foo-{zh;zh-hans;zh-hant|blog, WEBJOURNAL, WEBLOG}-quux",
		"parsed": "foo<convert-bracket>-{</><convert-flag>zh;zh-hans;zh-hant</><convert-delimiter>|</>blog, WEBJOURNAL, WEBLOG<convert-bracket>}-</>quux"
	},
	{
		"desc": "Explicit session-wise two-way language variant mapping (A flag and - flag)",
		"wikitext": "This is -{zh:China; zh-tw:Taiwan}-, but we'll forget that now.\n\nTaiwan is not China.\n\nBut -{A|zh:China; zh-tw:Taiwan}- is China,\n\n(This-{-|zh:China; zh-tw:Taiwan}- should be stripped!)\n\nand -{China}- is China.",
		"parsed": "This is <convert-bracket>-{</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>, but we'll forget that now.Taiwan is not China.But <convert-bracket>-{</><convert-flag>A</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</> is China,(This<convert-bracket>-{</><convert-flag>-</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</> should be stripped!)and <convert-bracket>-{</>China<convert-bracket>}-</> is China."
	},
	{
		"desc": "Explicit session-wise one-way language variant mapping (A flag and - flag)",
		"wikitext": "This is -{COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}-, but we'll forget that now.\n\nCOUNTRY is China or Taiwan.\n\nBut -{A|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- is COUNTRY,\n\n(This-{-|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- should be stripped!)\n\nand -{COUNTRY}- is COUNTRY.",
		"parsed": "This is <convert-bracket>-{</>COUNTRY<convert-lang>=&gtzh:</>China<convert-delimiter>;</>COUNTRY<convert-lang>=&gtzh-tw:</>Taiwan<convert-bracket>}-</>, but we'll forget that now.COUNTRY is China or Taiwan.But <convert-bracket>-{</><convert-flag>A</><convert-delimiter>|</>COUNTRY<convert-lang>=&gtzh:</>China<convert-delimiter>;</>COUNTRY<convert-lang>=&gtzh-tw:</>Taiwan<convert-bracket>}-</> is COUNTRY,(This<convert-bracket>-{</><convert-flag>-</><convert-delimiter>|</>COUNTRY<convert-lang>=&gtzh:</>China<convert-delimiter>;</>COUNTRY<convert-lang>=&gtzh-tw:</>Taiwan<convert-bracket>}-</> should be stripped!)and <convert-bracket>-{</>COUNTRY<convert-bracket>}-</> is COUNTRY."
	},
	{
		"desc": "Explicit session-wise two-way language variant mapping (H flag for hide)",
		"wikitext": "(This-{H|zh:China;zh-tw:Taiwan}- should be stripped!)\n\nTaiwan is China.",
		"parsed": "(This<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>;</><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</> should be stripped!)Taiwan is China."
	},
	{
		"desc": "Explicit session-wise one-way language variant mapping (H flag for hide)",
		"wikitext": "(This-{H|COUNTRY=>zh:China;COUNTRY=>zh-tw:Taiwan}- should be stripped!)\n\nCOUNTRY is Taiwan or China.",
		"parsed": "(This<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>COUNTRY<convert-lang>=&gtzh:</>China<convert-delimiter>;</>COUNTRY<convert-lang>=&gtzh-tw:</>Taiwan<convert-bracket>}-</> should be stripped!)COUNTRY is Taiwan or China."
	},
	{
		"desc": "Adding explicit conversion rule for title (T flag)",
		"wikitext": "Should be stripped-{T|zh:China;zh-tw:Taiwan}-!\n\nTaiwan is China.",
		"parsed": "Should be stripped<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>;</><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>!Taiwan is China."
	},
	{
		"desc": "Code coverage: T combined with H flag",
		"wikitext": "Should be stripped-{T;H|zh:China; zh-tw:Taiwan}-!\n\nTaiwan is China.",
		"parsed": "Should be stripped<convert-bracket>-{</><convert-flag>T;H</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>!Taiwan is China."
	},
	{
		"desc": "Code coverage: T with no variants",
		"wikitext": "-{H|zh:China; zh-tw:Taiwan}-\nTaiwan is China.-{T|Taiwan is China}-",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>Taiwan is China.<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</>Taiwan is China<convert-bracket>}-</>"
	},
	{
		"desc": "Code coverage: rules with no variants",
		"wikitext": "-{H|zh:China; zh-tw:Taiwan}-\nTaiwan is China.\n-{H|China}-\nTaiwan is China.",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>Taiwan is China.<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>China<convert-bracket>}-</>Taiwan is China."
	},
	{
		"desc": "Code coverage: D flag for conversion rule",
		"wikitext": "-{D|zh-cn:XA; zh-tw:YA}-\n-{A;D|zh-cn:XB; zh-tw:YB}-\n-{D;H|zh-cn:XC; zh-tw:YC}-\n\n-{D;H|FOO=>zh-tw:BAR;FOO=>zh-cn:BAT}-\n\n-{D|0=>zh-tw:1}-\n-{A;D|2=>zh-tw:3}-\n-{D;H|4=>zh-tw:5}-\n\nXA XB XC YA YB YC FOO BAR BAT 012345",
		"parsed": "<convert-bracket>-{</><convert-flag>D</><convert-delimiter>|</><convert-lang>zh-cn:</>XA<convert-delimiter>; </><convert-lang>zh-tw:</>YA<convert-bracket>}--{</><convert-flag>A;D</><convert-delimiter>|</><convert-lang>zh-cn:</>XB<convert-delimiter>; </><convert-lang>zh-tw:</>YB<convert-bracket>}--{</><convert-flag>D;H</><convert-delimiter>|</><convert-lang>zh-cn:</>XC<convert-delimiter>; </><convert-lang>zh-tw:</>YC<convert-bracket>}--{</><convert-flag>D;H</><convert-delimiter>|</>FOO<convert-lang>=&gtzh-tw:</>BAR<convert-delimiter>;</>FOO<convert-lang>=&gtzh-cn:</>BAT<convert-bracket>}--{</><convert-flag>D</><convert-delimiter>|</>0<convert-lang>=&gtzh-tw:</>1<convert-bracket>}--{</><convert-flag>A;D</><convert-delimiter>|</>2<convert-lang>=&gtzh-tw:</>3<convert-bracket>}--{</><convert-flag>D;H</><convert-delimiter>|</>4<convert-lang>=&gtzh-tw:</>5<convert-bracket>}-</>XA XB XC YA YB YC FOO BAR BAT 012345"
	},
	{
		"desc": "Code coverage: N flag for conversion rule",
		"wikitext": "-{N|zh-cn}-\n\n-{N|zh-tw}-\n\n-{N|sr-ec}-",
		"parsed": "<convert-bracket>-{</><convert-flag>N</><convert-delimiter>|</>zh-cn<convert-bracket>}--{</><convert-flag>N</><convert-delimiter>|</>zh-tw<convert-bracket>}--{</><convert-flag>N</><convert-delimiter>|</>sr-ec<convert-bracket>}-</>"
	},
	{
		"desc": "Code coverage: N flag for conversion rule (wt2html only)",
		"wikitext": "-{D;N|en}-",
		"parsed": "<convert-bracket>-{</><convert-flag>D;N</><convert-delimiter>|</>en<convert-bracket>}-</>"
	},
	{
		"desc": "Testing that changing the language variant here in the tests actually works",
		"wikitext": "Should be stripped-{T|zh:China; zh-tw:Taiwan}-!",
		"parsed": "Should be stripped<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>!"
	},
	{
		"desc": "Title with HTML",
		"wikitext": "-{T|zh:Title <i style=\"color:red\">with</i> HTML&amp;Entities}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <htmltag-bracket>&lt;</><htmltag-name>i </><htmltag-attribute html-i>style=</><htmltag-attribute-value>\"color:red\"</><htmltag-bracket>&gt</>with<htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</> HTML<entity>&amp;amp;</>Entities<convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Title with Wiki syntax",
		"wikitext": "-{T|zh:Title ''with'' Wiki's s&uuml;ntax&copy}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <apostrophes>''</><em>with</><apostrophes>''</> Wiki's s<entity>&amp;uuml;</>ntax&copy<convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Title with JavaScript injection",
		"wikitext": "-{T|zh:Title <i onclick=\"alert(42)\">click me</i> <script>alert(43)</script>}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <htmltag-bracket>&lt;</><htmltag-name>i </><htmltag-attribute html-i>onclick=</><htmltag-attribute-value>\"alert(42)\"</><htmltag-bracket>&gt</>click me<htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</> <script>alert(43)</script><convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Test 1 from T298401/T67747",
		"wikitext": "-{T|zh:Title <script>a</script>&amp;<i>b</i>}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <script>a</script><entity>&amp;amp;</><htmltag-bracket>&lt;</><htmltag-name>i</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>i</><htmltag-bracket>&gt</><convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Test 2 from T298401/T67747",
		"wikitext": "-{T|zh:Title <code style=\"display:none\">}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <htmltag-bracket>&lt;</><htmltag-name>code </><htmltag-attribute html-code>style=</><htmltag-attribute-value>\"display:none\"</><htmltag-bracket>&gt</><convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Test 3 from T298401/T67747",
		"wikitext": "-{T|zh:Title <b>Foo bar<b>}-\nShould be stripped!",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>Title <htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</>Foo bar<htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</><convert-bracket>}-</>Should be stripped!"
	},
	{
		"desc": "Recursive conversion of alt and title attrs shouldn't clear converter state",
		"wikitext": "-{H|zh-cn:Exclamation; zh-tw:exclamation}-\nShould be stripped-{T|zh-cn:China; zh-tw:Taiwan}-<span title=\"exclamation\">!</span>",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>Exclamation<convert-delimiter>; </><convert-lang>zh-tw:</>exclamation<convert-bracket>}-</>Should be stripped<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh-cn:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"exclamation\"</><htmltag-bracket>&gt</>!<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T26072: more test on conversion rule for title",
		"wikitext": "This should be stripped-{T|zh:China; zh-tw:Taiwan}-!\n\nThis won't take interferes with the title rule-{H|zh:Beijing; zh-tw:Taipei}-.",
		"parsed": "This should be stripped<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>; </><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>!This won't take interferes with the title rule<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh:</>Beijing<convert-delimiter>; </><convert-lang>zh-tw:</>Taipei<convert-bracket>}-</>."
	},
	{
		"desc": "Partly disable title conversion if variant == main language code",
		"wikitext": "-{T|zh-cn:CN;zh-tw:TW}-",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</><convert-lang>zh-cn:</>CN<convert-delimiter>;</><convert-lang>zh-tw:</>TW<convert-bracket>}-</>"
	},
	{
		"desc": "Partly disable title conversion if variant == main language code, more",
		"wikitext": "-{T|TW}-",
		"parsed": "<convert-bracket>-{</><convert-flag>T</><convert-delimiter>|</>TW<convert-bracket>}-</>"
	},
	{
		"desc": "Raw output of variant escape tags (R flag)",
		"wikitext": "Raw: -{R|zh:China;zh-tw:Taiwan}-",
		"parsed": "Raw: <convert-bracket>-{</><convert-flag>R</><convert-delimiter>|</><convert-lang>zh:</>China<convert-delimiter>;</><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</>"
	},
	{
		"desc": "Raw output of variant escape tags (R flag) (wt2html only)",
		"wikitext": "-{Variant}- -{D|syntax}- -{D;R|options}-",
		"parsed": "<convert-bracket>-{</>Variant<convert-bracket>}-</> <convert-bracket>-{</><convert-flag>D</><convert-delimiter>|</>syntax<convert-bracket>}-</> <convert-bracket>-{</><convert-flag>D;R</><convert-delimiter>|</>options<convert-bracket>}-</>"
	},
	{
		"desc": "Nested markup inside raw output of variant escape tags (R flag)",
		"wikitext": "Nested raw: -{R|nested -{zh:China;zh-tw:Taiwan}- nested}-",
		"parsed": "Nested raw: <convert-bracket>-{</><convert-flag>R</><convert-delimiter>|</>nested <convert-bracket>-{</><convert-lang>zh:</>China<convert-delimiter>;</><convert-lang>zh-tw:</>Taiwan<convert-bracket>}-</> nested<convert-bracket>}-</>"
	},
	{
		"desc": "Nested markup and spaces inside raw output of variant escape tags (R flag)",
		"wikitext": "X-{ outer -{ inner }- outer }-X",
		"parsed": "X<convert-bracket>-{ </>outer <convert-bracket>-{ </>inner <convert-bracket>}-</> outer <convert-bracket>}-</>X"
	},
	{
		"desc": "Templates inside raw output of variant escape tags (R flag)",
		"wikitext": "Nested raw: -{R|nested {{1x|hi}} templates}-",
		"parsed": "Nested raw: <convert-bracket>-{</><convert-flag>R</><convert-delimiter>|</>nested <template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground template-bracket>}}</> templates<convert-bracket>}-</>"
	},
	{
		"desc": "Strings evaluating false shouldn't be ignored by Language converter (T51072)",
		"wikitext": "-{zh-cn:0;zh-sg:1;zh-tw:2;zh-hk:3}-",
		"parsed": "<convert-bracket>-{</><convert-lang>zh-cn:</>0<convert-delimiter>;</><convert-lang>zh-sg:</>1<convert-delimiter>;</><convert-lang>zh-tw:</>2<convert-delimiter>;</><convert-lang>zh-hk:</>3<convert-bracket>}-</>"
	},
	{
		"desc": "Conversion rules from [numeric-only string] to [something else] (T48634)",
		"wikitext": "-{H|0=>zh-cn:B}--{H|0=>zh-cn:C;0=>zh-cn:D}--{H|0=>zh-hans:A}-012345-{A|zh-tw:0;zh-cn:E;}-012345",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>0<convert-lang>=&gtzh-cn:</>B<convert-bracket>}--{</><convert-flag>H</><convert-delimiter>|</>0<convert-lang>=&gtzh-cn:</>C<convert-delimiter>;</>0<convert-lang>=&gtzh-cn:</>D<convert-bracket>}--{</><convert-flag>H</><convert-delimiter>|</>0<convert-lang>=&gtzh-hans:</>A<convert-bracket>}-</>012345<convert-bracket>-{</><convert-flag>A</><convert-delimiter>|</><convert-lang>zh-tw:</>0<convert-delimiter>;</><convert-lang>zh-cn:</>E<convert-delimiter>;</><convert-bracket>}-</>012345"
	},
	{
		"desc": "Two-way converter rule entries with an empty value should be ignored (T53551)",
		"wikitext": "-{H|zh-cn:foo;zh-tw:;}-foobar",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>foo<convert-delimiter>;</><convert-lang>zh-tw:</><convert-delimiter>;</><convert-bracket>}-</>foobar"
	},
	{
		"desc": "One-way converter rule entries with an empty \"from\" string should be ignored (T53551)",
		"wikitext": "-{H|=>zh-cn:foo;}-foobar",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>=&gtzh-cn:</>foo<convert-delimiter>;</><convert-bracket>}-</>foobar"
	},
	{
		"desc": "Empty converter rule entries shouldn't be inserted into the conversion table (T53551)",
		"wikitext": "-{H|}-foobar",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-bracket>}-</>foobar"
	},
	{
		"desc": "Nested using of manual convert syntax",
		"wikitext": "Nested: -{zh-hans:Hi -{zh-cn:China;zh-sg:Singapore;}-;zh-hant:Hello -{zh-tw:Taiwan;zh-hk:H-{ong}- K-{}-ong;}-;}-!",
		"parsed": "Nested: <convert-bracket>-{</><convert-lang>zh-hans:</>Hi <convert-bracket>-{</><convert-lang>zh-cn:</>China<convert-delimiter>;</><convert-lang>zh-sg:</>Singapore<convert-delimiter>;</><convert-bracket>}-</><convert-delimiter>;</><convert-lang>zh-hant:</>Hello <convert-bracket>-{</><convert-lang>zh-tw:</>Taiwan<convert-delimiter>;</><convert-lang>zh-hk:</>H<convert-bracket>-{</>ong<convert-bracket>}-</> K<convert-bracket>-{}-</>ong<convert-delimiter>;</><convert-bracket>}-</><convert-delimiter>;</><convert-bracket>}-</>!"
	},
	{
		"desc": "HTML markups with conversion syntax in attribs, nested in other conversion blocks",
		"wikitext": "-{zh;zh-hans;zh-hant|<span title=\"-{X}-\">A</span>}-",
		"parsed": "<convert-bracket>-{</><convert-flag>zh;zh-hans;zh-hant</><convert-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"-{X}-\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><convert-bracket>}-</>"
	},
	{
		"desc": "HTML markups with conversion syntax in attribs, nested in other conversion blocks (not working yet in PHP parser)",
		"wikitext": "-{<span title=\"-{X}-\">A</span>}-",
		"parsed": "<convert-bracket>-{</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>title=</><htmltag-attribute-value>\"-{X}-\"</><htmltag-bracket>&gt</>A<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><convert-bracket>}-</>"
	},
	{
		"desc": "Language converter markup with block content",
		"wikitext": "<span>a-{b<div>c}-d\n\n<span>a-{zh;zh-hans;zh-hant|b<div>c}-d\n\n<span>a-{H|0=>zh-cn:x<span>y;0=>zh-tw:b<div>c}-d",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>a<convert-bracket>-{</>b<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>c<convert-bracket>}-</>d<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>a<convert-bracket>-{</><convert-flag>zh;zh-hans;zh-hant</><convert-delimiter>|</>b<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>c<convert-bracket>}-</>d<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>a<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>0<convert-lang>=&gtzh-cn:</>x<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>y<convert-delimiter>;</>0<convert-lang>=&gtzh-tw:</>b<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>c<convert-bracket>}-</>d"
	},
	{
		"desc": "LanguageConverter selser (1)",
		"wikitext": "-{raw}-",
		"parsed": "<convert-bracket>-{</>raw<convert-bracket>}-</>"
	},
	{
		"desc": "LanguageConverter selser (2)",
		"wikitext": "<span class=\"x\">TEXT1</span>\n[http://example.com TEXT2]\n[[Foo|TEXT3]]\n{{1x|TEXT4}}",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>class=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</>TEXT1<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> TEXT2</><link-ground extlink-bracket>]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>TEXT3</><link-ground link-bracket>]]</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>TEXT4</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "LanguageConverter selser (3)",
		"wikitext": "{|\n|-\n|<span>Foo</span>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><table-td>Foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "LanguageConverter selser (4)",
		"wikitext": "{|\n|-\n|<span class=\"x\">Foo</span>-{Bar}-\n||<span class=\"x\">Foo</span>-{Bar}-\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>class=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><table-td>Foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><convert-bracket>-{</><table-td>Bar</><convert-bracket>}-</><table-delimiter>|</><table-delimiter2>|</><htmltag-bracket>&lt;</><htmltag-name>span </><htmltag-attribute html-span>class=</><htmltag-attribute-value>\"x\"</><htmltag-bracket>&gt</><table-td>Foo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><convert-bracket>-{</><table-td>Bar</><convert-bracket>}-</><table-bracket>|}</>"
	},
	{
		"desc": "T153135: Don't break list handling if language converter markup is in the item.",
		"wikitext": ";-{zh-cn:AAA;zh-tw:BBB}-\n;-{R|foo:bar}-",
		"parsed": "<list>;</><convert-bracket>-{</><convert-lang>zh-cn:</><strong>AAA</><convert-delimiter>;</><convert-lang>zh-tw:</><strong>BBB</><convert-bracket>}-</><list>;</><convert-bracket>-{</><convert-flag>R</><convert-delimiter>|</><strong>foo:bar</><convert-bracket>}-</>"
	},
	{
		"desc": "T153135: Unclosed markup in definition list (code coverage)",
		"wikitext": ";<b>foo:bar\n;-{zh-cn:AAA",
		"parsed": "<list>;</><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</><strong>foo:bar</><list>;</><convert-bracket>-{</><convert-lang>zh-cn:</><strong>AAA</>"
	},
	{
		"desc": "T153135: Nested language converter markup in definition list (code coverage)",
		"wikitext": ";-{|zh-cn:AAA -{zh-hans|foo:bar}- -{R|bat:baz}-}-:def",
		"parsed": "<list>;</><convert-bracket>-{</><convert-delimiter>|</><convert-lang>zh-cn:</><strong>AAA </><convert-bracket>-{</><convert-flag>zh-hans</><convert-delimiter>|</><strong>foo:bar</><convert-bracket>}-</><strong> </><convert-bracket>-{</><convert-flag>R</><convert-delimiter>|</><strong>bat:baz</><convert-bracket>}-}-</><list>:</>def"
	},
	{
		"desc": "Language converter tricky html2wt cases (5)",
		"wikitext": "-{H|<nowiki>a:b=>c</nowiki>=>zh-cn:<nowiki>x;foo=>zh-cn:boo</nowiki>;bar=>zh-cn:<nowiki>bat;xyz=>zh-cn:abc</nowiki>}-foobar\n\n-{H|A=><nowiki>bo:g;us</nowiki>:B}-\n\n-{A|zh-tw:xyz; zh-cn:<nowiki>0;zh-tw:bar</nowiki>}-\n\n-{<nowiki>bo:g;us</nowiki>:xyz; zh-cn:abc}-\n\na:b=>c xyz",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>a:b=&gtc</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><convert-lang>=&gtzh-cn:</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>x;foo=&gtzh-cn:boo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><convert-delimiter>;</>bar<convert-lang>=&gtzh-cn:</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>bat;xyz=&gtzh-cn:abc</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><convert-bracket>}-</>foobar<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</>A=><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>bo:g;us</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>:B<convert-bracket>}--{</><convert-flag>A</><convert-delimiter>|</><convert-lang>zh-tw:</>xyz<convert-delimiter>; </><convert-lang>zh-cn:</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>0;zh-tw:bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><convert-bracket>}--{</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>bo:g;us</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>:xyz<convert-delimiter>; </><convert-lang>zh-cn:</>abc<convert-bracket>}-</>a:b=>c xyz"
	},
	{
		"desc": "T239806: Trailing garbage in language converter rules (1)",
		"wikitext": "-{H|zh-cn:约翰·塞纳; zh-hk:莊·先拿; zh-tw:約翰·希南; ;}-\n-{H|zh-cn:泰瑞斯·吉布森; zh-hk:泰列斯·吉遜; zh-tw:泰瑞斯·吉布森; ;}-\n-{H|zh-cn:金·米尔福特; zh-tw:金·米爾福特; 真·米爾福特;}-",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>约翰·塞纳<convert-delimiter>; </><convert-lang>zh-hk:</>莊·先拿<convert-delimiter>; </><convert-lang>zh-tw:</>約翰·希南;<convert-delimiter> ;</><convert-bracket>}--{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>泰瑞斯·吉布森<convert-delimiter>; </><convert-lang>zh-hk:</>泰列斯·吉遜<convert-delimiter>; </><convert-lang>zh-tw:</>泰瑞斯·吉布森;<convert-delimiter> ;</><convert-bracket>}--{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>金·米尔福特<convert-delimiter>; </><convert-lang>zh-tw:</>金·米爾福特; 真·米爾福特<convert-delimiter>;</><convert-bracket>}-</>"
	},
	{
		"desc": "T239806: Trailing garbage in language converter rules (2)",
		"wikitext": "-{H|zh-cn:玛格特·罗比; zh-tw:瑪格·羅比; zh-hk:瑪歌·羅比; zh-sg:玛格·罗比; ;}-",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-lang>zh-cn:</>玛格特·罗比<convert-delimiter>; </><convert-lang>zh-tw:</>瑪格·羅比<convert-delimiter>; </><convert-lang>zh-hk:</>瑪歌·羅比<convert-delimiter>; </><convert-lang>zh-sg:</>玛格·罗比;<convert-delimiter> ;</><convert-bracket>}-</>"
	},
	{
		"desc": "Langconvert tag: crh-latn to crh-cyrl",
		"wikitext": "<langconvert from=\"crh-latn\" to=\"crh-cyrl\">test</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"crh-latn\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"crh-cyrl\"</><exttag-bracket>&gt</><tag-langconvert exttag>test</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: en to en-x-piglatin",
		"wikitext": "<langconvert from=\"en\" to=\"en-x-piglatin\">test</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"en\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"en-x-piglatin\"</><exttag-bracket>&gt</><tag-langconvert exttag>test</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: gan-hans to gan-hant",
		"wikitext": "<langconvert from=\"gan-hans\" to=\"gan-hant\">爱</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"gan-hans\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"gan-hant\"</><exttag-bracket>&gt</><tag-langconvert exttag>爱</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: ku-latn to ku-arab",
		"wikitext": "<langconvert from=\"ku-latn\" to=\"ku-arab\">test</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"ku-latn\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"ku-arab\"</><exttag-bracket>&gt</><tag-langconvert exttag>test</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: shi-latn to shi-tfng",
		"wikitext": "<langconvert from=\"shi-latn\" to=\"shi-tfng\">test</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"shi-latn\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"shi-tfng\"</><exttag-bracket>&gt</><tag-langconvert exttag>test</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: sr-latn to sr-cyrl",
		"wikitext": "<langconvert from=\"sr-latn\" to=\"sr-cyrl\">zdravo</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"sr-latn\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"sr-cyrl\"</><exttag-bracket>&gt</><tag-langconvert exttag>zdravo</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: sr-el to sr-ec (should fail)",
		"wikitext": "<langconvert from=\"sr-el\" to=\"sr-ec\">zdravo</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"sr-el\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"sr-ec\"</><exttag-bracket>&gt</><tag-langconvert exttag>zdravo</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: tg to tg-latn",
		"wikitext": "<langconvert from=\"tg\" to=\"tg-latn\">тест</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"tg\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"tg-latn\"</><exttag-bracket>&gt</><tag-langconvert exttag>тест</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: uz-cyrl to uz-latn",
		"wikitext": "<langconvert from=\"uz-cyrl\" to=\"uz-latn\">тест</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"uz-cyrl\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"uz-latn\"</><exttag-bracket>&gt</><tag-langconvert exttag>тест</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: zh-hans to zh-hant",
		"wikitext": "<langconvert from=\"zh-hans\" to=\"zh-hant\">爱</langconvert>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"zh-hans\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"zh-hant\"</><exttag-bracket>&gt</><tag-langconvert exttag>爱</><exttag-bracket>&lt;/</><exttag-name>langconvert</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Langconvert tag: self-closed",
		"wikitext": "x<langconvert from=\"crh-latn\" to=\"crh-cyrl\"/>x",
		"parsed": "x<exttag-bracket>&lt;</><exttag-name>langconvert </><exttag-attribute ext-langconvert>from=</><exttag-attribute-value>\"crh-latn\"</><exttag-attribute ext-langconvert> to=</><exttag-attribute-value>\"crh-cyrl\"</><exttag-bracket>/&gt</>x"
	},
	{
		"desc": "T302678: Serialize empty twoway",
		"wikitext": "-{H|}-",
		"parsed": "<convert-bracket>-{</><convert-flag>H</><convert-delimiter>|</><convert-bracket>}-</>"
	},
	{
		"desc": "luaParserTests"
	},
	{
		"desc": "Scribunto: no such module",
		"wikitext": "{{#invoke:foo|bar}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>foo</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>bar</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: no such function",
		"wikitext": "{{#invoke:test|blah}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>blah</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: hello world",
		"wikitext": "{{#invoke:test|hello}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>hello</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: redirect to hello world",
		"wikitext": "{{#invoke:redirected|hello}}\n{{#invoke:redirected \"with\" quotes|hello}}\n{{#invoke:redirected|testIsRedirect|Module:Redirected}}\n{{#invoke:redirected \"with\" quotes|testIsRedirect|Module:Test \"with\" quotes}}\n{{#invoke:redirected \"with\" quotes|testIsRedirect|Module:Redirected \"with\" quotes}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>redirected</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>hello</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>redirected \"with\" quotes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>hello</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>redirected</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testIsRedirect</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Module:Redirected</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>redirected \"with\" quotes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testIsRedirect</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Module:Test \"with\" quotes</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>redirected \"with\" quotes</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testIsRedirect</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Module:Redirected \"with\" quotes</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: getAllArgs",
		"wikitext": "{{#invoke:test|getAllArgs|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getAllArgs</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>x</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>z</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>a=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>b=</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>c=</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>7=</><ext-ground parserfunction>?</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: getAllArgs, deprecated style",
		"wikitext": "{{#invoke:test|getAllArgs2|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getAllArgs2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>x</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>z</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>a=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>b=</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>c=</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>7=</><ext-ground parserfunction>?</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: getNumericArgs",
		"wikitext": "{{#invoke:test|getNumericArgs|x|y|z|a=1|b=2|c=3|7=?}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getNumericArgs</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>x</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>y</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>z</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>a=</><ext-ground parserfunction>1</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>b=</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>c=</><ext-ground parserfunction>3</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>7=</><ext-ground parserfunction>?</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: named numeric parameters",
		"wikitext": "{{#invoke:test|getArg|2|a|2=b}}\n{{#invoke:test|getArg|2|2=a|b}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>a</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>2=</><ext-ground parserfunction>b</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArg</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>2=</><ext-ground parserfunction>a</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>b</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: template-style argument trimming",
		"wikitext": "{{#invoke:test|getArgLength|2| x }}\n{{#invoke:test|getArgLength|2|2= x }}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArgLength</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> x </><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArgLength</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-delimiter>|</><ext-ground template-argument-name>2=</><ext-ground parserfunction> x </><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: missing argument",
		"wikitext": "{{#invoke:test|getArgType|2}}\n{{#invoke:test|getArgType|blah}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArgType</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getArgType</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>blah</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: parent frame access",
		"wikitext": "{{Scribunto_all_args|x|y|z|a = 1|b = 2|c = 3}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Scribunto_all_args</><template-ground template-delimiter>|</><template-ground template>x</><template-ground template-delimiter>|</><template-ground template>y</><template-ground template-delimiter>|</><template-ground template>z</><template-ground template-delimiter>|</><template-ground template-argument-name>a =</><template-ground template> 1</><template-ground template-delimiter>|</><template-ground template-argument-name>b =</><template-ground template> 2</><template-ground template-delimiter>|</><template-ground template-argument-name>c =</><template-ground template> 3</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Scribunto: expandTemplate",
		"wikitext": "{{#invoke:test|testExpandTemplate}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testExpandTemplate</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: expandTemplate with headers",
		"wikitext": "==foo==\n{{#invoke:test|testExpandTemplateWithHeaders}}",
		"parsed": "<section-header section--2>==</><section>foo</><section-header>==</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testExpandTemplateWithHeaders</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: newTemplateParserValue",
		"wikitext": "{{#invoke:test|testNewTemplateParserValue}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testNewTemplateParserValue</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: preprocess",
		"wikitext": "{{#invoke:test|testPreprocess|foo}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testPreprocess</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>foo</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: newParserValue",
		"wikitext": "{{#invoke:test|testNewParserValue|foo}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testNewParserValue</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>foo</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: table return",
		"wikitext": "{{#invoke:test|emptyTable}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>emptyTable</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: require",
		"wikitext": "{{#invoke:test|import}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>import</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: access to a module imported at the chunk level",
		"wikitext": "{{#invoke:test|bitop}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>bitop</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: invoke instance upvalue isolation",
		"wikitext": "{{#invoke:test|isolationTestUpvalue|1}}\n{{#invoke:test|isolationTestUpvalue|2}}\n{{#invoke:test|isolationTestUpvalue|3}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestUpvalue</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestUpvalue</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestUpvalue</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>3</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: invoke instance global isolation",
		"wikitext": "{{#invoke:test|isolationTestGlobal|1}}\n{{#invoke:test|isolationTestGlobal|2}}\n{{#invoke:test|isolationTestGlobal|3}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestGlobal</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>1</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestGlobal</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>2</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isolationTestGlobal</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>3</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: ASCII null",
		"wikitext": "{{#invoke:test|null}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>null</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: isSubsting during PST",
		"wikitext": "{{safesubst:#invoke:test|isSubsting}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>safesubst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>#invoke:test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isSubsting</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: isSubsting during normal parse",
		"wikitext": "{{safesubst:#invoke:test|isSubsting}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>safesubst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>#invoke:test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>isSubsting</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: frame:getTitle",
		"wikitext": "{{#invoke:test|getFrameTitle}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>getFrameTitle</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: Metatable on export table",
		"wikitext": "{{#invoke:Metatables|zero}}\n{{#invoke:Metatables|one}}\n{{#invoke:Metatables|two}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>Metatables</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>zero</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>Metatables</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>one</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>Metatables</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>two</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: Correct argument numbering with equals sign in function name",
		"wikitext": "{{#invoke:test|test=InFunctionName|good|bad}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>test=InFunctionName</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>good</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>bad</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: Strip markers in CSS",
		"wikitext": "{{#invoke:test|testStrippedCss|<nowiki>#ff0000</nowiki>}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testStrippedCss</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki>#ff0000</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Scribunto: Parser output isn't incorrectly cached across frames",
		"wikitext": "Root: {{#invoke:test|testFrameCaching}} Template: {{Scribunto frame caching}}",
		"parsed": "Root: <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>test</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>testFrameCaching</><ext-ground parserfunction-bracket>}}</> Template: <template-ground template-bracket>{{</><template-ground template-name pagename>Scribunto frame caching</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Scribunto: Test unstripNowiki behavior",
		"wikitext": "{{#invoke:EchoTest|echo|<nowiki>foo</nowiki>}}\n{{#invoke:EchoTest|echo|<nowiki>[[Foo]]</nowiki>}}\n\n{{#invoke:UnstripTest|unstrip|<nowiki>foo</nowiki>}}\n{{#invoke:UnstripTest|unstrip|<nowiki>[[Foo]]</nowiki>}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>EchoTest</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>echo</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki>foo</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>EchoTest</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>echo</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki>[[Foo]]</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>UnstripTest</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>unstrip</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki>foo</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#invoke</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction pagename>UnstripTest</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>unstrip</><ext-ground parserfunction-delimiter>|</><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki>[[Foo]]</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "magicLinks"
	},
	{
		"desc": "Magic links: internal link to RFC (T2479)",
		"wikitext": "[[RFC 123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>RFC 123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Magic links: RFC (T2479)",
		"wikitext": "RFC 822",
		"parsed": "<magic-link>RFC 822</>"
	},
	{
		"desc": "Magic links: RFC (T67278)",
		"wikitext": "This is RFC 822 but thisRFC 822 is not RFC 822linked.",
		"parsed": "This is <magic-link>RFC 822</> but thisRFC 822 is not RFC 822linked."
	},
	{
		"desc": "Magic links: RFC (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "RFC &nbsp;&#160;&#0160;&#xA0;&#Xa0; 822\nRFC\n822",
		"parsed": "RFC <entity>&amp;nbsp;&amp;#160;&amp;#0160;&amp;#xA0;&amp;#Xa0;</> 822RFC822"
	},
	{
		"desc": "Magic links: ISBN (T3937)",
		"wikitext": "ISBN 0-306-40615-2",
		"parsed": "<magic-link>ISBN 0-306-40615-2</>"
	},
	{
		"desc": "Magic links: ISBN (T67278)",
		"wikitext": "This is ISBN 978-0-316-09811-3 but thisISBN 978-0-316-09811-3 is not ISBN 978-0-316-09811-3linked.",
		"parsed": "This is <magic-link>ISBN 978-0-316-09811-3</> but thisISBN 978-0-316-09811-3 is not ISBN 978-0-316-09811-3linked."
	},
	{
		"desc": "Magic links: ISBN (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "ISBN &nbsp;&#160;&#0160;&#xA0;&#Xa0; 978&nbsp;0&#160;316&#0160;09811&#xA0;3\nISBN\n9780316098113\nISBN 978\n0316098113",
		"parsed": "ISBN <entity>&amp;nbsp;&amp;#160;&amp;#0160;&amp;#xA0;&amp;#Xa0;</> 978<entity>&amp;nbsp;</>0<entity>&amp;#160;</>316<entity>&amp;#0160;</>09811<entity>&amp;#xA0;</>3ISBN9780316098113ISBN 9780316098113"
	},
	{
		"desc": "Magic links: PMID incorrectly converts space to underscore",
		"wikitext": "PMID 1234",
		"parsed": "<magic-link>PMID 1234</>"
	},
	{
		"desc": "Magic links: PMID (T67278)",
		"wikitext": "This is PMID 1234 but thisPMID 1234 is not PMID 1234linked.",
		"parsed": "This is <magic-link>PMID 1234</> but thisPMID 1234 is not PMID 1234linked."
	},
	{
		"desc": "Magic links: PMID (w/ non-newline whitespace, T30950/T31025)",
		"wikitext": "PMID &nbsp;&#160;&#0160;&#xA0;&#Xa0; 1234\nPMID\n1234",
		"parsed": "PMID <entity>&amp;nbsp;&amp;#160;&amp;#0160;&amp;#xA0;&amp;#Xa0;</> 1234PMID1234"
	},
	{
		"desc": "Magic links: use appropriate serialization for \"almost\" magic links.",
		"wikitext": "X[[Special:BookSources/0978739256|foo]]\n\nX[https://tools.ietf.org/html/rfc1234 foo]",
		"parsed": "X<link-ground link-bracket>[[</><link-ground link-pagename pagename>Special:BookSources/0978739256</><link-ground link-delimiter>|</><link-ground link-text>foo</><link-ground link-bracket>]]</>X<link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>tools.ietf.org/html/rfc1234</><link-ground extlink-text> foo</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Magic links: All disabled (T47942)",
		"wikitext": "ISBN 0-306-40615-2\nPMID 1234\nRFC 4321",
		"parsed": "<magic-link>ISBN 0-306-40615-2PMID 1234RFC 4321</>"
	},
	{
		"desc": "magicWords"
	},
	{
		"desc": "Magic Word: {{CURRENTDAY}}",
		"wikitext": "{{CURRENTDAY}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTDAY</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDAY2}}",
		"wikitext": "{{CURRENTDAY2}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTDAY2</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDAYNAME}}",
		"wikitext": "{{CURRENTDAYNAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTDAYNAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTDOW}}",
		"wikitext": "{{CURRENTDOW}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTDOW</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTH}}",
		"wikitext": "{{CURRENTMONTH}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTMONTH</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTH1}}",
		"wikitext": "{{CURRENTMONTH1}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTMONTH1</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHABBREV}}",
		"wikitext": "{{CURRENTMONTHABBREV}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTMONTHABBREV</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHNAME}}",
		"wikitext": "{{CURRENTMONTHNAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTMONTHNAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTMONTHNAMEGEN}}",
		"wikitext": "{{CURRENTMONTHNAMEGEN}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTMONTHNAMEGEN</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTTIME}}",
		"wikitext": "{{CURRENTTIME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTTIME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTHOUR}}",
		"wikitext": "{{CURRENTHOUR}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTHOUR</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTWEEK}} (T6594)",
		"wikitext": "{{CURRENTWEEK}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTWEEK</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTYEAR}}",
		"wikitext": "{{CURRENTYEAR}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTYEAR</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{CURRENTTIMESTAMP}}",
		"wikitext": "{{CURRENTTIMESTAMP}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>CURRENTTIMESTAMP</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Words LOCAL (UTC)",
		"wikitext": "*{{LOCALMONTH}}\n*{{LOCALMONTH1}}\n*{{LOCALMONTHNAME}}\n*{{LOCALMONTHNAMEGEN}}\n*{{LOCALMONTHABBREV}}\n*{{LOCALDAY}}\n*{{LOCALDAY2}}\n*{{LOCALDAYNAME}}\n*{{LOCALYEAR}}\n*{{LOCALTIME}}\n*{{LOCALHOUR}}\n*{{LOCALWEEK}}\n*{{LOCALDOW}}\n*{{LOCALTIMESTAMP}}",
		"parsed": "<list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALMONTH</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALMONTH1</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALMONTHNAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALMONTHNAMEGEN</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALMONTHABBREV</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALDAY</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALDAY2</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALDAYNAME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALYEAR</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALTIME</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALHOUR</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALWEEK</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALDOW</><ext-ground parserfunction-bracket>}}</><list>*</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>LOCALTIMESTAMP</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{FULLPAGENAME}}",
		"wikitext": "{{FULLPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>FULLPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{FULLPAGENAMEE}}",
		"wikitext": "{{FULLPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>FULLPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}, same namespace",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACE}}, main namespace",
		"wikitext": "{{TALKSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKSPACEE}}",
		"wikitext": "{{TALKSPACEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKSPACEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}, same namespace",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACE}}, main namespace",
		"wikitext": "{{SUBJECTSPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTSPACEE}}",
		"wikitext": "{{SUBJECTSPACEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTSPACEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACE}}",
		"wikitext": "{{NAMESPACE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACEE}}",
		"wikitext": "{{NAMESPACEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{NAMESPACENUMBER}}",
		"wikitext": "{{NAMESPACENUMBER}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NAMESPACENUMBER</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBPAGENAME}}",
		"wikitext": "{{SUBPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBPAGENAMEE}}",
		"wikitext": "{{SUBPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{ROOTPAGENAME}}",
		"wikitext": "{{ROOTPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ROOTPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{ROOTPAGENAMEE}}",
		"wikitext": "{{ROOTPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>ROOTPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{BASEPAGENAME}}",
		"wikitext": "{{BASEPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>BASEPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{BASEPAGENAMEE}}",
		"wikitext": "{{BASEPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>BASEPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKPAGENAME}}",
		"wikitext": "{{TALKPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{TALKPAGENAMEE}}",
		"wikitext": "{{TALKPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>TALKPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTPAGENAME}}",
		"wikitext": "{{SUBJECTPAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTPAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SUBJECTPAGENAMEE}}",
		"wikitext": "{{SUBJECTPAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SUBJECTPAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{NUMBEROFFILES}}",
		"wikitext": "{{NUMBEROFFILES}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>NUMBEROFFILES</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}}",
		"wikitext": "{{PAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}} with metacharacters",
		"wikitext": "''{{PAGENAME}}''",
		"parsed": "<apostrophes>''</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAME</><ext-ground parserfunction-bracket>}}</><apostrophes>''</>"
	},
	{
		"desc": "Magic Word: {{PAGENAME}} with metacharacters (T28781)",
		"wikitext": "{{PAGENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAMEE}}",
		"wikitext": "{{PAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{PAGENAMEE}} with metacharacters (T28781)",
		"wikitext": "{{PAGENAMEE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGENAMEE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONID}} on latest revision",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONID}} on non-latest revision",
		"wikitext": "{{REVISIONID}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP}} on latest revision",
		"wikitext": "{{REVISIONTIMESTAMP}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONTIMESTAMP:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP}} on not-yet-existing current page",
		"wikitext": "{{REVISIONTIMESTAMP}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:{{PAGENAME}}}} on not-yet-existing current page",
		"wikitext": "{{REVISIONTIMESTAMP:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONTIMESTAMP:...}}} on non-existing non-current page",
		"wikitext": "{{REVISIONTIMESTAMP:This page does not exist}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>This page does not exist</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on latest revision",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on not-yet-existing current page",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER:{{PAGENAME}}}} on not-yet-existing current page",
		"wikitext": "{{REVISIONUSER:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER:...}} on non-existing non-current page",
		"wikitext": "{{REVISIONUSER:This page does not exist}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>This page does not exist</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{REVISIONUSER}} on non-latest revision",
		"wikitext": "{{REVISIONUSER}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONID:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONID:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONID:{{PAGENAME}}}} on non-saved revision",
		"wikitext": "{{REVISIONID:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONDAY}} on latest revision",
		"wikitext": "{{REVISIONDAY}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONDAY:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONDAY:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONMONTH}} on latest revision",
		"wikitext": "{{REVISIONMONTH}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONMONTH:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONMONTH:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{REVISIONYEAR:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{REVISIONYEAR:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONYEAR</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser Function: {{PAGESIZE:{{PAGENAME}}}} on latest revision",
		"wikitext": "{{PAGESIZE:{{PAGENAME}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGESIZE</><ext-ground parserfunction-delimiter>:</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>PAGENAME</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Parser functions with interwiki titles (T355706)",
		"wikitext": "* {{PAGEID:Parser test}} - {{PAGEID:wikipedia:Parser test}}\n* {{PAGESIZE:Parser test}} - {{PAGESIZE:wikipedia:Parser test}}\n* {{REVISIONID:Parser test}} - {{REVISIONID:wikipedia:Parser test}}\n* {{REVISIONDAY:Parser test}} - {{REVISIONDAY:wikipedia:Parser test}}\n* {{REVISIONDAY2:Parser test}} - {{REVISIONDAY2:wikipedia:Parser test}}\n* {{REVISIONMONTH:Parser test}} - {{REVISIONMONTH:wikipedia:Parser test}}\n* {{REVISIONMONTH1:Parser test}} - {{REVISIONMONTH1:wikipedia:Parser test}}\n* {{REVISIONYEAR:Parser test}} - {{REVISIONYEAR:wikipedia:Parser test}}\n* {{REVISIONTIMESTAMP:Parser test}} - {{REVISIONTIMESTAMP:wikipedia:Parser test}}\n* {{REVISIONUSER:Parser test}} - {{REVISIONUSER:wikipedia:Parser test}}",
		"parsed": "<list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGEID</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGEID</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGESIZE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGESIZE</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONID</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY2</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONDAY2</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH1</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONMONTH1</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONYEAR</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONYEAR</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONTIMESTAMP</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</><list>*</> <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Parser test</><ext-ground parserfunction-bracket>}}</> - <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>REVISIONUSER</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>wikipedia:Parser test</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SCRIPTPATH}}",
		"wikitext": "{{SCRIPTPATH}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SCRIPTPATH</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{STYLEPATH}}",
		"wikitext": "{{STYLEPATH}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>STYLEPATH</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SERVER}}",
		"wikitext": "{{SERVER}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SERVER</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SERVERNAME}}",
		"wikitext": "{{SERVERNAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SERVERNAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{SITENAME}}",
		"wikitext": "{{SITENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>SITENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: {{PAGELANGUAGE}} on a page with no explicitly set language",
		"wikitext": "{{PAGELANGUAGE}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>PAGELANGUAGE</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Case-sensitive magic words, when cased differently, should just be template transclusions",
		"wikitext": "{{CurrentMonth}}\n{{currentday}}\n{{cURreNTweEK}}\n{{currentHour}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>CurrentMonth</><template-ground template-bracket>}}{{</><template-ground template-name pagename>currentday</><template-ground template-bracket>}}{{</><template-ground template-name pagename>cURreNTweEK</><template-ground template-bracket>}}{{</><template-ground template-name pagename>currentHour</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Case-insensitive magic words should still work with weird casing.",
		"wikitext": "{{sErVeRNaMe}}\n{{LCFirst:AOEU}}\n{{ucFIRST:aoeu}}\n{{SERver}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>sErVeRNaMe</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>LCFirst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>AOEU</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>ucFIRST</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>aoeu</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>SERver</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "Magic Word: prioritize type info over data-parsoid",
		"wikitext": "__FORCETOC__",
		"parsed": "<double-underscore>__FORCETOC__</>"
	},
	{
		"desc": "Magic Word: serialize on separate line (parsoid)",
		"wikitext": "foo\n__NOTOC__\nbar",
		"parsed": "foo<double-underscore>__NOTOC__</>bar"
	},
	{
		"desc": "Magic Word: case-insensitive (all-lowercase)",
		"wikitext": "foo\n__notoc__\nbar",
		"parsed": "foo<double-underscore>__notoc__</>bar"
	},
	{
		"desc": "Magic Word: case-insensitive (mixed case)",
		"wikitext": "foo\n__NOtOC__\nbar",
		"parsed": "foo<double-underscore>__NOtOC__</>bar"
	},
	{
		"desc": "Magic words",
		"wikitext": "__TOC__\n__NOTOC__\n__FORCETOC__\n__INDEX__\n__NOINDEX__\n__NOGALLERY__\n__NOEDITSECTION__\n__NOTITLECONVERT__\n__NOCONTENTCONVERT__",
		"parsed": "<double-underscore>__TOC____NOTOC____FORCETOC____INDEX____NOINDEX____NOGALLERY____NOEDITSECTION____NOTITLECONVERT____NOCONTENTCONVERT__</>"
	},
	{
		"desc": "media"
	},
	{
		"desc": "Simple image",
		"wikitext": "[[Image:foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Simple image redirect",
		"wikitext": "[[Image:Redirect to foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Redirect to foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Serialize simple image with figure-inline wrapper",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Serialize simple image with mw:Image typeof",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Simple image (using File: namespace, now canonical)",
		"wikitext": "[[File:Foobar.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Right-aligned image",
		"wikitext": "[[File:Foobar.jpg|right]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with caption",
		"wikitext": "[[File:Foobar.jpg|right|Caption text]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption text</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with caption, T55312 #1",
		"wikitext": "[[File:Foobar.jpg|right|Caption page stuff]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption page stuff</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with caption, T55312 #2",
		"wikitext": "[[File:Foobar.jpg|right|Caption page=]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption page=</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with caption, T55312 #3",
		"wikitext": "[[File:Foobar.jpg|right|Caption page=stuff]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption page=stuff</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image caption with pipe entity",
		"wikitext": "[[File:Foobar.jpg|thumb|one &#x7C; two]]\n[[File:Foobar.jpg|thumb|one ''two'' &#x7C; three]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>one </><link-ground entity>&amp;#x7C;</><link-ground file-text> two</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>one </><link-ground apostrophes>''</><link-ground file-text em>two</><link-ground apostrophes>''</><link-ground file-text> </><link-ground entity>&amp;#x7C;</><link-ground file-text> three</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Bad images - basic functionality",
		"wikitext": "[[File:Bad.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Bad.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Bad images - T18039: text after bad image disappears",
		"wikitext": "Foo bar\n[[File:Bad.jpg]]\nBar foo",
		"parsed": "Foo bar<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Bad.jpg</><link-ground link-bracket>]]</>Bar foo"
	},
	{
		"desc": "Bad images - manualthumb",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Bad.jpg|Uh oh]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Bad.jpg</><link-ground link-delimiter>|</><link-ground file-text>Uh oh</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Bad images - in gallery",
		"wikitext": "<gallery>\nFile:Bad.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Bad.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Allow empty links in image captions (T62753)",
		"wikitext": "[[File:Foobar.jpg|thumb|Caption [[Link1]]\n[[]]\n[[Link2]]\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Caption </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Link1</><link-ground link-bracket>]]</><link-ground file-text>[[]]</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Link2</><link-ground link-bracket>]]]]</>"
	},
	{
		"desc": "Titles in unlinked images (T23454)",
		"wikitext": "[[File:Foobar.jpg|link=|stuff]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-delimiter>|</><link-ground file-text>stuff</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Unlinked media in gallery",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=|stuff\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery link-delimiter>|</><tag-gallery file-text>stuff</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Link with empty target",
		"wikitext": "[[]]",
		"parsed": "[[]]"
	},
	{
		"desc": "Image with link trail",
		"wikitext": "Linktrails should not work for images: [[File:Foobar.jpg]]s",
		"parsed": "Linktrails should not work for images: <link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>s"
	},
	{
		"desc": "Image with empty attribute",
		"wikitext": "[[File:Foobar.jpg|right||Caption text]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>||</><link-ground file-text>Caption text</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "1. Block image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|thumb|{{1x|137px}}|This is a caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>137px</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground file-text>This is a caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "2. Block Image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|{{1x|thumb}}|{{1x|137px}}|This is a caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>thumb</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>137px</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><link-ground file-text>This is a caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "3. Inline image with individual attributes from templates",
		"wikitext": "[[File:Foobar.jpg|{{1x|50px}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>50px</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with multiple attributes from the same template",
		"wikitext": "[[File:Foobar.jpg|{{image_attribs}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>image_attribs</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link tails",
		"wikitext": "123[[File:Foobar.jpg]]456\n123[[File:Foobar.jpg|right]]456\n123[[File:Foobar.jpg|thumb]]456",
		"parsed": "123<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>456123<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-bracket>]]</>456123<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>456"
	},
	{
		"desc": "Image with multiple captions -- only last one is accepted",
		"wikitext": "[[File:Foobar.jpg|right|Caption1 - ignored|[[Caption2]] - ignored|Caption3 - accepted]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption1 - ignored</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Caption2</><link-ground link-bracket>]]</><link-ground file-text> - ignored</><link-ground link-delimiter>|</><link-ground file-text>Caption3 - accepted</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with multiple widths -- use last",
		"wikitext": "[[File:Foobar.jpg|200px|300px|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>200px</><link-ground link-delimiter>|</><link-ground image-parameter>300px</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with multiple alignments -- use first (T50664)",
		"wikitext": "[[File:Foobar.jpg|thumb|left|right|center|caption]]\n\n[[File:Foobar.jpg|middle|text-top|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>center</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-delimiter>|</><link-ground image-parameter>text-top</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with width attribute at different positions",
		"wikitext": "[[File:Foobar.jpg|200px|right|Caption]]\n[[File:Foobar.jpg|right|200px|Caption]]\n[[File:Foobar.jpg|right|Caption|200px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>200px</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>200px</><link-ground link-delimiter>|</><link-ground file-text>Caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Caption</><link-ground link-delimiter>|</><link-ground image-parameter>200px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with size specified with pxpx (T15500, T53628)",
		"wikitext": "[[File:Foobar.jpg|20pxpx]]\n[[File:Foobar.jpg|200x20pxpx]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>20pxpx</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>200x20pxpx</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, wiki target",
		"wikitext": "[[File:Foobar.jpg|link=Main Page]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File with link to page section",
		"wikitext": "[[Main Page#section]]\n[[File:Foobar.jpg|link=Main Page#section]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-tosection>#section</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main Page#section</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, URL target",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, protocol-less URL target",
		"wikitext": "[[File:Foobar.jpg|link=//example.com/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>//example.com/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Escaping non-block captions (T107435)",
		"wikitext": "[[Image:Foobar.jpg|alt=123|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>123</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, wgExternalLinkTarget",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Thumb with link parameter, wgExternalLinkTarget",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|thumb]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, wgNoFollowLinks set to false",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, wgNoFollowDomainExceptions",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter, wgExternalLinkTarget, unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with empty link parameter",
		"wikitext": "[[File:Foobar.jpg|link=]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter (wiki target) and unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=Main_Page|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main_Page</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with link parameter (URL target) and unnamed parameter",
		"wikitext": "[[File:Foobar.jpg|link=http://example.com/|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Thumbnail image with link parameter",
		"wikitext": "[[File:Foobar.jpg|thumb|link=http://example.com/|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com/</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image (backwards compat)",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link to wiki page",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=Main_Page|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main_Page</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link to url",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=http://example.com|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>http://example.com</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit no link",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Manually-specified thumbnail image with explicit link and alt text",
		"wikitext": "[[File:Foobar.jpg|thumb=Thumb.png|link=Main_Page|alt=alttext|Title]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main_Page</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>alttext</><link-ground link-delimiter>|</><link-ground file-text>Title</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with frame and link",
		"wikitext": "[[File:Foobar.jpg|frame|left|This is a test image [[Main Page]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground file-text>This is a test image </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]]]</>"
	},
	{
		"desc": "Image with frame and link and explicit alt",
		"wikitext": "[[Image:Foobar.jpg|frame|left|This is a test image [[Main Page]]|alt=Altitude]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground file-text>This is a test image </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>Altitude</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with wiki markup in implicit alt",
		"wikitext": "[[Image:Foobar.jpg|testing '''bold''' in alt]]\n\n[[Image:Foobar.jpg|alt=testing '''bold''' in alt]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>testing </><link-ground apostrophes>'''</><link-ground file-text strong>bold</><link-ground apostrophes>'''</><link-ground file-text> in alt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>testing </><link-ground apostrophes>'''</><link-ground file-text strong>bold</><link-ground apostrophes>'''</><link-ground file-text> in alt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Alt image option should handle most kinds of wikitext without barfing",
		"wikitext": "[[Image:Foobar.jpg|thumb|This is the image caption|alt=This is a [[link]] and a {{1x|''bold template''}}.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>This is the image caption</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>This is a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>link</><link-ground link-bracket>]]</><link-ground file-text> and a </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground apostrophes>''</><template-link-ground template>bold template</><template-link-ground apostrophes>''</><template-link-ground template-bracket>}}</><link-ground file-text>.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Ampersand in alt attribute (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=&amp;amp;]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=&amp;amp;\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground entity>&amp;amp;</><link-ground file-text>amp;</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery entity>&amp;amp;</><tag-gallery file-text>amp;</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Link with encoded pipe in alt option",
		"wikitext": "[[File:Foobar.jpg|alt=http://testing.123?4=5&#x7C;6|caption]]\n\n[[File:Foobar.jpg|alt=http://testing.123?4=5&vert;6|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=http://testing.123?4=5&#x7C;6|caption\nFile:Foobar.jpg|alt=http://testing.123?4=5&vert;6|caption\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>http://testing.123?4=5</><link-ground entity>&amp;#x7C;</><link-ground file-text>6</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>http://testing.123?4=5</><link-ground entity>&amp;vert;</><link-ground file-text>6</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>http://testing.123?4=5</><tag-gallery entity>&amp;#x7C;</><tag-gallery file-text>6</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>http://testing.123?4=5</><tag-gallery entity>&amp;vert;</><tag-gallery file-text>6</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Italics markup in alt attribute (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=''x''|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=''x''|caption\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground apostrophes>''</><link-ground file-text em>x</><link-ground apostrophes>''</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery apostrophes>''</><tag-gallery file-text em>x</><tag-gallery apostrophes>''</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Nowiki markup in alt attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|alt=<nowiki>''x''</nowiki>|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|alt=<nowiki>''x''</nowiki>|caption\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>''x''</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery exttag-bracket>&lt;</><tag-gallery exttag-name>nowiki</><tag-gallery exttag-bracket>&gt</><tag-gallery tag-nowiki>''x''</><tag-gallery exttag-bracket>&lt;/</><tag-gallery exttag-name>nowiki</><tag-gallery exttag-bracket>&gt</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Ampersand in link attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|link=Foo_&_bar]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo_&_bar\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Foo_&amp;_bar</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Foo_&amp;_bar</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Italics markup in link attribute (T206940)",
		"wikitext": "[[Foo''s bar''s]]\n\n<!-- Note that \"italics\" are stripped, even though this is a valid page title -->\n[[File:Foobar.jpg|link=Foo''s bar''s|caption1]]\n\n[[File:Foobar.jpg|link=''Main Page''|caption2]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo''s bar''s|caption1\nFile:Foobar.jpg|link=''Main Page''|caption2\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo''s bar''s</><link-ground link-bracket>]]</><comment>&lt;!-- Note that \"italics\" are stripped, even though this is a valid page title --&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Foo</><link-ground apostrophes>''</><link-ground file-text em>s bar</><link-ground apostrophes>''</><link-ground file-text>s</><link-ground link-delimiter>|</><link-ground file-text>caption1</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground apostrophes>''</><link-ground file-text em>Main Page</><link-ground apostrophes>''</><link-ground link-delimiter>|</><link-ground file-text>caption2</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Foo</><tag-gallery apostrophes>''</><tag-gallery file-text em>s bar</><tag-gallery apostrophes>''</><tag-gallery file-text>s</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption1</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery apostrophes>''</><tag-gallery file-text em>Main Page</><tag-gallery apostrophes>''</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption2</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Nowiki markup in link attribute (edited html, no data-parsoid) (T206940)",
		"wikitext": "[[File:Foobar.jpg|link=Foo<nowiki>''s_bar''</nowiki>s|caption]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=Foo<nowiki>''s_bar''</nowiki>s|caption\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Foo</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>''s_bar''</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground file-text>s</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Foo</><tag-gallery exttag-bracket>&lt;</><tag-gallery exttag-name>nowiki</><tag-gallery exttag-bracket>&gt</><tag-gallery tag-nowiki>''s_bar''</><tag-gallery exttag-bracket>&lt;/</><tag-gallery exttag-name>nowiki</><tag-gallery exttag-bracket>&gt</><tag-gallery file-text>s</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "HTML entity prefix in link markup (T209236)",
		"wikitext": "[[File:Foobar.jpg|link=https://example.com?foo&params=bar]]\n\n<!-- consistency with gallery extension -->\n<gallery>\nFile:Foobar.jpg|link=https://example.com?foo&params=bar\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>https://example.com?foo&amp;params=bar</><link-ground link-bracket>]]</><comment>&lt;!-- consistency with gallery extension --&gt</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>https://example.com?foo&amp;params=bar</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Image with table with attributes in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{| class=\"123\" |\n|- class=\"456\" |\n| ha\n|}\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground table-bracket>{| </><link-ground table-definition html-table>class=</><link-ground table-definition-value>\"123\"</><link-ground table-definition html-table> |</><link-ground table-delimiter>|- </><link-ground table-definition html-tr>class=</><link-ground table-definition-value>\"456\"</><link-ground table-definition html-tr> |</><link-ground table-delimiter>| </><link-ground table-td>ha</><link-ground table-bracket>|}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with table with rows from templates in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{|\n{{1x|{{!}} hi}}\n|}\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground table-bracket>{|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-ext-link-ground parserfunction-bracket>{{</><template-ext-link-ground parserfunction-name>!</><template-ext-link-ground parserfunction-bracket>}}</><template-link-ground template> hi</><template-link-ground template-bracket>}}</><link-ground table-bracket>|}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with nested tables in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|Foo<br />\n{|\n|\n{|\n|z\n|}\n|}\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Foo</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>br </><link-ground htmltag-bracket>/&gt</><link-ground table-bracket>{|</><link-ground table-delimiter>|</><link-ground table-bracket>{|</><link-ground table-delimiter>|</><link-ground table-td>z</><link-ground table-bracket>|}|}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with heading and horizontal rule in caption",
		"wikitext": "[[File:Foobar.jpg|thumb|\n===Testing===\n123\n--------------\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground section-header section--3>===</><link-ground section>Testing</><link-ground section-header>===</><link-ground file-text>123</><hr>--------------</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with 'frameless' first.",
		"wikitext": "[[File:Foobar.jpg|frameless|caption]]\n\n[[File:Foobar.jpg|frameless|frame|caption]]\n\n[[File:Foobar.jpg|frameless|thumb|caption]]\n\n[[File:Foobar.jpg|frameless|thumbnail=Thumb.png|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with 'frame' first.",
		"wikitext": "[[File:Foobar.jpg|frame|caption]]\n[[File:Foobar.jpg|frame|frameless|caption]]\n[[File:Foobar.jpg|frame|thumb|caption]]\n[[File:Foobar.jpg|frame|thumbnail=Thumb.png|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with 'thumb' first.",
		"wikitext": "[[File:Foobar.jpg|thumb|caption]]\n[[File:Foobar.jpg|thumb|frameless|caption]]\n[[File:Foobar.jpg|thumb|frame|caption]]\n[[File:Foobar.jpg|thumb|thumbnail=Thumb.png|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with 'thumbnail=' first.",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|frameless|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|frame|caption]]\n[[File:Foobar.jpg|thumbnail=Thumb.png|thumb|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: unspecified format and border enlarge",
		"wikitext": "[[File:Foobar.jpg|2000px]]\n\n[[File:Foobar.jpg|border|2000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>border</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: \"unspecified format\" and border reduce",
		"wikitext": "[[File:Foobar.jpg|1000px]]\n\n[[File:Foobar.jpg|border|1000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>1000px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>border</><link-ground link-delimiter>|</><link-ground image-parameter>1000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: thumbs reduce",
		"wikitext": "[[File:Foobar.jpg|thumb|50px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: bitmap thumbs can't be enlarged past original size, but vector can.",
		"wikitext": "[[File:Foobar.jpg|thumb|2000px]]\n\n[[File:Foobar.svg|thumb|2000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: frameless can reduce in size",
		"wikitext": "[[File:Foobar.jpg|frameless|50px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: bitmap frameless can't be enlarged past original size, but vector can",
		"wikitext": "[[File:Foobar.jpg|frameless|2000px]]\n\n[[File:Foobar.svg|frameless|2000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: framed images are always unscaled.",
		"wikitext": "[[File:Foobar.jpg|frame]]\n\n[[File:Foobar.jpg|frame|50px]]\n\n[[File:Foobar.jpg|frame|50x50px]]\n\n[[File:Foobar.jpg|frame|2000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>50x50px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: framed vector images are scaled to their default size AND have srcset",
		"wikitext": "[[File:Foobar.svg|frame]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: manualthumb images are always unscaled.",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Thumb.png]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|50px]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|50x50px]]\n\n[[File:Foobar.jpg|thumbnail=Thumb.png|2000px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>50x50px</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>2000px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Bogus sizes during html2wt",
		"wikitext": "[[File:Foobar.jpg]]\n\n[[File:Foobar.jpg|10x10px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>10x10px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Link to image page- image page normally doesn't exist, hence edit link\nAdd test with existing image page\n#<p><a href=\"/wiki/File:Test\" title=\"Image:Test\">Image:test</a>",
		"wikitext": "[[:Image:test]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:Image:test</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T20784  Link to non-existent image page with caption should use caption as link text",
		"wikitext": "[[:Image:test|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:Image:test</><link-ground link-delimiter>|</><link-ground link-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Frameless image caption with a free URL",
		"wikitext": "[[File:Foobar.jpg|http://example.com]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>http://example.com</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Thumbnail image caption with a free URL",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>http://example.com</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Thumbnail image caption with a free URL and explicit alt",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com|alt=Alteration]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>http://example.com</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>Alteration</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "SVG thumbnails with no language set",
		"wikitext": "[[File:Foobar.svg|thumb|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "SVG thumbnails with language de",
		"wikitext": "[[File:Foobar.svg|lang=de|thumb|caption]]\n\n<gallery>\nFile:Foobar.svg|lang=de|caption\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>lang=</><link-ground file-text>de</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.svg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>lang=</><tag-gallery file-text>de</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "SVG thumbnails with invalid language code",
		"wikitext": "[[File:Foobar.svg|thumb|caption|lang=invalid:language:code]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-delimiter>|</><link-ground image-parameter>lang=</><link-ground file-text>invalid:language:code</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T3887: A ISBN with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|ISBN 1235467890]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>ISBN 1235467890</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T3887: A RFC with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|This is RFC 12354]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>This is RFC 12354</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T3887: A mailto link with a thumbnail",
		"wikitext": "[[File:Foobar.jpg|thumb|Please mailto:nobody@example.com]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Please mailto:nobody@example.com</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2648: Frameless image caption with a link",
		"wikitext": "[[File:Foobar.jpg|text with a [[link]] in it]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>text with a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>link</><link-ground link-bracket>]]</><link-ground file-text> in it</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2648: Frameless image caption with a link (suffix)",
		"wikitext": "[[File:Foobar.jpg|text with a [[link]]foo in it]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>text with a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>link</><link-ground link-bracket>]]</><link-ground file-text>foo in it</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2648: Frameless image caption with an interwiki link",
		"wikitext": "[[File:Foobar.jpg|text with a [[MeatBall:Link]] in it]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>text with a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>MeatBall:Link</><link-ground link-bracket>]]</><link-ground file-text> in it</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T2648: Frameless image caption with a piped interwiki link",
		"wikitext": "[[File:Foobar.jpg|text with a [[MeatBall:Link|link]] in it]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>text with a </><link-ground link-bracket>[[</><link-ground link-pagename pagename>MeatBall:Link</><link-ground link-delimiter>|</><link-ground link-text>link</><link-ground link-bracket>]]</><link-ground file-text> in it</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T107474: Frameless image caption with <nowiki>",
		"wikitext": "[[File:Foobar.jpg|<nowiki>text with a [[MeatBall:Link|link]] in it</nowiki>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>text with a [[MeatBall:Link|link]] in it</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Escape HTML special chars in image alt text",
		"wikitext": "[[File:Foobar.jpg|& < > \"]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>&amp; &lt; &gt \"</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Escape HTML special chars in image alt text with LanguageConverter",
		"wikitext": "[[File:Foobar.jpg|& < > \"]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>&amp; &lt; &gt \"</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Entities in file name and attributes",
		"wikitext": "[[File:7%25 solution.gif|manualthumb=7%25 solution.gif|link=7%25 solution|[[7%25 solution]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:7%25 solution.gif</><link-ground link-delimiter>|</><link-ground file-text>manualthumb=7%25 solution.gif</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>7%25 solution</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>7%25 solution</><link-ground link-bracket>]]]]</>"
	},
	{
		"desc": "T2499: Alt text should have &#1234;, not &amp;1234;",
		"wikitext": "[[File:Foobar.jpg|&#9792;]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground entity>&amp;#9792;</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken image caption with link",
		"wikitext": "[[Image:Foobar.jpg|thumb|This is a broken caption. But [[Main Page|this]] is just an ordinary link.",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>This is a broken caption. But </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>this</><link-ground link-bracket>]]</><link-ground file-text> is just an ordinary link.</>"
	},
	{
		"desc": "Image caption containing another image",
		"wikitext": "[[File:Foobar.jpg|thumb|This is a caption with another [[File:Thumb.png|image]] inside it!]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>This is a caption with another </><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Thumb.png</><link-ground link-delimiter>|</><link-ground file-text>image</><link-ground link-bracket>]]</><link-ground file-text> inside it!</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: caption containing a newline",
		"wikitext": "[[File:Foobar.jpg|This\n*is some text]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>This*is some text</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: caption containing leading space",
		"wikitext": "[[File:Foobar.jpg|thumb| bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>| </><link-ground file-text>bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: caption containing a table",
		"wikitext": "[[Image:Foobar.jpg|thumb|200px|This is an example image thumbnail caption with a table\n{|\n!Foo!!Bar\n|-\n|Foo1||Bar1\n|}\nand some more text.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>200px</><link-ground link-delimiter>|</><link-ground file-text>This is an example image thumbnail caption with a table</><link-ground table-bracket>{|</><link-ground table-delimiter>!</><link-ground table-th>Foo</><link-ground table-delimiter>!!</><link-ground table-th>Bar</><link-ground table-delimiter>|-|</><link-ground table-td>Foo1</><link-ground table-delimiter>||</><link-ground table-td>Bar1</><link-ground table-bracket>|}</><link-ground file-text>and some more text.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T5090: External links other than http: in image captions",
		"wikitext": "[[File:Foobar.jpg|thumb|200x200px|This caption has [irc://example.net irc] and [https://example.com Secure] ext links in it.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>200x200px</><link-ground link-delimiter>|</><link-ground file-text>This caption has </><link-ground extlink-bracket>[</><link-ground extlink-protocol>irc://</><link-ground extlink>example.net</><link-ground extlink-text> irc</><link-ground extlink-bracket>]</><link-ground file-text> and </><link-ground extlink-bracket>[</><link-ground extlink-protocol>https://</><link-ground extlink>example.com</><link-ground extlink-text> Secure</><link-ground extlink-bracket>]</><link-ground file-text> ext links in it.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Custom class",
		"wikitext": "[[Image:foobar.jpg|a|class=b]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>a</><link-ground link-delimiter>|</><link-ground image-parameter>class=</><link-ground file-text>b</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "\"border\", \"frameless\" and \"class\" attributes on an image.",
		"wikitext": "[[File:Foobar.jpg|frameless|border|class=extra|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>border</><link-ground link-delimiter>|</><link-ground image-parameter>class=</><link-ground file-text>extra</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Invalid image attributes (T64500)",
		"wikitext": "[[File:Foobar.jpg|thumb|float|left|caption]]\n\n[[File:Foobar.jpg|thumb|righ|caption]]\n\n[[File:Foobar.jpg|bogus1|thumb|bogus2|left|bogus3|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>float</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>righ</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>bogus1</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>bogus2</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground file-text>bogus3</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirected image",
		"wikitext": "[[Image:Barfoo.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Barfoo.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Missing image with uploads disabled",
		"wikitext": "[[File:Foobaz.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobaz.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment",
		"wikitext": "[[File:Foobar.jpg|middle|50px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size, middle alignment, non-standard namespace alias",
		"wikitext": "[[Image:Foobar.jpg|middle|50px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment (existing content)",
		"wikitext": "[[File:Foobar.jpg|50px|middle]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with size and middle alignment and non-standard namespace name",
		"wikitext": "[[Image:Foobar.jpg|50px|middle]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with both sizes, a baseline alignment, and a caption",
		"wikitext": "[[File:Foobar.jpg|500x10px|baseline|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>500x10px</><link-ground link-delimiter>|</><link-ground image-parameter>baseline</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with border and size spec",
		"wikitext": "[[File:Foobar.jpg|50px|border|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>50px</><link-ground link-delimiter>|</><link-ground image-parameter>border</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with halign, valign, and caption",
		"wikitext": "[[File:Foobar.jpg|left|baseline|thumb|caption content]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground image-parameter>baseline</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption content</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with halign, valign, and caption (existing content)",
		"wikitext": "[[File:Foobar.jpg|thumb|left|baseline|caption content]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground image-parameter>baseline</><link-ground link-delimiter>|</><link-ground file-text>caption content</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with specific size, halign, valign, and caption",
		"wikitext": "[[Image:Foobar.jpg|right|middle|thumb|50x50px|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>50x50px</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - thumbnail with specific size, halign, valign, and caption (existing content)",
		"wikitext": "[[File:Foobar.jpg|thumb|50x50px|right|middle|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>50x50px</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - framed image with specific size and caption (size is ignored)",
		"wikitext": "[[File:Foobar.jpg|frame|500x50px|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>500x50px</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - framed image with specific size, halign, valign, and caption (size is ignored)",
		"wikitext": "[[File:Foobar.jpg|left|baseline|frame|500x50px|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-delimiter>|</><link-ground image-parameter>baseline</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground image-parameter>500x50px</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - frameless image with specific size, border, and caption",
		"wikitext": "[[File:Foobar.jpg|frameless|442x50px|border|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>442x50px</><link-ground link-delimiter>|</><link-ground image-parameter>border</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - simple image with a formatted caption",
		"wikitext": "[[File:Foobar.jpg|<table><tr><td>a</td><td>b</td></tr><tr><td>c</td></tr></table>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>table</><link-ground htmltag-bracket>&gt&lt;</><link-ground htmltag-name>tr</><link-ground htmltag-bracket>&gt&lt;</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt</><link-ground file-text>a</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt&lt;</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt</><link-ground file-text>b</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt&lt;/</><link-ground htmltag-name>tr</><link-ground htmltag-bracket>&gt&lt;</><link-ground htmltag-name>tr</><link-ground htmltag-bracket>&gt&lt;</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt</><link-ground file-text>c</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>td</><link-ground htmltag-bracket>&gt&lt;/</><link-ground htmltag-name>tr</><link-ground htmltag-bracket>&gt&lt;/</><link-ground htmltag-name>table</><link-ground htmltag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - caption with a template in it",
		"wikitext": "[[File:Foobar.jpg|thumb|200x23px|This caption has a {{1x|transclusion}} in it.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>200x23px</><link-ground link-delimiter>|</><link-ground file-text>This caption has a </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>transclusion</><template-link-ground template-bracket>}}</><link-ground file-text> in it.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - caption with unbalanced tags in it",
		"wikitext": "foo\n[[File:Foobar.jpg|thumb|200x200px|This caption has a <center>unbalanced tag in it.]]\nbar",
		"parsed": "foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>200x200px</><link-ground link-delimiter>|</><link-ground file-text>This caption has a </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>center</><link-ground htmltag-bracket>&gt</><link-ground file-text>unbalanced tag in it.</><link-ground link-bracket>]]</>bar"
	},
	{
		"desc": "Parsoid-specific image handling - empty caption (1)",
		"wikitext": "[[File:Foobar.jpg|thumb|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - empty caption (2)",
		"wikitext": "[[File:Foobar.jpg|thumb]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - whitespace caption",
		"wikitext": "[[File:Foobar.jpg|thumb| ]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>| </><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid-specific image handling - lang option",
		"wikitext": "foo\n[[File:Foobar.svg|lang=de|caption]]\nbar",
		"parsed": "foo<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.svg</><link-ground link-delimiter>|</><link-ground image-parameter>lang=</><link-ground file-text>de</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>bar"
	},
	{
		"desc": "File containing double quotes and spaces",
		"wikitext": "[[File:Cool \"Gator\".png]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Cool \"Gator\".png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File containing single quotes",
		"wikitext": "[[File:Foo's ''italic'' bar.jpg]]\n[[File:Foo's ''italic'' bar.jpg|Foo's ''italic'' bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foo's ''italic'' bar.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foo's ''italic'' bar.jpg</><link-ground link-delimiter>|</><link-ground file-text>Foo's </><link-ground apostrophes>''</><link-ground file-text em>italic</><link-ground apostrophes>''</><link-ground file-text> bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken image links with HTML captions (T41700)",
		"wikitext": "[[File:Nonexistent|<script></script>]]\n[[File:Nonexistent|100x100px|<script></script>]]\n[[File:Nonexistent|&lt;]]\n[[File:Nonexistent|a<i>b</i>c]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Nonexistent</><link-ground link-delimiter>|</><link-ground file-text>&lt;script&gt&lt;/script&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Nonexistent</><link-ground link-delimiter>|</><link-ground image-parameter>100x100px</><link-ground link-delimiter>|</><link-ground file-text>&lt;script&gt&lt;/script&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Nonexistent</><link-ground link-delimiter>|</><link-ground entity>&amp;lt;</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Nonexistent</><link-ground link-delimiter>|</><link-ground file-text>a</><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>i</><link-ground htmltag-bracket>&gt</><link-ground file-text>b</><link-ground htmltag-bracket>&lt;/</><link-ground htmltag-name>i</><link-ground htmltag-bracket>&gt</><link-ground file-text>c</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media in wikilink",
		"wikitext": "[[Test|[[File:Foobar.jpg]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>]]"
	},
	{
		"desc": "Template with thumb image (with link in description)",
		"wikitext": "{{paramtest|param=[[Image:noimage.png|thumb|[[no link|link]] [[no link|caption]]]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>paramtest</><template-ground template-delimiter>|</><template-ground template-argument-name>param=</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Image:noimage.png</><template-link-ground link-delimiter>|</><template-link-ground image-parameter>thumb</><template-link-ground link-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>no link</><template-link-ground link-delimiter>|</><template-link-ground link-text>link</><template-link-ground link-bracket>]]</><template-link-ground file-text> </><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>no link</><template-link-ground link-delimiter>|</><template-link-ground link-text>caption</><template-link-ground link-bracket>]]]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "T3219 URL next to image (good)",
		"wikitext": "http://example.com [[File:Foobar.jpg]]",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T3219 URL next to image (broken)",
		"wikitext": "http://example.com[[File:Foobar.jpg]]",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image link to nonexistent file (T3850 - good)",
		"wikitext": "[[File:No_such.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:No_such.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": ":Image link to nonexistent file (T3850 - bad)",
		"wikitext": "[[:Image:No such.jpg]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>:Image:No such.jpg</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Fuzz testing: image with bogus manual thumbnail",
		"wikitext": "[[Image:foobar.jpg|thumbnail= ]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text> </><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Gallery with valid attributes",
		"wikitext": "<gallery type=\"123\" summary=\"345\">\nFile:File:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>type=</><exttag-attribute-value>\"123\"</><exttag-attribute ext-gallery> summary=</><exttag-attribute-value>\"345\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery",
		"wikitext": "<gallery>\nimage1.png |\nimage2.gif|||||\n\nimage3|\nimage4    |300px| centre\n image5.svg| http://///////\n[[x|xx]]]]\n* image6\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>image1.png </><tag-gallery link-delimiter>|</><tag-gallery link-pagename pagename>image2.gif</><tag-gallery link-delimiter>|||||</><tag-gallery link-pagename pagename>image3</><tag-gallery link-delimiter>|</><tag-gallery link-pagename pagename>image4    </><tag-gallery link-delimiter>|</><tag-gallery image-parameter>300px</><tag-gallery link-delimiter>| </><tag-gallery image-parameter>centre</><tag-gallery link-pagename pagename> image5.svg</><tag-gallery link-delimiter>| </><tag-gallery file-text>http://///////</><tag-gallery error>[[</><tag-gallery link-pagename pagename>x</><tag-gallery link-delimiter>|</><tag-gallery file-text>xx]]]]</><tag-gallery link-pagename pagename>* image6</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with line not in the file namespace",
		"wikitext": "<gallery>\n:'''''Albert Willimsky''' ''Geboren am 28.2.1890''\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>:'''''Albert Willimsky''' ''Geboren am 28.2.1890''</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery (with options, html)",
		"wikitext": "<gallery widths=\"70px\" heights=\"40px\" perrow=\"2\" caption=\"Foo [[Main Page]]\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nimage:foobar.jpg|some '''caption''' [[Main Page]]\nimage:foobar.jpg\nimage:foobar.jpg|alt=This is a foo-bar.|blabla.\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>widths=</><exttag-attribute-value>\"70px\"</><exttag-attribute ext-gallery> heights=</><exttag-attribute-value>\"40px\"</><exttag-attribute ext-gallery> perrow=</><exttag-attribute-value>\"2\"</><exttag-attribute ext-gallery> caption=</><exttag-attribute-value>\"Foo [[Main Page]]\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Nonexistent.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><tag-gallery link-pagename pagename>File:Nonexistent.jpgimage:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>some </><tag-gallery apostrophes>'''</><tag-gallery file-text strong>caption</><tag-gallery apostrophes>'''</><tag-gallery file-text> </><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>Main Page</><tag-gallery link-ground link-bracket>]]</><tag-gallery link-pagename pagename>image:foobar.jpgimage:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>This is a foo-bar.</><tag-gallery link-delimiter>|</><tag-gallery file-text>blabla.</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery (without px units)",
		"wikitext": "<gallery widths=\"70\" heights=\"40\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>widths=</><exttag-attribute-value>\"70\"</><exttag-attribute ext-gallery> heights=</><exttag-attribute-value>\"40\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery (with invalid units)",
		"wikitext": "<gallery widths=\"70em\" heights=\"40em\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>widths=</><exttag-attribute-value>\"70em\"</><exttag-attribute ext-gallery> heights=</><exttag-attribute-value>\"40em\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with link that has fragment",
		"wikitext": "<gallery>\nimage:foobar.jpg|link=Main_Page\nimage:foobar.jpg|link=Main_Page#section\nimage:foobar.jpg|link=Main Page#section|caption\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>image:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Main_Page</><tag-gallery link-pagename pagename>image:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Main_Page#section</><tag-gallery link-pagename pagename>image:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Main Page#section</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with template inside caption",
		"wikitext": "<gallery caption=\"{{1x|hi}}\">\nFile:Foobar.jpg|{{1x|ho}}\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>caption=</><exttag-attribute-value>\"{{1x|hi}}\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery template-ground template-bracket>{{</><tag-gallery template-ground template-name pagename>1x</><tag-gallery template-ground template-delimiter>|</><tag-gallery template-ground template>ho</><tag-gallery template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with wikitext inside gallery caption",
		"wikitext": "<gallery caption=\"# This should not be a list item\n\nText '''bold''' [[link]] {{ns:-1}}\n\n[[File:Foobar.jpg|thumb|File in gallery caption]]\">\nFile:Foobar.jpg|Image caption\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>caption=</><exttag-attribute-value>\"# This should not be a list itemText '''bold''' [[link]] {{ns:-1}}[[File:Foobar.jpg|thumb|File in gallery caption]]\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>Image caption</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with wikitext inside caption",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|[[File:Foobar.jpg|alt=inneralt|20x20px|desc]]\nFile:Foobar.jpg|alt=galleryalt|{{Test|unamedParam|alt=param}}\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>File:Foobar.jpg</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground image-parameter>alt=</><tag-gallery link-ground file-text>inneralt</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground image-parameter>20x20px</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground file-text>desc</><tag-gallery link-ground link-bracket>]]</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery template-ground template-bracket>{{</><tag-gallery template-ground template-name pagename>Test</><tag-gallery template-ground template-delimiter>|</><tag-gallery template-ground template>unamedParam</><tag-gallery template-ground template-delimiter>|</><tag-gallery template-ground template-argument-name>alt=</><tag-gallery template-ground template>param</><tag-gallery template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with wikitext incl bogus HTML tag (T237318)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|</ref>\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery error>&lt;/ref&gt</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery (with showfilename option)",
		"wikitext": "<gallery showfilename=\"\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nFile:Foobar.jpg|some '''caption''' [[Main Page]]\nFile:Foobar.jpg\nFile:Redirect to foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>showfilename=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Nonexistent.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><tag-gallery link-pagename pagename>File:Nonexistent.jpgFile:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>some </><tag-gallery apostrophes>'''</><tag-gallery file-text strong>caption</><tag-gallery apostrophes>'''</><tag-gallery file-text> </><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>Main Page</><tag-gallery link-ground link-bracket>]]</><tag-gallery link-pagename pagename>File:Foobar.jpgFile:Redirect to foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery (with namespace-less filenames)",
		"wikitext": "<gallery>\nFile:Nonexistent.jpg\nNonexistent.jpg\nimage:foobar.jpg\nfoobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Nonexistent.jpgNonexistent.jpgimage:foobar.jpgfoobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery override link with wikilink (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=Wikilink|alt=galleryalt\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Wikilink</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery override link with absolute external link (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|link=http://www.example.org\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>http://www.example.org</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery override link with absolute external link with LanguageConverter",
		"wikitext": "<gallery>\nFile:foobar.jpg|caption|alt=galleryalt|link=http://www.example.org\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>caption</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>http://www.example.org</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery override link with malicious javascript (T36852)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=galleryalt|link=\" onclick=\"alert('malicious javascript code!');\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>\" onclick=\"alert('malicious javascript code!');</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with invalid title as link (T45964)",
		"wikitext": "<gallery>\nFile:Foobar.jpg|link=<\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>&lt;</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Serialize gallery without attrs in data-mw",
		"wikitext": "<gallery caption=\"123\">\nFile:Test.png\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>caption=</><exttag-attribute-value>\"123\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Test.png</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery with class and style attributes",
		"wikitext": "<gallery class=\"center\" style=\"text-align: center;\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>class=</><exttag-attribute-value>\"center\"</><exttag-attribute ext-gallery> style=</><exttag-attribute-value>\"text-align: center;\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery in nolines mode",
		"wikitext": "<gallery mode=\"nolines\" showfilenames=\"yes\" caption=\"No Lines!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>mode=</><exttag-attribute-value>\"nolines\"</><exttag-attribute ext-gallery> showfilenames=</><exttag-attribute-value>\"yes\"</><exttag-attribute ext-gallery> caption=</><exttag-attribute-value>\"No Lines!\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>foo</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery in slideshow mode",
		"wikitext": "<gallery mode=\"slideshow\" showthumbnails=\"\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>mode=</><exttag-attribute-value>\"slideshow\"</><exttag-attribute ext-gallery> showthumbnails=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery in packed mode",
		"wikitext": "<gallery mode=\"packed\">\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>mode=</><exttag-attribute-value>\"packed\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery in packed-overlay mode",
		"wikitext": "<gallery mode=\"packed-overlay\" showfilenames=\"yes\" caption=\"Packed Overlay!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>mode=</><exttag-attribute-value>\"packed-overlay\"</><exttag-attribute ext-gallery> showfilenames=</><exttag-attribute-value>\"yes\"</><exttag-attribute ext-gallery> caption=</><exttag-attribute-value>\"Packed Overlay!\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>foo</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery in packed-hover mode",
		"wikitext": "<gallery mode=\"packed-hover\" showfilenames=\"yes\" caption=\"Packed Hover!\">\nFile:Foobar.jpg|foo\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>mode=</><exttag-attribute-value>\"packed-hover\"</><exttag-attribute ext-gallery> showfilenames=</><exttag-attribute-value>\"yes\"</><exttag-attribute ext-gallery> caption=</><exttag-attribute-value>\"Packed Hover!\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>foo</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Serialize gallery image captions on a line",
		"wikitext": "<gallery>\nFile:Foobar.jpg| hi  ho \nFile:Foobar.jpg|hi<br />ho\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>| </><tag-gallery file-text>hi  ho </><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>hi</><tag-gallery htmltag-bracket>&lt;</><tag-gallery htmltag-name>br </><tag-gallery htmltag-bracket>/&gt</><tag-gallery file-text>ho</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Centre-aligned image",
		"wikitext": "[[Image:foobar.jpg|centre]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>centre</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "None-aligned image",
		"wikitext": "[[Image:foobar.jpg|none]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>none</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Width + Height sized image (using px) (height is ignored)",
		"wikitext": "[[Image:foobar.jpg|640x480px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>640x480px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Width-sized image (using px, no following whitespace)",
		"wikitext": "[[Image:foobar.jpg|640px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>640px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Width-sized image (using px, with following whitespace - test regression from r39467)",
		"wikitext": "[[Image:foobar.jpg|640px ]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>640px </><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Width-sized image (using px, with preceding whitespace - test regression from r39467)",
		"wikitext": "[[Image:foobar.jpg| 640px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:foobar.jpg</><link-ground link-delimiter>| </><link-ground image-parameter>640px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with page parameter",
		"wikitext": "[[File:LoremIpsum.djvu]]\n\n[[File:LoremIpsum.djvu|page=2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><link-ground file-text>2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with page parameter and link",
		"wikitext": "[[File:LoremIpsum.djvu|link=https://google.com|page=2]]\n[[File:LoremIpsum.djvu|link=https://google.com?page=4|page=2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>https://google.com</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><link-ground file-text>2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>https://google.com?page=4</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><link-ground file-text>2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with page parameter and manualthumb",
		"wikitext": "[[File:LoremIpsum.djvu|thumbnail=Thumb.png|page=2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><link-ground file-text>2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with page parameter generated by a template",
		"wikitext": "[[File:LoremIpsum.djvu|page={{1x|2}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>2</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with modified page parameter; serialize data-mw not href query",
		"wikitext": "[[File:LoremIpsum.djvu|page 2]]\n\n[[File:LoremIpsum.djvu|page {{1x|2}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page </><link-ground file-text>2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>2</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with modified page parameter; serialize data-mw not href query (2)",
		"wikitext": "[[File:LoremIpsum.djvu|page 2]]\n\n[[File:LoremIpsum.djvu|page {{1x|2}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page </><link-ground file-text>2</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>page </><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>2</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Images with the \"|\" character in the comment",
		"wikitext": "[[File:Foobar.jpg|thumb|An [http://test/?param1=|left|&param2=|x external] URL]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>An </><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>test/?param1=|left|&amp;param2=|x</><link-ground extlink-text> external</><link-ground extlink-bracket>]</><link-ground file-text> URL</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "T146305: Don't break image parsing if nested language converter markup is in the caption.",
		"wikitext": "[[File:Foobar.jpg|thumb|-{|zh-cn:blog (hk: -{zh-hans|WEBJOURNAL}-, tw: -{zh-hans|WEBLOG}-)}-]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground convert-bracket>-{</><link-ground convert-delimiter>|</><link-ground convert-lang>zh-cn:</><link-ground file-text>blog (hk: </><link-ground convert-bracket>-{</><link-ground convert-flag>zh-hans</><link-ground convert-delimiter>|</><link-ground file-text>WEBJOURNAL</><link-ground convert-bracket>}-</><link-ground file-text>, tw: </><link-ground convert-bracket>-{</><link-ground convert-flag>zh-hans</><link-ground convert-delimiter>|</><link-ground file-text>WEBLOG</><link-ground convert-bracket>}-</><link-ground file-text>)</><link-ground convert-bracket>}-</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Don't break gallery if language converter markup is inside.",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=-{R|bat}-|[[File:foobar.jpg|20px|desc|alt=-{R|foo}-|-{R|bar}-]]\nFile:Foobar.jpg|alt=galleryalt|{{Test|unamedParam|alt=-{R|param}-}}\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery convert-bracket>-{</><tag-gallery convert-flag>R</><tag-gallery convert-delimiter>|</><tag-gallery file-text>bat</><tag-gallery convert-bracket>}-</><tag-gallery link-delimiter>|</><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>File:foobar.jpg</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground image-parameter>20px</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground file-text>desc</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground image-parameter>alt=</><tag-gallery link-ground convert-bracket>-{</><tag-gallery link-ground convert-flag>R</><tag-gallery link-ground convert-delimiter>|</><tag-gallery link-ground file-text>foo</><tag-gallery link-ground convert-bracket>}-</><tag-gallery link-ground link-delimiter>|</><tag-gallery link-ground convert-bracket>-{</><tag-gallery link-ground convert-flag>R</><tag-gallery link-ground convert-delimiter>|</><tag-gallery link-ground file-text>bar</><tag-gallery link-ground convert-bracket>}-</><tag-gallery link-ground link-bracket>]]</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>galleryalt</><tag-gallery link-delimiter>|</><tag-gallery template-ground template-bracket>{{</><tag-gallery template-ground template-name pagename>Test</><tag-gallery template-ground template-delimiter>|</><tag-gallery template-ground template>unamedParam</><tag-gallery template-ground template-delimiter>|</><tag-gallery template-ground template-argument-name>alt=</><tag-gallery template-ground convert-bracket>-{</><tag-gallery template-ground convert-flag>R</><tag-gallery template-ground convert-delimiter>|</><tag-gallery template-ground template>param</><tag-gallery template-ground convert-bracket>}-</><tag-gallery template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Free external link invading image caption",
		"wikitext": "[[File:Foobar.jpg|thumb|http://x|hello]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>http://x</><link-ground link-delimiter>|</><link-ground file-text>hello</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Special characters in embedded file links (T29679)",
		"wikitext": "[[File:Contains & ampersand.jpg]]\n[[File:Does not exist.jpg|Title with & ampersand]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Contains &amp; ampersand.jpg</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Does not exist.jpg</><link-ground link-delimiter>|</><link-ground file-text>Title with &amp; ampersand</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "1. Treebuilder fixup of formatting elt",
		"wikitext": "{|\n|\n<small>\n[[Image:Foobar.jpg|right|Test]]\n</small>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground file-text>Test</><link-ground link-bracket>]]</><htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "2. Treebuilder fixup of formatting elt",
		"wikitext": "'''foo[[File:Foobar.jpg|thumb|caption]]bar'''\n\n<small>[[Image:Foobar.jpg|right|300px]]</small>",
		"parsed": "<apostrophes>'''</><strong>foo</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text strong>caption</><link-ground link-bracket>]]</><strong>bar</><apostrophes>'''</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>300px</><link-ground link-bracket>]]</><htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. Treebuilder fixup of formatting elt",
		"wikitext": "<small>'''foo[[File:Foobar.jpg|thumb|caption]]bar'''</small>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><apostrophes>'''</><strong>foo</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text strong>caption</><link-ground link-bracket>]]</><strong>bar</><apostrophes>'''</><htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. Treebuilder fixup of formatting elt: formatting tags around captionless images",
		"wikitext": "'''<small>[[Image:Foobar.jpg|right|300px]]</small>'''",
		"parsed": "<apostrophes>'''</><htmltag-bracket>&lt;</><htmltag-name>small</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>300px</><link-ground link-bracket>]]</><htmltag-bracket>&lt;/</><htmltag-name>small</><htmltag-bracket>&gt</><apostrophes>'''</>"
	},
	{
		"desc": "Image: Modifying size of an image (1)",
		"wikitext": "[[Image:Foobar.jpg|230x230px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>230x230px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying size of an image (2)",
		"wikitext": "[[Image:Foobar.jpg|230x230px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>230x230px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying size of an image (3)",
		"wikitext": "[[Image:Foobar.jpg|thumb]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying alignment of an image (T50665)",
		"wikitext": "[[Image:Foobar.jpg|thumb|caption|right]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying mw-default-size of an frameless image (T64805)",
		"wikitext": "[[Image:Foobar.jpg|frameless|right]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying valign of an image (T51221)",
		"wikitext": "[[File:Foobar.jpg|20px|middle]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>20px</><link-ground link-delimiter>|</><link-ground image-parameter>middle</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying alt attribute of an image (T58400)",
		"wikitext": "[[File:Foobar.jpg|thumb|some caption|alt=some alternate text]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>some caption</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>some alternate text</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Modifying caption of an image",
		"wikitext": "[[Image:Foobar.jpg|thumb|original caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>original caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: empty alt attribute (T50924)",
		"wikitext": "[[File:Foobar.jpg|alt=|thumb|bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Block level image should have \\n before and after",
		"wikitext": "123\n[[File:Foobar.jpg|right|thumb|150x150px]]\n456",
		"parsed": "123<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>150x150px</><link-ground link-bracket>]]</>456"
	},
	{
		"desc": "Image: New block level image should have \\n before and after (existing content)",
		"wikitext": "123\n[[File:Foobar.jpg|right|thumb|150x150px]]\n456",
		"parsed": "123<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>right</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>150x150px</><link-ground link-bracket>]]</>456"
	},
	{
		"desc": "Image: upright option (parsoid)",
		"wikitext": "[[File:Foobar.jpg|thumb|upright|caption]]\n[[File:Foobar.jpg|thumb|upright=0.5|caption]]\n[[File:Foobar.jpg|thumb|500x500px|upright=0.5|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>upright</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>upright=</><link-ground file-text>0.5</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>500x500px</><link-ground link-delimiter>|</><link-ground image-parameter>upright=</><link-ground file-text>0.5</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: upright option is ignored on inline and frame images (parsoid)",
		"wikitext": "[[File:Foobar.jpg|500x500px|upright=0.5|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>500x500px</><link-ground link-delimiter>|</><link-ground image-parameter>upright=</><link-ground file-text>0.5</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: in template parameter with empty parameter",
		"wikitext": "{{1x|[[File:Foobar.jpg|link=]]}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>File:Foobar.jpg</><template-link-ground link-delimiter>|</><template-link-ground image-parameter>link=</><template-link-ground link-bracket>]]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Image: from basic HTML (1)",
		"wikitext": "[[File:Foobar.jpg|link=|alt=Alt|100x100px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>Alt</><link-ground link-delimiter>|</><link-ground image-parameter>100x100px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: from basic HTML (2)",
		"wikitext": "[[File:Foobar.jpg|link=|alt=Alt|100x100px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>Alt</><link-ground link-delimiter>|</><link-ground image-parameter>100x100px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: from basic HTML (3)",
		"wikitext": "[[File:Foobar.jpg|link=Main|alt=Alt|100x100px]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Main</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>Alt</><link-ground link-delimiter>|</><link-ground image-parameter>100x100px</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: from basic HTML (4)",
		"wikitext": "[[File:Foobar.jpg|link=]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image: Invalid title as link",
		"wikitext": "[[File:Foobar.jpg|link=<]]\n[[File:Foobar.jpg|link=<|thumb]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>&lt;</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>&lt;</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Image with page parameter and invalid link",
		"wikitext": "[[File:LoremIpsum.djvu|link=<|page=2]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:LoremIpsum.djvu</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>&lt;</><link-ground link-delimiter>|</><link-ground image-parameter>page=</><link-ground file-text>2</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Percent decode titles in the link option (T216003#7836261)",
		"wikitext": "[[Test%22123]]\n[[File:Foobar.jpg|link=Test%22123]]\n[[File:Foobar.jpg|link=[[Test%22123]]]]\n\n<gallery>\nFile:Foobar.jpg|link=Test%22123\nFile:Foobar.jpg|link=[[Test%22123]]\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test%22123</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Test%22123</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test%22123</><link-ground link-bracket>]]]]</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery file-text>Test%22123</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>link=</><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>Test%22123</><tag-gallery link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Should not double decode the link option",
		"wikitext": "[[Test%2522]]\n[[File:Foobar.jpg|link=Test%2522]]\n[[File:Foobar.jpg|link=[[Test%2522]]]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test%2522</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground file-text>Test%2522</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Test%2522</><link-ground link-bracket>]]]]</>"
	},
	{
		"desc": "Various link types in alt and link options",
		"wikitext": "[[File:Foobar.jpg|link=[[Main Page]]|alt=[[Main Page]]|caption]]\n\n[[File:Foobar.jpg|link=[[Media:Thumb.png]]|alt=[[Media:Thumb.png]]|caption]]\n\n[[File:Foobar.jpg|link=[[wikipedia:Foo]]|alt=[[wikipedia:Foo]]|caption]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Thumb.png</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Media:Thumb.png</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>link=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>wikipedia:Foo</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground link-bracket>[[</><link-ground link-pagename pagename>wikipedia:Foo</><link-ground link-bracket>]]</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Magic links inside image captions (autolinked)",
		"wikitext": "[[File:Foobar.jpg|thumb|http://example.com]]\n[[File:Foobar.jpg|thumb|RFC 1234]]\n[[File:Foobar.jpg|thumb|PMID 1234]]\n[[File:Foobar.jpg|thumb|ISBN 123456789x]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>http://example.com</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>RFC 1234</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>PMID 1234</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>ISBN 123456789x</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File in link scenarios",
		"wikitext": "[http://www.google.com [[File:Foobar.jpg|123]]]\n\n[http://www.google.com [[File:Foobar.jpg|thumb|123]]]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>www.google.com</><link-ground extlink-text> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]]</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>www.google.com</><link-ground extlink-text> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]]</><link-ground extlink-bracket>]</>"
	},
	{
		"desc": "Thumbnail output",
		"wikitext": "[[File:Thumb.png|thumb]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Thumb.png</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File with caption with pipe in extension tag attribute",
		"wikitext": "[[File:Foobar.jpg|thumb|Test <nowiki bogus=\"attri|bute\"/> 123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Test </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki </><link-ground exttag-attribute ext-nowiki>bogus=</><link-ground exttag-attribute-value>\"attri|bute\"</><link-ground exttag-bracket>/&gt</><link-ground file-text> 123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File with table in caption with extra table attribute spaces",
		"wikitext": "[[File:Foobar.jpg|thumb|\n{|\n|-  \n|hi\n|}\n]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground table-bracket>{|</><link-ground table-delimiter>|-  |</><link-ground table-td>hi</><link-ground table-bracket>|}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "File in formatting element violating content model",
		"wikitext": "<p>''[[File:Foobar.jpg|thumb]]''</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "File in formatting element violating content model, multiple open",
		"wikitext": "<p>'''''[[File:Foobar.jpg|thumb]]'''''</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><apostrophes>'''''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong em>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</><apostrophes>'''''</><htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "File in formatting element violating content model, figcaption content",
		"wikitext": "<p>''test [[File:Foobar.jpg|thumb|123]] 456''</p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><apostrophes>''</><em>test </><link-ground link-bracket>[[</><link-ground link-pagename pagename em>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text em>123</><link-ground link-bracket>]]</><em> 456</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Table in figcaption nested in table",
		"wikitext": "{|\n|foo\n|[[File:Foobar.jpg|thumb|\n{|\n|bar\n|}\n]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground table-bracket>{|</><link-ground table-delimiter>|</><link-ground table-td>bar</><link-ground table-bracket>|}</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "Files with case sensitive media options",
		"wikitext": "[[File:Foobar.jpg|thumb|left]]\n[[File:Foobar.jpg|thumb|Left]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground image-parameter>left</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>Left</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Exercise selser on native galleries",
		"wikitext": "<gallery>\nFile:Foobar.jpg|alt=123|123\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>alt=</><tag-gallery file-text>123</><tag-gallery link-delimiter>|</><tag-gallery file-text>123</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Selser preserves spacing in gallery when only caption is edited",
		"wikitext": "<gallery caption=\"123\">\nFile:Foobar.jpg\n\nFile:Foobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>caption=</><exttag-attribute-value>\"123\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpgFile:Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Selser preserves unedited gallery lines",
		"wikitext": "<gallery>\nFile:Foobar.jpg|123\nFile:Foobar.jpg|thumb|haha\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>123</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>thumb</><tag-gallery link-delimiter>|</><tag-gallery file-text>haha</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Format option in gallery - T214601",
		"wikitext": "<gallery>\nFile:Foobar.jpg|thumb|123\nFile:Doesnotexist.jpg|thumb|456 - has an error noted in the rdfa\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>thumb</><tag-gallery link-delimiter>|</><tag-gallery file-text>123</><tag-gallery link-pagename pagename>File:Doesnotexist.jpg</><tag-gallery link-delimiter>|</><tag-gallery image-parameter>thumb</><tag-gallery link-delimiter>|</><tag-gallery file-text>456 - has an error noted in the rdfa</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Broken inline media with a caption and an alt",
		"wikitext": "[[File:Broken.jpg|alt=An alternative text description.|A caption for the media.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Broken.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>An alternative text description.</><link-ground link-delimiter>|</><link-ground file-text>A caption for the media.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken block media with a caption and an alt",
		"wikitext": "[[File:Broken.jpg|alt=An alternative text description.|thumb|A caption for the media.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Broken.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>alt=</><link-ground file-text>An alternative text description.</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>A caption for the media.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken inline media with a caption",
		"wikitext": "[[File:Broken.jpg|A caption for the media.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Broken.jpg</><link-ground link-delimiter>|</><link-ground file-text>A caption for the media.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken block media with a caption",
		"wikitext": "[[File:Broken.jpg|thumb|A caption for the media.]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Broken.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>A caption for the media.</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Gallery line without file namespace",
		"wikitext": "<gallery>\nFoobar.jpg\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>Foobar.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Lines added to a self-closed gallery should not be dropped",
		"wikitext": "<gallery caption=\"123\" />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>caption=</><exttag-attribute-value>\"123\"</><exttag-attribute ext-gallery> </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "Broken media with frame and frameless formats",
		"wikitext": "[[File:Barfoo.jpg|frame|123]]\n[[File:Barfoo.jpg|frameless|123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Barfoo.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frame</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>File:Barfoo.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>frameless</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media with broken manualthumb",
		"wikitext": "[[File:Foobar.jpg|thumbnail=Barfoo.jpg|123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumbnail=</><link-ground file-text>Barfoo.jpg</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Media with caption that would stringify to a valid media option",
		"wikitext": "[[File:Foobar.jpg|'''thumb''']]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground apostrophes>'''</><link-ground file-text strong>thumb</><link-ground apostrophes>'''</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Collect media metadata",
		"wikitext": "[[File:Foobar.jpg|123]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground file-text>123</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Entities in media filenames",
		"wikitext": "[[File:Hi&#45;ho.jpg|thumb]]\n\n<gallery>\nHi&#45;ho.jpg\nFile:Hi&#45;ho.jpg\n</gallery>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Hi&amp;#45;ho.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>Hi&amp;#45;ho.jpgFile:Hi&amp;#45;ho.jpg</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Inline gallery attributes are appended to the defaults",
		"wikitext": "<gallery perrow=\"1\" style=\"color: red\">\nFile:Foobar.jpg|One\nFile:Foobar.jpg|Two\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery </><exttag-attribute ext-gallery>perrow=</><exttag-attribute-value>\"1\"</><exttag-attribute ext-gallery> style=</><exttag-attribute-value>\"color: red\"</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>One</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>Two</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Gallery line with trailing closing square brackets",
		"wikitext": "<gallery>\nFile:Foobar.jpg|Testing 123]]\nFile:Foobar.jpg|Testing [[123]]\n</gallery>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>gallery</><exttag-bracket>&gt</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>Testing 123]]</><tag-gallery link-pagename pagename>File:Foobar.jpg</><tag-gallery link-delimiter>|</><tag-gallery file-text>Testing </><tag-gallery link-ground link-bracket>[[</><tag-gallery link-ground link-pagename pagename>123</><tag-gallery link-ground link-bracket>]]</><exttag-bracket>&lt;/</><exttag-name>gallery</><exttag-bracket>&gt</>"
	},
	{
		"desc": "parserFunctionTests"
	},
	{
		"desc": "T240248: Erroring parser function shouldn't break references",
		"wikitext": "<ref>something</ref>\n{{#ifeq: {{#expr: string < 5 }} | 1 | true | false or error }}\n<references />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>ref</><exttag-bracket>&gt</><tag-ref>something</><exttag-bracket>&lt;/</><exttag-name>ref</><exttag-bracket>&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#ifeq</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> </><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#expr</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction> string &lt; 5 </><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction> </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> 1 </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> true </><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction> false or error </><ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;</><exttag-name>references </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "pfeqParserTests"
	},
	{
		"desc": "Basic usage of {{=}}",
		"wikitext": "This uses {{=}}.",
		"parsed": "This uses <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>=</><ext-ground parserfunction-bracket>}}</>."
	},
	{
		"desc": "Using {{Template:=}} doesn't invoke the parser function",
		"wikitext": "This uses {{Template:=}}.",
		"parsed": "This uses <template-ground template-bracket>{{</><template-ground template-name pagename>Template:=</><template-ground template-bracket>}}</>."
	},
	{
		"desc": "poem"
	},
	{
		"desc": "<poem>",
		"wikitext": "<poem>\nthis\nis\na\ntest\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem>thisisatest</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<poem> with recursive parsing",
		"wikitext": "<poem>\nthis ''is'' a '''test'''\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem>this </><tag-poem apostrophes>''</><tag-poem em>is</><tag-poem apostrophes>''</><tag-poem> a </><tag-poem apostrophes>'''</><tag-poem strong>test</><tag-poem apostrophes>'''</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<poem> with leading whitespace",
		"wikitext": "<poem>\n\n   test\n\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem skipformatting> </><tag-poem>  test</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Horizontal rule",
		"wikitext": "<poem>\nsome\n-----\ntext\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem>some</><tag-poem hr>-----</><tag-poem>text</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "nested <poem><nowiki>",
		"wikitext": "<poem><nowiki>\nthis\nis\na\ntest\n</nowiki></poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem exttag-bracket>&lt;</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><tag-poem tag-nowiki>thisisatest</><tag-poem exttag-bracket>&lt;/</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "nested <poem><nowiki> with formatting",
		"wikitext": "<poem><nowiki>\nthis\n'''is'''\na\ntest\n</nowiki></poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem exttag-bracket>&lt;</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><tag-poem tag-nowiki>this'''is'''atest</><tag-poem exttag-bracket>&lt;/</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Basic <poem> usage with style",
		"wikitext": "<poem style=\"border: 2px solid #d6d2c5; background-color: #f9f4e6; padding: 1em;\">\nA stately pleasure-dome decree:\nWhere Alph, the sacred river, ran\nThrough caverns measureless to man\nDown to a sunless sea.\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem </><exttag-attribute ext-poem>style=</><exttag-attribute-value>\"border: 2px solid #d6d2c5; background-color: #f9f4e6; padding: 1em;\"</><exttag-bracket>&gt</><tag-poem>A stately pleasure-dome decree:Where Alph, the sacred river, ranThrough caverns measureless to manDown to a sunless sea.</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Verify Parsoid handles entities in nowikis in poem correctly",
		"wikitext": "<poem>\nL1\nL2\n<nowiki>\n<ref>Not a ref</ref>\nfoo &amp; bar\n[[Not a link]]\n</nowiki>\nL3\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem>L1L2</><tag-poem exttag-bracket>&lt;</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><tag-poem tag-nowiki>&lt;ref&gtNot a ref&lt;/ref&gtfoo </><tag-poem tag-nowiki entity>&amp;amp;</><tag-poem tag-nowiki> bar[[Not a link]]</><tag-poem exttag-bracket>&lt;/</><tag-poem exttag-name>nowiki</><tag-poem exttag-bracket>&gt</><tag-poem>L3</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "UTF-8 sequences in extension tags (T231945)",
		"wikitext": "<poem>\n{{1x|ၶိူဝ်းႁဝ်ၶိူဝ်းရႃႇၸႃႇ}}\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem template-ground template-bracket>{{</><tag-poem template-ground template-name pagename>1x</><tag-poem template-ground template-delimiter>|</><tag-poem template-ground template>ၶိူဝ်းႁဝ်ၶိူဝ်းရႃႇၸႃႇ</><tag-poem template-ground template-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Multi-line poems with indentation use spans and breaks correctly (T235709)",
		"wikitext": "<poem>\n''CONGREGATI''\n:'''EX TOTO ORBE'''\n::'''''MATHEMATICI'''''\n:<span>foo</span>\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem apostrophes>''</><tag-poem em>CONGREGATI</><tag-poem apostrophes>''</><tag-poem list>:</><tag-poem apostrophes>'''</><tag-poem strong>EX TOTO ORBE</><tag-poem apostrophes>'''</><tag-poem list>::</><tag-poem apostrophes>'''''</><tag-poem strong em>MATHEMATICI</><tag-poem apostrophes>'''''</><tag-poem list>:</><tag-poem htmltag-bracket>&lt;</><tag-poem htmltag-name>span</><tag-poem htmltag-bracket>&gt</><tag-poem>foo</><tag-poem htmltag-bracket>&lt;/</><tag-poem htmltag-name>span</><tag-poem htmltag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Indention syntax with no content",
		"wikitext": "<poem>\n::\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem</><exttag-bracket>&gt</><tag-poem list>::</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Poem with class",
		"wikitext": "<poem class=\"hiho\">\nhi ho\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem </><exttag-attribute ext-poem>class=</><exttag-attribute-value>\"hiho\"</><exttag-bracket>&gt</><tag-poem>hi ho</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Poem with empty class",
		"wikitext": "<poem class=\"\">\nhi ho\n</poem>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>poem </><exttag-attribute ext-poem>class=</><exttag-attribute-value>\"\"</><exttag-bracket>&gt</><tag-poem>hi ho</><exttag-bracket>&lt;/</><exttag-name>poem</><exttag-bracket>&gt</>"
	},
	{
		"desc": "preTags"
	},
	{
		"desc": "<pre> with attributes (T5202)",
		"wikitext": "<pre style=\"background: blue; color:white\">Bluescreen of WikiDeath</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>style=</><exttag-attribute-value>\"background: blue; color:white\"</><exttag-bracket>&gt</><tag-pre>Bluescreen of WikiDeath</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<pre> with width attribute (T5202)",
		"wikitext": "<pre width=\"8\">Narrow screen goodies</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>width=</><exttag-attribute-value>\"8\"</><exttag-bracket>&gt</><tag-pre>Narrow screen goodies</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<pre> with forbidden attribute (T5202)",
		"wikitext": "<pre width=\"8\" onmouseover=\"alert(document.cookie)\">Narrow screen goodies</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>width=</><exttag-attribute-value>\"8\"</><exttag-attribute ext-pre> onmouseover=</><exttag-attribute-value>\"alert(document.cookie)\"</><exttag-bracket>&gt</><tag-pre>Narrow screen goodies</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Entities inside <pre>",
		"wikitext": "<pre>&lt;</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre entity>&amp;lt;</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<pre> with forbidden attribute values (T5202)",
		"wikitext": "<pre width=\"8\" style=\"border-width: expression(alert(document.cookie))\">Narrow screen goodies</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>width=</><exttag-attribute-value>\"8\"</><exttag-attribute ext-pre> style=</><exttag-attribute-value>\"border-width: expression(alert(document.cookie))\"</><exttag-bracket>&gt</><tag-pre>Narrow screen goodies</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<nowiki> inside <pre> (T15238)",
		"wikitext": "<pre>\n<nowiki>\n</pre>\n<pre>\n<nowiki></nowiki>\n</pre>\n<pre><nowiki><nowiki></nowiki>Foo<nowiki></nowiki></nowiki></pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>&lt;nowiki&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>&lt;nowiki&gt&lt;/nowiki&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>&lt;nowiki&gt&lt;nowiki&gt&lt;/nowiki&gtFoo&lt;nowiki&gt&lt;/nowiki&gt&lt;/nowiki&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "<nowiki> inside of #tag:pre",
		"wikitext": "{{#tag:pre|Foo <nowiki>&rarr;bar</nowiki>}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>pre</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Foo </><ext-ground exttag-bracket>&lt;</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><tag-nowiki entity>&amp;rarr;</><tag-nowiki>bar</><ext-ground exttag-bracket>&lt;/</><ext-ground exttag-name>nowiki</><ext-ground exttag-bracket>&gt</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "<nowiki> and <pre> preference (first one wins)",
		"wikitext": "<pre>\n<nowiki>\n</pre>\n</nowiki>\n</pre>\n\n<nowiki>\n<pre>\n<nowiki>\n</pre>\n</nowiki>\n</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>&lt;nowiki&gt</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><error>&lt;/nowiki&gt&lt;/pre&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;pre&gt&lt;nowiki&gt&lt;/pre&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><error>&lt;/pre&gt</>"
	},
	{
		"desc": "</pre> inside nowiki",
		"wikitext": "<nowiki></pre></nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;/pre&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Empty pre; pre inside other HTML tags (T56946)",
		"wikitext": "a\n\n<div><pre>\nfoo\n</pre></div>\n<pre></pre>",
		"parsed": "a<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "HTML pre followed by indent-pre",
		"wikitext": "<pre>foo</pre>\n bar",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><skipformatting> </>bar"
	},
	{
		"desc": "Block tag pre",
		"wikitext": "<p><pre>foo</pre></p>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>p</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>p</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Pres with newline attributes",
		"wikitext": "<pre class=\"one\ntwo\">hi</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>class=</><exttag-attribute-value>\"onetwo\"</><exttag-bracket>&gt</><tag-pre>hi</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Things that look like <pre> tags aren't treated as such",
		"wikitext": "Barack Obama <President> of the United States\n<President></President>",
		"parsed": "Barack Obama <President> of the United States<President></President>"
	},
	{
		"desc": "Handle broken pre-like tags (T66025)",
		"wikitext": "{{1x|<pre <pre>x</pre>}}\n\n<table><pre </table>",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground exttag-bracket>&lt;</><template-ground exttag-name>pre </><template-ground exttag-attribute ext-pre>&lt;pre</><template-ground exttag-bracket>&gt</><tag-pre>x</><template-ground exttag-bracket>&lt;/</><template-ground exttag-name>pre</><template-ground exttag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>&lt;/table</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Less than in attribute position",
		"wikitext": "<pre <pre>123</pre>\n\n<div <div>123</div>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>&lt;pre</><exttag-bracket>&gt</><tag-pre>123</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</><htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>123<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: handle pre with space after attribute",
		"wikitext": "<pre style=\"width:50%;\" >{{1x|foo}}</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-attribute ext-pre>style=</><exttag-attribute-value>\"width:50%;\"</><exttag-attribute ext-pre> </><exttag-bracket>&gt</><tag-pre>{{1x|foo}}</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Self-closed pre",
		"wikitext": "<pre />",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre </><exttag-bracket>/&gt</>"
	},
	{
		"desc": "HTML-pre: 1. embedded newlines",
		"wikitext": "<pre>foo</pre>\n\n<pre>\nfoo\n</pre>\n\n<pre>\n\nfoo\n</pre>\n\n<pre>\n\n\nfoo\n</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "HTML-pre: big spaces",
		"wikitext": "<pre>\n\n\n\n\nhaha\n\n\n\n\nhaha\n\n\n\n\n</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>hahahaha</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "HTML-pre: 2: indented text",
		"wikitext": "<pre>\n foo\n</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre> foo</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "HTML-pre: 3: other wikitext",
		"wikitext": "<pre>\n* foo\n# bar\n= no-h =\n'' no-italic ''\n[[ NoLink ]]\n</pre>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>pre</><exttag-bracket>&gt</><tag-pre>* foo# bar= no-h ='' no-italic ''[[ NoLink ]]</><exttag-bracket>&lt;/</><exttag-name>pre</><exttag-bracket>&gt</>"
	},
	{
		"desc": "preprocessor"
	},
	{
		"desc": "Preprocessor precedence 1: link is rightmost opening",
		"wikitext": "{{[[Foo|bar}}]]\n\nBut close-brace is not a valid character in a link title:\n{{[[Foo}}|bar]]\n\nHowever, we can still tell this was handled as a link in the preprocessor:\n{{1x|[[Foo}}|bar]]|bat}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground error>[[</><template-ground template-name pagename>Foo</><template-ground template-delimiter>|</><template-ground template>bar</><template-ground template-bracket>}}</>]]But close-brace is not a valid character in a link title:<template-ground template-bracket>{{</><template-ground error>[[</><template-ground template-name pagename>Foo</><template-ground template-bracket>}}</>|bar]]However, we can still tell this was handled as a link in the preprocessor:<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground error>}}</><template-link-ground link-delimiter>|</><template-link-ground link-text>bar</><template-link-ground link-bracket>]]</><template-ground template-delimiter>|</><template-ground template>bat</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 2: template is rightmost opening",
		"wikitext": "-{{1x|foo}-}}-",
		"parsed": "-<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo}-</><template-ground template-bracket>}}</>-"
	},
	{
		"desc": "Preprocessor precedence 3: language converter is rightmost opening",
		"wikitext": "{{1x|hi}}\n\n{{-{R|1x|hi}}}-\n\n[[-{R|raw]]}-",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground template-bracket>}}{{</><template-ground template-name pagename>-</><template-ground error>{</><template-ground template-name pagename>R</><template-ground template-delimiter>|</><template-ground template>1x</><template-ground template-delimiter>|</><template-ground template>hi</><template-ground template-bracket>}}</>}-<link-ground link-bracket>[[</><link-ground link-pagename pagename>-</><link-ground error>{</><link-ground link-pagename pagename>R</><link-ground link-delimiter>|</><link-ground link-text>raw</><link-ground link-bracket>]]</>}-"
	},
	{
		"desc": "Preprocessor precedence 4: left-most angle bracket",
		"wikitext": "<!--{raw}-->",
		"parsed": "<comment>&lt;!--{raw}--&gt</>"
	},
	{
		"desc": "Preprocessor precedence 5: tplarg takes precedence over template",
		"wikitext": "{{Precedence5|Bullet}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Precedence5</><template-ground template-delimiter>|</><template-ground template>Bullet</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 6: broken link is rightmost opening",
		"wikitext": "{{1x|[[Foo}}\n\n{{1x|[[Foo|bar|bat=baz}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground error>}}</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-link-ground link-bracket>[[</><template2-link-ground link-pagename pagename>Foo</><template2-link-ground link-delimiter>|</><template2-link-ground link-text>bar|bat=baz}}</>"
	},
	{
		"desc": "Preprocessor precedence 7: broken template is rightmost opening",
		"wikitext": "[[Foo|{{1x|Bar]]\n\n[[Foo|{{1x|Bar]]-x}}-y]]-z\n\nCareful: linktrails can move the end of the wikilink:\n[[Foo|{{1x|y']]a}}l]]l",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Bar]]</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template2-link-ground template-bracket>{{</><template2-link-ground template-name pagename>1x</><template2-link-ground template-delimiter>|</><template2-link-ground template>Bar]]-x</><template2-link-ground template-bracket>}}</><template-link-ground link-text>-y</><template-link-ground link-bracket>]]</><template-link-ground template>-zCareful: linktrails can move the end of the wikilink:</><template-link-ground link-bracket>[[</><template-link-ground link-pagename pagename>Foo</><template-link-ground link-delimiter>|</><template2-link-ground template-bracket>{{</><template2-link-ground template-name pagename>1x</><template2-link-ground template-delimiter>|</><template2-link-ground template>y']]a</><template2-link-ground template-bracket>}}</><template-link-ground link-text>l</><template-link-ground link-bracket>]]</><template-link-ground template>l</>"
	},
	{
		"desc": "Preprocessor precedence 8: broken language converter is rightmost opening",
		"wikitext": "[[Foo-{R|raw]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo-</><link-ground error>{</><link-ground link-pagename pagename>R</><link-ground link-delimiter>|</><link-ground link-text>raw</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Preprocessor precedence 9: groups of braces",
		"wikitext": "{{Preprocessor precedence 9|Four|Bullet|1|2}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Preprocessor precedence 9</><template-ground template-delimiter>|</><template-ground template>Four</><template-ground template-delimiter>|</><template-ground template>Bullet</><template-ground template-delimiter>|</><template-ground template>1</><template-ground template-delimiter>|</><template-ground template>2</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 10: groups of braces with leading dash",
		"wikitext": "{{Preprocessor precedence 10|Three|raw2|Bullet|1|2}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Preprocessor precedence 10</><template-ground template-delimiter>|</><template-ground template>Three</><template-ground template-delimiter>|</><template-ground template>raw2</><template-ground template-delimiter>|</><template-ground template>Bullet</><template-ground template-delimiter>|</><template-ground template>1</><template-ground template-delimiter>|</><template-ground template>2</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 11: found during visual diff testing",
		"wikitext": "{{#tag:span|-{{#tag:span|-{{1x|x}}}}}}\n\n{{1x|-{{1x|-{{1x|x}}}}}}\n\n{{1x|-{{1x|x}}}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#tag</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>span</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>-</><ext2-ground parserfunction-bracket>{{</><ext2-ground parserfunction-name>#tag</><ext2-ground parserfunction-delimiter>:</><ext2-ground parserfunction>span</><ext2-ground parserfunction-delimiter>|</><ext2-ground parserfunction>-</><template-ext2-ground template-bracket>{{</><template-ext2-ground template-name pagename>1x</><template-ext2-ground template-delimiter>|</><template-ext2-ground template>x</><template-ext2-ground template-bracket>}}</><ext2-ground parserfunction-bracket>}}</><ext-ground parserfunction-bracket>}}</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>-</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>-</><template3-ground template-bracket>{{</><template3-ground template-name pagename>1x</><template3-ground template-delimiter>|</><template3-ground template>x</><template3-ground template-bracket>}}</><template2-ground template-bracket>}}</><template-ground template-bracket>}}{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>-</><template2-ground template-bracket>{{</><template2-ground template-name pagename>1x</><template2-ground template-delimiter>|</><template2-ground template>x</><template2-ground template-bracket>}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 13: broken language converter in external link",
		"wikitext": "*[http://example.com/-{foo Example in URL]\n*[http://example.com Example in -{link} description]\n*{{1x|[http://example.com/-{foo Breaks template, however]}}",
		"parsed": "<list>*</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com/-{foo</><link-ground extlink-text> Example in URL</><link-ground extlink-bracket>]</><list>*</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>example.com</><link-ground extlink-text> Example in </><link-ground convert-bracket>-{</><link-ground extlink-text>link} description]</><link-ground list>*</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground extlink-bracket>[</><template-link-ground extlink-protocol>http://</><template-link-ground extlink>example.com/-{foo</><template-link-ground extlink-text> Breaks template, however</><template-link-ground extlink-bracket>]</><template-link-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 14: broken language converter in comment",
		"wikitext": "*<!--{{foo}}-->...should be ok\n*<!---{{foo}}-->...extra dashes\n*{{1x|foo<!-- -{bar} -->bat}}...should be ok",
		"parsed": "<list>*</><comment>&lt;!--{{foo}}--&gt</>...should be ok<list>*</><comment>&lt;!---{{foo}}--&gt</>...extra dashes<list>*</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground comment>&lt;!-- -{bar} --&gt</><template-ground template>bat</><template-ground template-bracket>}}</>...should be ok"
	},
	{
		"desc": "Preprocessor precedence 15: broken brace markup in headings",
		"wikitext": "__NOTOC__ __NOEDITSECTION__\n===1 foo[bar 1===\n1\n===2 foo[[bar 2===\n2\n===3 foo{bar 3===\n3\n===4 foo{{bar 4===\n4\n===5 foo{{{bar 5===\n5\n===6 foo-{bar 6===\n6",
		"parsed": "<double-underscore>__NOTOC__</> <double-underscore>__NOEDITSECTION__</><section-header section--3>===</><section>1 foo[bar 1</><section-header>===</>1<section-header section--3>===</><section>2 foo</><link-ground link-bracket>[[</><link-ground link-pagename pagename>bar 2===</>2<section-header section--3>===</><section>3 foo{bar 3</><section-header>===</>3<section-header section--3>===</><section>4 foo</><template-ground template-bracket>{{</><template-ground template-name pagename>bar 4===</>4<section-header section--3>===</><section>5 foo</><templatevariable-bracket>{{{</><templatevariable-name>bar 5===</>5<section-header section--3>===</><section>6 foo</><convert-bracket>-{</><section>bar 6===6</>"
	},
	{
		"desc": "Preprocessor precedence 16: matching closing braces to opening braces",
		"wikitext": "-{{{1x|foo}}bar}-",
		"parsed": "-{<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>foo</><template-ground template-bracket>}}</>bar}-"
	},
	{
		"desc": "Preprocessor precedence 17: template w/o target shouldn't prevent closing",
		"wikitext": "{{1x|hi {{}}}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>hi </><template2-ground template-bracket>{{}}</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Preprocessor precedence 19: break syntax",
		"wikitext": "-{{",
		"parsed": "-<template-ground template-bracket>{{</>"
	},
	{
		"desc": "Language converter over extlink",
		"wikitext": "{{1x\n| [-{oh no]}-]\n}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template> [</><template-ground convert-bracket>-{</><template-ground template>oh no]</><template-ground convert-bracket>}-</><template-ground template>]</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "pst"
	},
	{
		"desc": "pre-save transform: subst:",
		"wikitext": "{{subst:test}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>test</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: normal template",
		"wikitext": "{{test}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>test</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: nonexistent template",
		"wikitext": "{{thistemplatedoesnotexist}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>thistemplatedoesnotexist</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: subst magic variables",
		"wikitext": "{{subst:SITENAME}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>SITENAME</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: subst: templates with parameters",
		"wikitext": "{{subst:paramtest|param=\"something else\"}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>paramtest</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>param=\"something else\"</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: nowiki in subst (T3188)",
		"wikitext": "{{subst:nowikitest}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>nowikitest</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: comment in subst (T3936)",
		"wikitext": "{{subst:commenttest}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>commenttest</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: unclosed tag",
		"wikitext": "<nowiki>'''not wiki'''",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>'''not wiki'''</>"
	},
	{
		"desc": "pre-save transform: mixed tag case",
		"wikitext": "<NOwiki>'''not wiki'''</noWIKI>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>NOwiki</><exttag-bracket>&gt</><tag-nowiki>'''not wiki'''</><exttag-bracket>&lt;/</><exttag-name>noWIKI</><exttag-bracket>&gt</>"
	},
	{
		"desc": "pre-save transform: unclosed comment in <nowiki>",
		"wikitext": "wiki<nowiki>nowiki<!--nowiki</nowiki>wiki",
		"parsed": "wiki<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>nowiki&lt;!--nowiki</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>wiki"
	},
	{
		"desc": "(confirming safety of fix for subst T3936)",
		"wikitext": "{{Template:dangerous}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>Template:dangerous</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: comment containing gallery (T7024)",
		"wikitext": "<!-- <gallery>data</gallery> -->",
		"parsed": "<comment>&lt;!-- &lt;gallery&gtdata&lt;/gallery&gt --&gt</>"
	},
	{
		"desc": "pre-save transform: comment containing nowiki",
		"wikitext": "<!-- <nowiki>data</nowiki> -->",
		"parsed": "<comment>&lt;!-- &lt;nowiki&gtdata&lt;/nowiki&gt --&gt</>"
	},
	{
		"desc": "pre-save transform: <noinclude> in subst (T5298)",
		"wikitext": "{{subst:Includes}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Includes</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: <onlyinclude> in subst (T5298)",
		"wikitext": "{{subst:Includes2}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Includes2</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T24297: safesubst: works during PST",
		"wikitext": "{{subst:SafeSubstTest}}{{safesubst:SubstTest}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>SafeSubstTest</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>safesubst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>SubstTest</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "T24297: safesubst: works during normal parse",
		"wikitext": "{{SafeSubstTest}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>SafeSubstTest</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "subst: does not work during normal parse",
		"wikitext": "{{SubstTest}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>SubstTest</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "safesubst self: does not work during normal parse - T276476",
		"wikitext": "{{SafeSubstSelfTest}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>SafeSubstSelfTest</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Template named safesubst - T309405",
		"wikitext": "{{safesubst|123}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>safesubst</><template-ground template-delimiter>|</><template-ground template>123</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "subst: with whitespace - variable vs. template",
		"wikitext": "Variable: {{subst: ROOTPAGENAME}}\nVariable: {{subst:ROOTPAGENAME}}\nTemplate: {{subst: ROOTPAGENAME|template}}\nTemplate: {{subst:ROOTPAGENAME|template}}",
		"parsed": "Variable: <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> ROOTPAGENAME</><ext-ground parserfunction-bracket>}}</>Variable: <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ROOTPAGENAME</><ext-ground parserfunction-bracket>}}</>Template: <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> ROOTPAGENAME</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>template</><ext-ground parserfunction-bracket>}}</>Template: <ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>ROOTPAGENAME</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>template</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\")",
		"wikitext": "[[Article (context)|]]\n[[Bar:Article|]]\n[[:Bar:Article|]]\n[[Bar:Article (context)|]]\n[[:Bar:Article (context)|]]\n[[|Article]]\n[[|Article (context)]]\n[[Bar:X (Y) Z|]]\n[[:Bar:X (Y) Z|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Article (context)</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article (context)</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article (context)</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>[[|Article]][[|Article (context)]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Bar:X (Y) Z</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:X (Y) Z</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with interwiki prefix",
		"wikitext": "[[interwiki:Article|]]\n[[:interwiki:Article|]]\n[[interwiki:Bar:Article|]]\n[[:interwiki:Bar:Article|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>interwiki:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:interwiki:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>interwiki:Bar:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:interwiki:Bar:Article</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens in title",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with single, double-width and Arabic comma in title",
		"wikitext": "[[|Otherplace]]\n[[Otherplace, Elsewhere|]]\n[[Otherplace, Elsewhere, Anywhere|]]\n[[Otherplace，Elsewhere|]]\n[[Otherplace، Elsewhere|]]",
		"parsed": "[[|Otherplace]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Otherplace, Elsewhere</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Otherplace, Elsewhere, Anywhere</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Otherplace，Elsewhere</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Otherplace، Elsewhere</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens and comma",
		"wikitext": "[[|Otherplace]]\n[[Otherplace (place), Elsewhere|]]",
		"parsed": "[[|Otherplace]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Otherplace (place), Elsewhere</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with comma and parens",
		"wikitext": "[[|Yes, you.]]\n[[Me, Myself, and I (1937 song)|]]",
		"parsed": "[[|Yes, you.]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Me, Myself, and I (1937 song)</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace and parens",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace and comma",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace, comma and parens",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with namespace, parens and comma",
		"wikitext": "[[|Article]]",
		"parsed": "[[|Article]]"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with full-width parens and no space (Japanese and Chinese style, T32149)",
		"wikitext": "[[Article（context）|]]\n[[Bar:Article（context）|]]\n[[:Bar:Article（context）|]]\n[[|Article（context）]]\n[[Bar:X（Y）Z|]]\n[[:Bar:X（Y）Z|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Article（context）</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article（context）</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article（context）</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>[[|Article（context）]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Bar:X（Y）Z</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:X（Y）Z</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with full-width parens and space (Japanese and Chinese style, T32149)",
		"wikitext": "[[Article （context）|]]\n[[Bar:Article （context）|]]\n[[:Bar:Article （context）|]]\n[[|Article （context）]]\n[[Bar:X （Y） Z|]]\n[[:Bar:X （Y） Z|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Article （context）</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article （context）</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article （context）</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>[[|Article （context）]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Bar:X （Y） Z</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:X （Y） Z</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with parens and no space (Korean style, T32149)",
		"wikitext": "[[Article(context)|]]\n[[Bar:Article(context)|]]\n[[:Bar:Article(context)|]]\n[[|Article(context)]]\n[[Bar:X(Y)Z|]]\n[[:Bar:X(Y)Z|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Article(context)</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article(context)</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article(context)</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>[[|Article(context)]]<link-ground link-bracket>[[</><link-ground link-pagename pagename>Bar:X(Y)Z</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:X(Y)Z</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "pre-save transform: context links (\"pipe trick\") with commas (T23660)",
		"wikitext": "[[Article (context), context|]]\n[[Article (context)，context|]]\n[[Bar:Article (context), context|]]\n[[Bar:Article (context)，context|]]\n[[:Bar:Article (context), context|]]\n[[:Bar:Article (context)，context|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Article (context), context</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Article (context)，context</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article (context), context</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Bar:Article (context)，context</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article (context), context</><link-ground link-delimiter>|</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>:Bar:Article (context)，context</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Parsoid: backwards pipe trick",
		"wikitext": "[[|'''bar''']]",
		"parsed": "[[|<apostrophes>'''</><strong>bar</><apostrophes>'''</>]]"
	},
	{
		"desc": "pre-save transform: trim trailing empty lines",
		"wikitext": "Empty lines are trimmed",
		"parsed": "Empty lines are trimmed"
	},
	{
		"desc": "pre-save transform: Signature expansion",
		"wikitext": "* ~~~\n* ~~~~\n* ~~~~~\n* <noinclude>~~~</noinclude>\n* <includeonly>~~~</includeonly>\n* <onlyinclude>~~~</onlyinclude>",
		"parsed": "<list>*</> <signature>~~~</><list>*</> <signature>~~~~</><list>*</> <signature>~~~~~</><list>*</> <exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude signature>~~~</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt</><list>*</> <exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly signature>~~~</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</><list>*</> <exttag-bracket>&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude signature>~~~</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>"
	},
	{
		"desc": "ParserOutput flags from signature expansion (T84843)",
		"wikitext": "~~~~",
		"parsed": "<signature>~~~~</>"
	},
	{
		"desc": "pre-save transform: Signature expansion in nowiki tags (T2093)",
		"wikitext": "Shall not expand:\n\n<nowiki>~~~~</nowiki>\n\n<includeonly><nowiki>~~~~</nowiki></includeonly>\n\n<noinclude><nowiki>~~~~</nowiki></noinclude>\n\n<onlyinclude><nowiki>~~~~</nowiki></onlyinclude>\n\n{{subst:Foo}} shall be converted to FOO\n\nAs well as inside noinclude/onlyinclude\n<noinclude>{{subst:Foo}}</noinclude>\n<onlyinclude>{{subst:Foo}}</onlyinclude>\n\nBut not inside includeonly\n<includeonly>{{subst:Foo}}</includeonly>",
		"parsed": "Shall not expand:<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>~~~~</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly exttag-bracket>&lt;</><tag-includeonly exttag-name>nowiki</><tag-includeonly exttag-bracket>&gt</><tag-includeonly tag-nowiki>~~~~</><tag-includeonly exttag-bracket>&lt;/</><tag-includeonly exttag-name>nowiki</><tag-includeonly exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude exttag-bracket>&lt;</><tag-noinclude exttag-name>nowiki</><tag-noinclude exttag-bracket>&gt</><tag-noinclude tag-nowiki>~~~~</><tag-noinclude exttag-bracket>&lt;/</><tag-noinclude exttag-name>nowiki</><tag-noinclude exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude exttag-bracket>&lt;</><tag-onlyinclude exttag-name>nowiki</><tag-onlyinclude exttag-bracket>&gt</><tag-onlyinclude tag-nowiki>~~~~</><tag-onlyinclude exttag-bracket>&lt;/</><tag-onlyinclude exttag-name>nowiki</><tag-onlyinclude exttag-bracket>&gt</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>subst</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Foo</><ext-ground parserfunction-bracket>}}</> shall be converted to FOOAs well as inside noinclude/onlyinclude<exttag-bracket>&lt;</><exttag-name>noinclude</><exttag-bracket>&gt</><tag-noinclude ext-ground parserfunction-bracket>{{</><tag-noinclude ext-ground parserfunction-name>subst</><tag-noinclude ext-ground parserfunction-delimiter>:</><tag-noinclude ext-ground parserfunction>Foo</><tag-noinclude ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>noinclude</><exttag-bracket>&gt&lt;</><exttag-name>onlyinclude</><exttag-bracket>&gt</><tag-onlyinclude ext-ground parserfunction-bracket>{{</><tag-onlyinclude ext-ground parserfunction-name>subst</><tag-onlyinclude ext-ground parserfunction-delimiter>:</><tag-onlyinclude ext-ground parserfunction>Foo</><tag-onlyinclude ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>onlyinclude</><exttag-bracket>&gt</>But not inside includeonly<exttag-bracket>&lt;</><exttag-name>includeonly</><exttag-bracket>&gt</><tag-includeonly ext-ground parserfunction-bracket>{{</><tag-includeonly ext-ground parserfunction-name>subst</><tag-includeonly ext-ground parserfunction-delimiter>:</><tag-includeonly ext-ground parserfunction>Foo</><tag-includeonly ext-ground parserfunction-bracket>}}</><exttag-bracket>&lt;/</><exttag-name>includeonly</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: Recognize nowiki with trailing space in tags",
		"wikitext": "<nowiki ><div>[[foo]]</nowiki >\n\na<nowiki / >b\n\nc<nowiki />d\n\ne<nowiki/ >f",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki </><exttag-bracket>&gt</><tag-nowiki>&lt;div&gt[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki </><exttag-bracket>&gt</>a<exttag-bracket>&lt;</><exttag-name>nowiki </><exttag-attribute ext-nowiki>/ </><exttag-bracket>&gt</><tag-nowiki>bc&lt;nowiki /&gtde&lt;nowiki/ &gtf</>"
	},
	{
		"desc": "Category with empty sort key",
		"wikitext": "[[Category:MediaWiki User's Guide|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:MediaWiki User's Guide</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with empty sort key and parentheses",
		"wikitext": "[[Category:Foo (bar)|]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo (bar)</><link-ground link-delimiter>|</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with link tail",
		"wikitext": "123[[Category:Foo]]456",
		"parsed": "123<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>456"
	},
	{
		"desc": "Category with template",
		"wikitext": "[[Category:{{1x|Foo}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foo</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with template in sort key",
		"wikitext": "[[Category:Foo|{{1x|Bar}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Category with template in sort key and title",
		"wikitext": "[[Category:{{1x|Foo}}|{{1x|Bar}}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Foo</><template-link-ground template-bracket>}}</><link-ground link-delimiter>|</><template-link-ground template-bracket>{{</><template-link-ground template-name pagename>1x</><template-link-ground template-delimiter>|</><template-link-ground template>Bar</><template-link-ground template-bracket>}}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Tildes in comments",
		"wikitext": "<!-- ~~~~ -->",
		"parsed": "<comment>&lt;!-- ~~~~ --&gt</>"
	},
	{
		"desc": "quotes"
	},
	{
		"desc": "Quotes",
		"wikitext": "Normal text. '''Bold text.''' Normal text. ''Italic text.''\n\nNormal text. '''''Bold italic text.''''' Normal text.",
		"parsed": "Normal text. <apostrophes>'''</><strong>Bold text.</><apostrophes>'''</> Normal text. <apostrophes>''</><em>Italic text.</><apostrophes>''</>Normal text. <apostrophes>'''''</><strong em>Bold italic text.</><apostrophes>'''''</> Normal text."
	},
	{
		"desc": "Quotes wrapping HTML table",
		"wikitext": "'''<table><tr><td>hi</td></tr></table>'''",
		"parsed": "<apostrophes>'''</><htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><strong>hi</><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</><apostrophes>'''</>"
	},
	{
		"desc": "Unclosed and unmatched quotes",
		"wikitext": "'''''Bold italic text '''with bold deactivated''' in between.'''''\n\n'''''Bold italic text ''with italic deactivated'' in between.'''''\n\n'''Bold text..\n\n..spanning two paragraphs (should not work).'''\n\n'''Bold tag left open\n\n''Italic tag left open\n\nNormal text.\n\n<!-- Unmatching number of opening, closing tags: -->\n'''This year''''s election ''should'' beat '''last year''''s.\n\n''Tom'''s car is bigger than ''Susan'''s.\n\nPlain ''italic'''s plain",
		"parsed": "<apostrophes>'''''</><strong em>Bold italic text </><apostrophes>'''</><em>with bold deactivated</><apostrophes>'''</><strong em> in between.</><apostrophes>''''''''''</><strong em>Bold italic text </><apostrophes>''</><strong>with italic deactivated</><apostrophes>''</><strong em> in between.</><apostrophes>''''''''</><strong>Bold text..</>..spanning two paragraphs (should not work).<apostrophes>''''''</><strong>Bold tag left open</><apostrophes>''</><em>Italic tag left open</>Normal text.<comment>&lt;!-- Unmatching number of opening, closing tags: --&gt</><apostrophes>'''</><strong>This year'</><apostrophes>'''</>s election <apostrophes>''</><em>should</><apostrophes>''</> beat <apostrophes>'''</><strong>last year'</><apostrophes>'''</>s.<apostrophes>''</><em>Tom</><apostrophes>'''</><strong em>s car is bigger than </><apostrophes>''</><strong>Susan</><apostrophes>'''</>s.Plain <apostrophes>''</><em>italic'</><apostrophes>''</>s plain"
	},
	{
		"desc": "Italics and bold",
		"wikitext": "*plain\n*plain''italic''plain\n*plain''italic''plain''italic''plain\n*plain'''bold'''plain\n*plain'''bold'''plain'''bold'''plain\n*plain''italic''plain'''bold'''plain\n*plain'''bold'''plain''italic''plain\n*plain''italic'''bold-italic'''italic''plain\n*plain'''bold''bold-italic''bold'''plain\n*plain'''''bold-italic'''italic''plain\n*plain'''''bold-italic''bold'''plain\n*plain''italic'''bold-italic'''''plain\n*plain'''bold''bold-italic'''''plain\n*plain l'''italic''plain\n*plain l''''bold''' plain",
		"parsed": "<list>*</>plain<list>*</>plain<apostrophes>''</><em>italic</><apostrophes>''</>plain<list>*</>plain<apostrophes>''</><em>italic</><apostrophes>''</>plain<apostrophes>''</><em>italic</><apostrophes>''</>plain<list>*</>plain<apostrophes>'''</><strong>bold</><apostrophes>'''</>plain<list>*</>plain<apostrophes>'''</><strong>bold</><apostrophes>'''</>plain<apostrophes>'''</><strong>bold</><apostrophes>'''</>plain<list>*</>plain<apostrophes>''</><em>italic</><apostrophes>''</>plain<apostrophes>'''</><strong>bold</><apostrophes>'''</>plain<list>*</>plain<apostrophes>'''</><strong>bold</><apostrophes>'''</>plain<apostrophes>''</><em>italic</><apostrophes>''</>plain<list>*</>plain<apostrophes>''</><em>italic</><apostrophes>'''</><strong em>bold-italic</><apostrophes>'''</><em>italic</><apostrophes>''</>plain<list>*</>plain<apostrophes>'''</><strong>bold</><apostrophes>''</><strong em>bold-italic</><apostrophes>''</><strong>bold</><apostrophes>'''</>plain<list>*</>plain<apostrophes>'''''</><strong em>bold-italic</><apostrophes>'''</><em>italic</><apostrophes>''</>plain<list>*</>plain<apostrophes>'''''</><strong em>bold-italic</><apostrophes>''</><strong>bold</><apostrophes>'''</>plain<list>*</>plain<apostrophes>''</><em>italic</><apostrophes>'''</><strong em>bold-italic</><apostrophes>'''''</>plain<list>*</>plain<apostrophes>'''</><strong>bold</><apostrophes>''</><strong em>bold-italic</><apostrophes>'''''</>plain<list>*</>plain l'<apostrophes>''</><em>italic</><apostrophes>''</>plain<list>*</>plain l'<apostrophes>'''</><strong>bold</><apostrophes>'''</> plain"
	},
	{
		"desc": "Italics and possessives (1)",
		"wikitext": "obtained by ''[[Lunar Prospector]]'''s gamma-ray spectrometer",
		"parsed": "obtained by <apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Lunar Prospector</><link-ground link-bracket>]]</><em>'</><apostrophes>''</>s gamma-ray spectrometer"
	},
	{
		"desc": "Italics and possessives (2)",
		"wikitext": "'''''Flaming Pie''''' is ... released in 1997. In ''Flaming Pie'''s liner notes",
		"parsed": "<apostrophes>'''''</><strong em>Flaming Pie</><apostrophes>'''''</> is ... released in 1997. In <apostrophes>''</><em>Flaming Pie'</><apostrophes>''</>s liner notes"
	},
	{
		"desc": "Italics and possessives (3)",
		"wikitext": "The first monolingual dictionary written in a Romance language was ''Sebastián Covarrubias''' ''Tesoro de la lengua castellana o española'', published in 1611 in Madrid. In 1612 the first edition of the ''Vocabolario dell'[[Accademia della Crusca]]'', for Italian, was published. In 1690 in Rotterdam was published, posthumously, the ''Dictionnaire Universel''.",
		"parsed": "The first monolingual dictionary written in a Romance language was <apostrophes>''</><em>Sebastián Covarrubias'</><apostrophes>''</> <apostrophes>''</><em>Tesoro de la lengua castellana o española</><apostrophes>''</>, published in 1611 in Madrid. In 1612 the first edition of the <apostrophes>''</><em>Vocabolario dell'</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Accademia della Crusca</><link-ground link-bracket>]]</><apostrophes>''</>, for Italian, was published. In 1690 in Rotterdam was published, posthumously, the <apostrophes>''</><em>Dictionnaire Universel</><apostrophes>''</>."
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,2)",
		"wikitext": "''foo''",
		"parsed": "<apostrophes>''</><em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,3)",
		"wikitext": "''foo'''",
		"parsed": "<apostrophes>''</><em>foo'</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,4)",
		"wikitext": "''foo''''",
		"parsed": "<apostrophes>''</><em>foo''</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,4) w/ nowiki",
		"wikitext": "''foo<nowiki>''</nowiki>''",
		"parsed": "<apostrophes>''</><em>foo</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,5)",
		"wikitext": "''foo'''''",
		"parsed": "<apostrophes>''</><em>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 2-quote opening sequence: (2,5-3)",
		"wikitext": "''foo''",
		"parsed": "<apostrophes>''</><em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,2)",
		"wikitext": "'''foo''",
		"parsed": "'<apostrophes>''</><em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,3)",
		"wikitext": "'''foo'''",
		"parsed": "<apostrophes>'''</><strong>foo</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,4)",
		"wikitext": "'''foo''''",
		"parsed": "<apostrophes>'''</><strong>foo'</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,5)",
		"wikitext": "'''foo'''''",
		"parsed": "<apostrophes>'''</><strong>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 3-quote opening sequence: (3,5-2)",
		"wikitext": "'''foo'''",
		"parsed": "<apostrophes>'''</><strong>foo</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,2)",
		"wikitext": "''''foo''",
		"parsed": "''<apostrophes>''</><em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,2) w/ nowiki",
		"wikitext": "<nowiki>''</nowiki>''foo''",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,3)",
		"wikitext": "''''foo'''",
		"parsed": "'<apostrophes>'''</><strong>foo</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,4)",
		"wikitext": "''''foo''''",
		"parsed": "'<apostrophes>'''</><strong>foo'</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,4) w/ nowiki",
		"wikitext": "'<nowiki/>'''foo''''",
		"parsed": "'<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''</><strong>foo'</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,5)",
		"wikitext": "''''foo'''''",
		"parsed": "'<apostrophes>'''</><strong>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 4-quote opening sequence: (4,5-2)",
		"wikitext": "''''foo'''",
		"parsed": "'<apostrophes>'''</><strong>foo</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,2)",
		"wikitext": "'''''foo''",
		"parsed": "<apostrophes>'''''</><strong em>foo</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,2+3)",
		"wikitext": "'''''foo'''''",
		"parsed": "<apostrophes>'''''</><strong em>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,3)",
		"wikitext": "'''''foo'''",
		"parsed": "<apostrophes>'''''</><strong em>foo</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,3+2)",
		"wikitext": "'''''foo'''''",
		"parsed": "<apostrophes>'''''</><strong em>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,4)",
		"wikitext": "'''''foo''''",
		"parsed": "<apostrophes>'''''</><strong em>foo'</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,5)",
		"wikitext": "'''''foo'''''",
		"parsed": "<apostrophes>'''''</><strong em>foo</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: 5-quote opening sequence: (5,6)",
		"wikitext": "'''''foo''''''",
		"parsed": "<apostrophes>'''''</><strong em>foo'</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,2)",
		"wikitext": "''foo''''bar''",
		"parsed": "<apostrophes>''</><em>foo'</><apostrophes>'''</><strong em>bar</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,2+3) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'''''",
		"parsed": "<apostrophes>''</><em>foo'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''</><strong em>bar</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,3)",
		"wikitext": "''foo''''bar'''",
		"parsed": "<apostrophes>''</><em>foo'</><apostrophes>'''</><strong em>bar</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,3+2) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'''''",
		"parsed": "<apostrophes>''</><em>foo'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''</><strong em>bar</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,4)",
		"wikitext": "''foo''''bar''''",
		"parsed": "<apostrophes>''</><em>foo'</><apostrophes>'''</><strong em>bar'</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (2,4,4+2) w/ nowiki",
		"wikitext": "''foo'<nowiki/>'''bar'<nowiki/>'''''",
		"parsed": "<apostrophes>''</><em>foo'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''</><strong em>bar'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,2)",
		"wikitext": "'''foo''''bar''",
		"parsed": "<apostrophes>'''</><strong>foo'</><apostrophes>'''</>bar<apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,2-2)",
		"wikitext": "'''foo''''bar",
		"parsed": "<apostrophes>'''</><strong>foo'</><apostrophes>'''</>bar"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,3)",
		"wikitext": "'''foo''''bar'''",
		"parsed": "<apostrophes>'''</><strong>foo'</><apostrophes>'''</>bar<apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: multiple quote sequences: (3,4,3-3)",
		"wikitext": "'''foo''''bar",
		"parsed": "<apostrophes>'''</><strong>foo'</><apostrophes>'''</>bar"
	},
	{
		"desc": "Italics and bold: other quote tests: (2,3,5)",
		"wikitext": "''this is about '''foo's family'''''",
		"parsed": "<apostrophes>''</><em>this is about </><apostrophes>'''</><strong em>foo's family</><apostrophes>'''''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (2,(3,3),2)",
		"wikitext": "''this is about '''foo's''' family''",
		"parsed": "<apostrophes>''</><em>this is about </><apostrophes>'''</><strong em>foo's</><apostrophes>'''</><em> family</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3,2)",
		"wikitext": "'''this is about ''foo'''s family''",
		"parsed": "<apostrophes>'''</><strong>this is about </><apostrophes>''</><strong em>foo</><apostrophes>'''</><em>s family</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3+2+2,2)",
		"wikitext": "'''this is about ''foo'''''<nowiki/>''s family''",
		"parsed": "<apostrophes>'''</><strong>this is about </><apostrophes>''</><strong em>foo</><apostrophes>'''''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>''</><em>s family</><apostrophes>''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,2,3,3)",
		"wikitext": "'''this is about ''foo'''s family'''",
		"parsed": "'<apostrophes>''</><em>this is about </><apostrophes>''</>foo<apostrophes>'''</><strong>s family</><apostrophes>'''</>"
	},
	{
		"desc": "Italics and bold: other quote tests: (3,(2,2),3)",
		"wikitext": "'''this is about ''foo's'' family'''",
		"parsed": "<apostrophes>'''</><strong>this is about </><apostrophes>''</><strong em>foo's</><apostrophes>''</><strong> family</><apostrophes>'''</>"
	},
	{
		"desc": "Italicized possessive",
		"wikitext": "The ''[[Main Page]]'''s talk page.",
		"parsed": "The <apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>Main Page</><link-ground link-bracket>]]</><em>'</><apostrophes>''</>s talk page."
	},
	{
		"desc": "Quote balancing context should be restricted to td/th cells on the same wikitext line",
		"wikitext": "{|\n!''a!!''b\n|''a||''b\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><apostrophes>''</><table-th em>a</><table-delimiter>!!</><apostrophes>''</><table-th>b</><table-delimiter>|</><apostrophes>''</><table-td em>a</><table-delimiter>||</><apostrophes>''</><table-td>b</><table-bracket>|}</>"
	},
	{
		"desc": "Bold conversion test",
		"wikitext": "a b'''c ''d e'''f'' g h'''i ''j",
		"parsed": "a b'<apostrophes>''</><em>c </><apostrophes>''</>d e<apostrophes>'''</><strong>f</><apostrophes>''</><strong em> g h</><apostrophes>'''</><em>i </><apostrophes>''</>j"
	},
	{
		"desc": "redirects"
	},
	{
		"desc": "1. Simple redirect to page",
		"wikitext": "#REDIRECT [[Main Page]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "2. Other redirect variants",
		"wikitext": "#REDIRECT [[Main_Page]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main_Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "3. Other redirect variants",
		"wikitext": "#REDIRECT [[<nowiki>[[Bar]]</nowiki>]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground error>&lt;</><link-ground link-pagename pagename>nowiki&gt[[Bar</><link-ground link-bracket>]]</><error>&lt;/nowiki&gt</>]]"
	},
	{
		"desc": "4. Redirect to a templated destination",
		"wikitext": "#REDIRECT [[{{1x|Foo}}bar]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground error>{{</><link-ground link-pagename pagename>1x</><link-ground error>|Foo}}bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Empty redirect",
		"wikitext": "#REDIRECT [[]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[]]</>"
	},
	{
		"desc": "Optional colon in #REDIRECT",
		"wikitext": "#REDIRECT:[[Main Page]]",
		"parsed": "<redirect>#REDIRECT:</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Whitespace in #REDIRECT with optional colon",
		"wikitext": " \n #REDIRECT \n: \n[[Main Page]]",
		"parsed": "<skipformatting>  </>#REDIRECT <list>:</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Piped link in #REDIRECT",
		"wikitext": "#REDIRECT [[Main Page|bar]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground error>|bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to category (T104502)",
		"wikitext": "#REDIRECT [[Category:Foo]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to category with URL encoding (T104502)",
		"wikitext": "#REDIRECT [[Category%3AFoo]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category%3AFoo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to category page",
		"wikitext": "#REDIRECT [[:Category:Foo]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>:Category:Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to image page (1)",
		"wikitext": "#REDIRECT [[File:Wiki.png]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Wiki.png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to image page (2)",
		"wikitext": "#REDIRECT [[Image:Wiki.png]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Image:Wiki.png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to language (1) (T104918)",
		"wikitext": "#REDIRECT [[en:File:Wiki.png]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>en:File:Wiki.png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to language (2) (T104918)",
		"wikitext": "#REDIRECT [[:en:File:Wiki.png]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>:en:File:Wiki.png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect to interwiki (T104918)",
		"wikitext": "#REDIRECT [[meatball:File:Wiki.png]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>meatball:File:Wiki.png</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect syntax under text isn't considered a redirect",
		"wikitext": "some text\n\n#redirect [[Main Page]]",
		"parsed": "some text<redirect>#redirect </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "New redirect",
		"wikitext": "#REDIRECT [[Foo]]\nFoo",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>Foo"
	},
	{
		"desc": "Redirect followed by block on the same line",
		"wikitext": "#REDIRECT [[Main Page]]<!-- haha -->==hi==",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</><comment>&lt;!-- haha --&gt</>==hi=="
	},
	{
		"desc": "Redirect followed by horizontal rule on the same line",
		"wikitext": "#REDIRECT [[Main Page]]----",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>----"
	},
	{
		"desc": "Redirect followed by a newline",
		"wikitext": "#REDIRECT [[Main Page]]\nA newline",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>A newline"
	},
	{
		"desc": "Redirect followed by multiple newlines",
		"wikitext": "#REDIRECT [[Main Page]]\n\n\nA newline",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-bracket>]]</>A newline"
	},
	{
		"desc": "Drop duplicate redirects",
		"wikitext": "#REDIRECT [[Foo]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Redirect containing double quotes and spaces",
		"wikitext": "#REDIRECT [[Cool \"Gator\"]]",
		"parsed": "<redirect>#REDIRECT </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Cool \"Gator\"</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Broken redirect shouldn't crash parsoid (T332242)",
		"wikitext": "<!-- Not a valid redirect nor a valid parser function -->\n{{#REDIRECT [[]]}}",
		"parsed": "<comment>&lt;!-- Not a valid redirect nor a valid parser function --&gt</><ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#REDIRECT </>[[]]}}"
	},
	{
		"desc": "stringFunctionTests"
	},
	{
		"desc": "#len",
		"wikitext": "{{#len:}}\n{{#len:0}}\n{{#len:test}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#len</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#len</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>0</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#len</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>test</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#urldecode",
		"wikitext": "{{#urldecode:}}\n{{#urldecode:foo%20bar}}\n{{#urldecode:%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%92%D0%B8%D0%BA%D0%B8}}\n{{#urldecode: some unescaped string}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#urldecode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#urldecode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>foo%20bar</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#urldecode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%92%D0%B8%D0%BA%D0%B8</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#urldecode</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction> some unescaped string</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#pos",
		"wikitext": "{{#pos:Žmržlina|žlina}}\n{{#pos:stringstring|str|4}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#pos</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>Žmržlina</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>žlina</><ext-ground parserfunction-bracket>}}{{</><ext-ground parserfunction-name>#pos</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>stringstring</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>str</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>4</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "#pos with too large offset (T209600)",
		"wikitext": "{{#pos:FooBar|Foo|32}}",
		"parsed": "<ext-ground parserfunction-bracket>{{</><ext-ground parserfunction-name>#pos</><ext-ground parserfunction-delimiter>:</><ext-ground parserfunction>FooBar</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>Foo</><ext-ground parserfunction-delimiter>|</><ext-ground parserfunction>32</><ext-ground parserfunction-bracket>}}</>"
	},
	{
		"desc": "tables"
	},
	{
		"desc": "Tables with multiple newlines after individual lines embedded in links",
		"wikitext": "[[Test|\n{|\n\n|test\n|}]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Test</><link-ground link-delimiter>|</><link-ground table-bracket>{|</><link-ground table-delimiter>|</><link-ground table-td>test</><link-ground table-bracket>|}</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "A table with no data.",
		"wikitext": "{||}",
		"parsed": "<table-bracket>{|</><table-definition html-table>|}</>"
	},
	{
		"desc": "A table with no data (take 2)",
		"wikitext": "{|\n|}",
		"parsed": "<table-bracket>{||}</>"
	},
	{
		"desc": "A table with no data generated by a <table> markup",
		"wikitext": "<table></table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: Don't paragraph-wrap fosterable content even if table syntax is unbalanced",
		"wikitext": "{|\n<td>\n<td>\n</td>\n\n\n\n|}",
		"parsed": "<table-bracket>{|</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "A table with stray table end tags on start tag line (wt2html)",
		"wikitext": "{|style=\"color: red;\"|}\n\n{|style=\"color: red;\" |}\n|foo\n|}\n\n{|style=\"color: red;\"|} id=\"foo\"\n|foo\n|}\n\n{|style=\"color: red;\" |} id=\"foo\"\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-definition html-table>style=</><table-definition-value>\"color: red;\"</><table-definition html-table>|}</><table-bracket>{|</><table-definition html-table>style=</><table-definition-value>\"color: red;\"</><table-definition html-table> |}</><table-delimiter>|</><table-td>foo</><table-bracket>|}{|</><table-definition html-table>style=</><table-definition-value>\"color: red;\"</><table-definition html-table>|} id=</><table-definition-value>\"foo\"</><table-delimiter>|</><table-td>foo</><table-bracket>|}{|</><table-definition html-table>style=</><table-definition-value>\"color: red;\"</><table-definition html-table> |} id=</><table-definition-value>\"foo\"</><table-delimiter>|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "A table with nothing but a caption",
		"wikitext": "{|\n|+caption\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|+</><table-caption>caption</><table-bracket>|}</>"
	},
	{
		"desc": "A table with caption with default-spaced attributes and a table row",
		"wikitext": "{|\n|+ style=\"color: red;\" |caption1\n|-\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|+ </><html-caption table-definition>style=\"color: red;\" </><table-delimiter2>|</><table-caption>caption1</><table-delimiter>|-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "A table with captions with non-default spaced attributes and a table row",
		"wikitext": "{|\n|+style=\"color: red;\"|caption2\n|+ style=\"color: red;\"|caption3\n|-\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|+</><html-caption table-definition>style=\"color: red;\"</><table-delimiter2>|</><table-caption>caption2</><table-delimiter>|+ </><html-caption table-definition>style=\"color: red;\"</><table-delimiter2>|</><table-caption>caption3</><table-delimiter>|-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Table td-cell syntax variations",
		"wikitext": "{|\n|foo bar foo|baz\n|foo bar foo||baz\n|style='color:red;'|baz\n|style='color:red;'||baz\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><html-td table-definition>foo bar foo</><table-delimiter2>|</><table-td>baz</><table-delimiter>|</><table-td>foo bar foo</><table-delimiter>||</><table-td>baz</><table-delimiter>|</><html-td table-definition>style='color:red;'</><table-delimiter2>|</><table-td>baz</><table-delimiter>|</><table-td>style='color:red;'</><table-delimiter>||</><table-td>baz</><table-bracket>|}</>"
	},
	{
		"desc": "Simple table",
		"wikitext": "{|\n|1||2\n|-\n|3||4\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>1</><table-delimiter>||</><table-td>2</><table-delimiter>|-|</><table-td>3</><table-delimiter>||</><table-td>4</><table-bracket>|}</>"
	},
	{
		"desc": "Simple table but with multiple dashes for row wikitext",
		"wikitext": "{|\n|foo\n|-----\n|bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-delimiter>|-----|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Multiplication table",
		"wikitext": "{| border=\"1\" cellpadding=\"2\"\n|+Multiplication table\n|-\n!&times;!!1!!2!!3\n|-\n!1\n|1||2||3\n|-\n!2\n|2||4||6\n|-\n!3\n|3||6||9\n|-\n!4\n|4||8||12\n|-\n!5\n|5||10||15\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>border=</><table-definition-value>\"1\"</><table-definition html-table> cellpadding=</><table-definition-value>\"2\"</><table-delimiter>|+</><table-caption>Multiplication table</><table-delimiter>|-!</><entity>&amp;times;</><table-delimiter>!!</><table-th>1</><table-delimiter>!!</><table-th>2</><table-delimiter>!!</><table-th>3</><table-delimiter>|-!</><table-th>1</><table-delimiter>|</><table-td>1</><table-delimiter>||</><table-td>2</><table-delimiter>||</><table-td>3</><table-delimiter>|-!</><table-th>2</><table-delimiter>|</><table-td>2</><table-delimiter>||</><table-td>4</><table-delimiter>||</><table-td>6</><table-delimiter>|-!</><table-th>3</><table-delimiter>|</><table-td>3</><table-delimiter>||</><table-td>6</><table-delimiter>||</><table-td>9</><table-delimiter>|-!</><table-th>4</><table-delimiter>|</><table-td>4</><table-delimiter>||</><table-td>8</><table-delimiter>||</><table-td>12</><table-delimiter>|-!</><table-th>5</><table-delimiter>|</><table-td>5</><table-delimiter>||</><table-td>10</><table-delimiter>||</><table-td>15</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"||\" in table headings",
		"wikitext": "{|\n!h1||h2\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>h1</><table-delimiter>||</><table-th>h2</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"!!\" in table data",
		"wikitext": "{|\n|Foo!!||\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>Foo!!</><table-delimiter>||</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"||\" in indented table headings",
		"wikitext": ":{|\n!h1||h2\n|}",
		"parsed": "<list>:</><table-bracket>{|</><table-delimiter>!</><table-th>h1</><table-delimiter>||</><table-th>h2</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"!!\" in templates",
		"wikitext": "{|\n!a {{1x|b!!c}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>a </><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>b!!c</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"!!\" in table headings after newline",
		"wikitext": "{|\n!a\nb!!c\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>ab!!c</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"!!\" in table data of mixed wikitext / html syntax",
		"wikitext": "{|\n!a\n<tr><td>b!!c</td></tr>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>a</><htmltag-bracket>&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><table-th>b!!c</><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Accept empty attributes in td/th cells (td/th cells starting with leading ||)",
		"wikitext": "{|\n!|h1\n||a\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-delimiter2>|</><table-th>h1</><table-delimiter>|</><table-delimiter2>|</><table-td>a</><table-bracket>|}</>"
	},
	{
		"desc": "Accept \"| !\" at start of line in tables (ignore !-attribute)",
		"wikitext": "{|\n|-\n|!style=\"color:red\"|bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><html-td table-definition>!style=\"color:red\"</><table-delimiter2>|</><table-td>bar</><table-bracket>|}</>"
	},
	{
		"desc": "Allow +/- in 2nd and later cells in a row, in 1st cell when td-attrs are present, or in 1st cell when there is a space between \"|\" and +/- ",
		"wikitext": "{|\n|-\n|style='color:red;'|+1\n|style='color:blue;'|-1\n|-\n|1||2||3\n|1||+2||-3\n|-\n| +1\n| -1\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><html-td table-definition>style='color:red;'</><table-delimiter2>|</><table-td>+1</><table-delimiter>|</><html-td table-definition>style='color:blue;'</><table-delimiter2>|</><table-td>-1</><table-delimiter>|-|</><table-td>1</><table-delimiter>||</><table-td>2</><table-delimiter>||</><table-td>3</><table-delimiter>|</><table-td>1</><table-delimiter>||</><table-td>+2</><table-delimiter>||</><table-td>-3</><table-delimiter>|-| </><table-td>+1</><table-delimiter>| </><table-td>-1</><table-bracket>|}</>"
	},
	{
		"desc": "Table rowspan",
		"wikitext": "{| border=1\n|Cell 1, row 1\n|rowspan=2|Cell 2, row 1 (and 2)\n|Cell 3, row 1\n|-\n|Cell 1, row 2\n|Cell 3, row 2\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>border=</><table-definition-value>1</><table-delimiter>|</><table-td>Cell 1, row 1</><table-delimiter>|</><html-td table-definition>rowspan=2</><table-delimiter2>|</><table-td>Cell 2, row 1 (and 2)</><table-delimiter>|</><table-td>Cell 3, row 1</><table-delimiter>|-|</><table-td>Cell 1, row 2</><table-delimiter>|</><table-td>Cell 3, row 2</><table-bracket>|}</>"
	},
	{
		"desc": "Nested table",
		"wikitext": "{| border=1\n| &alpha;\n|\n{| bgcolor=#ABCDEF border=2\n|nested\n|-\n|table\n|}\n|the original table again\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>border=</><table-definition-value>1</><table-delimiter>| </><entity>&amp;alpha;</><table-delimiter>|</><table-bracket>{| </><table-definition html-table>bgcolor=</><table-definition-value>#ABCDEF</><table-definition html-table> border=</><table-definition-value>2</><table-delimiter>|</><table-td>nested</><table-delimiter>|-|</><table-td>table</><table-bracket>|}</><table-delimiter>|</><table-td>the original table again</><table-bracket>|}</>"
	},
	{
		"desc": "Invalid attributes in table cell (T3830)",
		"wikitext": "{|\n|Cell:|broken\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><html-td table-definition>Cell:</><table-delimiter2>|</><table-td>broken</><table-bracket>|}</>"
	},
	{
		"desc": "Table cell attributes: Pipes protected by nowikis should be treated as a plain character",
		"wikitext": "{|\n|title=\"foo\" |bar\n|title=\"foo<nowiki>|</nowiki>\" |bar\n|title=\"foo<nowiki>|</nowiki>\" bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><html-td table-definition>title=\"foo\" </><table-delimiter2>|</><table-td>bar</><table-delimiter>|</><html-td table-definition>title=\"foo</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>|</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><html-td table-definition>\" </><table-delimiter2>|</><table-td>bar</><table-delimiter>|</><table-td>title=\"foo</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>|</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-td>\" bar</><table-bracket>|}</>"
	},
	{
		"desc": "Table cell attributes: Pipes protected by nested nowikis should be treated as a plain character",
		"wikitext": "{|\n|<code><nowiki>{{ACB|PG}}</nowiki></code>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>code</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>{{ACB|PG}}</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>code</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Table security: embedded pipes",
		"wikitext": "{|\n| |[ftp://|x||]\" onmouseover=\"alert(document.cookie)\">test",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><table-delimiter2>|</><link-ground extlink-bracket>[</><link-ground extlink-protocol>ftp://</><table-td>|x</><table-delimiter>||</><table-td>]\" onmouseover=\"alert(document.cookie)\"&gttest</>"
	},
	{
		"desc": "Element attributes with double ! should not be broken up by <th>",
		"wikitext": "{|\n!hi <div class=\"!!\">ha</div> ho\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>hi </><htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>class=</><htmltag-attribute-value>\"!!\"</><htmltag-bracket>&gt</><table-th>ha</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-th> ho</><table-bracket>|}</>"
	},
	{
		"desc": "! and || in element attributes should not be parsed as <th>/<td>",
		"wikitext": "{|\n|<div style=\"color: red !important;\" data-contrived=\"put this here ||\">hi</div>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>div </><htmltag-attribute html-div>style=</><htmltag-attribute-value>\"color: red !important;\"</><htmltag-attribute html-div> data-contrived=</><htmltag-attribute-value>\"put this here ||\"</><htmltag-bracket>&gt</><table-td>hi</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "! and || in td attributes should not be parsed as <th>/<td>",
		"wikitext": "{|\n|style=\"color: red !important;\" data-contrived=\"put this here ||\"|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>style=\"color: red !important;\" data-contrived=\"put this here </><table-delimiter>||</><html-td table-definition>\"</><table-delimiter2>|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Invalid text in table attributes should be discarded",
		"wikitext": "{| <span>boo</span> style='border:1px solid black'\n|  <span>boo</span> style='color:blue'  |1\n|<span>boo</span> style='color:blue'|2\n|}",
		"parsed": "<table-bracket>{| </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><table-definition html-table>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><table-definition html-table> style=</><table-definition-value>'border:1px solid black'</><table-delimiter>|  </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition> style='color:blue'  </><table-delimiter2>|</><table-td>1</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition> style='color:blue'</><table-delimiter2>|</><table-td>2</><table-bracket>|}</>"
	},
	{
		"desc": "Invalid text in table attributes should be preserved by selective serializer",
		"wikitext": "{| <span>boo</span> style='border:1px solid black'\n|  <span>boo</span> style='color:blue'  | 1\n|<span>boo</span> style='color:blue'| 2\n|}",
		"parsed": "<table-bracket>{| </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><table-definition html-table>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><table-definition html-table> style=</><table-definition-value>'border:1px solid black'</><table-delimiter>|  </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition> style='color:blue'  </><table-delimiter2>| </><table-td>1</><table-delimiter>|</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition>boo</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><html-td table-definition> style='color:blue'</><table-delimiter2>| </><table-td>2</><table-bracket>|}</>"
	},
	{
		"desc": "1. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n|{{table_attribs}}\n| {{table_attribs}}\n|| {{table_attribs_5}}\n| <!--foo--> <!--bar--> <!--baz--> {{table_attribs}}\n|align=center {{table_attribs}}\n| <!--foo--> align=center <!--bar--> {{table_attribs}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs</><template-ground template-bracket>}}</><table-delimiter>| </><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs</><template-ground template-bracket>}}</><table-delimiter>|</><table-delimiter2>| </><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_5</><template-ground template-bracket>}}</><table-delimiter>| </><comment>&lt;!--foo--&gt</><table-td> </><comment>&lt;!--bar--&gt</><table-td> </><comment>&lt;!--baz--&gt</><table-td> </><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs</><template-ground template-bracket>}}</><table-delimiter>|</><table-td>align=center </><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs</><template-ground template-bracket>}}</><table-delimiter>| </><comment>&lt;!--foo--&gt</><table-td> align=center </><comment>&lt;!--bar--&gt</><table-td> </><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "2a. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n|{{table_attribs_2}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_2</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "2b: Delete whitespace/comments if found in fosterable position while template-wrapping",
		"wikitext": "<table>\n<tr>\n<td>hi</td>\n{{1x|<td>ho</td>\n<!--comment-->\n<td>hi</td>}}\n<td>ho</td>\n</tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>hi<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>ho</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground comment>&lt;!--comment--&gt</><template-ground htmltag-bracket>&lt;</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template>hi</><template-ground htmltag-bracket>&lt;/</><template-ground htmltag-name>td</><template-ground htmltag-bracket>&gt</><template-ground template-bracket>}}</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>ho<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "3. Template-generated table cell attributes and cell content",
		"wikitext": "{|\n!align=center {{table_header_cells}}\n|-\n|align=center {{table_cells}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>align=center </><template-ground template-bracket>{{</><template-ground template-name pagename>table_header_cells</><template-ground template-bracket>}}</><table-delimiter>|-|</><table-td>align=center </><template-ground template-bracket>{{</><template-ground template-name pagename>table_cells</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "4. Template-generated table cell attributes and cell content inside a templated table",
		"wikitext": "{{tbl-start}}\n!align=center {{table_header_cells}}\n|-\n|align=center {{table_cells}}\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}</>!align=center <template-ground template-bracket>{{</><template-ground template-name pagename>table_header_cells</><template-ground template-bracket>}}</>|-|align=center <template-ground template-bracket>{{</><template-ground template-name pagename>table_cells</><template-ground template-bracket>}}{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Table with row followed by newlines and table heading",
		"wikitext": "{|\n|-\n\n!foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-!</><table-th>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Table with empty line following the start tag",
		"wikitext": "{|\n\n|-\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Table attributes with empty value",
		"wikitext": "{|\n| style=|hello\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><html-td table-definition>style=</><table-delimiter2>|</><table-td>hello</><table-bracket>|}</>"
	},
	{
		"desc": "Wikitext table with a lot of comments",
		"wikitext": "{|\n<!-- c0 -->\n|foo\n<!-- c1 -->\n|-<!-- c2 -->\n<!-- c3 -->\n|<!-- c4 -->\n<!-- c5 -->\n|}",
		"parsed": "<table-bracket>{|</><comment>&lt;!-- c0 --&gt</><table-delimiter>|</><table-td>foo</><comment>&lt;!-- c1 --&gt</><table-delimiter>|-</><comment>&lt;!-- c2 --&gt&lt;!-- c3 --&gt</><table-delimiter>|</><comment>&lt;!-- c4 --&gt&lt;!-- c5 --&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Wikitext table comments represented in parsoid dom",
		"wikitext": "{|<!--c1--><!--c2-->\n|-<!--c3-->\n|x\n|}",
		"parsed": "<table-bracket>{|</><comment>&lt;!--c1--&gt&lt;!--c2--&gt</><table-delimiter>|-</><comment>&lt;!--c3--&gt</><table-delimiter>|</><table-td>x</><table-bracket>|}</>"
	},
	{
		"desc": "Wikitext table with double-line table cell",
		"wikitext": "{|\n|a\nb\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>ab</><table-bracket>|}</>"
	},
	{
		"desc": "Table cell with a single comment",
		"wikitext": "{|\n|<!-- c1 -->\n|a\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><comment>&lt;!-- c1 --&gt</><table-delimiter>|</><table-td>a</><table-bracket>|}</>"
	},
	{
		"desc": "Table-cell after a comment-only-empty-line",
		"wikitext": "{|\n|a\n<!--c1-->\n<!--c2-->|b\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>a</><comment>&lt;!--c1--&gt&lt;!--c2--&gt</><table-td>|b</><table-bracket>|}</>"
	},
	{
		"desc": "Build table with {{!}}",
		"wikitext": "{{{!}} class=\"wikitable\"\n!header\n!second header\n{{!}}- style=\"color:red;\"\n{{!}}data{{!}}{{!}} style=\"color:red;\" {{!}}second data\n{{!}}}",
		"parsed": "<table-bracket>{{{!}} </><table-definition html-table>class=</><table-definition-value>\"wikitable\"</><table-delimiter>!</><table-th>header</><table-delimiter>!</><table-th>second header</><table-delimiter>{{!}}- </><table-definition html-tr>style=</><table-definition-value>\"color:red;\"</><table-delimiter>{{!}}</><table-td>data</><table-delimiter>{{!}}{{!}} </><html-td table-definition>style=\"color:red;\" </><table-delimiter2>{{!}}</><table-td>second data</><table-bracket>{{!}}}</>"
	},
	{
		"desc": "Build table with pipe as data",
		"wikitext": "{| class=\"wikitable\"\n!header\n!second header\n|- style=\"color:red;\"\n|data|| style=\"color:red;\" |second data\n|-\n| style=\"color:red;\" |data with | || style=\"color:red;\" | second data with |\n|-\n||data with | |||second data with |\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>class=</><table-definition-value>\"wikitable\"</><table-delimiter>!</><table-th>header</><table-delimiter>!</><table-th>second header</><table-delimiter>|- </><table-definition html-tr>style=</><table-definition-value>\"color:red;\"</><table-delimiter>|</><table-td>data</><table-delimiter>|| </><html-td table-definition>style=\"color:red;\" </><table-delimiter2>|</><table-td>second data</><table-delimiter>|-| </><html-td table-definition>style=\"color:red;\" </><table-delimiter2>|</><table-td>data with | </><table-delimiter>|| </><html-td table-definition>style=\"color:red;\" </><table-delimiter2>| </><table-td>second data with |</><table-delimiter>|-|</><table-delimiter2>|</><table-td>data with | </><table-delimiter>||</><table-delimiter2>|</><table-td>second data with |</><table-bracket>|}</>"
	},
	{
		"desc": "Build table with wikilink",
		"wikitext": "{| class=\"wikitable\"\n!header||second header\n|- style=\"color:red;\"\n|data [[Main Page|linktext]]||second data [[Main Page|linktext]]\n|-\n|data||second data [[Main Page|link|text with pipe]]\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>class=</><table-definition-value>\"wikitable\"</><table-delimiter>!</><table-th>header</><table-delimiter>||</><table-th>second header</><table-delimiter>|- </><table-definition html-tr>style=</><table-definition-value>\"color:red;\"</><table-delimiter>|</><table-td>data </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>linktext</><link-ground link-bracket>]]</><table-delimiter>||</><table-td>second data </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>linktext</><link-ground link-bracket>]]</><table-delimiter>|-|</><table-td>data</><table-delimiter>||</><table-td>second data </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Main Page</><link-ground link-delimiter>|</><link-ground link-text>link|text with pipe</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "Wikitext table with html-syntax row",
		"wikitext": "{|\n|-\n<td>foo</td>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><htmltag-bracket>&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><error>foo</><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Fostered content in tables: Plain text",
		"wikitext": "{|\n|-\na\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><error>a</><table-bracket>|}</>"
	},
	{
		"desc": "Fostered content in tables: Lists",
		"wikitext": "{|\n|-\n*a\n*b\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><list>*</><error>a</><list>*</><error>b</><table-bracket>|}</>"
	},
	{
		"desc": "Template generated table cell with attributes",
		"wikitext": "{|\n|-\n{{table_attribs_4}} ||a||b\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-</><template-ground template-bracket>{{</><template-ground template-name pagename>table_attribs_4</><template-ground template-bracket>}}</><error> ||a||b</><table-bracket>|}</>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Cell combination tests",
		"wikitext": "{|\n|-\n!class=\"test\"{{table_cell_content|attr=! align=left}} /* th & th combine */\n|-\n|class=\"test\"{{table_cell_content}} /* td & td combine */\n|-\n!class=\"test\"{{table_cell_content}} /* th & td combine */\n|-\n|class=\"test\"{{table_cell_content|attr=! align=left}} /* td & th combine */\n|-\n|class=\"test\"{{table_cell_content|attr=style='color:red;'}}\n|-\n|class=\"test\"{{table_cell_content|cmt=<!--bar-->}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-!</><table-th>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-delimiter>|</><template-ground template-argument-name>attr=</><template-ground template>! align=left</><template-ground template-bracket>}}</><table-th> /* th &amp; th combine */</><table-delimiter>|-|</><table-td>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-bracket>}}</><table-td> /* td &amp; td combine */</><table-delimiter>|-!</><table-th>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-bracket>}}</><table-th> /* th &amp; td combine */</><table-delimiter>|-|</><table-td>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-delimiter>|</><template-ground template-argument-name>attr=</><template-ground template>! align=left</><template-ground template-bracket>}}</><table-td> /* td &amp; th combine */</><table-delimiter>|-|</><table-td>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-delimiter>|</><template-ground template-argument-name>attr=</><template-ground template>style='color:red;'</><template-ground template-bracket>}}</><table-delimiter>|-|</><table-td>class=\"test\"</><template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-delimiter>|</><template-ground template-argument-name>cmt=</><template-ground comment>&lt;!--bar--&gt</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "T343874: Templated table that has a templated cell with untemplated attributes",
		"wikitext": "{{tbl-start}}\n|-\n|class=\"test\"{{table_cell_content}}\n|-\n|class=\"test\"{{table_cell_content|attr=! align=left}}\n{{tbl-end}}",
		"parsed": "<template-ground template-bracket>{{</><template-ground template-name pagename>tbl-start</><template-ground template-bracket>}}</>|-|class=\"test\"<template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-bracket>}}</>|-|class=\"test\"<template-ground template-bracket>{{</><template-ground template-name pagename>table_cell_content</><template-ground template-delimiter>|</><template-ground template-argument-name>attr=</><template-ground template>! align=left</><template-ground template-bracket>}}{{</><template-ground template-name pagename>tbl-end</><template-ground template-bracket>}}</>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Regression tests",
		"wikitext": "{|\n|class=\"foo\"\n{{1x|1={{!}}bar}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>class=\"foo\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>bar</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Unsupported (standalone mode) Scenarios",
		"wikitext": "{|\n|-\n|class=\"foo\"{{1x|1= {{!}}bar}}\n|-\n|class=\"foo\"{{1x|1=&nbsp;{{!}}bar}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><table-td>class=\"foo\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground template> </><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>bar</><template-ground template-bracket>}}</><table-delimiter>|-|</><table-td>class=\"foo\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ground entity>&amp;nbsp;</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>bar</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Templated table cell with untemplated attributes: Unsupported Scenario",
		"wikitext": "{|\n|-\n|class=\"foo\"{{1x|1={{!}}title=\"fail\"{{!}}bar}}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|-|</><table-td>class=\"foo\"</><template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template-argument-name>1=</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>title=\"fail\"</><template-ext-ground parserfunction-bracket>{{</><template-ext-ground parserfunction-name>!</><template-ext-ground parserfunction-bracket>}}</><template-ground template>bar</><template-ground template-bracket>}}</><table-bracket>|}</>"
	},
	{
		"desc": "Parsoid: Round-trip tables directly followed by content (T53219)",
		"wikitext": "{|\n|foo\n|} bar\n\n{|\n|baz\n|}<b>quux</b>",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-bracket>|}</> bar<table-bracket>{|</><table-delimiter>|</><table-td>baz</><table-bracket>|}</><htmltag-bracket>&lt;</><htmltag-name>b</><htmltag-bracket>&gt</>quux<htmltag-bracket>&lt;/</><htmltag-name>b</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: Default to a newline after tables in new content (T53219)",
		"wikitext": "{|\n|foo\n|}\nbar\n{|\n|baz\n|}\n'''quux'''",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-bracket>|}</>bar<table-bracket>{|</><table-delimiter>|</><table-td>baz</><table-bracket>|}</><apostrophes>'''</><strong>quux</><apostrophes>'''</>"
	},
	{
		"desc": "Parsoid: Row-syntax table headings followed by comment & table cells",
		"wikitext": "{|\n!foo||bar\n<!-- foo -->  ||baz||quux\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>foo</><table-delimiter>||</><table-th>bar</><comment>&lt;!-- foo --&gt</><table-th>  ||baz||quux</><table-bracket>|}</>"
	},
	{
		"desc": "Parsoid: Recover better from broken table attributes",
		"wikitext": "{| class=\"foo\n| class=\"bar\" |\nfoo\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>class=</><table-definition-value>\"foo</><table-delimiter>| </><html-td table-definition>class=\"bar\" </><table-delimiter2>|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: Digest broken attributes on table and tr tag",
		"wikitext": "{| || |} ++\n|- || || ++ --\n|- > [\n|}",
		"parsed": "<table-bracket>{| </><table-definition html-table>|| |} ++</><table-delimiter>|- </><table-definition html-tr>|| || ++ --</><table-delimiter>|- </><table-definition html-tr>&gt [</><table-bracket>|}</>"
	},
	{
		"desc": "Table with missing opening <tr> tag",
		"wikitext": "<table>\n<td>foo</td>\n</tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</>foo<htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt</><error>&lt;/tr&gt</><htmltag-bracket>&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "1. Generate correct wikitext for tables with thead/tbody/tfoot",
		"wikitext": "{|\n|+Test\n!Month\n!Savings\n|-\n|January\n|$100\n|-\n|February\n|$80\n|-\n|Sum\n|$180\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|+</><table-caption>Test</><table-delimiter>!</><table-th>Month</><table-delimiter>!</><table-th>Savings</><table-delimiter>|-|</><table-td>January</><table-delimiter>|</><table-td>$100</><table-delimiter>|-|</><table-td>February</><table-delimiter>|</><table-td>$80</><table-delimiter>|-|</><table-td>Sum</><table-delimiter>|</><table-td>$180</><table-bracket>|}</>"
	},
	{
		"desc": "2. Generate correct wikitext for tables with thead/tbody/tfoot",
		"wikitext": "{|\n!heading\n|-\n|foo\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>heading</><table-delimiter>|-|</><table-td>foo</><table-bracket>|}</>"
	},
	{
		"desc": "Wikitext tables can be nested inside HTML tables",
		"wikitext": "<table>\n<tr><td>\n{|\n|foo\n|}\n</td></tr>\n</table>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>table</><htmltag-bracket>&gt&lt;</><htmltag-name>tr</><htmltag-bracket>&gt&lt;</><htmltag-name>td</><htmltag-bracket>&gt</><table-bracket>{|</><table-delimiter>|</><table-td>foo</><table-bracket>|}</><htmltag-bracket>&lt;/</><htmltag-name>td</><htmltag-bracket>&gt&lt;/</><htmltag-name>tr</><htmltag-bracket>&gt&lt;/</><htmltag-name>table</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before",
		"wikitext": "{|\n|[[Eau]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after",
		"wikitext": "{|\n|[[Eau]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, before multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, between multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, between multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after multiple cells",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "T319143 - copy-pasting of cells, after multiple cells, without \"row\"",
		"wikitext": "{|\n|[[Eau]]||[[Abc]]\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Eau</><link-ground link-bracket>]]</><table-delimiter>||</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Abc</><link-ground link-bracket>]]</><table-bracket>|}</>"
	},
	{
		"desc": "wtEscaping"
	},
	{
		"desc": "Headings: 0. Unnested",
		"wikitext": "<nowiki>=foo=</nowiki>\n\n<nowiki/>=foo=\n<!--cmt-->\n<nowiki>=foo=</nowiki>\n\n=foo''a''<nowiki>=</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>=foo=<comment>&lt;!--cmt--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>=foo<apostrophes>''</><em>a</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 1. Nested inside html",
		"wikitext": "= =foo= =\n\n== =foo= ==\n\n=== =foo= ===\n\n=<nowiki>=foo=</nowiki>=\n==<nowiki>=foo=</nowiki>==\n===<nowiki>=foo=</nowiki>===\n====<nowiki>=foo=</nowiki>====\n=====<nowiki>=foo=</nowiki>=====\n======<nowiki>=foo=</nowiki>======",
		"parsed": "<section-header section--1>=</><section> =foo= </><section-header>=</><section-header section--2>==</><section> =foo= </><section-header>==</><section-header section--3>===</><section> =foo= </><section-header>===</><section-header section--1>=</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>=</><section-header section--2>==</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>==</><section-header section--3>===</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>===</><section-header section--4>====</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>====</><section-header section--5>=====</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>=====</><section-header section--6>======</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=foo=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><section-header>======</>"
	},
	{
		"desc": "Headings: 2. Outside heading nest on a single line <h1>foo</h1>*bar",
		"wikitext": "= foo =\n<nowiki>*</nowiki>bar\n\n= foo =\n=bar\n\n= foo =\n<nowiki>=bar=</nowiki>",
		"parsed": "<section-header section--1>=</><section> foo </><section-header>=</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>bar<section-header section--1>=</><section> foo </><section-header>=</>=bar<section-header section--1>=</><section> foo </><section-header>=</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=bar=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 3. Nested inside html with wikitext split by html tags",
		"wikitext": "= ='''bold'''foo= =",
		"parsed": "<section-header section--1>=</><section> =</><apostrophes>'''</><section>bold</><apostrophes>'''</><section>foo= </><section-header>=</>"
	},
	{
		"desc": "Headings: 4a. No escaping needed (testing just h1 and h2)",
		"wikitext": "= =foo =\n\n= foo= =\n\n= =foo= =\n\n= =foo= bar =\n\n== =foo ==\n\n== foo= ==\n\n= = =\n\n= ''=''foo= =",
		"parsed": "<section-header section--1>=</><section> =foo </><section-header>=</><section-header section--1>=</><section> foo= </><section-header>=</><section-header section--1>=</><section> =foo= </><section-header>=</><section-header section--1>=</><section> =foo= bar </><section-header>=</><section-header section--2>==</><section> =foo </><section-header>==</><section-header section--2>==</><section> foo= </><section-header>==</><section-header section--1>=</><section> = </><section-header>=</><section-header section--1>=</><section> </><apostrophes>''</><section>=</><apostrophes>''</><section>foo= </><section-header>=</>"
	},
	{
		"desc": "Headings: 4b. No escaping needed (inside p-tags)",
		"wikitext": "=foo= x\n=foo= <s></s>",
		"parsed": "=foo= x=foo= <htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 4c. Short headings (1)",
		"wikitext": "<nowiki>===</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>===</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 4d. Short headings (2)",
		"wikitext": "=\n==\n===\n====\n=====",
		"parsed": "===<section-header section--1>=</><section>=</><section-header>=</><section-header section--1>=</><section>==</><section-header>=</><section-header section--2>==</><section>=</><section-header>==</>"
	},
	{
		"desc": "Headings: 6a. Heading chars in SOL context (with trailing spaces)",
		"wikitext": "<nowiki>=a=</nowiki>\n\n<nowiki>=a=</nowiki> \n\n<nowiki>=a=</nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 6b. Heading chars in SOL context (with trailing newlines)",
		"wikitext": "<nowiki>=a=</nowiki>\nb\n\n<nowiki>=a=</nowiki> \nb\n\n<nowiki>=a=</nowiki>\t\nb",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>b<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> b<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>\tb"
	},
	{
		"desc": "Headings: 6c. Heading chars in SOL context (leading newline break)",
		"wikitext": "a\n<nowiki>=b=</nowiki>",
		"parsed": "a<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=b=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 6d. Heading chars in SOL context (with interspersed comments)",
		"wikitext": "<!--c0--><nowiki>=a=</nowiki>\n\n<!--c1--><nowiki>=a=</nowiki> <!--c2-->\t <!--c3-->",
		"parsed": "<comment>&lt;!--c0--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><comment>&lt;!--c1--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=a=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</> <comment>&lt;!--c2--&gt</>\t <comment>&lt;!--c3--&gt</>"
	},
	{
		"desc": "Headings: 6d. Heading chars in SOL context (No escaping needed)",
		"wikitext": "=a=<div>b</div>",
		"parsed": "=a=<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "Headings: 7. Insert a newline between new content and headings",
		"wikitext": "== NEW ==\nnew\n\n==A==\na",
		"parsed": "<section-header section--2>==</><section> NEW </><section-header>==</>new<section-header section--2>==</><section>A</><section-header>==</>a"
	},
	{
		"desc": "Headings: Used as horizontal rule",
		"wikitext": "===============",
		"parsed": "<section-header section--6>======</><section>===</><section-header>======</>"
	},
	{
		"desc": "Lists: 0. Outside nests",
		"wikitext": "<nowiki>*</nowiki>foo\n\n<nowiki>#</nowiki>foo\n\n<nowiki>;</nowiki>Foo<nowiki>:</nowiki>bar",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>#</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>;</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>Foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>:</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>bar"
	},
	{
		"desc": "Lists: 1. Nested inside html (No unnecessary escapes)",
		"wikitext": "* *foo\n* #foo\n* :foo\n* ;foo\n*<nowiki>*foo</nowiki>\n*<nowiki>#foo</nowiki>\n*<nowiki>:foo</nowiki>\n*<nowiki>;foo</nowiki>\n\n# *foo\n# #foo\n# :foo\n# ;foo\n#<nowiki>*foo</nowiki>\n#<nowiki>#foo</nowiki>\n#<nowiki>:foo</nowiki>\n#<nowiki>;foo</nowiki>",
		"parsed": "<list>*</> *foo<list>*</> #foo<list>*</> :foo<list>*</> ;foo<list>*</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>*</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>#foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>*</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>:foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>*</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>;foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>#</> *foo<list>#</> #foo<list>#</> :foo<list>#</> ;foo<list>#</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>#</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>#foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>#</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>:foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>#</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>;foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Lists: 2. Inside definition lists",
		"wikitext": "; ;foo\n\n; <nowiki>:foo</nowiki>\n\n; <nowiki>:foo</nowiki>\n: bar\n\n: :foo",
		"parsed": "<list>;</><strong> ;foo</><list>;</><strong> </><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>:foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>;</><strong> </><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>:foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>:</> bar<list>:</> :foo"
	},
	{
		"desc": "Lists: 3. Only bullets at start of text in wikitext-generated HTML should be escaped",
		"wikitext": "* *foo*bar\n*<nowiki>*foo</nowiki>''it''*bar",
		"parsed": "<list>*</> *foo*bar<list>*</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*foo</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><em>it</><apostrophes>''</>*bar"
	},
	{
		"desc": "Lists: 4. No escapes needed",
		"wikitext": "*foo*bar\n\n*''foo''*bar\n\n*[[Foo]]: bar\n\n*[[Foo]]*bar",
		"parsed": "<list>*</>foo*bar<list>*</><apostrophes>''</><em>foo</><apostrophes>''</>*bar<list>*</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>: bar<list>*</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</>*bar"
	},
	{
		"desc": "Lists: 5. No unnecessary escapes",
		"wikitext": "* bar <span><nowiki>[[foo]]</nowiki></span>\n\n* =bar <span><nowiki>[[foo]]</nowiki></span>\n\n* [[bar <span><nowiki>[[foo]]</nowiki></span>\n\n* ]]bar <span><nowiki>[[foo]]</nowiki></span>\n\n* =bar <span>foo]]</span>=\n\n* <s></s>: a\n\n* ''* foo''",
		"parsed": "<list>*</> bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</> =bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</> <link-ground link-bracket>[[</><link-ground link-pagename pagename>bar </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</> ]]bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><list>*</> =bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>foo]]<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>=<list>*</> <htmltag-bracket>&lt;</><htmltag-name>s</><htmltag-bracket>&gt&lt;/</><htmltag-name>s</><htmltag-bracket>&gt</>: a<list>*</> <apostrophes>''</><em>* foo</><apostrophes>''</>"
	},
	{
		"desc": "Lists: 6. Escape bullets in SOL position",
		"wikitext": "<!--cmt--><nowiki>*</nowiki>foo",
		"parsed": "<comment>&lt;!--cmt--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>foo"
	},
	{
		"desc": "Lists: 7. Escape bullets in a multi-line context",
		"wikitext": "a\n<nowiki>*</nowiki>b",
		"parsed": "a<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>b"
	},
	{
		"desc": "Lists: 8. Escape colons only if not present in tags",
		"wikitext": "; <nowiki>a:b</nowiki>''c:d''",
		"parsed": "<list>;</><strong> </><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>a:b</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><strong em>c:d</><apostrophes>''</>"
	},
	{
		"desc": "HRs: 1. Single line",
		"wikitext": "----<nowiki>----</nowiki>\n----=foo=\n----*foo",
		"parsed": "<hr>----</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>----</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><hr>----</>=foo=<hr>----</>*foo"
	},
	{
		"desc": "Tables: 1a. Simple example",
		"wikitext": "<nowiki>{|</nowiki>\n|}",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>{|</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>|}"
	},
	{
		"desc": "Tables: 1b. No escaping needed",
		"wikitext": "!foo",
		"parsed": "!foo"
	},
	{
		"desc": "Tables: 1c. No escaping needed",
		"wikitext": "|foo",
		"parsed": "|foo"
	},
	{
		"desc": "Tables: 1d. No escaping needed",
		"wikitext": "|}foo",
		"parsed": "|}foo"
	},
	{
		"desc": "Tables: 2a. Nested in td",
		"wikitext": "{|\n|<nowiki>foo|bar</nowiki>\n|-\n|x<div><nowiki>a|b</nowiki></div>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo|bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>|-|</><table-td>x</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>a|b</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 2b. Nested in td",
		"wikitext": "{|\n|<nowiki>foo||bar</nowiki>\n|a''<nowiki>b||c</nowiki>''\n|a''<div><nowiki>b||c</nowiki></div>''\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo||bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>|</><table-td>a</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>b||c</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><table-delimiter>|</><table-td>a</><apostrophes>''</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>b||c</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><apostrophes>''</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 2c. Nested in td -- no escaping needed",
		"wikitext": "{|\n|foo!!bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo!!bar</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 3a. Nested in th",
		"wikitext": "{|\n!foo!bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>foo!bar</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 3b. Nested in th",
		"wikitext": "{|\n!<nowiki>foo!!bar</nowiki>\n!''<nowiki>foo|bar</nowiki>''\n!''<nowiki>foo!!bar</nowiki>''\n!''<span><nowiki>foo!!bar</nowiki></span>''\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo!!bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>!</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo|bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><table-delimiter>!</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo!!bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><table-delimiter>!</><apostrophes>''</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo!!bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>''</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 3c. Nested in th",
		"wikitext": "{|\n!<nowiki>foo||bar</nowiki>\n!<nowiki>foo||bar</nowiki>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo||bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-delimiter>!</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>foo||bar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 4a. Escape -",
		"wikitext": "{|\n!-bar\n|-\n| -bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>-bar</><table-delimiter>|-| </><table-td>-bar</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 4b. Escape +",
		"wikitext": "{|\n!+bar\n|-\n| +bar\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>!</><table-th>+bar</><table-delimiter>|-| </><table-td>+bar</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 4c. No escaping needed",
		"wikitext": "{|\n|foo-bar\n|foo+bar\n|-\n|''foo''-bar\n|''foo''+bar\n|-\n|foo\nbar|baz\n+bar\n-bar\n|-\n|x\n<div>a|b</div>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><table-td>foo-bar</><table-delimiter>|</><table-td>foo+bar</><table-delimiter>|-|</><apostrophes>''</><table-td em>foo</><apostrophes>''</><table-td>-bar</><table-delimiter>|</><apostrophes>''</><table-td em>foo</><apostrophes>''</><table-td>+bar</><table-delimiter>|-|</><table-td>foobar|baz+bar-bar</><table-delimiter>|-|</><table-td>x</><htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</><table-td>a|b</><htmltag-bracket>&lt;/</><htmltag-name>div</><htmltag-bracket>&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 4d. No escaping needed",
		"wikitext": "{|\n|[[Foo]]-bar\n||+1\n||-2\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>|</><link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-bracket>]]</><table-td>-bar</><table-delimiter>|</><table-delimiter2>|</><table-td>+1</><table-delimiter>|</><table-delimiter2>|</><table-td>-2</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 4e. Escape }",
		"wikitext": "{|\n| }\n|-\n|x||}\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><table-td>}</><table-delimiter>|-|</><table-td>x</><table-delimiter>||</><table-td>}</><table-bracket>|}</>"
	},
	{
		"desc": "Tables: 5. Empty table cells should get whitespace to avoid need for nowikis",
		"wikitext": "{|\n| || align=\"center\" | ||\n|}\n\n{|\n|\n| align=\"center\" |\n|\n|}\n\n{|\n| {{!}}{{!}} align=\"center\" | ||\n|}\n\n{|\n! !! align=\"center\" | !!\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| || </><html-td table-definition>align=\"center\" </><table-delimiter2>| </><table-delimiter>||</><table-bracket>|}{|</><table-delimiter>|| </><html-td table-definition>align=\"center\" </><table-delimiter2>|</><table-delimiter>|</><table-bracket>|}{|</><table-delimiter>| {{!}}{{!}} </><html-td table-definition>align=\"center\" </><table-delimiter2>| </><table-delimiter>||</><table-bracket>|}{|</><table-delimiter>! !! </><html-th table-definition>align=\"center\" </><table-delimiter2>| </><table-delimiter>!!</><table-bracket>|}</>"
	},
	{
		"desc": "T97430: Don't emit empty nowiki pairs around marker meta tags",
		"wikitext": "<nowiki>*</nowiki>This is a long sentence here that will make the nowiki algo split up the nowikis into multiple pairs\n|** Make this another long long long sentence forcing the nowiki algo to split up the nowikis.",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>This is a long sentence here that will make the nowiki algo split up the nowikis into multiple pairs|** Make this another long long long sentence forcing the nowiki algo to split up the nowikis."
	},
	{
		"desc": "Unclosed xmlish element in table line shouldn't eat end delimiters",
		"wikitext": "{|\n| <foo\n| bar>\n|}",
		"parsed": "<table-bracket>{|</><table-delimiter>| </><table-td>&lt;foo</><table-delimiter>| </><table-td>bar&gt</><table-bracket>|}</>"
	},
	{
		"desc": "Links 1. WikiLinks: No escapes needed",
		"wikitext": "[[Foo|Foo''boo'']]\n[[Foo|[Foobar]]]\n[[Foo|x [Foobar] x]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>Foo</><link-ground apostrophes>''</><link-ground link-text em>boo</><link-ground apostrophes>''</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>[Foobar]</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>x [Foobar] x</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Links 2. WikiLinks: Escapes needed",
		"wikitext": "[[Foo|<nowiki>Foobar]</nowiki>]]\n[[Foo|x <nowiki>[http://google.com g]</nowiki> x]]\n[[Foo|<nowiki>[[Bar]]</nowiki>]]\n[[Foo|<nowiki>x [[Bar]] x</nowiki>]]\n[[Foo||Bar]]\n[[Foo|<nowiki>]]bar</nowiki>]]\n[[Foo|<nowiki>[[bar</nowiki>]]\n[[Foo|<nowiki>x [[ y</nowiki>]]\n[[Foo|<nowiki>x ]] y</nowiki>]]\n[[Foo|<nowiki>x ]] y [[ z</nowiki>]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>Foobar]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>x </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[http://google.com g]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-text> x</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[[Bar]]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>x [[Bar]] x</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>|Bar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>]]bar</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[[bar</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>x [[ y</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>x ]] y</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>x ]] y [[ z</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Links 3. WikiLinks: No escapes needed",
		"wikitext": "[[Foo|[Foobar]]\n[[Foo|foo|bar]]",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>[Foobar</><link-ground link-bracket>]][[</><link-ground link-pagename pagename>Foo</><link-ground link-delimiter>|</><link-ground link-text>foo|bar</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "Links 4. ExtLinks: Escapes needed",
		"wikitext": "[http://google.com <nowiki>[google]</nowiki>]\n[http://google.com <nowiki>google]</nowiki>]\n[http://google.com <nowiki>goog] le</nowiki>]\n\n<nowiki>[http://google.com]</nowiki>\n\n<nowiki>[http://google.com google]</nowiki>\n\n[http://google.com<nowiki>]</nowiki>\n\n[{{1x|http://google.com}}<nowiki>]</nowiki>",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-text> </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>[google]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-text> </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>google]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground extlink-bracket>][</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-text> </><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>goog] le</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground extlink-bracket>]</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[http://google.com]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[http://google.com google]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</>[<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground template>http://google.com</><template-ground template-bracket>}}</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Links 5. ExtLinks: No escapes needed",
		"wikitext": "[http://google.com [google]\n\n[[http://google.com]]",
		"parsed": "<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-text> [google</><link-ground extlink-bracket>]</>[<link-ground extlink-bracket>[</><link-ground extlink-protocol>http://</><link-ground extlink>google.com</><link-ground extlink-bracket>]</>]"
	},
	{
		"desc": "Links 6. Add <nowiki/>s between text-nodes and url-links when required (T66300)",
		"wikitext": "x<nowiki/>http://example.com<nowiki/>y\nhttp://example.com<nowiki/>?x\nhttp://example.com<nowiki/>&x\nhttp://example.com<nowiki/>'x\nhttp://example.com<nowiki/>,x\nhttp://example.com<nowiki/>.x\nhttp://example.com<nowiki/>;x\nhttp://example.com<nowiki/>:x\nhttp://example.com<nowiki/>;x\nhttp://example.com<nowiki/>!x\nhttp://example.com<nowiki/>=x\nhttp://example.com<nowiki/>(x)\nhttp://example.com(x<nowiki/>)",
		"parsed": "x<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>http://example.com<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>y<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>?x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>&x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>'x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>,x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>.x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>;x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>:x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>;x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>!x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>=x<free-extlink-protocol>http://</><free-extlink>example.com</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>(x)<free-extlink-protocol>http://</><free-extlink>example.com(x</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>)"
	},
	{
		"desc": "Links 7a. Don't add spurious <nowiki/>s between text-nodes and url-links (T66300)",
		"wikitext": "x\nhttp://example.com\ny\n\"http://example.com\"\n(http://example.com)\n(http://example.com) foo\nhttp://example.com,\nhttp://example.com, foo",
		"parsed": "x<free-extlink-protocol>http://</><free-extlink>example.com</>y\"<free-extlink-protocol>http://</><free-extlink>example.com</>\"(<free-extlink-protocol>http://</><free-extlink>example.com</>)(<free-extlink-protocol>http://</><free-extlink>example.com</>) foo<free-extlink-protocol>http://</><free-extlink>example.com</>,<free-extlink-protocol>http://</><free-extlink>example.com</>, foo"
	},
	{
		"desc": "Links 7b. Don't add spurious <nowiki/>s between text-nodes and url-links (T66300)",
		"wikitext": "http://example.com.,;:!?\\\n-http://example.com:",
		"parsed": "<free-extlink-protocol>http://</><free-extlink>example.com</>.,;:!?\\-<free-extlink-protocol>http://</><free-extlink>example.com</>:"
	},
	{
		"desc": "Links 8. Add <nowiki/>s between text-nodes and RFC-links when required (T66300)",
		"wikitext": "RFC 123<nowiki/>4\nRFC 123<nowiki/>y\nX<nowiki/>RFC 123<nowiki/>y",
		"parsed": "<magic-link>RFC 123</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>4<magic-link>RFC 123</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>yX<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>RFC 123<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>y"
	},
	{
		"desc": "Links 9. Don't add spurious <nowiki/>s between text-nodes and RFC-links (T66300)",
		"wikitext": "RFC 123?foo\nRFC 123&foo\n-RFC 123-",
		"parsed": "<magic-link>RFC 123</>?foo<magic-link>RFC 123</>&foo-<magic-link>RFC 123</>-"
	},
	{
		"desc": "Links 10. Add <nowiki/>s between text-nodes and PMID-links when required (T66300)",
		"wikitext": "PMID 123<nowiki/>4\nPMID 123<nowiki/>y\nX<nowiki/>PMID 123<nowiki/>y",
		"parsed": "<magic-link>PMID 123</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>4<magic-link>PMID 123</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>yX<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>PMID 123<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>y"
	},
	{
		"desc": "Links 11. Don't add spurious <nowiki/>s between text-nodes and PMID-links (T66300)",
		"wikitext": "PMID 123?foo\nPMID 123&foo\n-PMID 123-",
		"parsed": "<magic-link>PMID 123</>?foo<magic-link>PMID 123</>&foo-<magic-link>PMID 123</>-"
	},
	{
		"desc": "Links 12. Add <nowiki/>s between text-nodes and ISBN-links when required (T66300)",
		"wikitext": "ISBN 1234567890<nowiki/>1\nISBN 1234567890<nowiki/>x\na<nowiki/>ISBN 1234567890<nowiki/>b",
		"parsed": "<magic-link>ISBN 1234567890</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>1<magic-link>ISBN 1234567890</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>xa<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>ISBN 1234567890<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>b"
	},
	{
		"desc": "Links 13. Don't add spurious <nowiki/>s between text-nodes and ISBN-links (T66300)",
		"wikitext": "-ISBN 1234567890's",
		"parsed": "-<magic-link>ISBN 1234567890</>'s"
	},
	{
		"desc": "Links 14. Protect link-like plain text. (Parsoid bug T78425)",
		"wikitext": "this is not a link: <nowiki>http://example.com</nowiki>",
		"parsed": "this is not a link: <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>http://example.com</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "1a. Quotes inside <b> and <i>",
		"wikitext": "''<nowiki/>'foo'''\n''<nowiki>''foo''</nowiki>''\n''<nowiki>'''foo'''</nowiki>''\n''foo''<nowiki/>'s\n'''<nowiki/>'foo''''\n'''<nowiki>''foo''</nowiki>'''\n'''<nowiki>'''foo'''</nowiki>'''\n'''foo'<nowiki/>''bar'<nowiki/>''baz'''\n'''foo'''<nowiki/>'s\n'''foo''\n''foo''<nowiki/>'\n''foo'''<nowiki/>'\n'''foo''<nowiki/>'\n''''foo'''\n'''foo'''<nowiki/>'\n''''foo'''<nowiki/>'\n''fools'<span> errand</span>''\n''<span>fool</span>'s errand''\n'<nowiki/>''foo'' bar '''baz''\na|!*#-:;+-~[]{}b'''x''",
		"parsed": "<apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><em>'foo'</><apostrophes>''''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''foo''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>'''foo'''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''''</><em>foo</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>'s<apostrophes>'''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><strong>'foo'</><apostrophes>''''''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>''foo''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''''''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>'''foo'''</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''''''</><strong>foo'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>''</><strong em>bar'</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>''</><strong>baz</><apostrophes>''''''</><strong>foo</><apostrophes>'''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>'s'<apostrophes>''</><em>foo</><apostrophes>''''</><em>foo</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>'<apostrophes>''</><em>foo'</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>''<apostrophes>''</><em>foo</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>''<apostrophes>'''</><strong>foo</><apostrophes>''''''</><strong>foo</><apostrophes>'''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>''<apostrophes>'''</><strong>foo</><apostrophes>'''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>'<apostrophes>''</><em>fools'</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><em> errand</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>''''</><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><em>fool</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><em>'s errand</><apostrophes>''</>'<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><apostrophes>''</><em>foo</><apostrophes>''</> bar '<apostrophes>''</><em>baz</><apostrophes>''</>a|!*#-:;+-~[]{}b'<apostrophes>''</><em>x</><apostrophes>''</>"
	},
	{
		"desc": "2. Link fragments separated by <i> and <b> tags",
		"wikitext": "[[''foo''<nowiki>hello]]</nowiki>\n\n[['''foo'''<nowiki>hello]]</nowiki>",
		"parsed": "<link-ground link-bracket>[[</><link-ground link-pagename pagename>''foo''</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>hello]]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>'''foo'''</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>hello]]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</>"
	},
	{
		"desc": "3. Link fragments inside <i> and <b>",
		"wikitext": "''[[foo''<nowiki>]]</nowiki>\n\n'''[[foo'''<nowiki>]]</nowiki>",
		"parsed": "<apostrophes>''</><link-ground link-bracket>[[</><link-ground link-pagename pagename em>foo''</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>]]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><apostrophes>'''</><link-ground link-bracket>[[</><link-ground link-pagename pagename strong>foo'''</><link-ground exttag-bracket>&lt;</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</><tag-nowiki>]]</><link-ground exttag-bracket>&lt;/</><link-ground exttag-name>nowiki</><link-ground exttag-bracket>&gt</>"
	},
	{
		"desc": "4. No escaping needed",
		"wikitext": "'<span>''bar''</span>'\n'<span>'''bar'''</span>'\n'a:b'foo",
		"parsed": "'<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>''</><em>bar</><apostrophes>''</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>''<htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><apostrophes>'''</><strong>bar</><apostrophes>'''</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>''a:b'foo"
	},
	{
		"desc": "1. No unnecessary escapes",
		"wikitext": "bar <span><nowiki>[[foo]]</nowiki></span>\n\n=bar <span><nowiki>[[foo]]</nowiki></span>\n\n[[bar <span><nowiki>[[foo]]</nowiki></span>\n\n]]bar <span><nowiki>[[foo]]</nowiki></span>\n\n=bar <span>foo]]</span><nowiki>=</nowiki>",
		"parsed": "bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>=bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><link-ground link-bracket>[[</><link-ground link-pagename pagename>bar </><link-ground htmltag-bracket>&lt;</><link-ground htmltag-name>span</><link-ground htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>]]bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>[[foo]]</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</>=bar <htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>foo]]<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>=</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "1. Leading whitespace in SOL context should be stripped",
		"wikitext": "a\n\na\n\n\ta(tab)\n\na\n<!--cmt-->\na\n\na\nb\n\na\n\tb\n\na\n\t b",
		"parsed": "aa\ta(tab)a<comment>&lt;!--cmt--&gt</>aaba\tba\t b"
	},
	{
		"desc": "3. Leading whitespace in indent-pre suppressing contexts should not be escaped",
		"wikitext": "<blockquote>\n a\n <span>b</span>\n c\n</blockquote>",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>blockquote</><htmltag-bracket>&gt</><skipformatting> </>a<skipformatting> </><htmltag-bracket>&lt;</><htmltag-name>span</><htmltag-bracket>&gt</>b<htmltag-bracket>&lt;/</><htmltag-name>span</><htmltag-bracket>&gt</><skipformatting> </>c<htmltag-bracket>&lt;/</><htmltag-name>blockquote</><htmltag-bracket>&gt</>"
	},
	{
		"desc": "4. Leading whitespace in indent-pre suppressing contexts should not be escaped",
		"wikitext": " [[File:Foobar.jpg|thumb|caption]]",
		"parsed": "<skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>File:Foobar.jpg</><link-ground link-delimiter>|</><link-ground image-parameter>thumb</><link-ground link-delimiter>|</><link-ground file-text>caption</><link-ground link-bracket>]]</>"
	},
	{
		"desc": "5. Nowiki escaping should account for indent-pres",
		"wikitext": " ==foo==",
		"parsed": "<skipformatting> </>==foo=="
	},
	{
		"desc": "T95794: nowiki escaping should account for leading space at start-of-line in an indent-pre block",
		"wikitext": " * foo\n * bar",
		"parsed": "<skipformatting> </>* foo<skipformatting> </>* bar"
	},
	{
		"desc": "Whitespace scrubbing in SOL position should account for SOL-sensitive wikitext markup",
		"wikitext": "foo\n\n%foo\n\n<nowiki/>*foo\n\n<nowiki/>#foo\n\n<nowiki/>=foo=\n\n[[Category:Foo]]\n<nowiki/>*foo\n\n [[Category:Foo]]\n<nowiki>*</nowiki>foo\n\n<nowiki/><!--boo-->*foo\n\n<!--boo--><nowiki/>*foo\n\n<!--a--><!--b--><!--c--><!--d--><!--e-->foo\n\n<!--a--><nowiki/><!--b--><!--c--><!--d--><!--e-->*foo",
		"parsed": "foo%foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>*foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>#foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>=foo=<link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>*foo<skipformatting> </><link-ground link-bracket>[[</><link-ground link-pagename pagename>Category:Foo</><link-ground link-bracket>]]</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>*</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>foo<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><comment>&lt;!--boo--&gt</>*foo<comment>&lt;!--boo--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</>*foo<comment>&lt;!--a--&gt&lt;!--b--&gt&lt;!--c--&gt&lt;!--d--&gt&lt;!--e--&gt</>foo<comment>&lt;!--a--&gt</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>/&gt</><comment>&lt;!--b--&gt&lt;!--c--&gt&lt;!--d--&gt&lt;!--e--&gt</>*foo"
	},
	{
		"desc": "1. Valid behavior switches should be escaped",
		"wikitext": "<nowiki>__TOC__</nowiki>\n''<nowiki>__TOC__</nowiki>''",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>__TOC__</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</><exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>__TOC__</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><apostrophes>''</>"
	},
	{
		"desc": "2. Invalid behavior switches should not be escaped",
		"wikitext": "__TOO__\n__|__",
		"parsed": "__TOO____|__"
	},
	{
		"desc": "Behavior switches should be SOL-transparent",
		"wikitext": " __TOC__\n\n <!-- this one's bogus -->\n __TOO__\n\n __TOC__ foo\n\n__TOC__\n bar",
		"parsed": "<skipformatting> </><double-underscore>__TOC__</><skipformatting> </><comment>&lt;!-- this one's bogus --&gt</><skipformatting> </>__TOO__<skipformatting> </><double-underscore>__TOC__</> foo<double-underscore>__TOC__</><skipformatting> </>bar"
	},
	{
		"desc": "During serialization, normalize output when given a SOL-transparent prefix",
		"wikitext": "x\n\n__NOTOC__y\n\n__NOTOC__z\n\n__notoc__p",
		"parsed": "x<double-underscore>__NOTOC__</>y<double-underscore>__NOTOC__</>z<double-underscore>__notoc__</>p"
	},
	{
		"desc": "1. a tags",
		"wikitext": "<a href=\"http://google.com\">google</a>",
		"parsed": "<a href=\"<free-extlink-protocol>http://</><free-extlink>google.com</>\">google</a>"
	},
	{
		"desc": "2. other tags",
		"wikitext": "* <nowiki><div>foo</div></nowiki>\n* <nowiki><div style=\"color:red\">foo</div></nowiki>\n* <nowiki><td></nowiki>",
		"parsed": "<list>*</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;div&gtfoo&lt;/div&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>*</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;div style=\"color:red\"&gtfoo&lt;/div&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</><list>*</> <exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;td&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "3. multi-line html tag",
		"wikitext": "<nowiki><div\n>foo</div\n></nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;div&gtfoo&lt;/div&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "4. extension tags",
		"wikitext": "<nowiki><ref>foo</ref></nowiki>\n\n<nowiki><ref>bar</nowiki>\n\nbaz<nowiki></ref></nowiki>",
		"parsed": "<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;ref&gtfoo&lt;/ref&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;ref&gtbar</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>baz<exttag-bracket>&lt;</><exttag-name>nowiki</><exttag-bracket>&gt</><tag-nowiki>&lt;/ref&gt</><exttag-bracket>&lt;/</><exttag-name>nowiki</><exttag-bracket>&gt</>"
	},
	{
		"desc": "Parsoid: newline inducing block nodes don't suppress <nowiki>",
		"wikitext": "a\n\n= foo =",
		"parsed": "a<section-header section--1>=</><section> foo </><section-header>=</>"
	},
	{
		"desc": "Escaping nowikis",
		"wikitext": "&lt;nowiki&gt;foo&lt;/nowiki&gt;",
		"parsed": "<entity>&amp;lt;</>nowiki<entity>&amp;gt;</>foo<entity>&amp;lt;</>/nowiki<entity>&amp;gt;</>"
	},
	{
		"desc": "(T54035) Nowiki-escaping should not get tripped by \" :\" in text",
		"wikitext": "foo's bar :",
		"parsed": "foo's bar :"
	},
	{
		"desc": "Ensure that when a leading-whitespace-containing string is emitted on a newline, it is correctly escaped",
		"wikitext": "<div>\nABC\n{{1x|\n{{{!}}\n{{!}} a\n{{!}}}}} b",
		"parsed": "<htmltag-bracket>&lt;</><htmltag-name>div</><htmltag-bracket>&gt</>ABC<template-ground template-bracket>{{</><template-ground template-name pagename>1x</><template-ground template-delimiter>|</><template-ground table-bracket>{{{!}}</><template-ground table-delimiter>{{!}} </><template-ground table-td>a</><template-ground table-bracket>{{!}}}</><template-ground template-bracket>}}</> b"
	}
]
